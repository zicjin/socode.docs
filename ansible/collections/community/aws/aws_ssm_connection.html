<section id="community-aws-aws-ssm-connection-execute-via-aws-systems-manager"> <h1>community.aws.aws_ssm connection – execute via AWS Systems Manager</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This connection plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/aws">community.aws collection</a> (version 3.4.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.aws</code>.</p> <p>To use it in a playbook, specify: <code>community.aws.aws_ssm</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>This connection plugin allows ansible to execute tasks on an EC2 instance via the aws ssm CLI.</li> </ul> </section> <section id="requirements"> <h2>Requirements</h2> <p>The below requirements are needed on the local controller node that executes this connection.</p> <ul class="simple"> <li>The remote EC2 instance must be running the AWS Systems Manager Agent (SSM Agent).</li> <li>The control machine must have the aws session manager plugin installed.</li> <li>The remote EC2 linux instance must have the curl installed.</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-access-key-id"><strong>access_key_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 1.3.0 of community.aws</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The STS access key to use when connecting via session-manager.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_access_key_id</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-bucket-name"><strong>bucket_name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The name of the S3 bucket used for file transfers.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_bucket_name</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-bucket-sse-kms-key-id"><strong>bucket_sse_kms_key_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 2.2.0 of community.aws</span></p> </div></td> <td><div class="ansible-option-cell">
<p>KMS key id to use when encrypting objects using <code>bucket_sse_mode=aws:kms</code>. Ignored otherwise.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_bucket_sse_kms_key_id</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-bucket-sse-mode"><strong>bucket_sse_mode</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 2.2.0 of community.aws</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Server-side encryption mode to use for uploads on the S3 bucket used for file transfer.</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li><span class="ansible-option-choices-entry">AES256</span></li> <li><span class="ansible-option-choices-entry">aws:kms</span></li> </ul> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_bucket_sse_mode</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-instance-id"><strong>instance_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The EC2 instance ID.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_instance_id</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-plugin"><strong>plugin</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>This defines the location of the session-manager-plugin binary.</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">“/usr/local/bin/session-manager-plugin”</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_plugin</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-profile"><strong>profile</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 1.5.0 of community.aws</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Sets AWS profile to use.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_profile</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-reconnection-retries"><strong>reconnection_retries</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Number of attempts to connect.</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">3</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_retries</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-region"><strong>region</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The region the EC2 instance is located.</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">“us-east-1”</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_region</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-secret-access-key"><strong>secret_access_key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 1.3.0 of community.aws</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The STS secret key to use when connecting via session-manager.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_secret_access_key</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-session-token"><strong>session_token</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 1.3.0 of community.aws</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The STS session token to use when connecting via session-manager.</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_session_token</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-aws-aws-ssm-connection-parameter-ssm-timeout"><strong>ssm_timeout</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">integer</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Connection timeout seconds.</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">60</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul class="simple"> <li>Variable: ansible_aws_ssm_timeout</li> </ul> </div></td> </tr>  </table> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja"># Stop Spooler Process on Windows Instances
- name: Stop Spooler Service on Windows Instances
  vars:
    ansible_connection: aws_ssm
    ansible_shell_type: powershell
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
    - name: Stop spooler service
      win_service:
        name: spooler
        state: stopped

# Install a Nginx Package on Linux Instance
- name: Install a Nginx Package
  vars:
    ansible_connection: aws_ssm
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-west-2
  tasks:
    - name: Install a Nginx Package
      yum:
        name: nginx
        state: present

# Create a directory in Windows Instances
- name: Create a directory in Windows Instance
  vars:
    ansible_connection: aws_ssm
    ansible_shell_type: powershell
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
    - name: Create a Directory
      win_file:
        path: C:\Windows\temp
        state: directory

# Making use of Dynamic Inventory Plugin
# =======================================
# aws_ec2.yml (Dynamic Inventory - Linux)
# This will return the Instance IDs matching the filter
#plugin: aws_ec2
#regions:
#    - us-east-1
#hostnames:
#    - instance-id
#filters:
#    tag:SSMTag: ssmlinux
# -----------------------
- name: install aws-cli
  hosts: all
  gather_facts: false
  vars:
    ansible_connection: aws_ssm
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
  - name: aws-cli
    raw: yum install -y awscli
    tags: aws-cli
# Execution: ansible-playbook linux.yaml -i aws_ec2.yml
# The playbook tasks will get executed on the instance ids returned from the dynamic inventory plugin using ssm connection.
# =====================================================
# aws_ec2.yml (Dynamic Inventory - Windows)
#plugin: aws_ec2
#regions:
#    - us-east-1
#hostnames:
#    - instance-id
#filters:
#    tag:SSMTag: ssmwindows
# -----------------------
- name: Create a dir.
  hosts: all
  gather_facts: false
  vars:
    ansible_connection: aws_ssm
    ansible_shell_type: powershell
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-east-1
  tasks:
    - name: Create the directory
      win_file:
        path: C:\Temp\SSM_Testing5
        state: directory
# Execution:  ansible-playbook win_file.yaml -i aws_ec2.yml
# The playbook tasks will get executed on the instance ids returned from the dynamic inventory plugin using ssm connection.

# Install a Nginx Package on Linux Instance; with specific SSE for file transfer
- name: Install a Nginx Package
  vars:
    ansible_connection: aws_ssm
    ansible_aws_ssm_bucket_name: nameofthebucket
    ansible_aws_ssm_region: us-west-2
    ansible_aws_ssm_bucket_sse_mode: 'aws:kms'
    ansible_aws_ssm_bucket_sse_kms_key_id: alias/kms-key-alias
  tasks:
    - name: Install a Nginx Package
      yum:
        name: nginx
        state: present
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Pat Sharkey (@psharkey)</li> <li>HanumanthaRao MVL (@hanumantharaomvl)</li> <li>Gaurav Ashtikar (@gau1991)</li> </ul> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> </section> <section id="collection-links"> <h3>Collection links</h3> <p class="ansible-links"> <a href="https://github.com/ansible-collections/community.aws/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc" aria-role="button" target="_blank" rel="noopener external">Issue Tracker</a> <a href="https://github.com/ansible-collections/community.aws" aria-role="button" target="_blank" rel="noopener external">Repository (Sources)</a> </p></section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/community/aws/aws_ssm_connection.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/community/aws/aws_ssm_connection.html</a>
  </p>
</div>
