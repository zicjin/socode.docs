<section id="community-general-machinectl-become-systemd-s-machinectl-privilege-escalation"> <h1>community.general.machinectl become – Systemd’s machinectl privilege escalation</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This become plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 5.4.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.machinectl</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id3">Notes</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>This become plugins allows your remote/login user to execute commands as another user via the machinectl utility.</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-machinectl-become-parameter-become-exe"><strong>become_exe</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Machinectl executable</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">“machinectl”</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul> <li>
<p>INI entries:</p> <pre data-language="YAML+Jinja">[privilege_escalation]
become_exe = machinectl
</pre> <pre data-language="YAML+Jinja">[machinectl_become_plugin]
executable = machinectl
</pre> </li> <li>Environment variable: ANSIBLE_BECOME_EXE</li> <li>Environment variable: ANSIBLE_MACHINECTL_EXE</li> <li>Variable: ansible_become_exe</li> <li>Variable: ansible_machinectl_exe</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-machinectl-become-parameter-become-flags"><strong>become_flags</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Options to pass to machinectl</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">“”</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul> <li>
<p>INI entries:</p> <pre data-language="YAML+Jinja">[privilege_escalation]
become_flags =
</pre> <pre data-language="YAML+Jinja">[machinectl_become_plugin]
flags =
</pre> </li> <li>Environment variable: ANSIBLE_BECOME_FLAGS</li> <li>Environment variable: ANSIBLE_MACHINECTL_FLAGS</li> <li>Variable: ansible_become_flags</li> <li>Variable: ansible_machinectl_flags</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-machinectl-become-parameter-become-pass"><strong>become_pass</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Password for machinectl</p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul> <li>
<p>INI entry:</p> <pre data-language="YAML+Jinja">[machinectl_become_plugin]
password = None
</pre> </li> <li>Environment variable: ANSIBLE_BECOME_PASS</li> <li>Environment variable: ANSIBLE_MACHINECTL_PASS</li> <li>Variable: ansible_become_password</li> <li>Variable: ansible_become_pass</li> <li>Variable: ansible_machinectl_pass</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-machinectl-become-parameter-become-user"><strong>become_user</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>User you ‘become’ to execute the task</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">“”</span></p> <p class="ansible-option-line"><span class="ansible-option-configuration">Configuration:</span></p> <ul> <li>
<p>INI entries:</p> <pre data-language="YAML+Jinja">[privilege_escalation]
become_user =
</pre> <pre data-language="YAML+Jinja">[machinectl_become_plugin]
user =
</pre> </li> <li>Environment variable: ANSIBLE_BECOME_USER</li> <li>Environment variable: ANSIBLE_MACHINECTL_USER</li> <li>Variable: ansible_become_user</li> <li>Variable: ansible_machinectl_user</li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>When not using this plugin with user <code>root</code>, it only works correctly with a polkit rule which will alter the behaviour of machinectl. This rule must alter the prompt behaviour to ask directly for the user credentials, if the user is allowed to perform the action (take a look at the examples section). If such a rule is not present the plugin only work if it is used in context with the root user, because then no further prompt will be shown by machinectl.</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja"># A polkit rule needed to use the module with a non-root user.
# See the Notes section for details.
60-machinectl-fast-user-auth.rules: |
    polkit.addRule(function(action, subject) {
        if(action.id == "org.freedesktop.machine1.host-shell" &amp;&amp; subject.isInGroup("wheel")) {
            return polkit.Result.AUTH_SELF_KEEP;
        }
    });
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Ansible Core Team</li> </ul> <div class="admonition hint"> <p class="admonition-title">Hint</p> <p>Configuration entries for each entry type have a low to high priority order. For example, a variable that is lower in the list will override a variable that is higher up.</p> </div> </section> <section id="collection-links"> <h3>Collection links</h3> <p class="ansible-links"> <a href="https://github.com/ansible-collections/community.general/issues" aria-role="button" target="_blank" rel="noopener external">Issue Tracker</a> <a href="https://github.com/ansible-collections/community.general" aria-role="button" target="_blank" rel="noopener external">Repository (Sources)</a> <a href="https://github.com/ansible-collections/community.general/issues/new?assignees=&amp;labels=&amp;template=bug_report.yml" aria-role="button" target="_blank" rel="noopener external">Submit a bug report</a> <a href="https://github.com/ansible-collections/community.general/issues/new?assignees=&amp;labels=&amp;template=feature_request.yml" aria-role="button" target="_blank" rel="noopener external">Request a feature</a> <a href="index#communication-for-community-general" aria-role="button" target="_blank">Communication</a> </p></section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/machinectl_become.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/community/general/machinectl_become.html</a>
  </p>
</div>
