<h1 id="community-general-dnf-versionlock-locks-package-versions-in-dnf-based-systems">community.general.dnf_versionlock – Locks package versions in dnf based systems</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 4.2.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.dnf_versionlock</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 4.0.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Locks package versions using the <code>versionlock</code> plugin in <code>dnf</code> based systems. This plugin takes a set of name and versions for packages and excludes all other versions of those packages. This allows you to for example protect packages from being updated by newer versions. The state of the plugin that reflects locking of packages is the <code>locklist</code>.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>dnf</li> <li>dnf-plugin-versionlock</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>[]</div> </td> <td> <div>Package name spec to add or exclude to or delete from the <code>locklist</code> using the format expected by the <code>dnf repoquery</code> command.</div> <div>This parameter is mutually exclusive with <em>state=clean</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>raw</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Do not resolve package name specs to NEVRAs to find specific version to lock to. Instead the package name specs are used as they are. This enables locking to not yet available versions of the package.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li>clean</li> <li>excluded</li> <li><div>
<b>present</b> ←</div></li> </ul> </td> <td> <div>Whether to add (<code>present</code> or <code>excluded</code>) to or remove (<code>absent</code> or <code>clean</code>) from the <code>locklist</code>.</div> <div>
<code>present</code> will add a package name spec to the <code>locklist</code>. If there is a installed package that matches, then only that version will be added. Otherwise, all available package versions will be added.</div> <div>
<code>excluded</code> will add a package name spec as excluded to the <code>locklist</code>. It means that packages represented by the package name spec will be excluded from transaction operations. All available package versions will be added.</div> <div>
<code>absent</code> will delete entries in the <code>locklist</code> that match the package name spec.</div> <div>
<code>clean</code> will delete all entries in the <code>locklist</code>. This option is mutually exclusive with <code>name</code>.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>The logics of the <code>versionlock</code> plugin for corner cases could be confusing, so please take in account that this module will do its best to give a <code>check_mode</code> prediction on what is going to happen. In case of doubt, check the documentation of the plugin.</li> <li>Sometimes the module could predict changes in <code>check_mode</code> that will not be such because <code>versionlock</code> concludes that there is already a entry in <code>locklist</code> that already matches.</li> <li>In an ideal world, the <code>versionlock</code> plugin would have a dry-run option to know for sure what is going to happen. So far we have to work with a best guess as close as possible to the behaviour inferred from its code.</li> <li>For most of cases where you want to lock and unlock specific versions of a package, this works fairly well.</li> <li>Supports <code>check_mode</code>.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Prevent installed nginx from being updated
  community.general.dnf_versionlock:
    name: nginx
    state: present

- name: Prevent multiple packages from being updated
  community.general.dnf_versionlock:
    name:
      - nginx
      - haproxy
    state: present

- name: Remove lock from nginx to be updated again
  community.general.dnf_versionlock:
    package: nginx
    state: absent

- name: Exclude bind 32:9.11 from installs or updates
  community.general.dnf_versionlock:
    package: bind-32:9.11*
    state: excluded

- name: Keep bash package in major version 4
  community.general.dnf_versionlock:
    name: bash-0:4.*
    raw: true
    state: present

- name: Delete all entries in the locklist of versionlock
  community.general.dnf_versionlock:
    state: clean
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>locklist_post</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>success and (not check mode or state is clean)</td> <td> <div>Locklist after module execution.</div> <br> <div><b>Sample:</b></div> <div>['bash-0:4.4.20-1.el8_4.*']</div> </td> </tr> <tr> <td colspan="1">  <b>locklist_pre</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>success</td> <td> <div>Locklist before module execution.</div> <br> <div><b>Sample:</b></div> <div>['bash-0:4.4.20-1.el8_4.*', '!bind-32:9.11.26-4.el8_4.*']</div> </td> </tr> <tr> <td colspan="1">  <b>specs_toadd</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>success</td> <td> <div>Package name specs meant to be added by versionlock.</div> <br> <div><b>Sample:</b></div> <div>['bash']</div> </td> </tr> <tr> <td colspan="1">  <b>specs_todelete</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>success</td> <td> <div>Package name specs meant to be deleted by versionlock.</div> <br> <div><b>Sample:</b></div> <div>['bind']</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Roberto Moreda (@moreda) &lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#c8a5a7baadaca9eeebfbfff3eeebfdfaf3eeebfcf0f3a9a4a4ada6bca9eeebfcfef3aba7a5">moreda<span>@</span>allenta<span>.</span>com</a>&gt;</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/dnf_versionlock_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/community/general/dnf_versionlock_module.html</a>
  </p>
</div>
