<section id="community-general-dnf-versionlock-module-locks-package-versions-in-dnf-based-systems"> <h1>community.general.dnf_versionlock module – Locks package versions in dnf based systems</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general collection</a> (version 5.4.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install community.general</code>.</p> <p>To use it in a playbook, specify: <code>community.general.dnf_versionlock</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 4.0.0: </span>of community.general</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Locks package versions using the <code>versionlock</code> plugin in <code>dnf</code> based systems. This plugin takes a set of name and versions for packages and excludes all other versions of those packages. This allows you to for example protect packages from being updated by newer versions. The state of the plugin that reflects locking of packages is the <code>locklist</code>.</li> </ul> </section> <section id="requirements"> <h2>Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>dnf</li> <li>dnf-plugin-versionlock</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-parameter-name"><strong>name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Package name spec to add or exclude to or delete from the <code>locklist</code> using the format expected by the <code>dnf repoquery</code> command.</p> <p>This parameter is mutually exclusive with <em>state=clean</em>.</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">[]</span></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-parameter-raw"><strong>raw</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Do not resolve package name specs to NEVRAs to find specific version to lock to. Instead the package name specs are used as they are. This enables locking to not yet available versions of the package.</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li>
<span class="ansible-option-default-bold">no</span> <span class="ansible-option-default">← (default)</span>
</li> <li><span class="ansible-option-choices-entry">yes</span></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Whether to add (<code>present</code> or <code>excluded</code>) to or remove (<code>absent</code> or <code>clean</code>) from the <code>locklist</code>.</p> <p><code>present</code> will add a package name spec to the <code>locklist</code>. If there is a installed package that matches, then only that version will be added. Otherwise, all available package versions will be added.</p> <p><code>excluded</code> will add a package name spec as excluded to the <code>locklist</code>. It means that packages represented by the package name spec will be excluded from transaction operations. All available package versions will be added.</p> <p><code>absent</code> will delete entries in the <code>locklist</code> that match the package name spec.</p> <p><code>clean</code> will delete all entries in the <code>locklist</code>. This option is mutually exclusive with <code>name</code>.</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li><span class="ansible-option-choices-entry">absent</span></li> <li><span class="ansible-option-choices-entry">clean</span></li> <li><span class="ansible-option-choices-entry">excluded</span></li> <li>
<span class="ansible-option-default-bold">present</span> <span class="ansible-option-default">← (default)</span>
</li> </ul> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>The logics of the <code>versionlock</code> plugin for corner cases could be confusing, so please take in account that this module will do its best to give a <code>check_mode</code> prediction on what is going to happen. In case of doubt, check the documentation of the plugin.</li> <li>Sometimes the module could predict changes in <code>check_mode</code> that will not be such because <code>versionlock</code> concludes that there is already a entry in <code>locklist</code> that already matches.</li> <li>In an ideal world, the <code>versionlock</code> plugin would have a dry-run option to know for sure what is going to happen. So far we have to work with a best guess as close as possible to the behaviour inferred from its code.</li> <li>For most of cases where you want to lock and unlock specific versions of a package, this works fairly well.</li> <li>Supports <code>check_mode</code>.</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Prevent installed nginx from being updated
  community.general.dnf_versionlock:
    name: nginx
    state: present

- name: Prevent multiple packages from being updated
  community.general.dnf_versionlock:
    name:
      - nginx
      - haproxy
    state: present

- name: Remove lock from nginx to be updated again
  community.general.dnf_versionlock:
    package: nginx
    state: absent

- name: Exclude bind 32:9.11 from installs or updates
  community.general.dnf_versionlock:
    package: bind-32:9.11*
    state: excluded

- name: Keep bash package in major version 4
  community.general.dnf_versionlock:
    name: bash-0:4.*
    raw: true
    state: present

- name: Delete all entries in the locklist of versionlock
  community.general.dnf_versionlock:
    state: clean
</pre> </section> <section id="return-values"> <h2>Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-return-locklist-post"><strong>locklist_post</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Locklist after module execution.</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> success and (not check mode or state is clean)</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> [“bash-0:4.4.20-1.el8_4.*”]</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-return-locklist-pre"><strong>locklist_pre</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Locklist before module execution.</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> success</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> [“bash-0:4.4.20-1.el8_4.*”, “!bind-32:9.11.26-4.el8_4.*”]</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-return-specs-toadd"><strong>specs_toadd</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Package name specs meant to be added by versionlock.</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> success</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> [“bash”]</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-community-general-dnf-versionlock-module-return-specs-todelete"><strong>specs_todelete</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Package name specs meant to be deleted by versionlock.</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> success</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> [“bind”]</p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Roberto Moreda (@moreda)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <p class="ansible-links"> <a href="https://github.com/ansible-collections/community.general/issues" aria-role="button" target="_blank" rel="noopener external">Issue Tracker</a> <a href="https://github.com/ansible-collections/community.general" aria-role="button" target="_blank" rel="noopener external">Repository (Sources)</a> <a href="https://github.com/ansible-collections/community.general/issues/new?assignees=&amp;labels=&amp;template=bug_report.yml" aria-role="button" target="_blank" rel="noopener external">Submit a bug report</a> <a href="https://github.com/ansible-collections/community.general/issues/new?assignees=&amp;labels=&amp;template=feature_request.yml" aria-role="button" target="_blank" rel="noopener external">Request a feature</a> <a href="index#communication-for-community-general" aria-role="button" target="_blank">Communication</a> </p></section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/community/general/dnf_versionlock_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/community/general/dnf_versionlock_module.html</a>
  </p>
</div>
