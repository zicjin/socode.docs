<section id="ansible-builtin-known-hosts-module-add-or-remove-a-host-from-the-known-hosts-file"> <h1>ansible.builtin.known_hosts module – Add or remove a host from the known_hosts file</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of <code>ansible-core</code> and included in all Ansible installations. In most cases, you can use the short module name <code>known_hosts</code> even without specifying the <code>collections:</code> keyword. However, we recommend you use the FQCN for easy linking to the module documentation and to avoid conflicting with other collections that may have the same module name.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.9: </span>of ansible.builtin</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id3">Attributes</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>The <code>known_hosts</code> module lets you add or remove a host keys from the <code>known_hosts</code> file.</li> <li>Starting at Ansible 2.2, multiple entries per host are allowed, but only one for each key type supported by ssh. This is useful if you’re going to want to use the <a class="reference internal" href="git_module#ansible-collections-ansible-builtin-git-module"><span class="std std-ref">ansible.builtin.git</span></a> module over ssh, for example.</li> <li>If you have a very large number of host keys to manage, you will find the <a class="reference internal" href="template_module#ansible-collections-ansible-builtin-template-module"><span class="std std-ref">ansible.builtin.template</span></a> module more useful.</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-parameter-hash-host"><strong>hash_host</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> <p><span class="ansible-option-versionadded">added in 2.3 of ansible.builtin</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Hash the hostname in the known_hosts file.</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li>
<span class="ansible-option-default-bold">no</span> <span class="ansible-option-default">← (default)</span>
</li> <li><span class="ansible-option-choices-entry">yes</span></li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-parameter-key"><strong>key</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The SSH public host key, as a string.</p> <p>Required if <code>state=present</code>, optional when <code>state=absent</code>, in which case all keys for the host are removed.</p> <p>The key must be in the right format for SSH (see sshd(8), section “SSH_KNOWN_HOSTS FILE FORMAT”).</p> <p>Specifically, the key should not match the format that is found in an SSH pubkey file, but should rather have the hostname prepended to a line that includes the pubkey, the same way that it would appear in the known_hosts file. The value prepended to the line must also match the value of the name parameter.</p> <p>Should be of format <code>&lt;hostname[,IP]&gt; ssh-rsa &lt;pubkey&gt;</code>.</p> <p>For custom SSH port, <code>key</code> needs to specify port as well. See example section.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell">  
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-parameter-host"><strong id="ansible-collections-ansible-builtin-known-hosts-module-parameter-name">name</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-aliases">aliases: host</span></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span> / <span class="ansible-option-required">required</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The host to add or remove (must match a host specified in key). It will be converted to lowercase so that ssh-keygen can find it.</p> <p>Must match with &lt;hostname&gt; or &lt;ip&gt; present in key attribute.</p> <p>For custom SSH port, <code>name</code> needs to specify port as well. See example section.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-parameter-path"><strong>path</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The known_hosts file to edit.</p> <p>The known_hosts file will be created if needed. The rest of the path must exist prior to running the module.</p> <p class="ansible-option-line"><span class="ansible-option-default-bold">Default:</span> <span class="ansible-option-default">“~/.ssh/known_hosts”</span></p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p><em>present</em> to add the host key.</p> <p><em>absent</em> to remove it.</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li><span class="ansible-option-choices-entry">absent</span></li> <li>
<span class="ansible-option-default-bold">present</span> <span class="ansible-option-default">← (default)</span>
</li> </ul> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><span class="ansible-attribute-support-label">Support: </span><span class="ansible-attribute-support-full">full</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in check_mode and return changed status prediction without modifying target</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-attribute-diff-mode"><strong>diff_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><span class="ansible-attribute-support-label">Support: </span><span class="ansible-attribute-support-full">full</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Will return details on what has changed (or possibly needs changing in check_mode), when in diff mode</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-known-hosts-module-attribute-platform"><strong>platform</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><span class="ansible-attribute-support-property">Platform:</span> <span class="ansible-attribute-support-full">posix</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Target OS/families that can be operated against</p> </div></td> </tr>  </table> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: Tell the host about our servers it might want to ssh to
  ansible.builtin.known_hosts:
    path: /etc/ssh/ssh_known_hosts
    name: foo.com.invalid
    key: "{{ lookup('ansible.builtin.file', 'pubkeys/foo.com.invalid') }}"

- name: Another way to call known_hosts
  ansible.builtin.known_hosts:
    name: host1.example.com   # or 10.9.8.77
    key: host1.example.com,10.9.8.77 ssh-rsa ASDeararAIUHI324324  # some key gibberish
    path: /etc/ssh/ssh_known_hosts
    state: present

- name: Add host with custom SSH port
  ansible.builtin.known_hosts:
    name: '[host1.example.com]:2222'
    key: '[host1.example.com]:2222 ssh-rsa ASDeararAIUHI324324' # some key gibberish
    path: /etc/ssh/ssh_known_hosts
    state: present
</pre> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Matthew Vernon (@mcv21)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <p class="ansible-links"> <a href="https://github.com/ansible/ansible/issues" aria-role="button" target="_blank" rel="noopener external">Issue Tracker</a> <a href="https://github.com/ansible/ansible" aria-role="button" target="_blank" rel="noopener external">Repository (Sources)</a> <a href="index#communication-for-ansible-builtin" aria-role="button" target="_blank">Communication</a> </p></section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/known_hosts_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/known_hosts_module.html</a>
  </p>
</div>
