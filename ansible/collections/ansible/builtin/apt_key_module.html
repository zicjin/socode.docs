<section id="ansible-builtin-apt-key-module-add-or-remove-an-apt-key"> <h1>ansible.builtin.apt_key module – Add or remove an apt key</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of <code>ansible-core</code> and included in all Ansible installations. In most cases, you can use the short module name <code>apt_key</code> even without specifying the <code>collections:</code> keyword. However, we recommend you use the FQCN for easy linking to the module documentation and to avoid conflicting with other collections that may have the same module name.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0: </span>of ansible.builtin</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#attributes" id="id4">Attributes</a></li> <li><a class="reference internal" href="#notes" id="id5">Notes</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> </ul>  <section id="synopsis"> <h2>Synopsis</h2> <ul class="simple"> <li>Add or remove an <em>apt</em> key, optionally downloading it.</li> </ul> </section> <section id="requirements"> <h2>Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>gpg</li> </ul> </section> <section id="parameters"> <h2>Parameters</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Comments</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-data"><strong>data</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The keyfile contents to add to the keyring.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-file"><strong>file</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The path to a keyfile on the remote server to add to the keyring.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-id"><strong>id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The identifier of the key.</p> <p>Including this allows check mode to correctly report the changed state.</p> <p>If specifying a subkey’s id be aware that apt-key does not understand how to remove keys via a subkey id. Specify the primary key’s id instead.</p> <p>This parameter is required when <code>state</code> is set to <code>absent</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-keyring"><strong>keyring</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">path</span></p> <p><span class="ansible-option-versionadded">added in 1.3 of ansible.builtin</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The full path to specific keyring file in <code>/etc/apt/trusted.gpg.d/</code>.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-keyserver"><strong>keyserver</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> <p><span class="ansible-option-versionadded">added in 1.6 of ansible.builtin</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The keyserver to retrieve key from.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-state"><strong>state</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Ensures that the key is present (added) or absent (revoked).</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li><span class="ansible-option-choices-entry">absent</span></li> <li>
<span class="ansible-option-default-bold">present</span> <span class="ansible-option-default">← (default)</span>
</li> </ul> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-url"><strong>url</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>The URL to retrieve key from.</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-parameter-validate-certs"><strong>validate_certs</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">boolean</span></p> </div></td> <td><div class="ansible-option-cell">
<p>If <code>no</code>, SSL certificates for the target url will not be validated. This should only be used on personally controlled sites using self-signed certificates.</p> <p class="ansible-option-line"><span class="ansible-option-choices">Choices:</span></p> <ul class="simple"> <li><span class="ansible-option-choices-entry">no</span></li> <li>
<span class="ansible-option-default-bold">yes</span> <span class="ansible-option-default">← (default)</span>
</li> </ul> </div></td> </tr>  </table> </section> <section id="attributes"> <h2>Attributes</h2> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Attribute</p></th> <th class="head"><p>Support</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-attribute-check-mode"><strong>check_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><span class="ansible-attribute-support-label">Support: </span><span class="ansible-attribute-support-full">full</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Can run in check_mode and return changed status prediction without modifying target</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-attribute-diff-mode"><strong>diff_mode</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><span class="ansible-attribute-support-label">Support: </span><span class="ansible-attribute-support-none">none</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Will return details on what has changed (or possibly needs changing in check_mode), when in diff mode</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-attribute-platform"><strong>platform</strong></p> 
</div></td> <td><div class="ansible-option-cell">
<p><span class="ansible-attribute-support-property">Platform:</span> <span class="ansible-attribute-support-full">debian</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Target OS/families that can be operated against</p> </div></td> </tr>  </table> </section> <section id="notes"> <h2>Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>The apt-key command has been deprecated and suggests to ‘manage keyring files in trusted.gpg.d instead’. See the Debian wiki for details. This module is kept for backwards compatiblity for systems that still use apt-key as the main way to manage apt repository keys.</li> <li>As a sanity check, downloaded key id must match the one specified.</li> <li>Use full fingerprint (40 characters) key ids to avoid key collisions. To generate a full-fingerprint imported key: <code>apt-key adv --list-public-keys --with-fingerprint --with-colons</code>.</li> <li>If you specify both the key id and the URL with <code>state=present</code>, the task can verify or add the key as needed.</li> <li>Adding a new key requires an apt cache update (e.g. using the <a class="reference internal" href="apt_module#ansible-collections-ansible-builtin-apt-module"><span class="std std-ref">ansible.builtin.apt</span></a> module’s update_cache option).</li> </ul> </div> </section> <section id="examples"> <h2>Examples</h2> <pre data-language="yaml+jinja">- name: One way to avoid apt_key once it is removed from your distro
  block:
    - name: somerepo |no apt key
      ansible.builtin.get_url:
        url: https://download.example.com/linux/ubuntu/gpg
        dest: /etc/apt/trusted.gpg.d/somerepo.asc

    - name: somerepo | apt source
      ansible.builtin.apt_repository:
      repo: "deb [arch=amd64 signed-by=/etc/apt/trusted.gpg.d/somerepo.asc] https://download.example.com/linux/ubuntu {{ ansible_distribution_release }} stable"
      state: present

- name: Add an apt key by id from a keyserver
  ansible.builtin.apt_key:
    keyserver: keyserver.ubuntu.com
    id: 36A1D7869245C8950F966E92D8576A8BA88D21E9

- name: Add an Apt signing key, uses whichever key is at the URL
  ansible.builtin.apt_key:
    url: https://ftp-master.debian.org/keys/archive-key-6.0.asc
    state: present

- name: Add an Apt signing key, will not download if present
  ansible.builtin.apt_key:
    id: 9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    url: https://ftp-master.debian.org/keys/archive-key-6.0.asc
    state: present

- name: Remove a Apt specific signing key, leading 0x is valid
  ansible.builtin.apt_key:
    id: 0x9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    state: absent

# Use armored file since utf-8 string is expected. Must be of "PGP PUBLIC KEY BLOCK" type.
- name: Add a key from a file on the Ansible server
  ansible.builtin.apt_key:
    data: "{{ lookup('ansible.builtin.file', 'apt.asc') }}"
    state: present

- name: Add an Apt signing key to a specific keyring file
  ansible.builtin.apt_key:
    id: 9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    url: https://ftp-master.debian.org/keys/archive-key-6.0.asc
    keyring: /etc/apt/trusted.gpg.d/debian.gpg

- name: Add Apt signing key on remote server to keyring
  ansible.builtin.apt_key:
    id: 9FED2BCBDCD29CDF762678CBAED4B06F473041FA
    file: /tmp/apt.gpg
    state: present
</pre> </section> <section id="return-values"> <h2>Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="colwidths-auto ansible-option-table docutils align-default" style="width: 100%"> <thead> <tr>
<th class="head"><p>Key</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-return-after"><strong>after</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>List of apt key ids or fingerprints after any modification</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> on change</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> [“D8576A8BA88D21E9”, “3B4FE6ACC0B21F32”, “D94AA3F0EFE21092”, “871920D1991BC93C”]</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-return-before"><strong>before</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">list</span> / <span class="ansible-option-elements">elements=string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>List of apt key ids or fingprints before any modifications</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> always</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> [“3B4FE6ACC0B21F32”, “D94AA3F0EFE21092”, “871920D1991BC93C”]</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-return-fp"><strong>fp</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>Fingerprint of the key to import</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> always</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> “D8576A8BA88D21E9”</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-return-id"><strong>id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>key id from source</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> always</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> “36A1D7869245C8950F966E92D8576A8BA88D21E9”</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-return-key-id"><strong>key_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>calculated key id, it should be same as ‘id’, but can be different</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> always</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> “36A1D7869245C8950F966E92D8576A8BA88D21E9”</p> </div></td> </tr> <tr>
<td><div class="ansible-option-cell"> 
<p class="ansible-option-title" id="ansible-collections-ansible-builtin-apt-key-module-return-short-id"><strong>short_id</strong></p> <p class="ansible-option-type-line"><span class="ansible-option-type">string</span></p> </div></td> <td><div class="ansible-option-cell">
<p>caclulated short key id</p> <p class="ansible-option-line"><span class="ansible-option-returned-bold">Returned:</span> always</p> <p class="ansible-option-line ansible-option-sample"><span class="ansible-option-sample-bold">Sample:</span> “A88D21E9”</p> </div></td> </tr>  </table> <section id="authors"> <h3>Authors</h3> <ul class="simple"> <li>Jayson Vantuyl (@jvantuyl)</li> </ul> </section> <section id="collection-links"> <h3>Collection links</h3> <p class="ansible-links"> <a href="https://github.com/ansible/ansible/issues" aria-role="button" target="_blank" rel="noopener external">Issue Tracker</a> <a href="https://github.com/ansible/ansible" aria-role="button" target="_blank" rel="noopener external">Repository (Sources)</a> <a href="index#communication-for-ansible-builtin" aria-role="button" target="_blank">Communication</a> </p></section> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_key_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_key_module.html</a>
  </p>
</div>
