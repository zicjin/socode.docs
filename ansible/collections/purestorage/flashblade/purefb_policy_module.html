<h1 id="purestorage-flashblade-purefb-policy-manage-flashblade-policies">purestorage.flashblade.purefb_policy – Manage FlashBlade policies</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/purestorage/flashblade">purestorage.flashblade collection</a> (version 1.9.0).</p> <p>You might already have this collection installed if you are using the <code>ansible</code> package. It is not included in <code>ansible-core</code>. To check whether it is installed, run <code>ansible-galaxy collection list</code>.</p> <p>To install it, use: <code>ansible-galaxy collection install purestorage.flashblade</code>.</p> <p>To use it in a playbook, specify: <code>purestorage.flashblade.purefb_policy</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0.0: </span>of purestorage.flashblade</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Manage policies for filesystem, file replica links and object store access</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>python &gt;= 2.7</li> <li>purity_fb &gt;= 1.9</li> <li>netaddr</li> <li>pytz</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>access</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>root-squash</b> ←</div></li> <li>all-squash</li> <li>no-squash</li> </ul> </td> <td> <div>Specifies access control for the export policy rule</div> </td> </tr> <tr> <td colspan="1">  <b>account</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>Name of Object Store account policy applies to.</div> <div>
<b>Special Case</b> <em>pure:policy</em> is used for the system-wide S3 policies</div> </td> </tr> <tr> <td colspan="1">  <b>actions</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li>s3:*</li> <li>s3:AbortMultipartUpload</li> <li>s3:CreateBucket</li> <li>s3:DeleteBucket</li> <li>s3:DeleteObject</li> <li>s3:DeleteObjectVersion</li> <li>s3:ExtendSafemodeRetentionPeriod</li> <li>s3:GetBucketAcl</li> <li>s3:GetBucketLocation</li> <li>s3:GetBucketVersioning</li> <li>s3:GetLifecycleConfiguration</li> <li>s3:GetObject</li> <li>s3:GetObjectAcl</li> <li>s3:GetObjectVersion</li> <li>s3:ListAllMyBuckets</li> <li>s3:ListBucket</li> <li>s3:ListBucketMultipartUploads</li> <li>s3:ListBucketVersions</li> <li>s3:ListMultipartUploadParts</li> <li>s3:PutBucketVersioning</li> <li>s3:PutLifecycleConfiguration</li> <li>s3:PutObject</li> </ul> </td> <td> <div>List of permissions to grant.</div> <div>System-wide policy rules cannot be deleted or modified</div> </td> </tr> <tr> <td colspan="1">  <b>anongid</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>Any user whose GID is affected by an <em>access</em> of `root_squash` or `all_squash` will have their GID mapped to anongid. The default anongid is null, which means 65534. Use "" to clear.</div> </td> </tr> <tr> <td colspan="1">  <b>anonuid</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>Any user whose UID is affected by an <em>access</em> of `root_squash` or `all_squash` will have their UID mapped to anonuid. The defaultis null, which means 65534. Use "" to clear.</div> </td> </tr> <tr> <td colspan="1">  <b>api_token</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>FlashBlade API token for admin privileged user.</div> </td> </tr> <tr> <td colspan="1">  <b>at</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Provide a time in 12-hour AM/PM format, eg. 11AM</div> </td> </tr> <tr> <td colspan="1">  <b>atime</b>  <div> <span>boolean</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>After a read operation has occurred, the inode access time is updated only if any of the following conditions is true; the previous access time is less than the inode modify time, the previous access time is less than the inode change time, or the previous access time is more than 24 hours ago.</div> <div>If set to false, disables the update of inode access times after read operations.</div> </td> </tr> <tr> <td colspan="1">  <b>before_rule</b>  <div> <span>integer</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>The index of the client rule to insert or move a client rule before.</div> </td> </tr> <tr> <td colspan="1">  <b>client</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <b>Default:</b><br><div>"*"</div> </td> <td> <div>Specifies the clients that will be permitted to access the export.</div> <div>Accepted notation is a single IP address, subnet in CIDR notation, netgroup, or anonymous (*).</div> </td> </tr> <tr> <td colspan="1">  <b>effect</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>allow</b> ←</div></li> </ul> </td> <td> <div>Allow S3 requests that match all of the <em>actions</em> item selected. Rules are additive.</div> </td> </tr> <tr> <td colspan="1">  <b>enabled</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>State of policy</div> </td> </tr> <tr> <td colspan="1">  <b>every</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Interval between snapshots in seconds</div> <div>Range available 300 - 31536000 (equates to 5m to 365d)</div> </td> </tr> <tr> <td colspan="1">  <b>fb_url</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>FlashBlade management IP address or Hostname.</div> </td> </tr> <tr> <td colspan="1">  <b>fileid_32bit</b>  <div> <span>boolean</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Whether the file id is 32 bits or not.</div> </td> </tr> <tr> <td colspan="1">  <b>filesystem</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>List of filesystems to add to a policy on creation</div> <div>To amend policy members use the <em>purefb_fs</em> module</div> </td> </tr> <tr> <td colspan="1">  <b>force_delete</b>  <div> <span>boolean</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Force the deletion of a Object Store Access Policy is this has attached users.</div> <div>WARNING This can have undesired side-effects.</div> <div>System-wide policies cannot be deleted</div> </td> </tr> <tr> <td colspan="1">  <b>ignore_enforcement</b>  <div> <span>boolean</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Certain combinations of actions and other rule elements are inherently ignored if specified together in a rule.</div> <div>If set to true, operations which attempt to set these combinations will fail.</div> <div>If set to false, such operations will instead be allowed.</div> </td> </tr> <tr> <td colspan="1">  <b>keep_for</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>How long to keep snapshots for</div> <div>Range available 300 - 31536000 (equates to 5m to 365d)</div> <div>Must not be set less than <em>every</em>
</div> </td> </tr> <tr> <td colspan="1">  <b>name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Name of the policy</div> </td> </tr> <tr> <td colspan="1">  <b>object_resources</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>List of bucket names and object paths, with a wildcard (*) to specify objects in a bucket; e.g., bucket1, bucket1/*, bucket2, bucket2/*.</div> <div>System-wide policy rules cannot be deleted or modified</div> </td> </tr> <tr> <td colspan="1">  <b>permission</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li>rw</li> <li><div>
<b>ro</b> ←</div></li> </ul> </td> <td> <div>Specifies which read-write client access permissions are allowed for the export.</div> </td> </tr> <tr> <td colspan="1">  <b>policy_type</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>snapshot</b> ←</div></li> <li>access</li> <li>nfs</li> </ul> </td> <td> <div>Type of policy</div> </td> </tr> <tr> <td colspan="1">  <b>replica_link</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>List of filesystem replica links to add to a policy on creation</div> <div>To amend policy members use the <em>purefb_fs_replica</em> module</div> </td> </tr> <tr> <td colspan="1">  <b>rule</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>Name of the rule for the Object Store Access Policy</div> <div>Rules in system-wide policies cannot be deleted or modified</div> </td> </tr> <tr> <td colspan="1">  <b>s3_delimiters</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>List of delimiter characters allowed in object list requests.</div> <div>Grants permissions to list 'folder names' (prefixes ending in a delimiter) instead of object keys.</div> <div>System-wide policy rules cannot be deleted or modified</div> </td> </tr> <tr> <td colspan="1">  <b>s3_prefixes</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>List of 'folders' (object key prefixes) for which object listings may be requested.</div> <div>System-wide policy rules cannot be deleted or modified</div> </td> </tr> <tr> <td colspan="1">  <b>secure</b>  <div> <span>boolean</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If true, this prevents NFS access to client connections coming from non-reserved ports.</div> <div>If false, allows NFS access to client connections coming from non-reserved ports.</div> <div>Applies to NFSv3, NFSv4.1, and auxiliary protocols MOUNT and NLM.</div> </td> </tr> <tr> <td colspan="1">  <b>security</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>sys</b> ←</div></li> <li>krb5</li> <li>krb5i</li> <li>krb5p</li> </ul> </td> <td> <div>The security flavors to use for accessing files on this mount point.</div> <div>If the server does not support the requested flavor, the mount operation fails.</div> <div>
<em>sys</em> trusts the client to specify users identity.</div> <div>
<em>krb</em> provides cryptographic proof of a users identity in each RPC request.</div> <div>
<em>krb5i</em> adds integrity checking to krb5, to ensure the data has not been tampered with.</div> <div>
<em>krb5p</em> adds integrity checking and encryption to krb5.</div> </td> </tr> <tr> <td colspan="1">  <b>source_ips</b>  <div> <span>list</span> / <span>elements=string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>List of IPs and subnets from which this rule should allow requests; e.g., 10.20.30.40, 10.20.30.0/24, 2001:DB8:1234:5678::/64.</div> <div>System-wide policy rules cannot be deleted or modified</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div>
<b>present</b> ←</div></li> <li>copy</li> </ul> </td> <td> <div>Create or delete policy.</div> <div>Copy is applicable only to Object Store Access Policies Rules</div> </td> </tr> <tr> <td colspan="1">  <b>target</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>Name of policy to copy rule to</div> </td> </tr> <tr> <td colspan="1">  <b>target_rule</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>Name of the rule to copy the exisitng rule to.</div> <div>If not defined the existing rule name is used.</div> </td> </tr> <tr> <td colspan="1">  <b>timezone</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Time Zone used for the <em>at</em> parameter</div> <div>If not provided, the module will attempt to get the current local timezone from the server</div> </td> </tr> <tr> <td colspan="1">  <b>user</b>  <div> <span>string</span> </div> <div> added in 1.9.0 of purestorage.flashblade </div> </td> <td> </td> <td> <div>User in the <em>account</em> that the policy is granted to.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>This module requires the <code>purity_fb</code> Python library</li> <li>You must set <code>PUREFB_URL</code> and <code>PUREFB_API</code> environment variables if <em>fb_url</em> and <em>api_token</em> arguments are not passed to the module directly</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create a simple snapshot policy with no rules
  purefb_policy:
    name: test_policy
    policy_type: snapshot
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create a snapshot policy and connect to existing filesystems and filesystem replica links
  purefb_policy:
    name: test_policy_with_members
    policy_type: snapshot
    filesystem:
    - fs1
    - fs2
    replica_link:
    - rl1
    - rl2
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create a snapshot policy with rules
  purefb_policy:
    name: test_policy2
    policy_type: snapshot
    at: 11AM
    keep_for: 86400
    every: 86400
    timezone: Asia/Shanghai
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete a snapshot policy
  purefb_policy:
    name: test_policy
    policy_type: snapshot
    state: absent
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create an empty object store access policy
  purefb_policy:
    name: test_os_policy
    account: test
    policy_type: access
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create an empty object store access policy and assign user
  purefb_policy:
    name: test_os_policy
    account: test
    policy_type: access
    user: fred
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create a object store access policy with simple rule
  purefb_policy:
    name: test_os_policy_rule
    policy_type: access
    account: test
    rule: rule1
    actions: "s3:*"
    object_resources: "*"
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create an empty NFS export policy
  purefb_policy:
    name: test_nfs_export
    policy_type: nfs
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create an NFS export policy with a client rule
  purefb_policy:
    name: test_nfs_export
    policy_type: nfs
    atime: true
    client: "10.0.1.0/24"
    secure: true
    security: [sys, krb5]
    permission: rw
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Create a new rule for an existing NFS export policy
  purefb_policy:
    name: test_nfs_export
    policy_type: nfs
    atime: true
    client: "10.0.2.0/24"
    security: sys
    permission: ro
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete a client rule from an NFS export policy
  purefb_policy:
    name: test_nfs_export
    client: "10.0.1.0/24"
    policy_type: nfs
    state: absent
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete an NFS export policy and all associated rules
  purefb_policy:
    name: test_nfs_export
    state: absent
    policy_type: nfs
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete a rule from an object store access policy
  purefb_policy:
    name: test_os_policy_rule
    account: test
    policy_type: access
    rule: rule1
    state: absent
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete a user from an object store access policy
  purefb_policy:
    name: test_os_policy_rule
    account: test
    user: fred
    policy_type: access
    state: absent
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete an object store access policy with attached users (USE WITH CAUTION)
  purefb_policy:
    name: test_os_policy_rule
    account: test
    policy_type: access
    force_delete: true
    state: absent
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Delete an object store access policy with no attached users
  purefb_policy:
    name: test_os_policy_rule
    account: test
    policy_type: access
    state: absent
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
- name: Copy an object store access policy rule to another exisitng policy
  purefb_policy:
    name: test_os_policy_rule
    policy_type: access
    account: test
    target: "account2/anotherpolicy"
    target_rule: new_rule1
    state: copy
    fb_url: 10.10.10.2
    api_token: T-9f276a18-50ab-446e-8a0c-666a3529a1b6
</pre>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>Pure Storage Ansible Team (@sdodsley) &lt;<a class="reference external" href="https://docs.ansible.com/cdn-cgi/l/email-protection#a2d2d7d0c78fc3ccd1cbc0cec78fd6c7c3cf848191959984819790998481969a99d2d7d0c7d1d6cdd0c3c5c78481969499c1cdcf">pure-ansible-team<span>@</span>purestorage<span>.</span>com</a>&gt;</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/latest/collections/purestorage/flashblade/purefb_policy_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/latest/collections/purestorage/flashblade/purefb_policy_module.html</a>
  </p>
</div>
