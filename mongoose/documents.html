<h1>Documents</h1>
<a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/docs/documents.md" target="_blank"> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEwMDAgMTAwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDQ4MCkiPjxwYXRoIHN0cm9rZT0iIzA5NzFCMiIgZmlsbD0iIzA5NzFCMiIgZD0iTTkzMC45LDQyMC41Yy0zMy4xLDMxLjgtNjkuMyw0Ny43LTEwOC43LDQ3LjdjLTQ0LjUsMC04My45LTE3LjItMTE4LjItNTEuNUw5OS40LTE4NS45Yy0zLjgtMy44LTYuNC04LjktNy42LTE1LjNjLTIuNS04LjktMjkuMi05Ny45LTgwLjEtMjY3Yy0zLjgtMTIuNy0xLjMtMjMuNSw3LjYtMzIuNGM2LjQtNS4xLDE0LTcuNiwyMi45LTcuNmg5LjVjMTMyLjIsNDQuNSwyMTkuOSw3My4xLDI2My4yLDg1LjhjMy44LDEuMyw3LjYsMy44LDExLjQsNy42YzM3NSwzNzAsNTc3LjIsNTcwLjIsNjA2LjQsNjAwLjdjMzguMSwzOS40LDU3LjIsNzkuNSw1Ny4yLDEyMC4xQzk4OC43LDM0Ni44LDk2OSwzODQuOSw5MzAuOSw0MjAuNXogTTY5NC40LDMxOS40YzMxLjgtNy42LDYxLjctMjUuNCw4OS42LTUzLjRjMjYuNy0yNi43LDQzLjItNTcuMiw0OS42LTkxLjVDNzQ3LjIsODguMSw1NzguNy03OS4xLDMyOC4zLTMyN2MtMTIuNywzMC41LTI5LjksNTYuNi01MS41LDc4LjJjLTI2LjcsMjYuNy01Ni42LDQ3LTg5LjYsNjFMMzMyLjEtNDIuOWwyMTAuNywyMTAuN0w2OTQuNCwzMTkuNHogTTE0NS4yLTIzOS4zYzMxLjgtNy42LDYxLTI1LjQsODcuNy01My40YzIxLjYtMjEuNiwzNi45LTQ3LDQ1LjgtNzYuM2MtMTIuNy0zLjgtNDIuOS0xNC05MC42LTMwLjVjLTQ3LjctMTYuNS04Mi4zLTI4LTEwMy45LTM0LjNjNi40LDE5LjEsMTYuOCw1Mi4xLDMxLjUsOTkuMkMxMzAuMy0yODcuNiwxNDAuMS0yNTUuOCwxNDUuMi0yMzkuM3ogTTg4OC45LDIyOS44bC01LjctNS43Yy0xMi43LDMzLjEtMzEuMSw2MS43LTU1LjMsODUuOEM4MDIuNSwzMzUuMyw3NzQuNSwzNTUsNzQ0LDM2OWwxLjksMS45bDEuOSwxLjljMjIuOSwyMi45LDQ3LjcsMzQuMyw3NC40LDM0LjNjMjIuOSwwLDQ1LjEtMTAuOCw2Ni43LTMyLjRjMjUuNC0yNC4yLDM4LjEtNDcuNywzOC4xLTcwLjZTOTE0LjQsMjU2LjUsODg4LjksMjI5Ljh6Ii8+PC9nPjwvZz4NCjwvc3ZnPg=="> </a><h2 id="documents">  Documents  </h2>   <p>Mongoose <a href="api/document">documents</a> represent a one-to-one mapping to documents as stored in MongoDB. Each document is an instance of its <a href="models">Model</a>.</p>  <h2 id="documents-vs-models">Documents vs Models</h2> <p><a href="https://mongoosejs.com/docs/api.html#Document">Document</a> and <a href="https://mongoosejs.com/docs/api.html#Model">Model</a> are distinct classes in Mongoose. The Model class is a subclass of the Document class. When you use the <a href="https://mongoosejs.com/docs/api.html#Model">Model constructor</a>, you create a new document.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> MyModel = mongoose.model(<span class="hljs-string">'Test'</span>, <span class="hljs-keyword">new</span> Schema({ <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span> }));
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> MyModel();

doc <span class="hljs-keyword">instanceof</span> MyModel; <span class="hljs-comment">// true</span>
doc <span class="hljs-keyword">instanceof</span> mongoose.Model; <span class="hljs-comment">// true</span>
doc <span class="hljs-keyword">instanceof</span> mongoose.Document; <span class="hljs-comment">// true</span>
</pre> <p>In Mongoose, a "document" generally means an instance of a model. You should not have to create an instance of the Document class without going through a model.</p> <h2 id="retrieving">Retrieving</h2> <p>When you load documents from MongoDB using model functions like <a href="https://mongoosejs.com/docs/api.html#model_Model.findOne"><code>findOne()</code></a>, you get a Mongoose document back.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> MyModel.findOne();

doc <span class="hljs-keyword">instanceof</span> MyModel; <span class="hljs-comment">// true</span>
doc <span class="hljs-keyword">instanceof</span> mongoose.Model; <span class="hljs-comment">// true</span>
doc <span class="hljs-keyword">instanceof</span> mongoose.Document; <span class="hljs-comment">// true</span>
</pre> <h2 id="updating-using-save">Updating Using <code>save()</code>
</h2> <p>Mongoose documents track changes. You can modify a document using vanilla JavaScript assignments and Mongoose will convert it into <a href="https://docs.mongodb.com/manual/reference/operator/update/">MongoDB update operators</a>.</p> <pre data-language="javascript">doc.name = <span class="hljs-string">'foo'</span>;

<span class="hljs-comment">// Mongoose sends an `updateOne({ _id: doc._id }, { $set: { name: 'foo' } })`</span>
<span class="hljs-comment">// to MongoDB.</span>
<span class="hljs-keyword">await</span> doc.save();
</pre> <p>The <code>save()</code> method returns a promise. If <code>save()</code> succeeds, the promise resolves to the document that was saved.</p> <pre data-language="javascript">doc.save().then(<span class="hljs-function"><span class="hljs-params">savedDoc</span> =&gt;</span> {
  savedDoc === doc; <span class="hljs-comment">// true</span>
});
</pre> <p>If the document with the corresponding <code>_id</code> is not found, Mongoose will report a <code>DocumentNotFoundError</code>:</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> MyModel.findOne();

<span class="hljs-comment">// Delete the document so Mongoose won't be able to save changes</span>
<span class="hljs-keyword">await</span> MyModel.deleteOne({ <span class="hljs-attr">_id</span>: doc._id });

doc.name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">await</span> doc.save(); <span class="hljs-comment">// Throws DocumentNotFoundError</span>
</pre> <h2 id="updating-using-queries">Updating Using Queries</h2> <p>The <a href="https://mongoosejs.com/docs/api.html#model_Model-save"><code>save()</code></a> function is generally the right way to update a document with Mongoose. With <code>save()</code>, you get full <a href="validation">validation</a> and <a href="middleware">middleware</a>.</p> <p>For cases when <code>save()</code> isn't flexible enough, Mongoose lets you create your own <a href="https://docs.mongodb.com/manual/reference/operator/update/">MongoDB updates</a> with casting, <a href="middleware#notes">middleware</a>, and <a href="validation#update-validators">limited validation</a>.</p> <pre data-language="javascript"><span class="hljs-comment">// Update all documents in the `mymodels` collection</span>
<span class="hljs-keyword">await</span> MyModel.updateMany({}, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'foo'</span> } });
</pre> <p><em>Note that <code>update()</code>, <code>updateMany()</code>, <code>findOneAndUpdate()</code>, etc. do <em>not</em> execute <code>save()</code> middleware. If you need save middleware and full validation, first query for the document and then <code>save()</code> it.</em></p> <h2 id="validating">Validating</h2> <p>Documents are casted and validated before they are saved. Mongoose first casts values to the specified type and then validates them. Internally, Mongoose calls the document's <a href="https://mongoosejs.com/docs/api.html#document_Document-validate"><code>validate()</code> method</a> before saving.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({ <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">age</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Number</span>, <span class="hljs-attr">min</span>: <span class="hljs-number">0</span> } });
<span class="hljs-keyword">const</span> Person = mongoose.model(<span class="hljs-string">'Person'</span>, schema);

<span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> Person({ <span class="hljs-attr">name</span>: <span class="hljs-string">'foo'</span>, <span class="hljs-attr">age</span>: <span class="hljs-string">'bar'</span> });
<span class="hljs-comment">// Cast to Number failed for value "bar" at path "age"</span>
<span class="hljs-keyword">await</span> p.validate();

<span class="hljs-keyword">let</span> p2 = <span class="hljs-keyword">new</span> Person({ <span class="hljs-attr">name</span>: <span class="hljs-string">'foo'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">-1</span> });
<span class="hljs-comment">// Path `age` (-1) is less than minimum allowed value (0).</span>
<span class="hljs-keyword">await</span> p2.validate();
</pre> <p>Mongoose also supports limited validation on updates using the <a href="validation#update-validators"><code>runValidators</code> option</a>. Mongoose casts parameters to query functions like <code>findOne()</code>, <code>updateOne()</code> by default. However, Mongoose does <em>not</em> run validation on query function parameters by default. You need to set <code>runValidators: true</code> for Mongoose to validate.</p> <pre data-language="javascript"><span class="hljs-comment">// Cast to number failed for value "bar" at path "age"</span>
<span class="hljs-keyword">await</span> Person.updateOne({}, { <span class="hljs-attr">age</span>: <span class="hljs-string">'bar'</span> });

<span class="hljs-comment">// Path `age` (-1) is less than minimum allowed value (0).</span>
<span class="hljs-keyword">await</span> Person.updateOne({}, { <span class="hljs-attr">age</span>: <span class="hljs-number">-1</span> }, { <span class="hljs-attr">runValidators</span>: <span class="hljs-literal">true</span> });
</pre> <p>Read the <a href="validation">validation</a> guide for more details.</p> <h2 id="overwriting">Overwriting</h2> <p>There are 2 different ways to overwrite a document (replacing all keys in the document). One way is to use the <a href="api/document#document_Document-overwrite"><code>Document#overwrite()</code> function</a> followed by <code>save()</code>.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> Person.findOne({ _id });

<span class="hljs-comment">// Sets `name` and unsets all other properties</span>
doc.overwrite({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Jean-Luc Picard'</span> });
<span class="hljs-keyword">await</span> doc.save();
</pre> <p>The other way is to use <a href="api/model#model_Model.replaceOne"><code>Model.replaceOne()</code></a>.</p> <pre data-language="javascript"><span class="hljs-comment">// Sets `name` and unsets all other properties</span>
<span class="hljs-keyword">await</span> Person.replaceOne({ _id }, { <span class="hljs-attr">name</span>: <span class="hljs-string">'Jean-Luc Picard'</span> });
</pre> <h3 id="next-up">  Next Up  </h3> <p>Now that we've covered Documents, let's take a look at <a href="subdocs">Subdocuments</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://mongoosejs.com/docs/documents.html" class="_attribution-link" target="_blank">https://mongoosejs.com/docs/documents.html</a>
  </p>
</div>
