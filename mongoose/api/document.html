<a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/document.js" target="_blank"> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEwMDAgMTAwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDQ4MCkiPjxwYXRoIHN0cm9rZT0iIzA5NzFCMiIgZmlsbD0iIzA5NzFCMiIgZD0iTTkzMC45LDQyMC41Yy0zMy4xLDMxLjgtNjkuMyw0Ny43LTEwOC43LDQ3LjdjLTQ0LjUsMC04My45LTE3LjItMTE4LjItNTEuNUw5OS40LTE4NS45Yy0zLjgtMy44LTYuNC04LjktNy42LTE1LjNjLTIuNS04LjktMjkuMi05Ny45LTgwLjEtMjY3Yy0zLjgtMTIuNy0xLjMtMjMuNSw3LjYtMzIuNGM2LjQtNS4xLDE0LTcuNiwyMi45LTcuNmg5LjVjMTMyLjIsNDQuNSwyMTkuOSw3My4xLDI2My4yLDg1LjhjMy44LDEuMyw3LjYsMy44LDExLjQsNy42YzM3NSwzNzAsNTc3LjIsNTcwLjIsNjA2LjQsNjAwLjdjMzguMSwzOS40LDU3LjIsNzkuNSw1Ny4yLDEyMC4xQzk4OC43LDM0Ni44LDk2OSwzODQuOSw5MzAuOSw0MjAuNXogTTY5NC40LDMxOS40YzMxLjgtNy42LDYxLjctMjUuNCw4OS42LTUzLjRjMjYuNy0yNi43LDQzLjItNTcuMiw0OS42LTkxLjVDNzQ3LjIsODguMSw1NzguNy03OS4xLDMyOC4zLTMyN2MtMTIuNywzMC41LTI5LjksNTYuNi01MS41LDc4LjJjLTI2LjcsMjYuNy01Ni42LDQ3LTg5LjYsNjFMMzMyLjEtNDIuOWwyMTAuNywyMTAuN0w2OTQuNCwzMTkuNHogTTE0NS4yLTIzOS4zYzMxLjgtNy42LDYxLTI1LjQsODcuNy01My40YzIxLjYtMjEuNiwzNi45LTQ3LDQ1LjgtNzYuM2MtMTIuNy0zLjgtNDIuOS0xNC05MC42LTMwLjVjLTQ3LjctMTYuNS04Mi4zLTI4LTEwMy45LTM0LjNjNi40LDE5LjEsMTYuOCw1Mi4xLDMxLjUsOTkuMkMxMzAuMy0yODcuNiwxNDAuMS0yNTUuOCwxNDUuMi0yMzkuM3ogTTg4OC45LDIyOS44bC01LjctNS43Yy0xMi43LDMzLjEtMzEuMSw2MS43LTU1LjMsODUuOEM4MDIuNSwzMzUuMyw3NzQuNSwzNTUsNzQ0LDM2OWwxLjksMS45bDEuOSwxLjljMjIuOSwyMi45LDQ3LjcsMzQuMyw3NC40LDM0LjNjMjIuOSwwLDQ1LjEtMTAuOCw2Ni43LTMyLjRjMjUuNC0yNC4yLDM4LjEtNDcuNywzOC4xLTcwLjZTOTE0LjQsMjU2LjUsODg4LjksMjI5Ljh6Ii8+PC9nPjwvZz4NCjwvc3ZnPg=="> </a><h1>Document</h1>

<div class="api-content">
<h3 id="document_Document-$errors">Document.prototype.$errors</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Hash containing current validation $errors.</p> </div>
<h3 id="document_Document-$getAllSubdocs">Document.prototype.$getAllSubdocs()</h3>
<div>
<p>Get all subdocs (by bfs)</p> </div>
<h3 id="document_Document-$ignore">Document.prototype.$ignore()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> the path to ignore </li></ul>
<div>
<p>Don't run validation on this path or persist changes to this path.</p> <h4>Example:</h4> <pre data-language="javascript">doc.foo = <span class="hljs-literal">null</span>;
doc.$ignore(<span class="hljs-string">'foo'</span>);
doc.save(); <span class="hljs-comment">// changes to foo will not be persisted and validators won't be run</span></pre> </div>
<h3 id="document_Document-$isDefault">Document.prototype.$isDefault()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">[path] <span class="method-type">«String»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Checks if a path is set to its default.</p> <h4>Example</h4> <pre data-language="javascript">MyModel = mongoose.model(<span class="hljs-string">'test'</span>, { <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">'Val '</span>} });
<span class="hljs-keyword">const</span> m = <span class="hljs-keyword">new</span> MyModel();
m.$isDefault(<span class="hljs-string">'name'</span>); <span class="hljs-comment">// true</span></pre> </div>
<h3 id="document_Document-$isDeleted">Document.prototype.$isDeleted()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">[val] <span class="method-type">«Boolean»</span> optional, overrides whether mongoose thinks the doc is deleted </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> whether mongoose thinks this doc is deleted. </li></ul>
<div>
<p>Getter/setter, determines whether the document was removed or not.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> product.remove();
product.$isDeleted(); <span class="hljs-comment">// true</span>
product.remove(); <span class="hljs-comment">// no-op, doesn't send anything to the db</span>

product.$isDeleted(<span class="hljs-literal">false</span>);
product.$isDeleted(); <span class="hljs-comment">// false</span>
product.remove(); <span class="hljs-comment">// will execute a remove against the db</span></pre> </div>
<h3 id="document_Document-$isEmpty">Document.prototype.$isEmpty()</h3>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Returns true if the given path is nullish or only contains empty objects. Useful for determining whether this subdoc will get stripped out by the <a href="../guide#minimize">minimize option</a>.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({ <span class="hljs-attr">nested</span>: { <span class="hljs-attr">foo</span>: <span class="hljs-built_in">String</span> } });
<span class="hljs-keyword">const</span> Model = mongoose.model(<span class="hljs-string">'Test'</span>, schema);
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> Model({});
doc.$isEmpty(<span class="hljs-string">'nested'</span>); <span class="hljs-comment">// true</span>
doc.nested.$isEmpty(); <span class="hljs-comment">// true</span>

doc.nested.foo = <span class="hljs-string">'bar'</span>;
doc.$isEmpty(<span class="hljs-string">'nested'</span>); <span class="hljs-comment">// false</span>
doc.nested.$isEmpty(); <span class="hljs-comment">// false</span></pre> </div>
<h3 id="document_Document-$isNew">Document.prototype.$isNew</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Boolean flag specifying if the document is new.</p> </div>
<h3 id="document_Document-$locals">Document.prototype.$locals</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Empty object that you can use for storing properties on the document. This is handy for passing data to middleware without conflicting with Mongoose internals.</p> <h4>Example:</h4> <pre data-language="javascript">schema.pre(<span class="hljs-string">'save'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{
  <span class="hljs-comment">// Mongoose will set `isNew` to `false` if `save()` succeeds</span>
  <span class="hljs-keyword">this</span>.$locals.wasNew = <span class="hljs-keyword">this</span>.isNew;
});

schema.post(<span class="hljs-string">'save'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{
  <span class="hljs-comment">// Prints true if `isNew` was set before `save()`</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.$locals.wasNew);
});</pre> </div>
<h3 id="document_Document-$markValid">Document.prototype.$markValid()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> the field to mark as valid </li></ul>
<div>
<p>Marks a path as valid, removing existing validation errors.</p> </div>
<h3 id="document_Document-$op">Document.prototype.$op</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>A string containing the current operation that Mongoose is executing on this document. May be <code>null</code>, <code>'save'</code>, <code>'validate'</code>, or <code>'remove'</code>.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> Model({ <span class="hljs-attr">name</span>: <span class="hljs-string">'test'</span> });
doc.$op; <span class="hljs-comment">// null</span>

<span class="hljs-keyword">const</span> promise = doc.save();
doc.$op; <span class="hljs-comment">// 'save'</span>

<span class="hljs-keyword">await</span> promise;
doc.$op; <span class="hljs-comment">// null</span></pre> </div>
<h3 id="document_Document-$parent">Document.prototype.$parent()</h3>
<div>
<p>Alias for <code>parent()</code>. If this document is a subdocument or populated document, returns the document's parent. Returns <code>undefined</code> otherwise.</p> </div>
<h3 id="document_Document-$session">Document.prototype.$session()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">[session] <span class="method-type">«ClientSession»</span> overwrite the current session </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«ClientSession»</span> </li></ul>
<div>
<p>Getter/setter around the session associated with this document. Used to automatically set <code>session</code> if you <code>save()</code> a doc that you got from a query with an associated session.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> session = MyModel.startSession();
<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> MyModel.findOne().session(session);
doc.$session() === session; <span class="hljs-comment">// true</span>
doc.$session(<span class="hljs-literal">null</span>);
doc.$session() === <span class="hljs-literal">null</span>; <span class="hljs-comment">// true</span></pre> <p>If this is a top-level document, setting the session propagates to all child docs.</p> </div>
<h3 id="document_Document-$set">Document.prototype.$set()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">path <span class="method-type">«String|Object»</span> path or object of key/vals to set </li>
<li class="param">val <span class="method-type">«Any»</span> the value to set </li>
<li class="param">[type] <span class="method-type">«Schema|String|Number|Buffer|*»</span> optionally specify a type for "on-the-fly" attributes </li>
<li class="param">[options] <span class="method-type">«Object»</span> optionally specify options that modify the behavior of the set </li>
</ul>
<div>
<p>Alias for <code>set()</code>, used internally to avoid conflicts</p> </div>
<h3 id="document_Document-$where">Document.prototype.$where</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Set this property to add additional query filters when Mongoose saves this document and <code>isNew</code> is false.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-comment">// Make sure `save()` never updates a soft deleted document.</span>
schema.pre(<span class="hljs-string">'save'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{
  <span class="hljs-keyword">this</span>.$where = { <span class="hljs-attr">isDeleted</span>: <span class="hljs-literal">false</span> };
});</pre> </div>
<h3 id="document_Document-depopulate">Document.prototype.depopulate()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Document»</span> this </li></ul>
<div>
<p>Takes a populated field and returns it to its unpopulated state.</p> <h4>Example:</h4> <pre data-language="javascript">Model.findOne().populate(<span class="hljs-string">'author'</span>).exec(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, doc</span>) </span>{
  <span class="hljs-built_in">console</span>.log(doc.author.name); <span class="hljs-comment">// Dr.Seuss</span>
  <span class="hljs-built_in">console</span>.log(doc.depopulate(<span class="hljs-string">'author'</span>));
  <span class="hljs-built_in">console</span>.log(doc.author); <span class="hljs-comment">// '5144cf8050f071d979c118a7'</span>
})</pre> <p>If the path was not provided, then all populated fields are returned to their unpopulated state.</p> </div>
<h3 id="document_Document-directModifiedPaths">Document.prototype.directModifiedPaths()</h3>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Array»</span> </li></ul>
<div>
<p>Returns the list of paths that have been directly modified. A direct modified path is a path that you explicitly set, whether via <code>doc.foo = 'bar'</code>, <code>Object.assign(doc, { foo: 'bar' })</code>, or <code>doc.set('foo', 'bar')</code>.</p> <p>A path <code>a</code> may be in <code>modifiedPaths()</code> but not in <code>directModifiedPaths()</code> because a child of <code>a</code> was directly modified.</p> <h4>Example</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({ <span class="hljs-attr">foo</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">nested</span>: { <span class="hljs-attr">bar</span>: <span class="hljs-built_in">String</span> } });
<span class="hljs-keyword">const</span> Model = mongoose.model(<span class="hljs-string">'Test'</span>, schema);
<span class="hljs-keyword">await</span> Model.create({ <span class="hljs-attr">foo</span>: <span class="hljs-string">'original'</span>, <span class="hljs-attr">nested</span>: { <span class="hljs-attr">bar</span>: <span class="hljs-string">'original'</span> } });

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> Model.findOne();
doc.nested.bar = <span class="hljs-string">'modified'</span>;
doc.directModifiedPaths(); <span class="hljs-comment">// ['nested.bar']</span>
doc.modifiedPaths(); <span class="hljs-comment">// ['nested', 'nested.bar']</span></pre> </div>
<h3 id="document_Document-equals">Document.prototype.equals()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">doc <span class="method-type">«Document»</span> a document to compare </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Returns true if this document is equal to another document.</p> <p>Documents are considered equal when they have matching <code>_id</code>s, unless neither document has an <code>_id</code>, in which case this function falls back to using <code>deepEqual()</code>.</p> </div>
<h3 id="document_Document-errors">Document.prototype.errors</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Hash containing current validation errors.</p> </div>
<h3 id="document_Document-get">Document.prototype.get()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">path <span class="method-type">«String»</span> </li>
<li class="param">[type] <span class="method-type">«Schema|String|Number|Buffer|*»</span> optionally specify a type for on-the-fly attributes </li>
<li class="param">[options] <span class="method-type">«Object»</span> </li>
<ul style="margin-top: 0.5em"><li>[options.virtuals=false] <span class="method-type">«Boolean»</span> Apply virtuals before getting this path </li></ul>
<ul style="margin-top: 0.5em"><li>[options.getters=true] <span class="method-type">«Boolean»</span> If false, skip applying getters and just get the raw value </li></ul>
</ul>
<div>
<p>Returns the value of a path.</p> <h4>Example</h4> <pre data-language="javascript"><span class="hljs-comment">// path</span>
doc.get(<span class="hljs-string">'age'</span>) <span class="hljs-comment">// 47</span>

<span class="hljs-comment">// dynamic casting to a string</span>
doc.get(<span class="hljs-string">'age'</span>, <span class="hljs-built_in">String</span>) <span class="hljs-comment">// "47"</span></pre> </div>
<h3 id="document_Document-getChanges">Document.prototype.getChanges()</h3>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Object»</span> </li></ul>
<div>
<p>Returns the changes that happened to the document in the format that will be sent to MongoDB.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> Schema({
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">Number</span>,
  <span class="hljs-attr">country</span>: <span class="hljs-built_in">String</span>
});
<span class="hljs-keyword">const</span> User = mongoose.model(<span class="hljs-string">'User'</span>, userSchema);
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> User.create({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Hafez'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">country</span>: <span class="hljs-string">'Egypt'</span>
});

<span class="hljs-comment">// returns an empty object, no changes happened yet</span>
user.getChanges(); <span class="hljs-comment">// { }</span>

user.country = <span class="hljs-literal">undefined</span>;
user.age = <span class="hljs-number">26</span>;

user.getChanges(); <span class="hljs-comment">// { $set: { age: 26 }, { $unset: { country: 1 } } }</span>

<span class="hljs-keyword">await</span> user.save();

user.getChanges(); <span class="hljs-comment">// { }</span></pre> <p>Modifying the object that <code>getChanges()</code> returns does not affect the document's change tracking state. Even if you <code>delete user.getChanges().$set</code>, Mongoose will still send a <code>$set</code> to the server.</p> </div>
<h3 id="document_Document-id">Document.prototype.id</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The string version of this documents _id.</p> <h4>Note:</h4> <p>This getter exists on all documents by default. The getter can be disabled by setting the <code>id</code> <a href="../guide#id">option</a> of its <code>Schema</code> to false at construction time.</p> <pre data-language="javascript"><span class="hljs-keyword">new</span> Schema({ <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-literal">false</span> });</pre> </div>
<h3 id="document_Document-init">Document.prototype.init()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">doc <span class="method-type">«Object»</span> document returned by mongo </li></ul>
<div>
<p>Initializes the document without setters or marking anything modified.</p> <p>Called internally after a document is returned from mongodb. Normally, you do <strong>not</strong> need to call this function on your own.</p> <p>This function triggers <code>init</code> <a href="../middleware">middleware</a>. Note that <code>init</code> hooks are <a href="../middleware#synchronous">synchronous</a>.</p> </div>
<h3 id="document_Document-inspect">Document.prototype.inspect()</h3>
<div>
<p>Helper for console.log</p> </div>
<h3 id="document_Document-invalidate">Document.prototype.invalidate()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">path <span class="method-type">«String»</span> the field to invalidate. For array elements, use the <code>array.i.field</code> syntax, where <code>i</code> is the 0-based index in the array. </li>
<li class="param">errorMsg <span class="method-type">«String|Error»</span> the error which states the reason <code>path</code> was invalid </li>
<li class="param">value <span class="method-type">«Object|String|Number|any»</span> optional invalid value </li>
<li class="param">[kind] <span class="method-type">«String»</span> optional <code>kind</code> property for the error </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«ValidationError»</span> the current ValidationError, with all currently invalidated paths </li></ul>
<div>
<p>Marks a path as invalid, causing validation to fail.</p> <p>The <code>errorMsg</code> argument will become the message of the <code>ValidationError</code>.</p> <p>The <code>value</code> argument (if passed) will be available through the <code>ValidationError.value</code> property.</p> <pre data-language="javascript">doc.invalidate(<span class="hljs-string">'size'</span>, <span class="hljs-string">'must be less than 20'</span>, <span class="hljs-number">14</span>);

doc.validate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
  <span class="hljs-built_in">console</span>.log(err)
  <span class="hljs-comment">// prints</span>
  { <span class="hljs-attr">message</span>: <span class="hljs-string">'Validation failed'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ValidationError'</span>,
    <span class="hljs-attr">errors</span>:
     { <span class="hljs-attr">size</span>:
        { <span class="hljs-attr">message</span>: <span class="hljs-string">'must be less than 20'</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">'ValidatorError'</span>,
          <span class="hljs-attr">path</span>: <span class="hljs-string">'size'</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'user defined'</span>,
          <span class="hljs-attr">value</span>: <span class="hljs-number">14</span> } } }
})</pre> </div>
<h3 id="document_Document-isDirectModified">Document.prototype.isDirectModified()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String|Array&lt;String&gt;»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Returns true if <code>path</code> was directly set and modified, else false.</p> <h4>Example</h4> <pre data-language="javascript">doc.set(<span class="hljs-string">'documents.0.title'</span>, <span class="hljs-string">'changed'</span>);
doc.isDirectModified(<span class="hljs-string">'documents.0.title'</span>) <span class="hljs-comment">// true</span>
doc.isDirectModified(<span class="hljs-string">'documents'</span>) <span class="hljs-comment">// false</span></pre> </div>
<h3 id="document_Document-isDirectSelected">Document.prototype.isDirectSelected()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Checks if <code>path</code> was explicitly selected. If no projection, always returns true.</p> <h4>Example</h4> <pre data-language="javascript">Thing.findOne().select(<span class="hljs-string">'nested.name'</span>).exec(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, doc</span>) </span>{
   doc.isDirectSelected(<span class="hljs-string">'nested.name'</span>) <span class="hljs-comment">// true</span>
   doc.isDirectSelected(<span class="hljs-string">'nested.otherName'</span>) <span class="hljs-comment">// false</span>
   doc.isDirectSelected(<span class="hljs-string">'nested'</span>)  <span class="hljs-comment">// false</span>
})</pre> </div>
<h3 id="document_Document-isInit">Document.prototype.isInit()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Checks if <code>path</code> is in the <code>init</code> state, that is, it was set by <code>Document#init()</code> and not modified since.</p> </div>
<h3 id="document_Document-isModified">Document.prototype.isModified()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">[path] <span class="method-type">«String»</span> optional </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Returns true if any of the given paths is modified, else false. If no arguments, returns <code>true</code> if any path in this document is modified.</p> <p>If <code>path</code> is given, checks if a path or any full path containing <code>path</code> as part of its path chain has been modified.</p> <h4>Example</h4> <pre data-language="javascript">doc.set(<span class="hljs-string">'documents.0.title'</span>, <span class="hljs-string">'changed'</span>);
doc.isModified()                      <span class="hljs-comment">// true</span>
doc.isModified(<span class="hljs-string">'documents'</span>)           <span class="hljs-comment">// true</span>
doc.isModified(<span class="hljs-string">'documents.0.title'</span>)   <span class="hljs-comment">// true</span>
doc.isModified(<span class="hljs-string">'documents otherProp'</span>) <span class="hljs-comment">// true</span>
doc.isDirectModified(<span class="hljs-string">'documents'</span>)     <span class="hljs-comment">// false</span></pre> </div>
<h3 id="document_Document-isNew">Document.prototype.isNew</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>Boolean flag specifying if the document is new.</p> </div>
<h3 id="document_Document-isSelected">Document.prototype.isSelected()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String|Array&lt;String&gt;»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Boolean»</span> </li></ul>
<div>
<p>Checks if <code>path</code> was selected in the source query which initialized this document.</p> <h4>Example</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> Thing.findOne().select(<span class="hljs-string">'name'</span>);
doc.isSelected(<span class="hljs-string">'name'</span>) <span class="hljs-comment">// true</span>
doc.isSelected(<span class="hljs-string">'age'</span>)  <span class="hljs-comment">// false</span></pre> </div>
<h3 id="document_Document-markModified">Document.prototype.markModified()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">path <span class="method-type">«String»</span> the path to mark modified </li>
<li class="param">[scope] <span class="method-type">«Document»</span> the scope to run validators with </li>
</ul>
<div>
<p>Marks the path as having pending changes to write to the db.</p> <p><em>Very helpful when using <a href="../schematypes#mixed">Mixed</a> types.</em></p> <h4>Example:</h4> <pre data-language="javascript">doc.mixed.type = <span class="hljs-string">'changed'</span>;
doc.markModified(<span class="hljs-string">'mixed.type'</span>);
doc.save() <span class="hljs-comment">// changes to mixed.type are now persisted</span></pre> </div>
<h3 id="document_Document-modifiedPaths">Document.prototype.modifiedPaths()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">[options] <span class="method-type">«Object»</span> </li>
<ul style="margin-top: 0.5em"><li>[options.includeChildren=false] <span class="method-type">«Boolean»</span> if true, returns children of modified paths as well. For example, if false, the list of modified paths for <code>doc.colors = { primary: 'blue' };</code> will <strong>not</strong> contain <code>colors.primary</code>. If true, <code>modifiedPaths()</code> will return an array that contains <code>colors.primary</code>. </li></ul>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Array»</span> </li></ul>
<div>
<p>Returns the list of paths that have been modified.</p> </div>
<h3 id="document_Document-overwrite">Document.prototype.overwrite()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">obj <span class="method-type">«Object»</span> the object to overwrite this document with </li></ul>
<div>
<p>Overwrite all values in this document with the values of <code>obj</code>, except for immutable properties. Behaves similarly to <code>set()</code>, except for it unsets all properties that aren't in <code>obj</code>.</p> </div>
<h3 id="document_Document-parent">Document.prototype.parent()</h3>
<div>
<p>If this document is a subdocument or populated document, returns the document's parent. Returns the original document if there is no parent.</p> </div>
<h3 id="document_Document-populate">Document.prototype.populate()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">path <span class="method-type">«String|Object|Array»</span> either the path to populate or an object specifying all parameters, or either an array of those </li>
<li class="param">[select] <span class="method-type">«Object|String»</span> Field selection for the population query </li>
<li class="param">[model] <span class="method-type">«Model»</span> The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema's <code>ref</code> field. </li>
<li class="param">[match] <span class="method-type">«Object»</span> Conditions for the population query </li>
<li class="param">[options] <span class="method-type">«Object»</span> Options for the population query (sort, etc) </li>
<ul style="margin-top: 0.5em"><li>[options.path=null] <span class="method-type">«String»</span> The path to populate. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.retainNullValues=false] <span class="method-type">«boolean»</span> by default, Mongoose removes null and undefined values from populated arrays. Use this option to make <code>populate()</code> retain <code>null</code> and <code>undefined</code> array entries. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.getters=false] <span class="method-type">«boolean»</span> if true, Mongoose will call any getters defined on the <code>localField</code>. By default, Mongoose gets the raw value of <code>localField</code>. For example, you would need to set this option to <code>true</code> if you wanted to <a href="../schematypes#schematype-options">add a <code>lowercase</code> getter to your <code>localField</code></a>. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.clone=false] <span class="method-type">«boolean»</span> When you do <code>BlogPost.find().populate('author')</code>, blog posts with the same author will share 1 copy of an <code>author</code> doc. Enable this option to make Mongoose clone populated docs before assigning them. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.match=null] <span class="method-type">«Object|Function»</span> Add an additional filter to the populate query. Can be a filter object containing <a href="https://docs.mongodb.com/manual/tutorial/query-documents/">MongoDB query syntax</a>, or a function that returns a filter object. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.transform=null] <span class="method-type">«Function»</span> Function that Mongoose will call on every populated document that allows you to transform the populated document. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.options=null] <span class="method-type">«Object»</span> Additional options like <code>limit</code> and <code>lean</code>. </li></ul>
<li class="param">[callback] <span class="method-type">«Function»</span> Callback </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise,null»</span> </li></ul>
<div>
<p>Populates paths on an existing document.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">await</span> doc.populate([
  <span class="hljs-string">'stories'</span>,
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'fans'</span>, <span class="hljs-attr">sort</span>: { <span class="hljs-attr">name</span>: <span class="hljs-number">-1</span> } }
]);
doc.populated(<span class="hljs-string">'stories'</span>); <span class="hljs-comment">// Array of ObjectIds</span>
doc.stories[<span class="hljs-number">0</span>].title; <span class="hljs-comment">// 'Casino Royale'</span>
doc.populated(<span class="hljs-string">'fans'</span>); <span class="hljs-comment">// Array of ObjectIds</span>

<span class="hljs-keyword">await</span> doc.populate(<span class="hljs-string">'fans'</span>, <span class="hljs-string">'-email'</span>);
doc.fans[<span class="hljs-number">0</span>].email <span class="hljs-comment">// not populated</span>

<span class="hljs-keyword">await</span> doc.populate(<span class="hljs-string">'author fans'</span>, <span class="hljs-string">'-email'</span>);
doc.author.email <span class="hljs-comment">// not populated</span>
doc.fans[<span class="hljs-number">0</span>].email <span class="hljs-comment">// not populated</span></pre> </div>
<h3 id="document_Document-populated">Document.prototype.populated()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Array,ObjectId,Number,Buffer,String,undefined»</span> </li></ul>
<div>
<p>Gets _id(s) used during population of the given <code>path</code>.</p> <h4>Example:</h4> <pre data-language="javascript">Model.findOne().populate(<span class="hljs-string">'author'</span>).exec(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, doc</span>) </span>{
  <span class="hljs-built_in">console</span>.log(doc.author.name)         <span class="hljs-comment">// Dr.Seuss</span>
  <span class="hljs-built_in">console</span>.log(doc.populated(<span class="hljs-string">'author'</span>)) <span class="hljs-comment">// '5144cf8050f071d979c118a7'</span>
})</pre> <p>If the path was not populated, returns <code>undefined</code>.</p> </div>
<h3 id="document_Document-replaceOne">Document.prototype.replaceOne()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">doc <span class="method-type">«Object»</span> </li>
<li class="param">options <span class="method-type">«Object»</span> </li>
<li class="param">callback <span class="method-type">«Function»</span> </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Query»</span> </li></ul>
<div>
<p>Sends a replaceOne command with this document <code>_id</code> as the query selector.</p> <h4>Valid options:</h4> <ul> <li>same as in <a href="model#model_Model.replaceOne">Model.replaceOne</a>
</li> </ul> </div>
<h3 id="document_Document-save">Document.prototype.save()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">[options] <span class="method-type">«Object»</span> options optional options </li>
<ul style="margin-top: 0.5em"><li>[options.session=null] <span class="method-type">«Session»</span> the <a href="https://docs.mongodb.com/manual/reference/server-sessions/">session</a> associated with this save operation. If not specified, defaults to the <a href="api#document_Document-%24session">document's associated session</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.safe] <span class="method-type">«Object»</span> (DEPRECATED) overrides <a href="http://mongoosejs.com//docs/guide.html#safe">schema's safe option</a>. Use the <code>w</code> option instead. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.validateBeforeSave] <span class="method-type">«Boolean»</span> set to false to save without validating. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false] <span class="method-type">«Boolean»</span> If <code>true</code>, Mongoose will only validate modified paths, as opposed to modified paths and <code>required</code> paths. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.w] <span class="method-type">«Number|String»</span> set the <a href="https://docs.mongodb.com/manual/reference/write-concern/#w-option">write concern</a>. Overrides the <a href="../guide#writeConcern">schema-level <code>writeConcern</code> option</a> </li></ul>
<ul style="margin-top: 0.5em"><li>[options.j] <span class="method-type">«Boolean»</span> set to true for MongoDB to wait until this <code>save()</code> has been <a href="https://docs.mongodb.com/manual/reference/write-concern/#j-option">journaled before resolving the returned promise</a>. Overrides the <a href="../guide#writeConcern">schema-level <code>writeConcern</code> option</a> </li></ul>
<ul style="margin-top: 0.5em"><li>[options.wtimeout] <span class="method-type">«Number»</span> sets a <a href="https://docs.mongodb.com/manual/reference/write-concern/#wtimeout">timeout for the write concern</a>. Overrides the <a href="../guide#writeConcern">schema-level <code>writeConcern</code> option</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.checkKeys=true] <span class="method-type">«Boolean»</span> the MongoDB driver prevents you from saving keys that start with '$' or contain '.' by default. Set this option to <code>false</code> to skip that check. See <a href="https://docs.mongodb.com/manual/reference/limits/#Restrictions-on-Field-Names">restrictions on field names</a> </li></ul>
<ul style="margin-top: 0.5em"><li>[options.timestamps=true] <span class="method-type">«Boolean»</span> if <code>false</code> and <a href="guide#timestamps">timestamps</a> are enabled, skip timestamps for this <code>save()</code>. </li></ul>
<li class="param">[fn] <span class="method-type">«Function»</span> optional callback </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise,undefined»</span> Returns undefined if used with callback or a Promise otherwise. </li></ul>
<div>
<p>Saves this document by inserting a new document into the database if <a href="https://mongoosejs.com/docs/api.html#document_Document-isNew">document.isNew</a> is <code>true</code>, or sends an <a href="https://mongoosejs.com/docs/api.html#document_Document-updateOne">updateOne</a> operation <strong>only</strong> with the modifications to the database, it does not replace the whole document in the latter case.</p> <h4>Example:</h4> <pre data-language="javascript">product.sold = <span class="hljs-built_in">Date</span>.now();
product = <span class="hljs-keyword">await</span> product.save();</pre> <p>If save is successful, the returned promise will fulfill with the document saved.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> newProduct = <span class="hljs-keyword">await</span> product.save();
newProduct === product; <span class="hljs-comment">// true</span></pre> </div>
<h3 id="document_Document-schema">Document.prototype.schema</h3>
<h5>Type:</h5>
<ul><li><span class="method-type">«property»</span></li></ul>
<div>
<p>The document's schema.</p> </div>
<h3 id="document_Document-set">Document.prototype.set()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">path <span class="method-type">«String|Object»</span> path or object of key/vals to set </li>
<li class="param">val <span class="method-type">«Any»</span> the value to set </li>
<li class="param">[type] <span class="method-type">«Schema|String|Number|Buffer|*»</span> optionally specify a type for "on-the-fly" attributes </li>
<li class="param">[options] <span class="method-type">«Object»</span> optionally specify options that modify the behavior of the set </li>
</ul>
<div>
<p>Sets the value of a path, or many paths.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-comment">// path, value</span>
doc.set(path, value)

<span class="hljs-comment">// object</span>
doc.set({
    <span class="hljs-attr">path</span>  : value
  , <span class="hljs-attr">path2</span> : {
       <span class="hljs-attr">path</span>  : value
    }
})

<span class="hljs-comment">// on-the-fly cast to number</span>
doc.set(path, value, <span class="hljs-built_in">Number</span>)

<span class="hljs-comment">// on-the-fly cast to string</span>
doc.set(path, value, <span class="hljs-built_in">String</span>)

<span class="hljs-comment">// changing strict mode behavior</span>
doc.set(path, value, { <span class="hljs-attr">strict</span>: <span class="hljs-literal">false</span> });</pre> </div>
<h3 id="document_Document-toJSON">Document.prototype.toJSON()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">options <span class="method-type">«Object»</span> </li></ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Object»</span> </li></ul>
<div>
<p>The return value of this method is used in calls to JSON.stringify(doc).</p> <p>This method accepts the same options as <a href="#document_Document-toObject">Document#toObject</a>. To apply the options to every document of your schema by default, set your <a href="#schema_Schema">schemas</a> <code>toJSON</code> option to the same argument.</p> <pre data-language="javascript">schema.set(<span class="hljs-string">'toJSON'</span>, { <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> })</pre> <p>See <a href="../guide#toJSON">schema options</a> for details.</p> </div>
<h3 id="document_Document-toObject">Document.prototype.toObject()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">[options] <span class="method-type">«Object»</span> </li>
<ul style="margin-top: 0.5em"><li>[options.getters=false] <span class="method-type">«Boolean»</span> if true, apply all getters, including virtuals </li></ul>
<ul style="margin-top: 0.5em"><li>[options.virtuals=false] <span class="method-type">«Boolean»</span> if true, apply virtuals, including aliases. Use <code>{ getters: true, virtuals: false }</code> to just apply getters, not virtuals </li></ul>
<ul style="margin-top: 0.5em"><li>[options.aliases=true] <span class="method-type">«Boolean»</span> if <code>options.virtuals = true</code>, you can set <code>options.aliases = false</code> to skip applying aliases. This option is a no-op if <code>options.virtuals = false</code>. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.minimize=true] <span class="method-type">«Boolean»</span> if true, omit any empty objects from the output </li></ul>
<ul style="margin-top: 0.5em"><li>[options.transform=null] <span class="method-type">«Function|null»</span> if set, mongoose will call this function to allow you to transform the returned object </li></ul>
<ul style="margin-top: 0.5em"><li>[options.depopulate=false] <span class="method-type">«Boolean»</span> if true, replace any conventionally populated paths with the original id in the output. Has no affect on virtual populated paths. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.versionKey=true] <span class="method-type">«Boolean»</span> if false, exclude the version key (<code>__v</code> by default) from the output </li></ul>
<ul style="margin-top: 0.5em"><li>[options.flattenMaps=false] <span class="method-type">«Boolean»</span> if true, convert Maps to POJOs. Useful if you want to <code>JSON.stringify()</code> the result of <code>toObject()</code>. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.useProjection=false] <span class="method-type">«Boolean»</span> <ul> <li>If true, omits fields that are excluded in this document's projection. Unless you specified a projection, this will omit any field that has <code>select: false</code> in the schema.</li> </ul> </li></ul>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Object»</span> js object </li></ul>
<div>
<p>Converts this document into a plain-old JavaScript object (<a href="https://masteringjs.io/tutorials/fundamentals/pojo">POJO</a>).</p> <p>Buffers are converted to instances of <a href="http://mongodb.github.com/node-mongodb-native/api-bson-generated/binary.html">mongodb.Binary</a> for proper storage.</p> <h4>Options:</h4> <ul> <li>
<code>getters</code> apply all getters (path and virtual getters), defaults to false</li> <li>
<code>aliases</code> apply all aliases if <code>virtuals=true</code>, defaults to true</li> <li>
<code>virtuals</code> apply virtual getters (can override <code>getters</code> option), defaults to false</li> <li>
<code>minimize</code> remove empty objects, defaults to true</li> <li>
<code>transform</code> a transform function to apply to the resulting document before returning</li> <li>
<code>depopulate</code> depopulate any populated paths, replacing them with their original refs, defaults to false</li> <li>
<code>versionKey</code> whether to include the version key, defaults to true</li> <li>
<code>flattenMaps</code> convert Maps to POJOs. Useful if you want to JSON.stringify() the result of toObject(), defaults to false</li> <li>
<code>useProjection</code> set to <code>true</code> to omit fields that are excluded in this document's projection. Unless you specified a projection, this will omit any field that has <code>select: false</code> in the schema.</li> </ul> <h4>Getters/Virtuals</h4> <p>Example of only applying path getters</p> <pre data-language="javascript">doc.toObject({ <span class="hljs-attr">getters</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">false</span> })</pre> <p>Example of only applying virtual getters</p> <pre data-language="javascript">doc.toObject({ <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> })</pre> <p>Example of applying both path and virtual getters</p> <pre data-language="javascript">doc.toObject({ <span class="hljs-attr">getters</span>: <span class="hljs-literal">true</span> })</pre> <p>To apply these options to every document of your schema by default, set your <a href="#schema_Schema">schemas</a> <code>toObject</code> option to the same argument.</p> <pre data-language="javascript">schema.set(<span class="hljs-string">'toObject'</span>, { <span class="hljs-attr">virtuals</span>: <span class="hljs-literal">true</span> })</pre> <h4>Transform</h4> <p>We may need to perform a transformation of the resulting object based on some criteria, say to remove some sensitive information or return a custom object. In this case we set the optional <code>transform</code> function.</p> <p>Transform functions receive three arguments</p> <pre data-language="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) </span>{}</pre> <ul> <li>
<code>doc</code> The mongoose document which is being converted</li> <li>
<code>ret</code> The plain object representation which has been converted</li> <li>
<code>options</code> The options in use (either schema options or the options passed inline)</li> </ul> <h4>Example</h4> <pre data-language="javascript"><span class="hljs-comment">// specify the transform schema option</span>
<span class="hljs-keyword">if</span> (!schema.options.toObject) schema.options.toObject = {};
schema.options.toObject.transform = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) </span>{
  <span class="hljs-comment">// remove the _id of every document before returning the result</span>
  <span class="hljs-keyword">delete</span> ret._id;
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-comment">// without the transformation in the schema</span>
doc.toObject(); <span class="hljs-comment">// { _id: 'anId', name: 'Wreck-it Ralph' }</span>

<span class="hljs-comment">// with the transformation</span>
doc.toObject(); <span class="hljs-comment">// { name: 'Wreck-it Ralph' }</span></pre> <p>With transformations we can do a lot more than remove properties. We can even return completely new customized objects:</p> <pre data-language="javascript"><span class="hljs-keyword">if</span> (!schema.options.toObject) schema.options.toObject = {};
schema.options.toObject.transform = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) </span>{
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">movie</span>: ret.name }
}

<span class="hljs-comment">// without the transformation in the schema</span>
doc.toObject(); <span class="hljs-comment">// { _id: 'anId', name: 'Wreck-it Ralph' }</span>

<span class="hljs-comment">// with the transformation</span>
doc.toObject(); <span class="hljs-comment">// { movie: 'Wreck-it Ralph' }</span></pre> <p><em>Note: if a transform function returns <code>undefined</code>, the return value will be ignored.</em></p> <p>Transformations may also be applied inline, overridding any transform set in the options:</p> <pre data-language="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">xform</span> (<span class="hljs-params">doc, ret, options</span>) </span>{
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">inline</span>: ret.name, <span class="hljs-attr">custom</span>: <span class="hljs-literal">true</span> }
}

<span class="hljs-comment">// pass the transform as an inline option</span>
doc.toObject({ <span class="hljs-attr">transform</span>: xform }); <span class="hljs-comment">// { inline: 'Wreck-it Ralph', custom: true }</span></pre> <p>If you want to skip transformations, use <code>transform: false</code>:</p> <pre data-language="javascript">schema.options.toObject.hide = <span class="hljs-string">'_id'</span>;
schema.options.toObject.transform = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">doc, ret, options</span>) </span>{
  <span class="hljs-keyword">if</span> (options.hide) {
    options.hide.split(<span class="hljs-string">' '</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prop</span>) </span>{
      <span class="hljs-keyword">delete</span> ret[prop];
    });
  }
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> Doc({ <span class="hljs-attr">_id</span>: <span class="hljs-string">'anId'</span>, <span class="hljs-attr">secret</span>: <span class="hljs-number">47</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Wreck-it Ralph'</span> });
doc.toObject();                                        <span class="hljs-comment">// { secret: 47, name: 'Wreck-it Ralph' }</span>
doc.toObject({ <span class="hljs-attr">hide</span>: <span class="hljs-string">'secret _id'</span>, <span class="hljs-attr">transform</span>: <span class="hljs-literal">false</span> });<span class="hljs-comment">// { _id: 'anId', secret: 47, name: 'Wreck-it Ralph' }</span>
doc.toObject({ <span class="hljs-attr">hide</span>: <span class="hljs-string">'secret _id'</span>, <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// { name: 'Wreck-it Ralph' }</span></pre> <p>If you pass a transform in <code>toObject()</code> options, Mongoose will apply the transform to <a href="../subdocs">subdocuments</a> in addition to the top-level document. Similarly, <code>transform: false</code> skips transforms for all subdocuments.</p> <h2>Note that this behavior is different for transforms defined in the schema</h2> <p>if you define a transform in <code>schema.options.toObject.transform</code>, that transform will <strong>not</strong> apply to subdocuments.</p> <pre data-language="javascript">const memberSchema = new Schema({ name: String, email: String });
const groupSchema = new Schema({ members: [memberSchema], name: String, email });
const Group = mongoose.model('Group', groupSchema);

const doc = new Group({
  name: 'Engineering',
  email: '<a href="mailto:dev@mongoosejs.io">dev@mongoosejs.io</a>',
  members: [{ name: 'Val', email: '<a href="mailto:val@mongoosejs.io">val@mongoosejs.io</a>' }]
});

// Removes `email` from both top-level document **and** array elements
// { name: 'Engineering', members: [{ name: 'Val' }] }
doc.toObject({ transform: (doc, ret) =&gt; { delete ret.email; return ret; } });
</pre> <p>Transforms, like all of these options, are also available for <code>toJSON</code>. See <a href="https://thecodebarbarian.com/the-80-20-guide-to-json-stringify-in-javascript.html">this guide to <code>JSON.stringify()</code></a> to learn why <code>toJSON()</code> and <code>toObject()</code> are separate functions.</p> <p>See <a href="../guide#toObject">schema options</a> for some more details.</p> <p><em>During save, no custom options are applied to the document before being sent to the database.</em></p> </div>
<h3 id="document_Document-toString">Document.prototype.toString()</h3>
<div>
<p>Helper for console.log</p> </div>
<h3 id="document_Document-undefined">Document.prototype.undefined</h3>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Array&lt;Document&gt;»</span> array of populated documents. Empty array if there are no populated documents associated with this document. </li></ul>
<div>
<p>Gets all populated documents associated with this document.</p> </div>
<h3 id="document_Document-unmarkModified">Document.prototype.unmarkModified()</h3>
<h5>Parameters</h5>
<ul class="params"><li class="param">path <span class="method-type">«String»</span> the path to unmark modified </li></ul>
<div>
<p>Clears the modified state on the specified path.</p> <h4>Example:</h4> <pre data-language="javascript">doc.foo = <span class="hljs-string">'bar'</span>;
doc.unmarkModified(<span class="hljs-string">'foo'</span>);
doc.save(); <span class="hljs-comment">// changes to foo will not be persisted</span></pre> </div>
<h3 id="document_Document-update">Document.prototype.update()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">doc <span class="method-type">«Object»</span> </li>
<li class="param">options <span class="method-type">«Object»</span> </li>
<li class="param">callback <span class="method-type">«Function»</span> </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Query»</span> </li></ul>
<div>
<p>Sends an update command with this document <code>_id</code> as the query selector.</p> <h4>Example:</h4> <pre data-language="javascript">weirdCar.update({<span class="hljs-attr">$inc</span>: {<span class="hljs-attr">wheels</span>:<span class="hljs-number">1</span>}}, { <span class="hljs-attr">w</span>: <span class="hljs-number">1</span> }, callback);</pre> <h4>Valid options:</h4> <ul> <li>same as in <a href="#model_Model.update">Model.update</a>
</li> </ul> </div>
<h3 id="document_Document-updateOne">Document.prototype.updateOne()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">doc <span class="method-type">«Object»</span> </li>
<li class="param">[options] <span class="method-type">«Object»</span> optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions"><code>Query.prototype.setOptions()</code></a> </li>
<ul style="margin-top: 0.5em"><li>[options.lean] <span class="method-type">«Object»</span> if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See <a href="https://mongoosejs.com/docs/api.html#query_Query-lean"><code>Query.lean()</code></a> and the <a href="../tutorials/lean">Mongoose lean tutorial</a>. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.strict] <span class="method-type">«Boolean|String»</span> overwrites the schema's <a href="http://mongoosejs.com/docs/guide.html#strict">strict mode option</a> </li></ul>
<ul style="margin-top: 0.5em"><li>[options.timestamps=null] <span class="method-type">«Boolean»</span> If set to <code>false</code> and <a href="../guide#timestamps">schema-level timestamps</a> are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set. </li></ul>
<li class="param">callback <span class="method-type">«Function»</span> </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Query»</span> </li></ul>
<div>
<p>Sends an updateOne command with this document <code>_id</code> as the query selector.</p> <h4>Example:</h4> <pre data-language="javascript">weirdCar.updateOne({<span class="hljs-attr">$inc</span>: {<span class="hljs-attr">wheels</span>:<span class="hljs-number">1</span>}}, { <span class="hljs-attr">w</span>: <span class="hljs-number">1</span> }, callback);</pre> <h4>Valid options:</h4> <ul> <li>same as in <a href="#model_Model.updateOne">Model.updateOne</a>
</li> </ul> </div>
<h3 id="document_Document-validate">Document.prototype.validate()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">[pathsToValidate] <span class="method-type">«Array|String»</span> list of paths to validate. If set, Mongoose will validate only the modified paths that are in the given list. </li>
<li class="param">[options] <span class="method-type">«Object»</span> internal options </li>
<ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false] <span class="method-type">«Boolean»</span> if <code>true</code> mongoose validates only modified paths. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.pathsToSkip] <span class="method-type">«Array|string»</span> list of paths to skip. If set, Mongoose will validate every modified path that is not in this list. </li></ul>
<li class="param">[callback] <span class="method-type">«Function»</span> optional callback called after validation completes, passing an error if one occurred </li>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«Promise»</span> Promise </li></ul>
<div>
<p>Executes registered validation rules for this document.</p> <h4>Note:</h4> <p>This method is called <code>pre</code> save and if a validation rule is violated, <a href="#model_Model-save">save</a> is aborted and the error is returned to your <code>callback</code>.</p> <h4>Example:</h4> <pre data-language="javascript">doc.validate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
  <span class="hljs-keyword">if</span> (err) handleError(err);
  <span class="hljs-keyword">else</span> <span class="hljs-comment">// validation passed</span>
});</pre> </div>
<h3 id="document_Document-validateSync">Document.prototype.validateSync()</h3>
<h5>Parameters</h5>
<ul class="params">
<li class="param">pathsToValidate <span class="method-type">«Array|string»</span> only validate the given paths </li>
<li class="param">[options] <span class="method-type">«Object»</span> options for validation </li>
<ul style="margin-top: 0.5em"><li>[options.validateModifiedOnly=false] <span class="method-type">«Boolean»</span> If <code>true</code>, Mongoose will only validate modified paths, as opposed to modified paths and <code>required</code> paths. </li></ul>
<ul style="margin-top: 0.5em"><li>[options.pathsToSkip] <span class="method-type">«Array|string»</span> list of paths to skip. If set, Mongoose will validate every modified path that is not in this list. </li></ul>
</ul>
<h5>Returns:</h5>
<ul><li>
<span class="method-type">«ValidationError,undefined»</span> ValidationError if there are errors during validation, or undefined if there is no error. </li></ul>
<div>
<p>Executes registered validation rules (skipping asynchronous validators) for this document.</p> <h4>Note:</h4> <p>This method is useful if you need synchronous validation.</p> <h4>Example:</h4> <pre data-language="javascript"><span class="hljs-keyword">const</span> err = doc.validateSync();
<span class="hljs-keyword">if</span> (err) {
  handleError(err);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// validation passed</span>
}</pre> </div>
</div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://mongoosejs.com/docs/api/document.html" class="_attribution-link" target="_blank">https://mongoosejs.com/docs/api/document.html</a>
  </p>
</div>
