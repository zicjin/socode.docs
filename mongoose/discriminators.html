<a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/docs/discriminators.md" target="_blank"> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEwMDAgMTAwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDQ4MCkiPjxwYXRoIHN0cm9rZT0iIzA5NzFCMiIgZmlsbD0iIzA5NzFCMiIgZD0iTTkzMC45LDQyMC41Yy0zMy4xLDMxLjgtNjkuMyw0Ny43LTEwOC43LDQ3LjdjLTQ0LjUsMC04My45LTE3LjItMTE4LjItNTEuNUw5OS40LTE4NS45Yy0zLjgtMy44LTYuNC04LjktNy42LTE1LjNjLTIuNS04LjktMjkuMi05Ny45LTgwLjEtMjY3Yy0zLjgtMTIuNy0xLjMtMjMuNSw3LjYtMzIuNGM2LjQtNS4xLDE0LTcuNiwyMi45LTcuNmg5LjVjMTMyLjIsNDQuNSwyMTkuOSw3My4xLDI2My4yLDg1LjhjMy44LDEuMyw3LjYsMy44LDExLjQsNy42YzM3NSwzNzAsNTc3LjIsNTcwLjIsNjA2LjQsNjAwLjdjMzguMSwzOS40LDU3LjIsNzkuNSw1Ny4yLDEyMC4xQzk4OC43LDM0Ni44LDk2OSwzODQuOSw5MzAuOSw0MjAuNXogTTY5NC40LDMxOS40YzMxLjgtNy42LDYxLjctMjUuNCw4OS42LTUzLjRjMjYuNy0yNi43LDQzLjItNTcuMiw0OS42LTkxLjVDNzQ3LjIsODguMSw1NzguNy03OS4xLDMyOC4zLTMyN2MtMTIuNywzMC41LTI5LjksNTYuNi01MS41LDc4LjJjLTI2LjcsMjYuNy01Ni42LDQ3LTg5LjYsNjFMMzMyLjEtNDIuOWwyMTAuNywyMTAuN0w2OTQuNCwzMTkuNHogTTE0NS4yLTIzOS4zYzMxLjgtNy42LDYxLTI1LjQsODcuNy01My40YzIxLjYtMjEuNiwzNi45LTQ3LDQ1LjgtNzYuM2MtMTIuNy0zLjgtNDIuOS0xNC05MC42LTMwLjVjLTQ3LjctMTYuNS04Mi4zLTI4LTEwMy45LTM0LjNjNi40LDE5LjEsMTYuOCw1Mi4xLDMxLjUsOTkuMkMxMzAuMy0yODcuNiwxNDAuMS0yNTUuOCwxNDUuMi0yMzkuM3ogTTg4OC45LDIyOS44bC01LjctNS43Yy0xMi43LDMzLjEtMzEuMSw2MS43LTU1LjMsODUuOEM4MDIuNSwzMzUuMyw3NzQuNSwzNTUsNzQ0LDM2OWwxLjksMS45bDEuOSwxLjljMjIuOSwyMi45LDQ3LjcsMzQuMyw3NC40LDM0LjNjMjIuOSwwLDQ1LjEtMTAuOCw2Ni43LTMyLjRjMjUuNC0yNC4yLDM4LjEtNDcuNywzOC4xLTcwLjZTOTE0LjQsMjU2LjUsODg4LjksMjI5Ljh6Ii8+PC9nPjwvZz4NCjwvc3ZnPg=="> </a><h1 id="discriminators">Discriminators</h1>   <h2 id="the-modeldiscriminator-function">The model.discriminator() function</h2> <p>Discriminators are a schema inheritance mechanism. They enable you to have multiple models with overlapping schemas on top of the same underlying MongoDB collection.</p> <p>Suppose you wanted to track different types of events in a single collection. Every event will have a timestamp, but events that represent clicked links should have a URL. You can achieve this using the <code>model.discriminator()</code> function. This function takes 3 parameters, a model name, a discriminator schema and an optional key (defaults to the model name). It returns a model whose schema is the union of the base schema and the discriminator schema.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> options = { <span class="hljs-attr">discriminatorKey</span>: <span class="hljs-string">'kind'</span> };

<span class="hljs-keyword">const</span> eventSchema = <span class="hljs-keyword">new</span> mongoose.Schema({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span> }, options);
<span class="hljs-keyword">const</span> Event = mongoose.model(<span class="hljs-string">'Event'</span>, eventSchema);

<span class="hljs-comment">// ClickedLinkEvent is a special type of Event that has</span>
<span class="hljs-comment">// a URL.</span>
<span class="hljs-keyword">const</span> ClickedLinkEvent = Event.discriminator(<span class="hljs-string">'ClickedLink'</span>,
  <span class="hljs-keyword">new</span> mongoose.Schema({ <span class="hljs-attr">url</span>: <span class="hljs-built_in">String</span> }, options));

<span class="hljs-comment">// When you create a generic event, it can't have a URL field...</span>
<span class="hljs-keyword">const</span> genericEvent = <span class="hljs-keyword">new</span> Event({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now(), <span class="hljs-attr">url</span>: <span class="hljs-string">'google.com'</span> });
assert.ok(!genericEvent.url);

<span class="hljs-comment">// But a ClickedLinkEvent can</span>
<span class="hljs-keyword">const</span> clickedEvent =
  <span class="hljs-keyword">new</span> ClickedLinkEvent({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now(), <span class="hljs-attr">url</span>: <span class="hljs-string">'google.com'</span> });
assert.ok(clickedEvent.url);</pre> <h2 id="discriminators-save-to-the-event-models-collection">Discriminators save to the Event model's collection</h2> <p>Suppose you created another discriminator to track events where a new user registered. These <code>SignedUpEvent</code> instances will be stored in the same collection as generic events and <code>ClickedLinkEvent</code> instances.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> event1 = <span class="hljs-keyword">new</span> Event({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now() });
<span class="hljs-keyword">const</span> event2 = <span class="hljs-keyword">new</span> ClickedLinkEvent({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now(), <span class="hljs-attr">url</span>: <span class="hljs-string">'google.com'</span> });
<span class="hljs-keyword">const</span> event3 = <span class="hljs-keyword">new</span> SignedUpEvent({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now(), <span class="hljs-attr">user</span>: <span class="hljs-string">'testuser'</span> });

<span class="hljs-comment">/*
const save = function(doc, callback) {
  doc.save(function(error, doc) {
    callback(error, doc);
  });
}; */</span>

<span class="hljs-built_in">Promise</span>.all([event1.save(), event2.save(), event3.save()]).
  then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> Event.countDocuments()).
  then(<span class="hljs-function"><span class="hljs-params">count</span> =&gt;</span> {
    assert.equal(count, <span class="hljs-number">3</span>);
  });</pre> <h2 id="discriminator-keys">Discriminator keys</h2> <p>The way mongoose tells the difference between the different discriminator models is by the 'discriminator key', which is <code>__t</code> by default. Mongoose adds a String path called <code>__t</code> to your schemas that it uses to track which discriminator this document is an instance of.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> event1 = <span class="hljs-keyword">new</span> Event({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now() });
<span class="hljs-keyword">const</span> event2 = <span class="hljs-keyword">new</span> ClickedLinkEvent({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now(), <span class="hljs-attr">url</span>: <span class="hljs-string">'google.com'</span> });
<span class="hljs-keyword">const</span> event3 = <span class="hljs-keyword">new</span> SignedUpEvent({ <span class="hljs-attr">time</span>: <span class="hljs-built_in">Date</span>.now(), <span class="hljs-attr">user</span>: <span class="hljs-string">'testuser'</span> });

assert.ok(!event1.__t);
assert.equal(event2.__t, <span class="hljs-string">'ClickedLink'</span>);
assert.equal(event3.__t, <span class="hljs-string">'SignedUp'</span>);</pre><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://mongoosejs.com/docs/discriminators.html" class="_attribution-link" target="_blank">https://mongoosejs.com/docs/discriminators.html</a>
  </p>
</div>
