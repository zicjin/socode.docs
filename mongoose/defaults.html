<a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/docs/defaults.md" target="_blank"> <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAxMDAwIDEwMDAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDEwMDAgMTAwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz48ZyB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDQ4MCkiPjxwYXRoIHN0cm9rZT0iIzA5NzFCMiIgZmlsbD0iIzA5NzFCMiIgZD0iTTkzMC45LDQyMC41Yy0zMy4xLDMxLjgtNjkuMyw0Ny43LTEwOC43LDQ3LjdjLTQ0LjUsMC04My45LTE3LjItMTE4LjItNTEuNUw5OS40LTE4NS45Yy0zLjgtMy44LTYuNC04LjktNy42LTE1LjNjLTIuNS04LjktMjkuMi05Ny45LTgwLjEtMjY3Yy0zLjgtMTIuNy0xLjMtMjMuNSw3LjYtMzIuNGM2LjQtNS4xLDE0LTcuNiwyMi45LTcuNmg5LjVjMTMyLjIsNDQuNSwyMTkuOSw3My4xLDI2My4yLDg1LjhjMy44LDEuMyw3LjYsMy44LDExLjQsNy42YzM3NSwzNzAsNTc3LjIsNTcwLjIsNjA2LjQsNjAwLjdjMzguMSwzOS40LDU3LjIsNzkuNSw1Ny4yLDEyMC4xQzk4OC43LDM0Ni44LDk2OSwzODQuOSw5MzAuOSw0MjAuNXogTTY5NC40LDMxOS40YzMxLjgtNy42LDYxLjctMjUuNCw4OS42LTUzLjRjMjYuNy0yNi43LDQzLjItNTcuMiw0OS42LTkxLjVDNzQ3LjIsODguMSw1NzguNy03OS4xLDMyOC4zLTMyN2MtMTIuNywzMC41LTI5LjksNTYuNi01MS41LDc4LjJjLTI2LjcsMjYuNy01Ni42LDQ3LTg5LjYsNjFMMzMyLjEtNDIuOWwyMTAuNywyMTAuN0w2OTQuNCwzMTkuNHogTTE0NS4yLTIzOS4zYzMxLjgtNy42LDYxLTI1LjQsODcuNy01My40YzIxLjYtMjEuNiwzNi45LTQ3LDQ1LjgtNzYuM2MtMTIuNy0zLjgtNDIuOS0xNC05MC42LTMwLjVjLTQ3LjctMTYuNS04Mi4zLTI4LTEwMy45LTM0LjNjNi40LDE5LjEsMTYuOCw1Mi4xLDMxLjUsOTkuMkMxMzAuMy0yODcuNiwxNDAuMS0yNTUuOCwxNDUuMi0yMzkuM3ogTTg4OC45LDIyOS44bC01LjctNS43Yy0xMi43LDMzLjEtMzEuMSw2MS43LTU1LjMsODUuOEM4MDIuNSwzMzUuMyw3NzQuNSwzNTUsNzQ0LDM2OWwxLjksMS45bDEuOSwxLjljMjIuOSwyMi45LDQ3LjcsMzQuMyw3NC40LDM0LjNjMjIuOSwwLDQ1LjEtMTAuOCw2Ni43LTMyLjRjMjUuNC0yNC4yLDM4LjEtNDcuNywzOC4xLTcwLjZTOTE0LjQsMjU2LjUsODg4LjksMjI5Ljh6Ii8+PC9nPjwvZz4NCjwvc3ZnPg=="> </a><h1 id="defaults">Defaults</h1>   <h2 id="declaring-defaults-in-your-schema">Declaring Defaults in Your Schema</h2> <p>Your schemas can define default values for certain paths. If you create a new document without that path set, the default will kick in.</p> <p>Note: Mongoose only applies a default if the value of the path is strictly <code>undefined</code>.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">String</span>,
  <span class="hljs-attr">role</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">'guitarist'</span> }
});

<span class="hljs-keyword">const</span> Person = db.model(<span class="hljs-string">'Person'</span>, schema);

<span class="hljs-keyword">const</span> axl = <span class="hljs-keyword">new</span> Person({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Axl Rose'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'singer'</span> });
assert.equal(axl.role, <span class="hljs-string">'singer'</span>);

<span class="hljs-keyword">const</span> slash = <span class="hljs-keyword">new</span> Person({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Slash'</span> });
assert.equal(slash.role, <span class="hljs-string">'guitarist'</span>);

<span class="hljs-keyword">const</span> izzy = <span class="hljs-keyword">new</span> Person({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Izzy'</span>, <span class="hljs-attr">role</span>: <span class="hljs-literal">undefined</span> });
assert.equal(izzy.role, <span class="hljs-string">'guitarist'</span>);

<span class="hljs-comment">// Defaults do **not** run on `null`, `''`, or value other than `undefined`.</span>
<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> Person({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Bar'</span>, <span class="hljs-attr">role</span>: <span class="hljs-literal">null</span> });
assert.strictEqual(foo.role, <span class="hljs-literal">null</span>);

Person.create(axl, slash, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
  assert.ifError(error);
  Person.find({ <span class="hljs-attr">role</span>: <span class="hljs-string">'guitarist'</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, docs</span>) </span>{
    assert.ifError(error);
    assert.equal(docs.length, <span class="hljs-number">1</span>);
    assert.equal(docs[<span class="hljs-number">0</span>].name, <span class="hljs-string">'Slash'</span>);
  });
});</pre> <h2 id="default-functions">Default Functions</h2> <p>You can also set the <code>default</code> schema option to a function. Mongoose will execute that function and use the return value as the default.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">String</span>,
  <span class="hljs-attr">date</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-built_in">Date</span>,
    <span class="hljs-comment">// `Date.now()` returns the current unix timestamp as a number</span>
    <span class="hljs-attr">default</span>: <span class="hljs-built_in">Date</span>.now
  }
});

<span class="hljs-keyword">const</span> BlogPost = db.model(<span class="hljs-string">'BlogPost'</span>, schema);

<span class="hljs-keyword">const</span> post = <span class="hljs-keyword">new</span> BlogPost({ <span class="hljs-attr">title</span>: <span class="hljs-string">'5 Best Arnold Schwarzenegger Movies'</span> });

<span class="hljs-comment">// The post has a default Date set to now</span>
assert.ok(post.date.getTime() &gt;= <span class="hljs-built_in">Date</span>.now() - <span class="hljs-number">1000</span>);
assert.ok(post.date.getTime() &lt;= <span class="hljs-built_in">Date</span>.now());</pre> <h2 id="the-setdefaultsoninsert-option">The setDefaultsOnInsert Option</h2> <p>By default, mongoose only applies defaults when you create a new document. It will <strong>not</strong> set defaults if you use <code>update()</code> and <code>findOneAndUpdate()</code>. However, mongoose 4.x lets you opt-in to this behavior using the <code>setDefaultsOnInsert</code> option.</p> <h4 id="important">Important</h4> <p>The <code>setDefaultsOnInsert</code> option relies on the <a href="https://docs.mongodb.org/manual/reference/operator/update/setOnInsert/">MongoDB <code>$setOnInsert</code> operator</a>. The <code>$setOnInsert</code> operator was introduced in MongoDB 2.4. If you're using MongoDB server &lt; 2.4.0, do <strong>not</strong> use <code>setDefaultsOnInsert</code>.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">String</span>,
  <span class="hljs-attr">genre</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">'Action'</span> }
});

<span class="hljs-keyword">const</span> Movie = db.model(<span class="hljs-string">'Movie'</span>, schema);

<span class="hljs-keyword">const</span> query = {};
<span class="hljs-keyword">const</span> update = { <span class="hljs-attr">title</span>: <span class="hljs-string">'The Terminator'</span> };
<span class="hljs-keyword">const</span> options = {
  <span class="hljs-comment">// Return the document after updates are applied</span>
  <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">// Create a document if one isn't found. Required</span>
  <span class="hljs-comment">// for `setDefaultsOnInsert`</span>
  <span class="hljs-attr">upsert</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">setDefaultsOnInsert</span>: <span class="hljs-literal">true</span>
};

Movie.
  findOneAndUpdate(query, update, options, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error, doc</span>) </span>{
    assert.ifError(error);
    assert.equal(doc.title, <span class="hljs-string">'The Terminator'</span>);
    assert.equal(doc.genre, <span class="hljs-string">'Action'</span>);
  });</pre> <h2 id="default-functions-and-this">Default functions and this</h2> <p>Unless it is running on a query with <code>setDefaultsOnInsert</code>, a default function's <code>this</code> refers to the document.</p> <pre data-language="javascript"><span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">new</span> Schema({
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">String</span>,
  <span class="hljs-attr">released</span>: <span class="hljs-built_in">Boolean</span>,
  <span class="hljs-attr">releaseDate</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-built_in">Date</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>() </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.released) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Date</span>.now();
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }
});

<span class="hljs-keyword">const</span> Movie = db.model(<span class="hljs-string">'Movie'</span>, schema);

<span class="hljs-keyword">const</span> movie1 = <span class="hljs-keyword">new</span> Movie({ <span class="hljs-attr">title</span>: <span class="hljs-string">'The Terminator'</span>, <span class="hljs-attr">released</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// The post has a default Date set to now</span>
assert.ok(movie1.releaseDate.getTime() &gt;= <span class="hljs-built_in">Date</span>.now() - <span class="hljs-number">1000</span>);
assert.ok(movie1.releaseDate.getTime() &lt;= <span class="hljs-built_in">Date</span>.now());

<span class="hljs-keyword">const</span> movie2 = <span class="hljs-keyword">new</span> Movie({ <span class="hljs-attr">title</span>: <span class="hljs-string">'The Legend of Conan'</span>, <span class="hljs-attr">released</span>: <span class="hljs-literal">false</span> });

<span class="hljs-comment">// Since `released` is false, the default function will return null</span>
assert.strictEqual(movie2.releaseDate, <span class="hljs-literal">null</span>);</pre><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://mongoosejs.com/docs/defaults.html" class="_attribution-link" target="_blank">https://mongoosejs.com/docs/defaults.html</a>
  </p>
</div>
