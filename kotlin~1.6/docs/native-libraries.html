<h1 data-toc="native-libraries" id="native-libraries.md">Kotlin/Native libraries</h1>
<section class="chapter"><h2 id="kotlin-compiler-specifics" data-toc="native-libraries#kotlin-compiler-specifics">Kotlin compiler specifics</h2>
<p id="84b1b392">To produce a library with the Kotlin/Native compiler use the <code class="code ">-produce library</code> or <code class="code ">-p library</code> flag. For example:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ kotlinc-native foo.kt -p library -o bar </pre>
<p id="cdb29bf2">This command will produce a <code class="code ">bar.klib</code> with the compiled contents of <code class="code ">foo.kt</code>.</p>
<p id="df63b5a9">To link to a library use the <code class="code ">-library &lt;name&gt;</code> or <code class="code ">-l &lt;name&gt;</code> flag. For example:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ kotlinc-native qux.kt -l bar </pre>
<p id="e5489a35">This command will produce a <code class="code ">program.kexe</code> out of <code class="code ">qux.kt</code> and <code class="code ">bar.klib</code></p></section><section class="chapter"><h2 id="cinterop-tool-specifics" data-toc="native-libraries#cinterop-tool-specifics">cinterop tool specifics</h2>
<p id="f8abb95a">The <b id="d16f4aef" class="">cinterop</b> tool produces <code class="code ">.klib</code> wrappers for native libraries as its main output. For example, using the simple <code class="code ">libgit2.def</code> native library definition file provided in your Kotlin/Native distribution</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ cinterop -def samples/gitchurn/src/nativeInterop/cinterop/libgit2.def -compiler-option -I/usr/local/include -o libgit2 </pre>
<p id="84939967">we will obtain <code class="code ">libgit2.klib</code>.</p>
<p id="d28b5e9a">See more details in <a href="native-c-interop" id="c105477">C Interop</a></p></section><section class="chapter"><h2 id="klib-utility" data-toc="native-libraries#klib-utility">klib utility</h2>
<p id="6e2ffe85">The <b id="48141375" class="">klib</b> library management utility allows you to inspect and install the libraries.</p>
<p id="5e2231f4">The following commands are available:</p>
<ul class="list _ul" id="d498aa9e">
<li class="list__item" id="a3e3bd5d">
<p id="5c76c094"><code class="code ">content</code> – list library contents:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib contents &lt;name&gt; </pre>
</li>
<li class="list__item" id="fbbf50c">
<p id="4df5cd51"><code class="code ">info</code> – inspect the bookkeeping details of the library</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib info &lt;name&gt; </pre>
</li>
<li class="list__item" id="9c8bd696">
<p id="b5239042"><code class="code ">install</code> – install the library to the default location use</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib install &lt;name&gt; </pre>
</li>
<li class="list__item" id="12b50bb6">
<p id="402a6860"><code class="code ">remove</code> – remove the library from the default repository use</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib remove &lt;name&gt; </pre>
</li>
</ul>
<p id="90170bdb">All of the above commands accept an additional <code class="code ">-repository &lt;directory&gt;</code> argument for specifying a repository different to the default one.</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib &lt;command&gt; &lt;name&gt; -repository &lt;directory&gt; </pre></section><section class="chapter"><h2 id="several-examples" data-toc="native-libraries#several-examples">Several examples</h2>
<p id="cc955bfe">First let's create a library. Place the tiny library source code into <code class="code ">kotlinizer.kt</code>:</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">package kotlinizer val String.kotlinized get() = "Kotlin $this" </pre>
<pre class="code-block" data-lang="bash" data-language="bash">$ kotlinc-native kotlinizer.kt -p library -o kotlinizer </pre>
<p id="317100fe">The library has been created in the current directory:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ ls kotlinizer.klib kotlinizer.klib </pre>
<p id="ec95145b">Now let's check out the contents of the library:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib contents kotlinizer </pre>
<p id="d9205fb5">You can install <code class="code ">kotlinizer</code> to the default repository:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ klib install kotlinizer </pre>
<p id="b171a13f">Remove any traces of it from the current directory:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ rm kotlinizer.klib </pre>
<p id="755e5e01">Create a very short program and place it into a <code class="code ">use.kt</code>:</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">import kotlinizer.* fun main(args: Array&lt;String&gt;) { println("Hello, ${"world".kotlinized}!") } </pre>
<p id="e93d5a01">Now compile the program linking with the library you have just created:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ kotlinc-native use.kt -l kotlinizer -o kohello </pre>
<p id="8b1fa0cf">And run the program:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ ./kohello.kexe Hello, Kotlin world! </pre>
<p id="2b268fe0">Have fun!</p></section><section class="chapter"><h2 id="advanced-topics" data-toc="native-libraries#advanced-topics">Advanced topics</h2>
<section class="chapter"><h3 id="library-search-sequence" data-toc="native-libraries#library-search-sequence">Library search sequence</h3>
<p id="4864fc95">When given a <code class="code ">-library foo</code> flag, the compiler searches the <code class="code ">foo</code> library in the following order:</p>
<ul class="list _ul" id="87a9057b">
<li class="list__item" id="86a0df5f"><p>Current compilation directory or an absolute path.</p></li>
<li class="list__item" id="3c4890"><p>All repositories specified with <code class="code ">-repo</code> flag.</p></li>
<li class="list__item" id="9856b244"><p>Libraries installed in the default repository (For now the default is <code class="code ">~/.konan</code>, however it could be changed by setting <b id="21f62975" class="">KONAN_DATA_DIR</b> environment variable).</p></li>
<li class="list__item" id="e559c207"><p>Libraries installed in <code class="code ">$installation/klib</code> directory.</p></li>
</ul></section><section class="chapter"><h3 id="library-format" data-toc="native-libraries#library-format">Library format</h3>
<p id="ef12ef30">Kotlin/Native libraries are zip files containing a predefined directory structure, with the following layout:</p>
<p id="cc788c77"><code class="code ">foo.klib</code> when unpacked as <code class="code ">foo/</code> gives us:</p>
<pre class="code-block" data-lang="plaintext" data-language="plaintext"> - foo/ - $component_name/ - ir/ - Serialized Kotlin IR. - targets/ - $platform/ - kotlin/ - Kotlin compiled to LLVM bitcode. - native/ - Bitcode files of additional native objects. - $another_platform/ - There can be several platform specific kotlin and native pairs. - linkdata/ - A set of ProtoBuf files with serialized linkage metadata. - resources/ - General resources such as images. (Not used yet). - manifest - A file in the java property format describing the library. </pre>
<p id="e06e2f08">An example layout can be found in <code class="code ">klib/stdlib</code> directory of your installation.</p></section></section><div class="last-modified"> Last modified: 01 March 2021</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="native-immutability">Immutability in Kotlin/Native</a> <a class="navigation-links__next" href="native-platform-libs">Platform libraries</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/native-libraries.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/native-libraries.html</a>
  </p>
</div>
