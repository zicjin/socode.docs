<h1 data-toc="ksp-overview" id="ksp-overview.md">Kotlin Symbol Processing API</h1>
<p id="f450b5bf">Kotlin Symbol Processing (<em id="a45395dc" class="">KSP</em>) is an API that you can use to develop lightweight compiler plugins. KSP provides a simplified compiler plugin API that leverages the power of Kotlin while keeping the learning curve at a minimum. Compared to <a href="kapt" id="cb4c87d4">kapt</a>, annotation processors that use KSP can run up to 2 times faster.</p>
<p id="3f462471">To learn more about how KSP compares to kapt, check out <a href="ksp-why-ksp" id="3e776551">why KSP</a>. To get started writing a KSP processor, take a look at the <a href="ksp-quickstart" id="afa97b5b">KSP quickstart</a>.</p>
<section class="chapter"><h2 id="overview" data-toc="ksp-overview#overview">Overview</h2>
<p id="be77a634">The KSP API processes Kotlin programs idiomatically. KSP understands Kotlin-specific features, such as extension functions, declaration-site variance, and local functions. It also models types explicitly and provides basic type checking, such as equivalence and assign-compatibility.</p>
<p id="98249429">The API models Kotlin program structures at the symbol level according to <a href="grammar" id="cf7d1e01" data-external="true" rel="noopener noreferrer">Kotlin grammar</a>. When KSP-based plugins process source programs, constructs like classes, class members, functions, and associated parameters are accessible for the processors, while things like <code class="code ">if</code> blocks and <code class="code ">for</code> loops are not.</p>
<p id="cbb6d6b">Conceptually, KSP is similar to <a href="../api/latest/jvm/stdlib/kotlin.reflect/-k-type/index" id="564afa76" data-external="true" rel="noopener noreferrer">KType</a> in Kotlin reflection. The API allows processors to navigate from class declarations to corresponding types with specific type arguments and vice-versa. You can also substitute type arguments, specify variances, apply star projections, and mark nullabilities of types.</p>
<p id="949bcf77">Another way to think of KSP is as a preprocessor framework of Kotlin programs. By considering KSP-based plugins as <em id="27013091" class="">symbol processors</em>, or simply <em id="96840668" class="">processors</em>, the data flow in a compilation can be described in the following steps:</p>
<ol class="list _decimal" id="1c24167a">
<li class="list__item" id="39fd6513"><p>Processors read and analyze source programs and resources.</p></li>
<li class="list__item" id="d58c29f"><p>Processors generate code or other forms of output.</p></li>
<li class="list__item" id="a0d6816e"><p>The Kotlin compiler compiles the source programs together with the generated code.</p></li>
</ol>
<p id="51f6e54e">Unlike a full-fledged compiler plugin, processors cannot modify the code. A compiler plugin that changes language semantics can sometimes be very confusing. KSP avoids that by treating the source programs as read-only.</p>
<p id="508a77cc">You can also get an overview of KSP in this video:</p>

</section><section class="chapter"><h2 id="how-ksp-looks-at-source-files" data-toc="ksp-overview#how-ksp-looks-at-source-files">How KSP looks at source files</h2>
<p id="2561754d">Most processors navigate through the various program structures of the input source code. Before diving into usage of the API, let's see at how a file might look from KSP's point of view:</p>
<pre class="code-block" data-lang="plaintext" data-language="plaintext">KSFile packageName: KSName fileName: String annotations: List&lt;KSAnnotation&gt; (File annotations) declarations: List&lt;KSDeclaration&gt; KSClassDeclaration // class, interface, object simpleName: KSName qualifiedName: KSName containingFile: String typeParameters: KSTypeParameter parentDeclaration: KSDeclaration classKind: ClassKind primaryConstructor: KSFunctionDeclaration superTypes: List&lt;KSTypeReference&gt; // contains inner classes, member functions, properties, etc. declarations: List&lt;KSDeclaration&gt; KSFunctionDeclaration // top level function simpleName: KSName qualifiedName: KSName containingFile: String typeParameters: KSTypeParameter parentDeclaration: KSDeclaration functionKind: FunctionKind extensionReceiver: KSTypeReference? returnType: KSTypeReference parameters: List&lt;KSValueParameter&gt; // contains local classes, local functions, local variables, etc. declarations: List&lt;KSDeclaration&gt; KSPropertyDeclaration // global variable simpleName: KSName qualifiedName: KSName containingFile: String typeParameters: KSTypeParameter parentDeclaration: KSDeclaration extensionReceiver: KSTypeReference? type: KSTypeReference getter: KSPropertyGetter returnType: KSTypeReference setter: KSPropertySetter parameter: KSValueParameter </pre>
<p id="49c9ddfb">This view lists common things that are declared in the file: classes, functions, properties, and so on.</p></section><section class="chapter"><h2 id="symbolprocessorprovider-the-entry-point" data-toc="ksp-overview#symbolprocessorprovider-the-entry-point">SymbolProcessorProvider: the entry point</h2>
<p id="357d683f">KSP expects an implementation of the <code class="code ">SymbolProcessorProvider</code> interface to instantiate <code class="code ">SymbolProcessor</code>:</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">interface SymbolProcessorProvider { fun create(environment: SymbolProcessorEnvironment): SymbolProcessor } </pre>
<p id="c536ca30">While <code class="code ">SymbolProcessor</code> is defined as:</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">interface SymbolProcessor { fun process(resolver: Resolver): List&lt;KSAnnotated&gt; // Let's focus on this fun finish() {} fun onError() {} } </pre>
<p id="b1c2dabf">A <code class="code ">Resolver</code> provides <code class="code ">SymbolProcessor</code> with access to compiler details such as symbols. A processor that finds all top-level functions and non-local functions in top-level classes might look something like the following:</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">class HelloFunctionFinderProcessor : SymbolProcessor() { // ... val functions = mutableListOf&lt;String&gt;() val visitor = FindFunctionsVisitor() override fun process(resolver: Resolver) { resolver.getAllFiles().map { it.accept(visitor, Unit) } } inner class FindFunctionsVisitor : KSVisitorVoid() { override fun visitClassDeclaration(classDeclaration: KSClassDeclaration, data: Unit) { classDeclaration.getDeclaredFunctions().map { it.accept(this, Unit) } } override fun visitFunctionDeclaration(function: KSFunctionDeclaration, data: Unit) { functions.add(function) } override fun visitFile(file: KSFile, data: Unit) { file.declarations.map { it.accept(this, Unit) } } } // ... class Provider : SymbolProcessorProvider { override fun create(environment: SymbolProcessorEnvironment): SymbolProcessor = TODO() } } </pre></section><section class="chapter"><h2 id="resources" data-toc="ksp-overview#resources">Resources</h2>
<ul class="list _ul" id="6daa8704">
<li class="list__item" id="44b299ec"><p><a href="ksp-quickstart" id="44b7fb5b">Quickstart</a></p></li>
<li class="list__item" id="4d03ab13"><p><a href="ksp-why-ksp" id="677fec">Why use KSP?</a></p></li>
<li class="list__item" id="dc367203"><p><a href="ksp-examples" id="42624d0e">Examples</a></p></li>
<li class="list__item" id="9471458d"><p><a href="ksp-additional-details" id="7c69718c">How KSP models Kotlin code</a></p></li>
<li class="list__item" id="6d7ac758"><p><a href="ksp-reference" id="eece10f9">Reference for Java annotation processor authors</a></p></li>
<li class="list__item" id="8ec64102"><p><a href="ksp-incremental" id="436d270b">Incremental processing notes</a></p></li>
<li class="list__item" id="f9c4fd85"><p><a href="ksp-multi-round" id="b2004c12">Multiple round processing notes</a></p></li>
<li class="list__item" id="41bdf690"><p><a href="ksp-multiplatform" id="f636bd02">KSP on multiplatform projects</a></p></li>
<li class="list__item" id="fd6559b6"><p><a href="ksp-command-line" id="e27640ec">Running KSP from command line</a></p></li>
<li class="list__item" id="6bf20fa3"><p><a href="ksp-faq" id="cbfbcedc">FAQ</a></p></li>
</ul></section><section class="chapter"><h2 id="supported-libraries" data-toc="ksp-overview#supported-libraries">Supported libraries</h2>
<p id="cd08413c">The table below includes a list of popular libraries on Android and their various stages of support for KSP. If your library is missing, please feel free to submit a pull request.</p>
<div class="table-wrapper"><table class=" wide" id="a6fe5412">
<thead><tr class="ijRowHead" id="99561fb3">
<th id="a9a66270"><p>Library</p></th>
<th id="7fbf949d"><p>Status</p></th>
<th id="e8420aab"><p>Tracking issue for KSP</p></th>
</tr></thead>
<tbody>
<tr class="" id="3b40fb1d">
<td id="6d913dcd"><p>Room</p></td>
<td id="d1bc1b3"><p><a href="https://developer.android.com/jetpack/androidx/releases/room#2.3.0-beta02" id="9bf2ae38" data-external="true" rel="noopener noreferrer">Experimentally supported</a></p></td>
<td id="7b9b38f7"></td>
</tr>
<tr class="" id="3c228fac">
<td id="56e6c615"><p>Moshi</p></td>
<td id="be80415c"><p><a href="https://github.com/square/moshi/" id="958d9568" data-external="true" rel="noopener noreferrer">Officially supported</a></p></td>
<td id="c471f8a8"></td>
</tr>
<tr class="" id="8888d151">
<td id="abfd218d"><p>RxHttp</p></td>
<td id="dc64a1be"><p><a href="https://github.com/liujingxing/rxhttp" id="d6f604fd" data-external="true" rel="noopener noreferrer">Officially supported</a></p></td>
<td id="568812f9"></td>
</tr>
<tr class="" id="4bd6b2bb">
<td id="a29306b6"><p>Kotshi</p></td>
<td id="d7b37b7e"><p><a href="https://github.com/ansman/kotshi" id="7e8c9082" data-external="true" rel="noopener noreferrer">Officially supported</a></p></td>
<td id="ead2495c"></td>
</tr>
<tr class="" id="671f26fa">
<td id="df9e27cc"><p>Lyricist</p></td>
<td id="7330f56f"><p><a href="https://github.com/adrielcafe/lyricist" id="172621c5" data-external="true" rel="noopener noreferrer">Officially supported</a></p></td>
<td id="d3e9e5ea"></td>
</tr>
<tr class="" id="cbff93c4">
<td id="c44dc1ae"><p>Lich SavedState</p></td>
<td id="1059f8bc"><p><a href="https://github.com/line/lich/tree/master/savedstate" id="29d4969e" data-external="true" rel="noopener noreferrer">Officially supported</a></p></td>
<td id="2f0b6439"></td>
</tr>
<tr class="" id="675e7a41">
<td id="9340194a"><p>gRPC Dekorator</p></td>
<td id="73a8572b"><p><a href="https://github.com/mottljan/grpc-dekorator" id="f3104ce3" data-external="true" rel="noopener noreferrer">Officially supported</a></p></td>
<td id="ab76c020"></td>
</tr>
<tr class="" id="be10f3d4">
<td id="e015c26"><p>Auto Factory</p></td>
<td id="b52fcf96"><p>Not yet supported</p></td>
<td id="4b37715d"><p><a href="https://github.com/google/auto/issues/982" id="b6c0926c" data-external="true" rel="noopener noreferrer">Link</a></p></td>
</tr>
<tr class="" id="55a4f066">
<td id="4763ab6"><p>Dagger</p></td>
<td id="3923889"><p>Not yet supported</p></td>
<td id="77467e64"><p><a href="https://github.com/google/dagger/issues/2349" id="36d12d0c" data-external="true" rel="noopener noreferrer">Link</a></p></td>
</tr>
<tr class="" id="21cf9ae9">
<td id="4a2c2e56"><p>Hilt</p></td>
<td id="4e05eb24"><p>Not yet supported</p></td>
<td id="c381adc7"><p><a href="https://issuetracker.google.com/179057202" id="dbed940f" data-external="true" rel="noopener noreferrer">Link</a></p></td>
</tr>
<tr class="" id="816717d">
<td id="f50d3a3d"><p>Glide</p></td>
<td id="4494c554"><p>Not yet supported</p></td>
<td id="2afd556e"><p><a href="https://github.com/bumptech/glide/issues/4492" id="979dd8e1" data-external="true" rel="noopener noreferrer">Link</a></p></td>
</tr>
<tr class="" id="aec12cbd">
<td id="8e70f644"><p>DeeplinkDispatch</p></td>
<td id="324c1d31"><p><a href="https://github.com/airbnb/DeepLinkDispatch/pull/323" id="c6123f4" data-external="true" rel="noopener noreferrer">Supported via airbnb/DeepLinkDispatch#323</a></p></td>
<td id="3af955c4"></td>
</tr>
<tr class="" id="e582b401">
<td id="ecebff13"><p>Micronaut</p></td>
<td id="5ef4d59"><p>In Progress</p></td>
<td id="29d8a257"><p><a href="https://github.com/micronaut-projects/micronaut-core/issues/6781" id="dde6b012" data-external="true" rel="noopener noreferrer">Link</a></p></td>
</tr>
</tbody>
</table></div></section><div class="last-modified"> Last modified: 21 January 2022</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="lombok">Lombok compiler plugin</a> <a class="navigation-links__next" href="ksp-quickstart">KSP quickstart</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/ksp-overview.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/ksp-overview.html</a>
  </p>
</div>
