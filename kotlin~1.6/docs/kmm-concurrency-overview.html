<h1 data-toc="kmm-concurrency-overview" id="kmm-concurrency-overview.md">Concurrency overview</h1>
<p id="3cf7c734">When you extend your development experience from Android to Kotlin Multiplatform Mobile, you will encounter a different state and concurrency model for iOS. This is a Kotlin/Native model. <a href="native-overview" id="48db199d">Kotlin/Native</a> is a technology for compiling Kotlin code to native binaries that can run without a virtual machine, for example on iOS.</p>
<p id="6f8ad569">Having mutable memory available to multiple threads at the same time, if unrestricted, is known to be risky and prone to error. Languages like Java, C++, and Swift/Objective-C let multiple threads access the same state in an unrestricted way. Concurrency issues are unlike other programming issues in that they are often very difficult to reproduce. You may not see them locally while developing, and they may happen sporadically. And sometimes you can only see them in production under load.</p>
<p id="2eb31592">In short, just because your tests pass, you can’t necessarily be sure that your code is OK.</p>
<p id="97b325c7">Not all languages are designed this way. JavaScript simply does not allow you to access the same state concurrently. At the other end of the spectrum is Rust, with its language-level management of concurrency and states, which makes it very popular.</p>
<section class="chapter"><h2 id="rules-for-state-sharing" data-toc="kmm-concurrency-overview#rules-for-state-sharing">Rules for state sharing</h2>
<p id="fdb2417e">Kotlin/Native introduces rules for sharing states between threads. These rules exist to prevent unsafe shared access to mutable states. If you come from a JVM background and write concurrent code, you may need to change the way you architect your data, but doing so will allow you to achieve the same results without risky side effects.</p>
<p id="4a7e65c9">It is also important to point out that there are <a href="kmm-concurrent-mutability" id="1db60ef8">ways to work around these rules</a>. The intent is to make working around these rules something that you rarely have to do, if ever.</p>
<p id="ed231a75">There are just two simple rules regarding state and concurrency.</p>
<section class="chapter"><h3 id="rule-1-mutable-state-1-thread" data-toc="kmm-concurrency-overview#rule-1-mutable-state-1-thread">Rule 1: Mutable state == 1 thread</h3>
<p id="fc7c8149">If your state is mutable, only one thread can <em id="a0709167" class="">see</em> it at a time. Any regular class state that you would normally use in Kotlin is considered by the Kotlin/Native runtime as <em id="eed378f" class="">mutable</em>. If you aren't using concurrency, Kotlin/Native behaves the same as any other Kotlin code, with the exception of <a href="#global-state" id="46f66ebd">global state</a>.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">data class SomeData(var count:Int) fun simpleState(){ val sd = SomeData(42) sd.count++ println("My count is ${sd.count}") // It will be 43 } </pre>
<p id="72917eda">If there's only one thread, you won’t have concurrency issues. Technically this is referred to as <em id="f711cdb9" class="">thread confinement</em>, which means that you cannot change the UI from a background thread. Kotlin/Native's state rules formalize that concept for all threads.</p></section><section class="chapter"><h3 id="rule-2-immutable-state-many-threads" data-toc="kmm-concurrency-overview#rule-2-immutable-state-many-threads">Rule 2: Immutable state == many threads</h3>
<p id="80983622">If a state can't be changed, multiple threads can safely access it. In Kotlin/Native, <em id="22ba2a3c" class="">immutable</em> doesn't mean everything is a <code class="code ">val</code>. It means <em id="8705b614" class="">frozen state</em>.</p></section></section><section class="chapter"><h2 id="immutable-and-frozen-state" data-toc="kmm-concurrency-overview#immutable-and-frozen-state">Immutable and frozen state</h2>
<p id="165cd544">The example below is immutable by definition – it has 2 <code class="code ">val</code> elements, and both are of final immutable types.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">data class SomeData(val s:String, val i:Int) </pre>
<p id="6e1f8533">This next example may be immutable or mutable. It is not clear what <code class="code ">SomeInterface</code> will do internally at compile time. In Kotlin, it is not possible to determine deep immutability statically at compile time.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">data class SomeData(val s:String, val i:SomeInterface) </pre>
<p id="cce0853c">Kotlin/Native needs to verify that some part of a state really is immutable at runtime. The runtime could simply go through the whole state and verify that each part is deeply immutable, but that would be inflexible. And if you needed to do that every time the runtime wanted to check mutability, there would be significant consequences for performance.</p>
<p id="d723677d">Kotlin/Native defines a new runtime state called <em id="f3524c3a" class="">frozen</em>. Any instance of an object may be frozen. If an object is frozen:</p>
<ol class="list _decimal" id="d71064d6">
<li class="list__item" id="b399f8bc"><p>You cannot change any part of its state. Attempting to do so will result in a runtime exception: <code class="code ">InvalidMutabilityException</code>. A frozen object instance is 100%, runtime-verified, immutable.</p></li>
<li class="list__item" id="c7490785"><p>Everything it references is also frozen. All other objects it has a reference to are guaranteed to be frozen. This means that, when the runtime needs to determine whether an object can be shared with another thread, it only needs to check whether that object is frozen. If it is, the whole graph is also frozen and is safe to be shared.</p></li>
</ol>
<p id="1adb822d">The Native runtime adds an extension function <code class="code ">freeze()</code> to all classes. Calling <code class="code ">freeze()</code> will freeze an object, and everything referenced by the object, recursively.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">data class MoreData(val strData: String, var width: Float) data class SomeData(val moreData: MoreData, var count: Int) //... val sd = SomeData(MoreData("abc", 10.0), 0) sd.freeze() </pre>
<figure data-theme="light" id="ed02856c" width="587" class=" "><img class="js-gif article__bordered-element  " src="data:image/png;base64,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" data-gif-src="images/freezing-state.animated.gif" alt="Freezing state" width="587" style="width: 587px;"></figure><ul class="list _ul" id="617cbfd9">
<li class="list__item" id="18a9e08d"><p><code class="code ">freeze()</code> is a one-way operation. You can't <em id="2fdd51a5" class="">unfreeze</em> something.</p></li>
<li class="list__item" id="ed594953"><p><code class="code ">freeze()</code> is not available in shared Kotlin code, but several libraries provide expect and actual declarations for using it in shared code. However, if you're using a concurrency library, like <a href="https://github.com/Kotlin/kotlinx.coroutines" id="2096753e" data-external="true" rel="noopener noreferrer"><code class="code ">kotlinx.coroutines</code></a>, it will likely freeze data that crosses thread boundaries automatically.</p></li>
</ul>
<p id="b1ff073d"><code class="code ">freeze</code> is not unique to Kotlin. You can also find it in <a href="https://www.honeybadger.io/blog/when-to-use-freeze-and-frozen-in-ruby/" id="3132363f" data-external="true" rel="noopener noreferrer">Ruby</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze" id="ddc0bd0c" data-external="true" rel="noopener noreferrer">JavaScript</a>.</p></section><section class="chapter"><h2 id="global-state" data-toc="kmm-concurrency-overview#global-state">Global state</h2>
<p id="58215b8b">Kotlin allows you to define a state as globally available. If left simply mutable, the global state would violate <a href="#rule-1-mutable-state-1-thread" id="6c31b9ce">Rule 1</a>. <br> To conform to Kotlin/Native's state rules, the global state has some special conditions. These conditions freeze the state or make it visible only to a single thread.</p>
<section class="chapter"><h3 id="global-object" data-toc="kmm-concurrency-overview#global-object">Global object</h3>
<p id="c28f7bd0">Global <code class="code ">object</code> instances are frozen by default. This means that all threads can access them, but they are immutable. The following won't work.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">object SomeState{ var count = 0 fun add(){ count++ //This will throw an exception } } </pre>
<p id="428857fb">Trying to change <code class="code ">count</code> will throw an exception because <code class="code ">SomeState</code> is frozen (which means all of its data is frozen).</p>
<p id="a40fb63d">You can make a global object thread <em id="7ea7fc6d" class="">local</em>, which will allow it to be mutable and give each thread a copy of its state. Annotate it with <code class="code ">@ThreadLocal</code>.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">@ThreadLocal object SomeState{ var count = 0 fun add(){ count++ //👍 } } </pre>
<p id="57bb211c">If different threads read <code class="code ">count</code>, they'll get different values, because each thread has its own copy.</p>
<p id="6b6a4c28">These global object rules also apply to companion objects.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">class SomeState{ companion object{ var count = 0 fun add(){ count++ //This will throw an exception } } } </pre></section><section class="chapter"><h3 id="global-properties" data-toc="kmm-concurrency-overview#global-properties">Global properties</h3>
<p id="efb05cd">Global properties are a special case. <em id="a11ce4b2" class="">They are only available to the main thread</em>, but they are mutable. Accessing them from other threads will throw an exception.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">val hello = "Hello" //Only main thread can see this </pre>
<p id="121b9808">You can annotate them with :</p>
<ul class="list _ul" id="2fd33ff1">
<li class="list__item" id="82fd395"><p><code class="code ">@SharedImmutable</code>, which will make them globally available but frozen.</p></li>
<li class="list__item" id="f38c2478"><p><code class="code ">@ThreadLocal</code>, which will give each thread its own mutable copy.</p></li>
</ul>
<p id="aabc970f">This rule applies to global properties with backing fields. Computed properties and global functions do not have the main thread restriction.</p></section></section><section class="chapter"><h2 id="current-and-future-models" data-toc="kmm-concurrency-overview#current-and-future-models">Current and future models</h2>
<p id="de032596">Kotlin/Native's concurrency rules will require some adjustment in architecture design, but with the help of libraries and new best practices, day to day development is basically unaffected. In fact, adhering to Kotlin/Native's rules regarding multiplatform code will result in safer concurrency across the KMM application. You can try out the Kotlin/Native concurrency model in <a href="https://play.kotlinlang.org/hands-on/Kotlin%20Native%20Concurrency/" id="d100e270" data-external="true" rel="noopener noreferrer">this hands-on tutorial</a>.</p>
<p id="42cb7d6b">In the KMM application, you have Android and iOS targets with different state rules. Some teams, generally ones working on larger applications, share code for very specific functionality, and often manage concurrency in the host platform. This will require explicit freezing of states returned from Kotlin, but otherwise, it is straightforward.</p>
<p id="a668a150">A more extensive model, where concurrency is managed in Kotlin and the host communicates on its main thread to shared code, is simpler from a state management perspective. Concurrency libraries, like <a href="https://github.com/Kotlin/kotlinx.coroutines" id="5e9c63f0" data-external="true" rel="noopener noreferrer"><code class="code ">kotlinx.coroutines</code></a>, will help automate freezing. You'll also be able to leverage the power of <a href="coroutines-overview" id="d37778e2">coroutines</a> in your code and increase efficiency by sharing more code.</p>
<p id="af5167c4">However, the current Kotlin/Native concurrency model has a number of deficiencies. For example, mobile developers are used to freely sharing their objects between threads, and they have already developed a number of approaches and architectural patterns to avoid data races while doing so. It is possible to write efficient applications that do not block the main thread using Kotlin/Native, but the ability to do so comes with a steep learning curve.</p>
<p id="de818f94">That's why we are working on creating a new memory manager and concurrency model for Kotlin/Native that will help us remove these drawbacks. Learn more about <a href="https://blog.jetbrains.com/kotlin/2020/07/kotlin-native-memory-management-roadmap/" id="8a634b6" data-external="true" rel="noopener noreferrer">where we are going with this</a>.</p>
<p id="30ffe019"><em id="87219b8f" class="">This material was prepared by <a href="https://touchlab.co/" id="a25bb366" data-external="true" rel="noopener noreferrer">Touchlab</a> for publication by JetBrains.</em></p></section><div class="last-modified"> Last modified: 05 October 2021</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="kmm-publish-apps">Publish KMM apps</a> <a class="navigation-links__next" href="kmm-concurrent-mutability">Concurrent mutability</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/kmm-concurrency-overview.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/kmm-concurrency-overview.html</a>
  </p>
</div>
