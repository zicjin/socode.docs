<h1 data-toc="native-ios-symbolication" id="native-ios-symbolication.md">Symbolicating iOS crash reports</h1>
<p id="3a0bef4c">Debugging an iOS application crash sometimes involves analyzing crash reports. More info about crash reports can be found in the <a href="https://developer.apple.com/library/archive/technotes/tn2151/_index.html" id="e784c10b" data-external="true" rel="noopener noreferrer">Apple documentation</a>.</p>
<p id="cdf1d08d">Crash reports generally require symbolication to become properly readable: symbolication turns machine code addresses into human-readable source locations. The document below describes some specific details of symbolicating crash reports from iOS applications using Kotlin.</p>
<section class="chapter"><h2 id="producing-dsym-for-release-kotlin-binaries" data-toc="native-ios-symbolication#producing-dsym-for-release-kotlin-binaries">Producing .dSYM for release Kotlin binaries</h2>
<p id="8d441320">To symbolicate addresses in Kotlin code (e.g. for stack trace elements corresponding to Kotlin code) <code class="code ">.dSYM</code> bundle for Kotlin code is required.</p>
<p id="34999e66">By default, Kotlin/Native compiler produces <code class="code ">.dSYM</code> for release (i.e. optimized) binaries on Darwin platforms. This can be disabled with <code class="code ">-Xadd-light-debug=disable</code> compiler flag. At the same time, this option is disabled by default for other platforms. To enable it, use the <code class="code ">-Xadd-light-debug=enable</code> compiler option.</p>
<div class="tabs" id="87e12e97" data-group="build-script">
<div class="tabs__content" data-gtm="tab" id="b516df90" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code-block" data-lang="kotlin" data-title="Kotlin" data-language="kotlin">kotlin { targets.withType&lt;org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget&gt; { binaries.all { freeCompilerArgs += "-Xadd-light-debug={enable|disable}" } } } </pre></div>
<div class="tabs__content" data-gtm="tab" id="998a9da0" data-sync-tabs="groovy" data-title="Groovy"><pre class="code-block" data-lang="groovy" data-title="Groovy" data-language="groovy">kotlin { targets.withType(org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget) { binaries.all { freeCompilerArgs += "-Xadd-light-debug={enable|disable}" } } } </pre></div>
</div>
<p id="61ea0ec">In projects created from IntelliJ IDEA or AppCode templates these <code class="code ">.dSYM</code> bundles are then discovered by Xcode automatically.</p></section><section class="chapter"><h2 id="make-frameworks-static-when-using-rebuild-from-bitcode" data-toc="native-ios-symbolication#make-frameworks-static-when-using-rebuild-from-bitcode">Make frameworks static when using rebuild from bitcode</h2>
<p id="48dfbd09">Rebuilding Kotlin-produced framework from bitcode invalidates the original <code class="code ">.dSYM</code>. If it is performed locally, make sure the updated <code class="code ">.dSYM</code> is used when symbolicating crash reports.</p>
<p id="433c29dd">If rebuilding is performed on App Store side, then <code class="code ">.dSYM</code> of rebuilt <em id="f66e183d" class="">dynamic</em> framework seems discarded and not downloadable from App Store Connect. In this case, it may be required to make the framework static.</p>
<div class="tabs" id="bcab61c7" data-group="build-script">
<div class="tabs__content" data-gtm="tab" id="87ead5df" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code-block" data-lang="kotlin" data-title="Kotlin" data-language="kotlin">kotlin { targets.withType&lt;org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget&gt; { binaries.withType&lt;org.jetbrains.kotlin.gradle.plugin.mpp.Framework&gt; { isStatic = true } } } </pre></div>
<div class="tabs__content" data-gtm="tab" id="7d637afd" data-sync-tabs="groovy" data-title="Groovy"><pre class="code-block" data-lang="groovy" data-title="Groovy" data-language="groovy">kotlin { targets.withType(org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget) { binaries.withType(org.jetbrains.kotlin.gradle.plugin.mpp.Framework) { isStatic = true } } } </pre></div>
</div></section><section class="chapter"><h2 id="decode-inlined-stack-frames" data-toc="native-ios-symbolication#decode-inlined-stack-frames">Decode inlined stack frames</h2>
<p id="859b93a2">Xcode doesn't seem to properly decode stack trace elements of inlined function calls (these aren't only Kotlin <code class="code ">inline</code> functions but also functions that are inlined when optimizing machine code). So some stack trace elements may be missing. If this is the case, consider using <code class="code ">lldb</code> to process crash report that is already symbolicated by Xcode, for example:</p>
<pre class="code-block" data-lang="bash" data-language="bash">$ lldb -b -o "script import lldb.macosx" -o "crashlog file.crash" </pre>
<p id="9a3fe0c">This command should output crash report that is additionally processed and includes inlined stack trace elements.</p>
<p id="589c5fb5">More details can be found in <a href="https://lldb.llvm.org/use/symbolication.html" id="ad2a5a2b" data-external="true" rel="noopener noreferrer">LLDB documentation</a>.</p></section><div class="last-modified"> Last modified: 08 September 2021</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="native-debugging">Debugging Kotlin/Native</a> <a class="navigation-links__next" href="native-improving-compilation-time">Tips for improving Kotlin/Native compilation times</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/native-ios-symbolication.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/native-ios-symbolication.html</a>
  </p>
</div>
