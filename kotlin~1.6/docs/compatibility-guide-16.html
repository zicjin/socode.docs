<h1 data-toc="compatibility-guide-16" id="compatibility-guide-16.md">Compatibility guide for Kotlin 1.6</h1>
<p id="e496bcd5"><em id="7299b818" class=""><a href="kotlin-evolution" id="573f8bca">Keeping the Language Modern</a></em> and <em id="41db5ec3" class=""><a href="kotlin-evolution" id="4d06ef38">Comfortable Updates</a></em> are among the fundamental principles in Kotlin Language Design. The former says that constructs which obstruct language evolution should be removed, and the latter says that this removal should be well-communicated beforehand to make code migration as smooth as possible.</p>
<p id="49841485">While most of the language changes were already announced through other channels, like update changelogs or compiler warnings, this document summarizes them all, providing a complete reference for migration from Kotlin 1.5 to Kotlin 1.6.</p>
<section class="chapter"><h2 id="basic-terms" data-toc="compatibility-guide-16#basic-terms">Basic terms</h2>
<p id="2a041f50">In this document we introduce several kinds of compatibility:</p>
<ul class="list _ul" id="72d69f2d">
<li class="list__item" id="30455671"><p><em id="d3bef897" class="">source</em>: source-incompatible change stops code that used to compile fine (without errors or warnings) from compiling anymore</p></li>
<li class="list__item" id="3afc702e"><p><em id="4eaab950" class="">binary</em>: two binary artifacts are said to be binary-compatible if interchanging them doesn't lead to loading or linkage errors</p></li>
<li class="list__item" id="d22c69e"><p><em id="8575914a" class="">behavioral</em>: a change is said to be behavioral-incompatible if the same program demonstrates different behavior before and after applying the change</p></li>
</ul>
<p id="584de34c">Remember that those definitions are given only for pure Kotlin. Compatibility of Kotlin code from the other languages perspective (for example, from Java) is out of the scope of this document.</p></section><section class="chapter"><h2 id="language" data-toc="compatibility-guide-16#language">Language</h2>
<section class="chapter"><h3 id="make-when-statements-with-enum-sealed-and-boolean-subjects-exhaustive-by-default" data-toc="compatibility-guide-16#make-when-statements-with-enum-sealed-and-boolean-subjects-exhaustive-by-default">Make when statements with enum, sealed, and Boolean subjects exhaustive by default</h3>
<aside data-type="tip" class="prompt" data-title="" id="f2c39fb5"><p id="c43fb63d"><b id="839e5eb1" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-47709" id="b220e46a" data-external="true" rel="noopener noreferrer">KT-47709</a></p>
<p id="700ad57b"><b id="8ec5c7b3" class="">Component</b>: Core language</p>
<p id="44b870c0"><b id="c09721c7" class="">Incompatible change type</b>: source</p>
<p id="429c2a41"><b id="a7222646" class="">Short summary</b>: Kotlin 1.6 will warn about the <code class="code ">when</code> statement with an enum, sealed, or Boolean subject being non-exhaustive</p>
<p id="49bbb408"><b id="75c34180" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="c74b8ae8">
<li class="list__item" id="95b9e2cc"><p>1.6.0: introduce a warning when the <code class="code ">when</code> statement with an enum, sealed, or Boolean subject is non-exhaustive (error in the progressive mode)</p></li>
<li class="list__item" id="f77b3c0"><p>1.7.0: raise this warning to an error</p></li>
</ul></aside></section><section class="chapter"><h3 id="deprecate-confusing-grammar-in-when-with-subject" data-toc="compatibility-guide-16#deprecate-confusing-grammar-in-when-with-subject">Deprecate confusing grammar in when-with-subject</h3>
<aside data-type="tip" class="prompt" data-title="" id="8850ecb0"><p id="5833ed6c"><b id="2eba1110" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48385" id="92134a29" data-external="true" rel="noopener noreferrer">KT-48385</a></p>
<p id="9ae7d6dd"><b id="4410e378" class="">Component</b>: Core language</p>
<p id="aa0faad7"><b id="42f7df5a" class="">Incompatible change type</b>: source</p>
<p id="ff7b9b19"><b id="153d19f3" class="">Short summary</b>: Kotlin 1.6 will deprecate several confusing grammar constructs in <code class="code ">when</code> condition expressions</p>
<p id="9a71f979"><b id="a286e401" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="69109dae">
<li class="list__item" id="a2976490"><p>1.6.20: introduce a deprecation warning on the affected expressions</p></li>
<li class="list__item" id="9062718a"><p>1.8.0: raise this warning to an error</p></li>
<li class="list__item" id="86956be4"><p>&gt;= 1.8: repurpose some deprecated constructs for new language features</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-access-to-class-members-in-the-super-constructor-call-of-its-companion-and-nested-objects" data-toc="compatibility-guide-16#prohibit-access-to-class-members-in-the-super-constructor-call-of-its-companion-and-nested-objects">Prohibit access to class members in the super constructor call of its companion and nested objects</h3>
<aside data-type="tip" class="prompt" data-title="" id="9fee1cb7"><p id="b03519d4"><b id="770abc04" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-25289" id="b6e3dbca" data-external="true" rel="noopener noreferrer">KT-25289</a></p>
<p id="dd62730e"><b id="9b213142" class="">Component</b>: Core language</p>
<p id="96fca6a1"><b id="e87016b8" class="">Incompatible change type</b>: source</p>
<p id="9a63ce9e"><b id="2bc57244" class="">Short summary</b>: Kotlin 1.6 will report an error for arguments of super constructor call of companion and regular objects if the receiver of such arguments refers to the containing declaration</p>
<p id="ade79f75"><b id="c3ac7532" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="63ca9e6b">
<li class="list__item" id="cefed85a"><p>1.5.20: introduce a warning on the problematic arguments</p></li>
<li class="list__item" id="b0ad942"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitSelfCallsInNestedObjects</code> can be used to temporarily revert to the pre-1.6 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="type-nullability-enhancement-improvements" data-toc="compatibility-guide-16#type-nullability-enhancement-improvements">Type nullability enhancement improvements</h3>
<aside data-type="tip" class="prompt" data-title="" id="aa0dc107"><p id="85e99287"><b id="18b4e10a" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48623" id="3bcba136" data-external="true" rel="noopener noreferrer">KT-48623</a></p>
<p id="49eea64a"><b id="e76314eb" class="">Component</b>: Kotlin/JVM</p>
<p id="57ae78e4"><b id="bd34b66e" class="">Incompatible change type</b>: source</p>
<p id="f7595841"><b id="c26920b1" class="">Short summary</b>: Kotlin 1.7 will change how it loads and interprets type nullability annotations in Java code</p>
<p id="e0f7cc13"><b id="e6ad4756" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="6f879f66">
<li class="list__item" id="8186e62a"><p>1.4.30: introduce warnings for cases where more precise type nullability could lead to an error</p></li>
<li class="list__item" id="791c5054"><p>1.7.0: infer more precise nullability of Java types, <code class="code ">-XXLanguage:-TypeEnhancementImprovementsInStrictMode</code> can be used to temporarily revert to the pre-1.7 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="prevent-implicit-coercions-between-different-numeric-types" data-toc="compatibility-guide-16#prevent-implicit-coercions-between-different-numeric-types">Prevent implicit coercions between different numeric types</h3>
<aside data-type="tip" class="prompt" data-title="" id="3cb5b611"><p id="deefa53a"><b id="bfd2e876" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48645" id="268d1219" data-external="true" rel="noopener noreferrer">KT-48645</a></p>
<p id="87aa3f2f"><b id="c8f86ff2" class="">Component</b>: Kotlin/JVM</p>
<p id="83e51c30"><b id="b5947bc2" class="">Incompatible change type</b>: behavioral</p>
<p id="893a7430"><b id="6d98f37e" class="">Short summary</b>: Kotlin will avoid converting numeric values automatically to a primitive numeric type where only a downcast to that type was needed semantically</p>
<p id="47b1792e"><b id="8224b86" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="730ebe45">
<li class="list__item" id="4bb56b41"><p>&lt; 1.5.30: the old behavior in all affected cases</p></li>
<li class="list__item" id="6b4a716c"><p>1.5.30: fix the downcast behavior in generated property delegate accessors, <code class="code ">-Xuse-old-backend</code> can be used to temporarily revert to the pre-1.5.30 fix behavior</p></li>
<li class="list__item" id="5a7b2ecb"><p>&gt;= 1.6.20: fix the downcast behavior in other affected cases</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-declarations-of-repeatable-annotation-classes-whose-container-annotation-violates-jls" data-toc="compatibility-guide-16#prohibit-declarations-of-repeatable-annotation-classes-whose-container-annotation-violates-jls">Prohibit declarations of repeatable annotation classes whose container annotation violates JLS</h3>
<aside data-type="tip" class="prompt" data-title="" id="5072223e"><p id="af744ac7"><b id="643ac9ab" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-47928" id="c5828b02" data-external="true" rel="noopener noreferrer">KT-47928</a></p>
<p id="7ff326b9"><b id="1dd9f3d1" class="">Component</b>: Kotlin/JVM</p>
<p id="a431dc7f"><b id="d851df02" class="">Incompatible change type</b>: source</p>
<p id="69f1141d"><b id="2ff9d1e4" class="">Short summary</b>: Kotlin 1.6 will check that the container annotation of a repeatable annotation satisfies the same requirements as in <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-9.html#jls-9.6.3" id="1c16eb19" data-external="true" rel="noopener noreferrer">JLS 9.6.3</a>: array-typed value method, retention, and target</p>
<p id="e3edcbee"><b id="cdb61720" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="fcc8dc79">
<li class="list__item" id="c852df2d"><p>1.5.30: introduce a warning on repeatable container annotation declarations violating JLS requirements (error in the progressive mode)</p></li>
<li class="list__item" id="ccaa0569"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-RepeatableAnnotationContainerConstraints</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-declaring-a-nested-class-named-container-in-a-repeatable-annotation-class" data-toc="compatibility-guide-16#prohibit-declaring-a-nested-class-named-container-in-a-repeatable-annotation-class">Prohibit declaring a nested class named Container in a repeatable annotation class</h3>
<aside data-type="tip" class="prompt" data-title="" id="861b99ba"><p id="198a366"><b id="ab96b248" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-47971" id="509af7e0" data-external="true" rel="noopener noreferrer">KT-47971</a></p>
<p id="7c9d055"><b id="84c52ad" class="">Component</b>: Kotlin/JVM</p>
<p id="6896a489"><b id="7a9eea3f" class="">Incompatible change type</b>: source</p>
<p id="947b0292"><b id="4c9797aa" class="">Short summary</b>: Kotlin 1.6 will check that a repeatable annotation declared in Kotlin doesn't have a nested class with the predefined name <code class="code ">Container</code></p>
<p id="f0737b88"><b id="d45706a7" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="8de6008a">
<li class="list__item" id="73d0b60"><p>1.5.30: introduce a warning on nested classes with the name <code class="code ">Container</code> in a Kotlin-repeatable annotation class (error in the progressive mode)</p></li>
<li class="list__item" id="71b7504a"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-RepeatableAnnotationContainerConstraints</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-jvmfield-on-a-property-in-the-primary-constructor-that-overrides-an-interface-property" data-toc="compatibility-guide-16#prohibit-jvmfield-on-a-property-in-the-primary-constructor-that-overrides-an-interface-property">Prohibit @JvmField on a property in the primary constructor that overrides an interface property</h3>
<aside data-type="tip" class="prompt" data-title="" id="646508c7"><p id="e1988c49"><b id="8caabf88" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-32753" id="5c09ec94" data-external="true" rel="noopener noreferrer">KT-32753</a></p>
<p id="e65e6fdd"><b id="e52d2bd5" class="">Component</b>: Kotlin/JVM</p>
<p id="68e708d5"><b id="39045b11" class="">Incompatible change type</b>: source</p>
<p id="e9b4576d"><b id="18141c79" class="">Short summary</b>: Kotlin 1.6 will outlaw annotating a property declared in the primary constructor that overrides an interface property with the <code class="code ">@JvmField</code> annotation</p>
<p id="5d0fd95e"><b id="3b8a5965" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="553481c">
<li class="list__item" id="936ea2b6"><p>1.5.20: introduce a warning on the <code class="code ">@JvmField</code> annotation on such properties in the primary constructor</p></li>
<li class="list__item" id="8bec5d84"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitJvmFieldOnOverrideFromInterfaceInPrimaryConstructor</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-super-calls-from-public-abi-inline-functions" data-toc="compatibility-guide-16#prohibit-super-calls-from-public-abi-inline-functions">Prohibit super calls from public-abi inline functions</h3>
<aside data-type="tip" class="prompt" data-title="" id="c1f5dc78"><p id="c844dcbf"><b id="2443db51" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-45379" id="3873ed0f" data-external="true" rel="noopener noreferrer">KT-45379</a></p>
<p id="bc8e8389"><b id="ef276767" class="">Component</b>: Core language</p>
<p id="4a8ac74e"><b id="2fdb8036" class="">Incompatible change type</b>: source</p>
<p id="b7ae775a"><b id="64210451" class="">Short summary</b>: Kotlin 1.6 will outlaw calling functions with a <code class="code ">super</code> qualifier from public or protected inline functions and properties</p>
<p id="c300be8f"><b id="30424e7b" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="f8d42405">
<li class="list__item" id="69c14ac3"><p>1.5.0: introduce a warning on super calls from public or protected inline functions or property accessors</p></li>
<li class="list__item" id="e75a95a2"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitSuperCallsFromPublicInline</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-protected-constructor-calls-from-public-inline-functions" data-toc="compatibility-guide-16#prohibit-protected-constructor-calls-from-public-inline-functions">Prohibit protected constructor calls from public inline functions</h3>
<aside data-type="tip" class="prompt" data-title="" id="a6dd09f5"><p id="9f40c07b"><b id="efacb05f" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48860" id="f04b82cd" data-external="true" rel="noopener noreferrer">KT-48860</a></p>
<p id="970fa705"><b id="e01aa0d" class="">Component</b>: Core language</p>
<p id="b06f3f3e"><b id="56342279" class="">Incompatible change type</b>: source</p>
<p id="7b5a184d"><b id="a86a74ae" class="">Short summary</b>: Kotlin 1.6 will outlaw calling protected constructors from public or protected inline functions and properties</p>
<p id="90289ea8"><b id="8b816a55" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="7989ce1d">
<li class="list__item" id="1b17860a"><p>1.4.30: introduce a warning on protected constructor calls from public or protected inline functions or property accessors</p></li>
<li class="list__item" id="f7507f95"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitProtectedConstructorCallFromPublicInline</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-exposing-private-nested-types-from-private-in-file-types" data-toc="compatibility-guide-16#prohibit-exposing-private-nested-types-from-private-in-file-types">Prohibit exposing private nested types from private-in-file types</h3>
<aside data-type="tip" class="prompt" data-title="" id="7c8d9f41"><p id="7dfc8830"><b id="42aa7675" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-20094" id="7cc057fc" data-external="true" rel="noopener noreferrer">KT-20094</a></p>
<p id="aaf4c85"><b id="ecba00cd" class="">Component</b>: Core language</p>
<p id="1801453"><b id="1165f5ed" class="">Incompatible change type</b>: source</p>
<p id="cde3387b"><b id="9058a79c" class="">Short summary</b>: Kotlin 1.6 will outlaw exposing private nested types and inner classes from private-in-file types</p>
<p id="b500ee38"><b id="88123641" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="e7f5577b">
<li class="list__item" id="91bf301c"><p>1.5.0: introduce a warning on private types exposed from private-in-file types</p></li>
<li class="list__item" id="e99136cd"><p>1.6.0: raise this warning to an error, <code class="code ">-XXLanguage:-PrivateInFileEffectiveVisibility</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="annotation-target-is-not-analyzed-in-several-cases-for-annotations-on-a-type" data-toc="compatibility-guide-16#annotation-target-is-not-analyzed-in-several-cases-for-annotations-on-a-type">Annotation target is not analyzed in several cases for annotations on a type</h3>
<aside data-type="tip" class="prompt" data-title="" id="53469bea"><p id="404e7a84"><b id="b435ce43" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-28449" id="5ea65b4" data-external="true" rel="noopener noreferrer">KT-28449</a></p>
<p id="d23e62bf"><b id="6e5b5ff4" class="">Component</b>: Core language</p>
<p id="d7d6ec77"><b id="c2abc124" class="">Incompatible change type</b>: source</p>
<p id="efc7a443"><b id="cfc8dec" class="">Short summary</b>: Kotlin 1.6 will no longer allow annotations on types that should not be applicable to types</p>
<p id="f600c950"><b id="6d8eeb7c" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="fa69ed17">
<li class="list__item" id="8d162501"><p>1.5.20: introduce an error in the progressive mode</p></li>
<li class="list__item" id="b75be76b"><p>1.6.0: introduce an error, <code class="code ">-XXLanguage:-ProperCheckAnnotationsTargetInTypeUsePositions</code> can be used to temporarily disable the error reporting</p></li>
</ul></aside></section><section class="chapter"><h3 id="prohibit-calls-to-functions-named-suspend-with-a-trailing-lambda" data-toc="compatibility-guide-16#prohibit-calls-to-functions-named-suspend-with-a-trailing-lambda">Prohibit calls to functions named suspend with a trailing lambda</h3>
<aside data-type="tip" class="prompt" data-title="" id="9e0a637b"><p id="93f40ecd"><b id="2f8ce4fa" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-22562" id="b908efd2" data-external="true" rel="noopener noreferrer">KT-22562</a></p>
<p id="3e615ccd"><b id="715f3f27" class="">Component</b>: Core language</p>
<p id="70c5f6e9"><b id="4a6408c9" class="">Incompatible change type</b>: source</p>
<p id="a9f5474e"><b id="3b295493" class="">Short summary</b>: Kotlin 1.6 will no longer allow calling functions named <code class="code ">suspend</code> that have the single argument of a functional type passed as a trailing lambda</p>
<p id="6e368c84"><b id="6333ec2c" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="f1ed4bfc">
<li class="list__item" id="870707d1"><p>1.3.0: introduce a warning on such function calls</p></li>
<li class="list__item" id="67c6cd7b"><p>1.6.0: raise this warning to an error</p></li>
<li class="list__item" id="f4f4dbc"><p>&gt;= 1.7.0: introduce changes to the language grammar, so that <code class="code ">suspend</code> before <code class="code ">{</code> is parsed as a keyword</p></li>
</ul></aside></section></section><section class="chapter"><h2 id="standard-library" data-toc="compatibility-guide-16#standard-library">Standard library</h2>
<section class="chapter"><h3 id="remove-brittle-contains-optimization-in-minus-removeall-retainall" data-toc="compatibility-guide-16#remove-brittle-contains-optimization-in-minus-removeall-retainall">Remove brittle contains optimization in minus/removeAll/retainAll</h3>
<aside data-type="tip" class="prompt" data-title="" id="31d7eb73"><p id="9913a606"><b id="7c50494b" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-45438" id="cbfdb52b" data-external="true" rel="noopener noreferrer">KT-45438</a></p>
<p id="5bfbd6cb"><b id="5404986" class="">Component</b>: kotlin-stdlib</p>
<p id="51db4fc7"><b id="38e9619d" class="">Incompatible change type</b>: behavioral</p>
<p id="cab1b515"><b id="9e457231" class="">Short summary</b>: Kotlin 1.6 will no longer perform conversion to set for the argument of functions and operators that remove several elements from collection/iterable/array/sequence.</p>
<p id="2661e792"><b id="c567689f" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="d62d7ae7">
<li class="list__item" id="ae536b5"><p>&lt; 1.6: the old behavior: the argument is converted to set in some cases</p></li>
<li class="list__item" id="7460c6d1">
<p>1.6.0: if the function argument is a collection, it's no longer converted to <code class="code ">Set</code>. If it's not a collection, it can be converted to <code class="code ">List</code> instead. </p>
<br><p> The old behavior can be temporarily turned back on JVM by setting the system property <code class="code ">kotlin.collections.convert_arg_to_set_in_removeAll=true</code></p>
</li>
<li class="list__item" id="44c60afd"><p>&gt;= 1.7: the system property above will no longer have an effect</p></li>
</ul></aside></section><section class="chapter"><h3 id="change-value-generation-algorithm-in-random-nextlong" data-toc="compatibility-guide-16#change-value-generation-algorithm-in-random-nextlong">Change value generation algorithm in Random.nextLong</h3>
<aside data-type="tip" class="prompt" data-title="" id="bf9a8a55"><p id="5d6a9f14"><b id="47d04afb" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-47304" id="883c5634" data-external="true" rel="noopener noreferrer">KT-47304</a></p>
<p id="b0ab6a2c"><b id="c326ece0" class="">Component</b>: kotlin-stdlib</p>
<p id="56aae589"><b id="a71b44b7" class="">Incompatible change type</b>: behavioral</p>
<p id="1043c66b"><b id="9c5f0eb1" class="">Short summary</b>: Kotlin 1.6 changes the value generation algorithm in the <code class="code ">Random.nextLong</code> function to avoid producing values out of the specified range.</p>
<p id="e31bfc3c"><b id="469361f1" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="eda20ca2"><li class="list__item" id="de226a39"><p>1.6.0: the behavior is fixed immediately</p></li></ul></aside></section><section class="chapter"><h3 id="gradually-change-the-return-type-of-collection-min-and-max-functions-to-non-nullable" data-toc="compatibility-guide-16#gradually-change-the-return-type-of-collection-min-and-max-functions-to-non-nullable">Gradually change the return type of collection min and max functions to non-nullable</h3>
<aside data-type="tip" class="prompt" data-title="" id="2b9b4e62"><p id="9661a7d6"><b id="852f9860" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-38854" id="4fd3d8e6" data-external="true" rel="noopener noreferrer">KT-38854</a></p>
<p id="e4a36516"><b id="313dea07" class="">Component</b>: kotlin-stdlib</p>
<p id="f42baa31"><b id="c7da2ee5" class="">Incompatible change type</b>: source</p>
<p id="d2b95139"><b id="35c7514" class="">Short summary</b>: the return type of collection <code class="code ">min</code> and <code class="code ">max</code> functions will be changed to non-nullable in Kotlin 1.7</p>
<p id="cba25f7f"><b id="3c108d48" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="851ee9f6">
<li class="list__item" id="8e00a70e"><p>1.4.0: introduce <code class="code ">...OrNull</code> functions as synonyms and deprecate the affected API (see details in the issue)</p></li>
<li class="list__item" id="6e40a8f9"><p>1.5.0: raise the deprecation level of the affected API to an error</p></li>
<li class="list__item" id="44537214"><p>1.6.0: hide the deprecated functions from the public API</p></li>
<li class="list__item" id="40bfa37c"><p>&gt;= 1.7: reintroduce the affected API but with non-nullable return type</p></li>
</ul></aside></section><section class="chapter"><h3 id="deprecate-floating-point-array-functions-contains-indexof-lastindexof" data-toc="compatibility-guide-16#deprecate-floating-point-array-functions-contains-indexof-lastindexof">Deprecate floating-point array functions: contains, indexOf, lastIndexOf</h3>
<aside data-type="tip" class="prompt" data-title="" id="7b5a0996"><p id="ec337c22"><b id="43ea685f" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-28753" id="9d91f7eb" data-external="true" rel="noopener noreferrer">KT-28753</a></p>
<p id="34e3cd86"><b id="c0e9a92e" class="">Component</b>: kotlin-stdlib</p>
<p id="e42f1213"><b id="d0520db0" class="">Incompatible change type</b>: source</p>
<p id="ff69d960"><b id="78212b16" class="">Short summary</b>: Kotlin deprecates floating-point array functions <code class="code ">contains</code>, <code class="code ">indexOf</code>, <code class="code ">lastIndexOf</code> that compare values using the IEEE-754 order instead of the total order</p>
<p id="325cccad"><b id="b8b6e518" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="3e2fbbf3">
<li class="list__item" id="80253545"><p>1.4.0: deprecate the affected functions with a warning</p></li>
<li class="list__item" id="4d1b413a"><p>1.6.0: raise the deprecation level to an error</p></li>
<li class="list__item" id="29f9e5e1"><p>&gt;= 1.7: hide the deprecated functions from the public API</p></li>
</ul></aside></section><section class="chapter"><h3 id="migrate-declarations-from-kotlin-dom-and-kotlin-browser-packages-to-kotlinx" data-toc="compatibility-guide-16#migrate-declarations-from-kotlin-dom-and-kotlin-browser-packages-to-kotlinx">Migrate declarations from kotlin.dom and kotlin.browser packages to kotlinx.*</h3>
<aside data-type="tip" class="prompt" data-title="" id="b7ae1022"><p id="3f3f9340"><b id="60eb247" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-39330" id="d568934a" data-external="true" rel="noopener noreferrer">KT-39330</a></p>
<p id="4dbdedae"><b id="75d39c90" class="">Component</b>: kotlin-stdlib (JS)</p>
<p id="dbded6b8"><b id="1e572669" class="">Incompatible change type</b>: source</p>
<p id="f3e5c0eb"><b id="802907c5" class="">Short summary</b>: declarations from the <code class="code ">kotlin.dom</code> and <code class="code ">kotlin.browser</code> packages are moved to the corresponding <code class="code ">kotlinx.*</code> packages to prepare for extracting them from stdlib</p>
<p id="779d5ff2"><b id="7732034d" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="dff17171">
<li class="list__item" id="8ce1324c"><p>1.4.0: introduce the replacement API in <code class="code ">kotlinx.dom</code> and <code class="code ">kotlinx.browser</code> packages</p></li>
<li class="list__item" id="6ebbcf28"><p>1.4.0: deprecate the API in <code class="code ">kotlin.dom</code> and <code class="code ">kotlin.browser</code> packages and propose the new API above as a replacement</p></li>
<li class="list__item" id="824bcca"><p>1.6.0: raise the deprecation level to an error</p></li>
<li class="list__item" id="876e46f9"><p>&gt;= 1.7: remove the deprecated functions from stdlib</p></li>
<li class="list__item" id="4ce2677e"><p>&gt;= 1.7: move the API in kotlinx.* packages to a separate library</p></li>
</ul></aside></section><section class="chapter"><h3 id="make-regex-replace-function-not-inline-in-kotlin-js" data-toc="compatibility-guide-16#make-regex-replace-function-not-inline-in-kotlin-js">Make Regex.replace function not inline in Kotlin/JS</h3>
<aside data-type="tip" class="prompt" data-title="" id="567f7a7c"><p id="506931b9"><b id="eadf47f5" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-27738" id="dfeff94" data-external="true" rel="noopener noreferrer">KT-27738</a></p>
<p id="e81c97af"><b id="3d1f0597" class="">Component</b>: kotlin-stdlib (JS)</p>
<p id="3fad7a07"><b id="27465470" class="">Incompatible change type</b>: source</p>
<p id="5a31c4bd"><b id="c91a43e8" class="">Short summary</b>: the <code class="code ">Regex.replace</code> function with the functional <code class="code ">transform</code> parameter will no longer be inline in Kotlin/JS</p>
<p id="c13120df"><b id="a2166b2b" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="42370d24"><li class="list__item" id="ad66c045"><p>1.6.0: remove the <code class="code ">inline</code> modifier from the affected function</p></li></ul></aside></section><section class="chapter"><h3 id="different-behavior-of-the-regex-replace-function-in-jvm-and-js-when-replacement-string-contains-group-reference" data-toc="compatibility-guide-16#different-behavior-of-the-regex-replace-function-in-jvm-and-js-when-replacement-string-contains-group-reference">Different behavior of the Regex.replace function in JVM and JS when replacement string contains group reference</h3>
<aside data-type="tip" class="prompt" data-title="" id="9a6f1b2b"><p id="dadc26e1"><b id="83912169" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-28378" id="625090ce" data-external="true" rel="noopener noreferrer">KT-28378</a></p>
<p id="c184d495"><b id="fbd81ede" class="">Component</b>: kotlin-stdlib (JS)</p>
<p id="a7e5f7d3"><b id="ca467702" class="">Incompatible change type</b>: behavioral</p>
<p id="1ef59dca"><b id="b937013a" class="">Short summary</b>: the function <code class="code ">Regex.replace</code> in Kotlin/JS with the replacement pattern string will follow the same syntax of that pattern as in Kotlin/JVM</p>
<p id="5609cea0"><b id="6faa0f6" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="ea40e644"><li class="list__item" id="29ce5024"><p>1.6.0: change the replacement pattern handling in <code class="code ">Regex.replace</code> of the Kotlin/JS stdlib</p></li></ul></aside></section><section class="chapter"><h3 id="use-the-unicode-case-folding-in-js-regex" data-toc="compatibility-guide-16#use-the-unicode-case-folding-in-js-regex">Use the Unicode case folding in JS Regex</h3>
<aside data-type="tip" class="prompt" data-title="" id="e9b91761"><p id="ebcb9d41"><b id="32621e72" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-45928" id="1270b5de" data-external="true" rel="noopener noreferrer">KT-45928</a></p>
<p id="9d661604"><b id="4bb5bf6d" class="">Component</b>: kotlin-stdlib (JS)</p>
<p id="f62f78f8"><b id="9bb31fb7" class="">Incompatible change type</b>: behavioral</p>
<p id="89020f5f"><b id="f8d16f3f" class="">Short summary</b>: the <code class="code ">Regex</code> class in Kotlin/JS will use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/unicode" id="6bfabef4" data-external="true" rel="noopener noreferrer"><code class="code ">unicode</code></a> flag when calling the underlying JS Regular expressions engine to search and compare characters according to the Unicode rules. This brings certain version requirements of the JS environment and causes more strict validation of unnecessary escaping in the regex pattern string.</p>
<p id="a2547f1"><b id="bc239f42" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="a90ef2ec">
<li class="list__item" id="47ca6f88"><p>1.5.0: enable the Unicode case folding in most functions of the JS <code class="code ">Regex</code> class</p></li>
<li class="list__item" id="3706bc24"><p>1.6.0: enable the Unicode case folding in the <code class="code ">Regex.replaceFirst</code> function</p></li>
</ul></aside></section><section class="chapter"><h3 id="deprecate-some-js-only-api" data-toc="compatibility-guide-16#deprecate-some-js-only-api">Deprecate some JS-only API</h3>
<aside data-type="tip" class="prompt" data-title="" id="a95e58e2"><p id="63358b6e"><b id="80665fa7" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48587" id="6ccf8bbe" data-external="true" rel="noopener noreferrer">KT-48587</a></p>
<p id="521ffa74"><b id="edf9a78f" class="">Component</b>: kotlin-stdlib (JS)</p>
<p id="797b13d"><b id="e98c0bcc" class="">Incompatible change type</b>: source</p>
<p id="a9d27581"><b id="af1a4004" class="">Short summary</b>: a number of JS-only functions in stdlib are deprecated for removal. They include: <code class="code ">String.concat(String)</code>, <code class="code ">String.match(regex: String)</code>, <code class="code ">String.matches(regex: String)</code>, and the <code class="code ">sort</code> functions on arrays taking a comparison function, for example, <code class="code ">Array&lt;out T&gt;.sort(comparison: (a: T, b: T) -&gt; Int)</code></p>
<p id="bac41d5a"><b id="c6aee56c" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="504612da">
<li class="list__item" id="3203aee3"><p>1.6.0: deprecate the affected functions with a warning</p></li>
<li class="list__item" id="57748237"><p>1.7.0: raise the deprecation level to an error</p></li>
<li class="list__item" id="6eefce15"><p>1.8.0: remove the deprecated functions from the public API</p></li>
</ul></aside></section><section class="chapter"><h3 id="hide-implementation-and-interop-specific-functions-from-the-public-api-of-classes-in-kotlin-js" data-toc="compatibility-guide-16#hide-implementation-and-interop-specific-functions-from-the-public-api-of-classes-in-kotlin-js">Hide implementation- and interop-specific functions from the public API of classes in Kotlin/JS</h3>
<aside data-type="tip" class="prompt" data-title="" id="8ac0a0b2"><p id="8d86f7e4"><b id="88b42d59" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48587" id="284cd8bb" data-external="true" rel="noopener noreferrer">KT-48587</a></p>
<p id="46490497"><b id="984c8c0b" class="">Component</b>: kotlin-stdlib (JS)</p>
<p id="fe9437f6"><b id="e9af629e" class="">Incompatible change type</b>: source, binary</p>
<p id="d33c47f7"><b id="b47fa398" class="">Short summary</b>: the functions <code class="code ">HashMap.createEntrySet</code> and <code class="code ">AbstactMutableCollection.toJSON</code> change their visibility to internal</p>
<p id="166dd5e9"><b id="50b34f1" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="382ed484"><li class="list__item" id="6eefd690"><p>1.6.0: make the functions internal, thus removing them from the public API</p></li></ul></aside></section></section><section class="chapter"><h2 id="tools" data-toc="compatibility-guide-16#tools">Tools</h2>
<section class="chapter"><h3 id="deprecate-kotlingradlesubplugin-class" data-toc="compatibility-guide-16#deprecate-kotlingradlesubplugin-class">Deprecate KotlinGradleSubplugin class</h3>
<aside data-type="tip" class="prompt" data-title="" id="7d760571"><p id="71f3eb91"><b id="442c0a0b" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48830" id="b5c8ec54" data-external="true" rel="noopener noreferrer">KT-48830</a></p>
<p id="bce88402"><b id="32e61a40" class="">Component</b>: Gradle</p>
<p id="fa671c45"><b id="45d80a26" class="">Incompatible change type</b>: source</p>
<p id="4e286443"><b id="7c741c84" class="">Short summary</b>: the class <code class="code ">KotlinGradleSubplugin</code> will be deprecated in favor of <code class="code ">KotlinCompilerPluginSupportPlugin</code></p>
<p id="21a7d515"><b id="d354db57" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="68566e45">
<li class="list__item" id="30ae0d71"><p>1.6.0: raise the deprecation level to an error</p></li>
<li class="list__item" id="6abdc4d5"><p>&gt;= 1.7.0: remove the deprecated class</p></li>
</ul></aside></section><section class="chapter"><h3 id="remove-kotlin-usefallbackcompilersearch-build-option" data-toc="compatibility-guide-16#remove-kotlin-usefallbackcompilersearch-build-option">Remove kotlin.useFallbackCompilerSearch build option</h3>
<aside data-type="tip" class="prompt" data-title="" id="41b96919"><p id="1e70693"><b id="388b95a8" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-46719" id="1c1bf4de" data-external="true" rel="noopener noreferrer">KT-46719</a></p>
<p id="e0cbe8c7"><b id="d09ff4b1" class="">Component</b>: Gradle</p>
<p id="c515c6d4"><b id="b3944151" class="">Incompatible change type</b>: source</p>
<p id="fad9346d"><b id="b84749b5" class="">Short summary</b>: remove the deprecated 'kotlin.useFallbackCompilerSearch' build option</p>
<p id="a232022e"><b id="69842117" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="4cc9f6d9">
<li class="list__item" id="6c09655b"><p>1.5.0: raise the deprecation level to a warning</p></li>
<li class="list__item" id="460de986"><p>1.6.0: remove the deprecated option</p></li>
</ul></aside></section><section class="chapter"><h3 id="remove-several-compiler-options" data-toc="compatibility-guide-16#remove-several-compiler-options">Remove several compiler options</h3>
<aside data-type="tip" class="prompt" data-title="" id="1829a227"><p id="66a72c91"><b id="baf15e4" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48847" id="8001cb56" data-external="true" rel="noopener noreferrer">KT-48847</a></p>
<p id="19956604"><b id="d6314006" class="">Component</b>: Gradle</p>
<p id="213b523a"><b id="fb253c13" class="">Incompatible change type</b>: source</p>
<p id="94216289"><b id="13503508" class="">Short summary</b>: remove the deprecated <code class="code ">noReflect</code> and <code class="code ">includeRuntime</code> compiler options</p>
<p id="dd8c6ae8"><b id="3796977c" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="550b09e8">
<li class="list__item" id="35a22edb"><p>1.5.0: raise the deprecation level to an error</p></li>
<li class="list__item" id="b056c4ef"><p>1.6.0: remove the deprecated options</p></li>
</ul></aside></section><section class="chapter"><h3 id="deprecate-useir-compiler-option" data-toc="compatibility-guide-16#deprecate-useir-compiler-option">Deprecate useIR compiler option</h3>
<aside data-type="tip" class="prompt" data-title="" id="7778214d"><p id="26e4c92d"><b id="afe76539" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48847" id="55fc4e8d" data-external="true" rel="noopener noreferrer">KT-48847</a></p>
<p id="68704ba0"><b id="98f00822" class="">Component</b>: Gradle</p>
<p id="d196c292"><b id="d76cf795" class="">Incompatible change type</b>: source</p>
<p id="1a643f4b"><b id="55cddfe3" class="">Short summary</b>: hide the deprecated <code class="code ">useIR</code> compiler option</p>
<p id="f3ec93c1"><b id="5f4ed886" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="db86f64c">
<li class="list__item" id="61abebe"><p>1.5.0: raise the deprecation level to a warning</p></li>
<li class="list__item" id="898f48f8"><p>1.6.0: hide the option</p></li>
<li class="list__item" id="b1fcb1e3"><p>&gt;= 1.7.0: remove the deprecated option</p></li>
</ul></aside></section></section><div class="last-modified"> Last modified: 16 November 2021</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="components-stability-pre-1-4">Stability of Kotlin components (pre 1.4)</a> <a class="navigation-links__next" href="compatibility-guide-15">Compatibility guide for Kotlin 1.5</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/compatibility-guide-16.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/compatibility-guide-16.html</a>
  </p>
</div>
