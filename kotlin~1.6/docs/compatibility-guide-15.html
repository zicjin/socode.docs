<h1 data-toc="compatibility-guide-15" id="compatibility-guide-15.md">Compatibility guide for Kotlin 1.5</h1>
<p id="7786d575"><em id="1657cc90" class=""><a href="kotlin-evolution" id="5c635fdf">Keeping the Language Modern</a></em> and <em id="5d70866e" class=""><a href="kotlin-evolution" id="2c1ec6f">Comfortable Updates</a></em> are among the fundamental principles in Kotlin Language Design. The former says that constructs which obstruct language evolution should be removed, and the latter says that this removal should be well-communicated beforehand to make code migration as smooth as possible.</p>
<p id="a7e9eec7">While most of the language changes were already announced through other channels, like update changelogs or compiler warnings, this document summarizes them all, providing a complete reference for migration from Kotlin 1.4 to Kotlin 1.5.</p>
<section class="chapter"><h2 id="basic-terms" data-toc="compatibility-guide-15#basic-terms">Basic terms</h2>
<p id="6ad325b">In this document we introduce several kinds of compatibility:</p>
<ul class="list _ul" id="fb13c5a">
<li class="list__item" id="42181dd3"><p><em id="9e896a7b" class="">source</em>: source-incompatible change stops code that used to compile fine (without errors or warnings) from compiling anymore</p></li>
<li class="list__item" id="99443bea"><p><em id="c526383d" class="">binary</em>: two binary artifacts are said to be binary-compatible if interchanging them doesn't lead to loading or linkage errors</p></li>
<li class="list__item" id="7f536c5d"><p><em id="6cae9b69" class="">behavioral</em>: a change is said to be behavioral-incompatible if the same program demonstrates different behavior before and after applying the change</p></li>
</ul>
<p id="99e18ffe">Remember that those definitions are given only for pure Kotlin. Compatibility of Kotlin code from the other languages perspective (for example, from Java) is out of the scope of this document.</p></section><section class="chapter"><h2 id="language-and-stdlib" data-toc="compatibility-guide-15#language-and-stdlib">Language and stdlib</h2>
<section class="chapter"><h3 id="forbid-spread-operator-in-signature-polymorphic-calls" data-toc="compatibility-guide-15#forbid-spread-operator-in-signature-polymorphic-calls">Forbid spread operator in signature-polymorphic calls</h3>
<aside data-type="tip" class="prompt" data-title="" id="34b86ee9"><p id="7bddf689"><b id="735f3d1a" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-35226" id="d808307c" data-external="true" rel="noopener noreferrer">KT-35226</a></p>
<p id="6db81f28"><b id="c0c667bc" class="">Component</b>: Core language</p>
<p id="17efce4a"><b id="94791827" class="">Incompatible change type</b>: source</p>
<p id="c188d7ac"><b id="60af6b55" class="">Short summary</b>: Kotlin 1.5 will outlaw the use of spread operator (*) on signature-polymorphic calls</p>
<p id="e3becb6e"><b id="20167ebc" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="50067553">
<li class="list__item" id="68a6d040"><p>&lt; 1.5: introduce warning for the problematic operator at call-site</p></li>
<li class="list__item" id="337f90b"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitSpreadOnSignaturePolymorphicCall</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="forbid-non-abstract-classes-containing-abstract-members-invisible-from-that-classes-internal-package-private" data-toc="compatibility-guide-15#forbid-non-abstract-classes-containing-abstract-members-invisible-from-that-classes-internal-package-private">Forbid non-abstract classes containing abstract members invisible from that classes (internal/package-private)</h3>
<aside data-type="tip" class="prompt" data-title="" id="12ab423a"><p id="d537d66e"><b id="d15e58ad" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-27825" id="7a66c122" data-external="true" rel="noopener noreferrer">KT-27825</a></p>
<p id="b773e35e"><b id="d828b5a1" class="">Component</b>: Core language</p>
<p id="f411092e"><b id="cb37ad30" class="">Incompatible change type</b>: source</p>
<p id="d361fc85"><b id="87893d87" class="">Short summary</b>: Kotlin 1.5 will outlaw non-abstract classes containing abstract members invisible from that classes (internal/package-private)</p>
<p id="f3876738"><b id="7b23dc8" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="df2aae5e">
<li class="list__item" id="ba82e30a"><p>&lt; 1.5: introduce warning for the problematic classes</p></li>
<li class="list__item" id="4c503207"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitInvisibleAbstractMethodsInSuperclasses</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="forbid-using-array-based-on-non-reified-type-parameters-as-reified-type-arguments-on-jvm" data-toc="compatibility-guide-15#forbid-using-array-based-on-non-reified-type-parameters-as-reified-type-arguments-on-jvm">Forbid using array based on non-reified type parameters as reified type arguments on JVM</h3>
<aside data-type="tip" class="prompt" data-title="" id="29cc52e7"><p id="3e8bcee6"><b id="bd97b873" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-31227" id="bd9ea77d" data-external="true" rel="noopener noreferrer">KT-31227</a></p>
<p id="62991c0e"><b id="9fa3c17b" class="">Component</b>: Core language</p>
<p id="1f35522d"><b id="e74f3951" class="">Incompatible change type</b>: source</p>
<p id="34fa789b"><b id="c15adfe4" class="">Short summary</b>: Kotlin 1.5 will outlaw using array based on non-reified type parameters as reified type arguments on JVM</p>
<p id="c40a948"><b id="5dd38044" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="760b634c">
<li class="list__item" id="19cfbe47"><p>&lt; 1.5: introduce warning for the problematic calls</p></li>
<li class="list__item" id="9bf397fb"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitNonReifiedArraysAsReifiedTypeArguments</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="forbid-secondary-enum-class-constructors-which-do-not-delegate-to-the-primary-constructor" data-toc="compatibility-guide-15#forbid-secondary-enum-class-constructors-which-do-not-delegate-to-the-primary-constructor">Forbid secondary enum class constructors which do not delegate to the primary constructor</h3>
<aside data-type="tip" class="prompt" data-title="" id="c5660041"><p id="b4d33b6e"><b id="b3a59ea5" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-35870" id="54694bd3" data-external="true" rel="noopener noreferrer">KT-35870</a></p>
<p id="11632c9a"><b id="41360196" class="">Component</b>: Core language</p>
<p id="edfa3610"><b id="939d4420" class="">Incompatible change type</b>: source</p>
<p id="e1d0e45e"><b id="662cc087" class="">Short summary</b>: Kotlin 1.5 will outlaw secondary enum class constructors which do not delegate to the primary constructor</p>
<p id="e52b81f9"><b id="411c9215" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="7d0ea29e">
<li class="list__item" id="e7f574e4"><p>&lt; 1.5: introduce warning for the problematic constructors</p></li>
<li class="list__item" id="e4ef27cf"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-RequiredPrimaryConstructorDelegationCallInEnums</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="forbid-exposing-anonymous-types-from-private-inline-functions" data-toc="compatibility-guide-15#forbid-exposing-anonymous-types-from-private-inline-functions">Forbid exposing anonymous types from private inline functions</h3>
<aside data-type="tip" class="prompt" data-title="" id="28cd1fd9"><p id="bab950c4"><b id="ac0b4dbb" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-33917" id="31eeb1a9" data-external="true" rel="noopener noreferrer">KT-33917</a></p>
<p id="d3a112a2"><b id="de4c1980" class="">Component</b>: Core language</p>
<p id="428e05e0"><b id="3cf46471" class="">Incompatible change type</b>: source</p>
<p id="256ed680"><b id="a6230ece" class="">Short summary</b>: Kotlin 1.5 will outlaw exposing anonymous types from private inline functions</p>
<p id="cff9a9e3"><b id="11e8260" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="34af1d15">
<li class="list__item" id="23eaaf0e"><p>&lt; 1.5: introduce warning for the problematic constructors</p></li>
<li class="list__item" id="60dceaad"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-ApproximateAnonymousReturnTypesInPrivateInlineFunctions</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="forbid-passing-non-spread-arrays-after-arguments-with-sam-conversion" data-toc="compatibility-guide-15#forbid-passing-non-spread-arrays-after-arguments-with-sam-conversion">Forbid passing non-spread arrays after arguments with SAM-conversion</h3>
<aside data-type="tip" class="prompt" data-title="" id="3beb0d81"><p id="99c3ece4"><b id="4575986f" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-35224" id="dba2c7c2" data-external="true" rel="noopener noreferrer">KT-35224</a></p>
<p id="97d07608"><b id="c8a6aa06" class="">Component</b>: Core language</p>
<p id="ff6966e6"><b id="627e905a" class="">Incompatible change type</b>: source</p>
<p id="e924f3f1"><b id="58f08b56" class="">Short summary</b>: Kotlin 1.5 will outlaw passing non-spread arrays after arguments with SAM-conversion</p>
<p id="f39031e0"><b id="b090738a" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="68e935b1">
<li class="list__item" id="8c047a32"><p>1.3.70: introduce warning for the problematic calls</p></li>
<li class="list__item" id="6a7f85fe"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-ProhibitVarargAsArrayAfterSamArgument</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="support-special-semantics-for-underscore-named-catch-block-parameters" data-toc="compatibility-guide-15#support-special-semantics-for-underscore-named-catch-block-parameters">Support special semantics for underscore-named catch block parameters</h3>
<aside data-type="tip" class="prompt" data-title="" id="ae6bbb49"><p id="7f50670b"><b id="ff3f71ba" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-31567" id="2d16b826" data-external="true" rel="noopener noreferrer">KT-31567</a></p>
<p id="591cb8eb"><b id="542134" class="">Component</b>: Core language</p>
<p id="db8ce2ab"><b id="3536d30" class="">Incompatible change type</b>: source</p>
<p id="28eaffe3"><b id="cf9d57fc" class="">Short summary</b>: Kotlin 1.5 will outlaw references to the underscore symbol (<code class="code ">_</code>) that is used to omit parameter name of an exception in the catch block</p>
<p id="f3faeb38"><b id="1a0c11b4" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="135a18fe">
<li class="list__item" id="e621cb6a"><p>1.4.20: introduce warning for the problematic references</p></li>
<li class="list__item" id="45c8583a"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-ForbidReferencingToUnderscoreNamedParameterOfCatchBlock</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="change-implementation-strategy-of-sam-conversion-from-anonymous-class-based-to-invokedynamic" data-toc="compatibility-guide-15#change-implementation-strategy-of-sam-conversion-from-anonymous-class-based-to-invokedynamic">Change implementation strategy of SAM conversion from anonymous class-based to invokedynamic</h3>
<aside data-type="tip" class="prompt" data-title="" id="12645fb6"><p id="5e3a7cd5"><b id="f2be3817" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-44912" id="b4207af" data-external="true" rel="noopener noreferrer">KT-44912</a></p>
<p id="63be8a58"><b id="14276f8" class="">Component</b>: Kotlin/JVM</p>
<p id="de429f88"><b id="a063ebc7" class="">Incompatible change type</b>: behavioral</p>
<p id="e5a1c7dc"><b id="3c96beb3" class="">Short summary</b>: Since Kotlin 1.5, implementation strategy of SAM (single abstract method) conversion will be changed from generating an anonymous class to using the <code class="code ">invokedynamic</code> JVM instruction</p>
<p id="3beea8a0"><b id="b7bcd35d" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="c0fa48da"><li class="list__item" id="23a4f0ae"><p>1.5: change implementation strategy of SAM conversion, <code class="code ">-Xsam-conversions=class</code> can be used to revert implementation scheme to the one that used before</p></li></ul></aside></section><section class="chapter"><h3 id="performance-issues-with-the-jvm-ir-based-backend" data-toc="compatibility-guide-15#performance-issues-with-the-jvm-ir-based-backend">Performance issues with the JVM IR-based backend</h3>
<aside data-type="tip" class="prompt" data-title="" id="5f5290a3"><p id="14bb9d38"><b id="a8d81d" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-48233" id="855468f2" data-external="true" rel="noopener noreferrer">KT-48233</a></p>
<p id="3ecd5dfe"><b id="206325d6" class="">Component</b>: Kotlin/JVM</p>
<p id="78d21b36"><b id="105e74d" class="">Incompatible change type</b>: behavioral</p>
<p id="ce552f55"><b id="7160ae7d" class="">Short summary</b>: Kotlin 1.5 uses the <a href="https://blog.jetbrains.com/kotlin/2021/02/the-jvm-backend-is-in-beta-let-s-make-it-stable-together/" id="892254f3" data-external="true" rel="noopener noreferrer">IR-based backend</a> for the Kotlin/JVM compiler by default. The old backend is still used by default for earlier language versions.</p>
<p id="ec88d434">You might encounter some performance degradation issues using the new compiler in Kotlin 1.5. We are working on fixing such cases.</p>
<p id="543c67d"><b id="5092d878" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="560bdb1c">
<li class="list__item" id="d413d7ca"><p>&lt; 1.5: by default, the old JVM backend is used</p></li>
<li class="list__item" id="36339ccf"><p>&gt;= 1.5: by default, the IR-based backend is used. If you need to use the old backend in Kotlin 1.5, add the following lines to the project's configuration file to temporarily revert to pre-1.5 behavior:</p></li>
</ul>
<p id="86eb869d">In Gradle:</p>
<div class="tabs" id="aa2f53fa"> <div class="tabs__content" data-gtm="tab" id="ec6acd97" data-title="Kotlin"><pre class="code-block" data-lang="kotlin" data-title="Kotlin" data-language="kotlin">tasks.withType&lt;org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile&gt; { kotlinOptions.useOldBackend = true } </pre></div> <div class="tabs__content" data-gtm="tab" id="261b51f4" data-title="Groovy"><pre class="code-block" data-lang="groovy" data-title="Groovy" data-language="groovy">tasks.withType(org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile) { kotlinOptions.useOldBackend = true } </pre></div>
</div>
<p id="dd20858e">In Maven:</p>
<pre class="code-block" data-lang="markup" data-language="markup">&lt;configuration&gt; &lt;args&gt; &lt;arg&gt;-Xuse-old-backend&lt;/arg&gt; &lt;/args&gt; &lt;/configuration&gt; </pre>
<p id="42667067">Support for this flag will be removed in one of the future releases.</p></aside></section><section class="chapter"><h3 id="new-field-sorting-in-the-jvm-ir-based-backend" data-toc="compatibility-guide-15#new-field-sorting-in-the-jvm-ir-based-backend">New field sorting in the JVM IR-based backend</h3>
<aside data-type="tip" class="prompt" data-title="" id="5bb0b402"><p id="ac87f43c"><b id="b365128b" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-46378" id="c2f06072" data-external="true" rel="noopener noreferrer">KT-46378</a></p>
<p id="d46bb4cc"><b id="9b3430ac" class="">Component</b>: Kotlin/JVM</p>
<p id="14a11838"><b id="1336e7bd" class="">Incompatible change type</b>: behavioral</p>
<p id="5932e075"><b id="445b4cfd" class="">Short summary</b>: Since version 1.5, Kotlin uses the <a href="https://blog.jetbrains.com/kotlin/2021/02/the-jvm-backend-is-in-beta-let-s-make-it-stable-together/" id="bf94e2b5" data-external="true" rel="noopener noreferrer">IR-based backend</a> that sorts JVM bytecode differently: it generates fields declared in the constructor before fields declared in the body, while it's vice versa for the old backend. The new sorting may change the behavior of programs that use serialization frameworks that depend on the field order, such as Java serialization.</p>
<p id="5f2e20bf"><b id="4b402946" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="c45250a9">
<li class="list__item" id="68db2a2b"><p>&lt; 1.5: by default, the old JVM backend is used. It has fields declared in the body before fields declared in the constructor.</p></li>
<li class="list__item" id="ddaa6346"><p>&gt;= 1.5: by default, the new IR-based backend is used. Fields declared in the constructor are generated before fields declared in the body. As a workaround, you can temporarily switch to the old backend in Kotlin 1.5. To do that, add the following lines to the project's configuration file:</p></li>
</ul>
<p id="bb661cc1">In Gradle:</p>
<div class="tabs" id="1524ca0b"> <div class="tabs__content" data-gtm="tab" id="372e8dbb" data-title="Kotlin"><pre class="code-block" data-lang="kotlin" data-title="Kotlin" data-language="kotlin">tasks.withType&lt;org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile&gt; { kotlinOptions.useOldBackend = true } </pre></div> <div class="tabs__content" data-gtm="tab" id="17ba1b9b" data-title="Groovy"><pre class="code-block" data-lang="groovy" data-title="Groovy" data-language="groovy">tasks.withType(org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile) { kotlinOptions.useOldBackend = true } </pre></div>
</div>
<p id="fcad5f6">In Maven:</p>
<pre class="code-block" data-lang="markup" data-language="markup">&lt;configuration&gt; &lt;args&gt; &lt;arg&gt;-Xuse-old-backend&lt;/arg&gt; &lt;/args&gt; &lt;/configuration&gt; </pre>
<p id="fa0e3ff7">Support for this flag will be removed in one of the future releases.</p></aside></section><section class="chapter"><h3 id="generate-nullability-assertion-for-delegated-properties-with-a-generic-call-in-the-delegate-expression" data-toc="compatibility-guide-15#generate-nullability-assertion-for-delegated-properties-with-a-generic-call-in-the-delegate-expression">Generate nullability assertion for delegated properties with a generic call in the delegate expression</h3>
<aside data-type="tip" class="prompt" data-title="" id="b2a36fe4"><p id="17af4114"><b id="4fdcf491" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-44304" id="769c8693" data-external="true" rel="noopener noreferrer">KT-44304</a></p>
<p id="e34c57c9"><b id="b72e8442" class="">Component</b>: Kotlin/JVM</p>
<p id="2e47f5f0"><b id="b2b9015b" class="">Incompatible change type</b>: behavioral</p>
<p id="51a0a5a"><b id="e74aa1af" class="">Short summary</b>: Since Kotlin 1.5, the Kotlin compiler will emit nullability assertions for delegated properties with a generic call in the delegate expression</p>
<p id="7c262242"><b id="5003ec67" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="67bee630"><li class="list__item" id="8e58a6e7"><p>1.5: emit nullability assertion for delegated properties (see details in the issue), <code class="code ">-Xuse-old-backend</code> or <code class="code ">-language-version 1.4</code> can be used to temporarily revert to pre-1.5 behavior</p></li></ul></aside></section><section class="chapter"><h3 id="turn-warnings-into-errors-for-calls-with-type-parameters-annotated-by-onlyinputtypes" data-toc="compatibility-guide-15#turn-warnings-into-errors-for-calls-with-type-parameters-annotated-by-onlyinputtypes">Turn warnings into errors for calls with type parameters annotated by @OnlyInputTypes</h3>
<aside data-type="tip" class="prompt" data-title="" id="53c37d1"><p id="332ffd68"><b id="4ea001d2" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-45861" id="e3125d18" data-external="true" rel="noopener noreferrer">KT-45861</a></p>
<p id="d5cf8259"><b id="17a5b075" class="">Component</b>: Core language</p>
<p id="b91e286d"><b id="f56849b6" class="">Incompatible change type</b>: source</p>
<p id="28d92e55"><b id="4615bc29" class="">Short summary</b>: Kotlin 1.5 will outlaw calls like <code class="code ">contains</code>, <code class="code ">indexOf</code>, and <code class="code ">assertEquals</code> with senseless arguments to improve type safety</p>
<p id="4f49b9ce"><b id="6895c4ab" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="62608372">
<li class="list__item" id="a9d90d56"><p>1.4.0: introduce warning for the problematic constructors</p></li>
<li class="list__item" id="2b2d7d6f"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-StrictOnlyInputTypesChecks</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="use-the-correct-order-of-arguments-execution-in-calls-with-named-vararg" data-toc="compatibility-guide-15#use-the-correct-order-of-arguments-execution-in-calls-with-named-vararg">Use the correct order of arguments execution in calls with named vararg</h3>
<aside data-type="tip" class="prompt" data-title="" id="e448ef09"><p id="5f58da4d"><b id="cb778ab" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-17691" id="43986f67" data-external="true" rel="noopener noreferrer">KT-17691</a></p>
<p id="bb013351"><b id="59c32628" class="">Component</b>: Kotlin/JVM</p>
<p id="3973f6cb"><b id="1fbf1c8d" class="">Incompatible change type</b>: behavioral</p>
<p id="57c8c0c"><b id="f38be6e1" class="">Short summary</b>: Kotlin 1.5 will change the order of arguments execution in calls with named vararg</p>
<p id="a47f8617"><b id="80af4453" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="e56f9359">
<li class="list__item" id="4794d483"><p>&lt; 1.5: introduce warning for the problematic constructors</p></li>
<li class="list__item" id="4cae2264"><p>&gt;= 1.5: raise this warning to an error, <code class="code ">-XXLanguage:-UseCorrectExecutionOrderForVarargArguments</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="use-default-value-of-the-parameter-in-operator-functional-calls" data-toc="compatibility-guide-15#use-default-value-of-the-parameter-in-operator-functional-calls">Use default value of the parameter in operator functional calls</h3>
<aside data-type="tip" class="prompt" data-title="" id="ac8a806c"><p id="ad3fd3c8"><b id="2361f4f1" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-42064" id="917eb668" data-external="true" rel="noopener noreferrer">KT-42064</a></p>
<p id="ed8c1d81"><b id="5b6ae703" class="">Component</b>: Kotlin/JVM</p>
<p id="966dbd74"><b id="414d4c92" class="">Incompatible change type</b>: behavioral</p>
<p id="59b9a90d"><b id="1cbfc940" class="">Short summary</b>: Kotlin 1.5 will use default value of the parameter in operator calls</p>
<p id="188c386f"><b id="5a38b45f" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="d3571636">
<li class="list__item" id="39bf97a9"><p>&lt; 1.5: old behavior (see details in the issue)</p></li>
<li class="list__item" id="22b716c7"><p>&gt;= 1.5: behavior changed, <code class="code ">-XXLanguage:-JvmIrEnabledByDefault</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="produce-empty-reversed-progressions-in-for-loops-if-regular-progression-is-also-empty" data-toc="compatibility-guide-15#produce-empty-reversed-progressions-in-for-loops-if-regular-progression-is-also-empty">Produce empty reversed progressions in for loops if regular progression is also empty</h3>
<aside data-type="tip" class="prompt" data-title="" id="477e6085"><p id="f0952d2a"><b id="ea3d5a96" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-42533" id="27edd39" data-external="true" rel="noopener noreferrer">KT-42533</a></p>
<p id="1c6be6da"><b id="763f1458" class="">Component</b>: Kotlin/JVM</p>
<p id="45222d3f"><b id="273e3ae4" class="">Incompatible change type</b>: behavioral</p>
<p id="e841019f"><b id="2a4c338e" class="">Short summary</b>: Kotlin 1.5 will produce empty reversed progressions in for loops if regular progression is also empty</p>
<p id="1d4a82c3"><b id="77a6c4b8" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="c69d4840">
<li class="list__item" id="5c749759"><p>&lt; 1.5: old behavior (see details in the issue)</p></li>
<li class="list__item" id="24911e52"><p>&gt;= 1.5: behavior changed, <code class="code ">-XXLanguage:-JvmIrEnabledByDefault</code> can be used to temporarily revert to pre-1.5 behavior</p></li>
</ul></aside></section><section class="chapter"><h3 id="straighten-char-to-code-and-char-to-digit-conversions-out" data-toc="compatibility-guide-15#straighten-char-to-code-and-char-to-digit-conversions-out">Straighten Char-to-code and Char-to-digit conversions out</h3>
<aside data-type="tip" class="prompt" data-title="" id="c48239da"><p id="6409ff15"><b id="cd3dcc25" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-23451" id="49247e3" data-external="true" rel="noopener noreferrer">KT-23451</a></p>
<p id="30fc3d32"><b id="5ad20fd7" class="">Component</b>: kotlin-stdlib</p>
<p id="84d5e48a"><b id="bcce31c" class="">Incompatible change type</b>: source</p>
<p id="19472be8"><b id="3996518d" class="">Short summary</b>: Since Kotlin 1.5, conversions of Char to number types will be deprecated</p>
<p id="d0096c40"><b id="f78df186" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="2fd3dceb"><li class="list__item" id="6ad45a64"><p>1.5: deprecate <code class="code ">Char.toInt()/toShort()/toLong()/toByte()/toDouble()/toFloat()</code> and the reverse functions like <code class="code ">Long.toChar()</code>, and propose replacement</p></li></ul></aside></section><section class="chapter"><h3 id="inconsistent-case-insensitive-comparison-of-characters-in-kotlin-text-functions" data-toc="compatibility-guide-15#inconsistent-case-insensitive-comparison-of-characters-in-kotlin-text-functions">Inconsistent case-insensitive comparison of characters in kotlin.text functions</h3>
<aside data-type="tip" class="prompt" data-title="" id="e9f7622f"><p id="d9bacc69"><b id="a589296b" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-45496" id="2ae76eaf" data-external="true" rel="noopener noreferrer">KT-45496</a></p>
<p id="c763ed9d"><b id="a7460972" class="">Component</b>: kotlin-stdlib</p>
<p id="9155d2f2"><b id="8f3e5911" class="">Incompatible change type</b>: behavioral</p>
<p id="b416914b"><b id="bf19c13f" class="">Short summary</b>: Since Kotlin 1.5, <code class="code ">Char.equals</code> will be improved in case-insensitive case by first comparing whether the uppercase variants of characters are equal, then whether the lowercase variants of those uppercase variants (as opposed to the characters themselves) are equal</p>
<p id="692e1332"><b id="f8644eed" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="9fe2bddb">
<li class="list__item" id="14965419"><p>&lt; 1.5: old behavior (see details in the issue)</p></li>
<li class="list__item" id="1ccf8279"><p>1.5: change behavior for <code class="code ">Char.equals</code> function</p></li>
</ul></aside></section><section class="chapter"><h3 id="remove-default-locale-sensitive-case-conversion-api" data-toc="compatibility-guide-15#remove-default-locale-sensitive-case-conversion-api">Remove default locale-sensitive case conversion API</h3>
<aside data-type="tip" class="prompt" data-title="" id="91de9248"><p id="2a60df76"><b id="124f6e27" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-43023" id="a09b3472" data-external="true" rel="noopener noreferrer">KT-43023</a></p>
<p id="dfdd0f5a"><b id="a6ae0954" class="">Component</b>: kotlin-stdlib</p>
<p id="4b9858de"><b id="892abe6e" class="">Incompatible change type</b>: source</p>
<p id="3de9a2e3"><b id="e61dc3a9" class="">Short summary</b>: Since Kotlin 1.5, default locale-sensitive case conversion functions like <code class="code ">String.toUpperCase()</code> will be deprecated</p>
<p id="b1103039"><b id="8b090510" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="14a8580f"><li class="list__item" id="586309af"><p>1.5: deprecate case conversions functions with the default locale (see details in the issue), and propose replacement</p></li></ul></aside></section><section class="chapter"><h3 id="gradually-change-the-return-type-of-collection-min-and-max-functions-to-non-nullable" data-toc="compatibility-guide-15#gradually-change-the-return-type-of-collection-min-and-max-functions-to-non-nullable">Gradually change the return type of collection min and max functions to non-nullable</h3>
<aside data-type="tip" class="prompt" data-title="" id="35492f2f"><p id="5b59d812"><b id="b01fb893" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-38854" id="7c2f9712" data-external="true" rel="noopener noreferrer">KT-38854</a></p>
<p id="e2a60d44"><b id="ebad1e00" class="">Component</b>: kotlin-stdlib (JVM)</p>
<p id="a03489cc"><b id="31bd6db" class="">Incompatible change type</b>: source</p>
<p id="19bfb337"><b id="2195a8fb" class="">Short summary</b>: return type of collection <code class="code ">min</code> and <code class="code ">max</code> functions will be changed to non-nullable in 1.6</p>
<p id="a1257a06"><b id="493be992" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="c1aebaa2">
<li class="list__item" id="10e5a359"><p>1.4: introduce <code class="code ">...OrNull</code> functions as synonyms and deprecate the affected API (see details in the issue)</p></li>
<li class="list__item" id="3f35bf68"><p>1.5.0: raise the deprecation level of the affected API to error</p></li>
<li class="list__item" id="e24bac4e"><p>&gt;=1.6: reintroduce the affected API but with non-nullable return type</p></li>
</ul></aside></section><section class="chapter"><h3 id="raise-the-deprecation-level-of-conversions-of-floating-point-types-to-short-and-byte" data-toc="compatibility-guide-15#raise-the-deprecation-level-of-conversions-of-floating-point-types-to-short-and-byte">Raise the deprecation level of conversions of floating-point types to Short and Byte</h3>
<aside data-type="tip" class="prompt" data-title="" id="48f6fe7a"><p id="1c0282e9"><b id="66783014" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-30360" id="afe817b8" data-external="true" rel="noopener noreferrer">KT-30360</a></p>
<p id="a2838fa2"><b id="81d532c9" class="">Component</b>: kotlin-stdlib (JVM)</p>
<p id="1b732848"><b id="78450113" class="">Incompatible change type</b>: source</p>
<p id="eacfe149"><b id="4b66dcc8" class="">Short summary</b>: conversions of floating-point types to <code class="code ">Short</code> and <code class="code ">Byte</code> deprecated in Kotlin 1.4 with <code class="code ">WARNING</code> level will cause errors since Kotlin 1.5.0.</p>
<p id="5a4db6ad"><b id="37fb142c" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="65bbaf75">
<li class="list__item" id="3b180da8"><p>1.4: deprecate <code class="code ">Double.toShort()/toByte()</code> and <code class="code ">Float.toShort()/toByte()</code> and propose replacement</p></li>
<li class="list__item" id="eb2307b6"><p>1.5.0: raise the deprecation level to error</p></li>
</ul></aside></section></section><section class="chapter"><h2 id="tools" data-toc="compatibility-guide-15#tools">Tools</h2>
<section class="chapter"><h3 id="do-not-mix-several-jvm-variants-of-kotlin-test-in-a-single-project" data-toc="compatibility-guide-15#do-not-mix-several-jvm-variants-of-kotlin-test-in-a-single-project">Do not mix several JVM variants of kotlin-test in a single project</h3>
<aside data-type="tip" class="prompt" data-title="" id="9006980a"><p id="29a6138a"><b id="a44a27ca" class="">Issue</b>: <a href="https://youtrack.jetbrains.com/issue/KT-40225" id="a662f9c0" data-external="true" rel="noopener noreferrer">KT-40225</a></p>
<p id="452a2f8a"><b id="3da81034" class="">Component</b>: Gradle</p>
<p id="55b42006"><b id="c158dcd3" class="">Incompatible change type</b>: behavioral</p>
<p id="7f188931"><b id="3869ba4f" class="">Short summary</b>: several mutually exclusive <code class="code ">kotlin-test</code> variants for different testing frameworks could have been in a project if one of them is brought by a transitive dependency. From 1.5.0, Gradle won't allow having mutually exclusive <code class="code ">kotlin-test</code> variants for different testing frameworks.</p>
<p id="ab861225"><b id="c0c9c3e" class="">Deprecation cycle</b>:</p>
<ul class="list _ul" id="266fa08c">
<li class="list__item" id="a9a20fa1"><p>&lt; 1.5: having several mutually exclusive <code class="code ">kotlin-test</code> variants for different testing frameworks is allowed</p></li>
<li class="list__item" id="3938f1f">
<p>&gt;= 1.5: behavior changed, </p>
<br><p> Gradle throws an exception like "Cannot select module with conflict on capability...". Possible solutions: </p>
<ul class="list _ul" id="17543ae4">
<li class="list__item" id="5bb3c476"><p id="401e2340">use the same <code class="code ">kotlin-test</code> variant and the corresponding testing framework as the transitive dependency brings.</p></li>
<li class="list__item" id="bd18bc2c"><p id="5bb7390">find another variant of the dependency that doesn't bring the <code class="code ">kotlin-test</code> variant transitively, so you can use the testing framework you would like to use.</p></li>
<li class="list__item" id="f141e8bf"><p id="9fc78979">find another variant of the dependency that brings another <code class="code ">kotlin-test</code> variant transitively, which uses the same testing framework you would like to use.</p></li>
<li class="list__item" id="99d171d9">
<p id="c70c7b92">exclude the testing framework that is brought transitively. The following example is for excluding JUnit 4:</p>
<pre class="code-block" data-lang="groovy" data-language="groovy">configurations { testImplementation.get().exclude("org.jetbrains.kotlin", "kotlin-test-junit") } </pre>
<p id="49140466">After excluding the testing framework, test your application. If it stopped working, rollback excluding changes, use the same testing framework as the library does, and exclude your testing framework.</p>
</li>
</ul>
</li>
</ul></aside></section></section><div class="last-modified"> Last modified: 15 October 2021</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="compatibility-guide-16">Compatibility guide for Kotlin 1.6</a> <a class="navigation-links__next" href="compatibility-guide-14">Compatibility guide for Kotlin 1.4</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/compatibility-guide-15.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/compatibility-guide-15.html</a>
  </p>
</div>
