<h1 data-toc="native-faq" id="native-faq.md">Kotlin/Native FAQ</h1>
<section class="chapter"><h2 id="how-do-i-run-my-program" data-toc="native-faq#how-do-i-run-my-program">How do I run my program?</h2>
<p id="11737f7b">Define a top-level function <code class="code ">fun main(args: Array&lt;String&gt;)</code> or just <code class="code ">fun main()</code> if you are not interested in passed arguments, please ensure it's not in a package. Also compiler switch <code class="code ">-entry</code> could be used to make any function taking <code class="code ">Array&lt;String&gt;</code> or no arguments and return <code class="code ">Unit</code> as an entry point.</p></section><section class="chapter"><h2 id="what-is-kotlin-native-memory-management-model" data-toc="native-faq#what-is-kotlin-native-memory-management-model">What is Kotlin/Native memory management model?</h2>
<p id="f2c1a36f">Kotlin/Native provides an automated memory management scheme, similar to what Java or Swift provides. The current implementation includes an automated reference counter with a cycle collector to collect cyclical garbage.</p></section><section class="chapter"><h2 id="how-do-i-create-a-shared-library" data-toc="native-faq#how-do-i-create-a-shared-library">How do I create a shared library?</h2>
<p id="df15f19f">Use the <code class="code ">-produce dynamic</code> compiler switch, or <code class="code ">binaries.sharedLib()</code> in Gradle.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">kotlin { iosArm64("mylib") { binaries.sharedLib() } } </pre>
<p id="e2471c71">It will produce a platform-specific shared object (<code class="code ">.so</code> on Linux, <code class="code ">.dylib</code> on macOS, and <code class="code ">.dll</code> on Windows targets) and a C language header, allowing the use of all public APIs available in your Kotlin/Native program from C/C++ code. See <a href="https://github.com/JetBrains/kotlin/tree/master/kotlin-native/samples/python_extension" id="29e24ce" data-external="true" rel="noopener noreferrer">this example</a> of using such a shared object to provide a bridge between Python and Kotlin/Native.</p></section><section class="chapter"><h2 id="how-do-i-create-a-static-library-or-an-object-file" data-toc="native-faq#how-do-i-create-a-static-library-or-an-object-file">How do I create a static library or an object file?</h2>
<p id="a1e84588">Use the <code class="code ">-produce static</code> compiler switch, or <code class="code ">binaries.staticLib()</code> in Gradle.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">kotlin { iosArm64("mylib") { binaries.staticLib() } } </pre>
<p id="94f51a31">It will produce a platform-specific static object (<code class="code ">.a</code> library format) and a C language header, allowing you to use all the public APIs available in your Kotlin/Native program from C/C++ code.</p></section><section class="chapter"><h2 id="how-do-i-run-kotlin-native-behind-a-corporate-proxy" data-toc="native-faq#how-do-i-run-kotlin-native-behind-a-corporate-proxy">How do I run Kotlin/Native behind a corporate proxy?</h2>
<p id="4885f704">As Kotlin/Native needs to download a platform specific toolchain, you need to specify <code class="code ">-Dhttp.proxyHost=xxx -Dhttp.proxyPort=xxx</code> as the compiler's or <code class="code ">gradlew</code> arguments, or set it via the <code class="code ">JAVA_OPTS</code> environment variable.</p></section><section class="chapter"><h2 id="how-do-i-specify-a-custom-objective-c-prefix-name-for-my-kotlin-framework" data-toc="native-faq#how-do-i-specify-a-custom-objective-c-prefix-name-for-my-kotlin-framework">How do I specify a custom Objective-C prefix/name for my Kotlin framework?</h2>
<p id="b3c4a89e">Use the <code class="code ">-module-name</code> compiler option or matching Gradle DSL statement.</p>
<div class="tabs" id="bdb4abfb" data-group="build-script">
<div class="tabs__content" data-gtm="tab" id="9716a740" data-sync-tabs="kotlin" data-title="Kotlin"><pre class="code-block" data-lang="kotlin" data-title="Kotlin" data-language="kotlin">kotlin { iosArm64("myapp") { binaries.framework { freeCompilerArgs += listOf("-module-name", "TheName") } } } </pre></div>
<div class="tabs__content" data-gtm="tab" id="cdb2b8f2" data-sync-tabs="groovy" data-title="Groovy"><pre class="code-block" data-lang="groovy" data-title="Groovy" data-language="groovy">kotlin { iosArm64("myapp") { binaries.framework { freeCompilerArgs += ["-module-name", "TheName"] } } } </pre></div>
</div></section><section class="chapter"><h2 id="how-do-i-rename-the-ios-framework" data-toc="native-faq#how-do-i-rename-the-ios-framework">How do I rename the iOS framework?</h2>
<p id="7b477eb2">The default name is for an iOS framework is <code class="code ">&lt;project name&gt;.framework</code>. To set a custom name, use the <code class="code ">baseName</code> option. This will also set the module name.</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">kotlin { iosArm64("myapp") { binaries { framework { baseName = "TheName" } } } } </pre></section><section class="chapter"><h2 id="how-do-i-enable-bitcode-for-my-kotlin-framework" data-toc="native-faq#how-do-i-enable-bitcode-for-my-kotlin-framework">How do I enable bitcode for my Kotlin framework?</h2>
<p id="5d9008f1">By default gradle plugin adds it on iOS target.</p>
<ul class="list _ul" id="311eb922">
<li class="list__item" id="855fbad2"><p>For debug build it embeds placeholder LLVM IR data as a marker.</p></li>
<li class="list__item" id="c6d78dcb"><p>For release build it embeds bitcode as data.</p></li>
</ul>
<p id="f29cfba2">Or commandline arguments: <code class="code ">-Xembed-bitcode</code> (for release) and <code class="code ">-Xembed-bitcode-marker</code> (debug)</p>
<p id="5615bddb">Setting this in a Gradle DSL:</p>
<pre class="code-block" data-lang="kotlin" data-language="kotlin">kotlin { iosArm64("myapp") { binaries { framework { // Use "marker" to embed the bitcode marker (for debug builds). // Use "disable" to disable embedding. embedBitcode("bitcode") // for release binaries. } } } } </pre>
<p id="fcdeddc5">These options have nearly the same effect as clang's <code class="code ">-fembed-bitcode</code>/<code class="code ">-fembed-bitcode-marker</code> and swiftc's <code class="code ">-embed-bitcode</code>/<code class="code ">-embed-bitcode-marker</code>.</p></section><section class="chapter"><h2 id="why-do-i-see-invalidmutabilityexception" data-toc="native-faq#why-do-i-see-invalidmutabilityexception">Why do I see InvalidMutabilityException?</h2>
<p id="47f546e1">It likely happens, because you are trying to mutate a frozen object. An object can transfer to the frozen state either explicitly, as objects reachable from objects on which the <code class="code ">kotlin.native.concurrent.freeze</code> is called, or implicitly (i.e. reachable from <code class="code ">enum</code> or global singleton object - see the next question).</p></section><section class="chapter"><h2 id="how-do-i-make-a-singleton-object-mutable" data-toc="native-faq#how-do-i-make-a-singleton-object-mutable">How do I make a singleton object mutable?</h2>
<p id="2f6b4495">Currently, singleton objects are immutable (i.e. frozen after creation), and it's generally considered good practise to have the global state immutable. If for some reason you need a mutable state inside such an object, use the <code class="code ">@konan.ThreadLocal</code> annotation on the object. Also the <code class="code ">kotlin.native.concurrent.AtomicReference</code> class could be used to store different pointers to frozen objects in a frozen object and automatically update them.</p></section><section class="chapter"><h2 id="how-can-i-compile-my-project-with-unreleased-versions-of-kotlin-native" data-toc="native-faq#how-can-i-compile-my-project-with-unreleased-versions-of-kotlin-native">How can I compile my project with unreleased versions of Kotlin/Native?</h2>
<p id="872288ca">First, please consider trying <a href="eap" id="6a261cb">preview versions</a>.</p>
<p id="79a997a1">In case you need an even more recent development version, you can build Kotlin/Native from source code: clone <a href="https://github.com/JetBrains/kotlin" id="a6a44eef" data-external="true" rel="noopener noreferrer">Kotlin repository</a> and follow <a href="https://github.com/JetBrains/kotlin/blob/master/kotlin-native/README.md#building-from-source" id="353c56ae" data-external="true" rel="noopener noreferrer">these steps</a>.</p></section><div class="last-modified"> Last modified: 08 September 2021</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="native-improving-compilation-time">Tips for improving Kotlin/Native compilation times</a> <a class="navigation-links__next" href="native-app-with-c-and-libcurl">Create an app using C Interop and libcurl â€“ tutorial</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/native-faq.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/native-faq.html</a>
  </p>
</div>
