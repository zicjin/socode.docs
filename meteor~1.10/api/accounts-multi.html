<p>The <code>accounts-base</code> package exports two constructors, called <code>AccountsClient</code> and <code>AccountsServer</code>, which are used to create the <code>Accounts</code> object that is available on the client and the server, respectively.</p> <p>This predefined <code>Accounts</code> object (along with similar convenience methods of <code>Meteor</code>, such as <a href="#meteor_logout"><code>Meteor.logout</code></a>) is sufficient to implement most accounts-related logic in Meteor apps. Nevertheless, these two constructors can be instantiated more than once, to create multiple independent connections between different accounts servers and their clients, in more complicated authentication situations.</p>  <h2 class="api-heading" id="AccountsCommon"> <div class="locus"> Anywhere </div> <code>new AccountsCommon(options)</code> <div class="subtext-api"> <code>import { AccountsCommon } from 'meteor/accounts-base'</code> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L21" target="_blank"> (accounts-base/accounts_common.js, line 21) </a> </div> </h2>   <p>Super-constructor for AccountsClient and AccountsServer.</p>    <p>The <code>AccountsClient</code> and <code>AccountsServer</code> classes share a common superclass, <code>AccountsCommon</code>. Methods defined on <code>AccountsCommon.prototype</code> will be available on both the client and the server, via the predefined <code>Accounts</code> object (most common) or any custom <code>accountsClientOrServer</code> object created using the <code>AccountsClient</code> or <code>AccountsServer</code> constructors (less common).</p> <p>Here are a few of those methods:</p>  <h3 class="api-heading" id="AccountsCommon-userId"> <div class="locus"> Anywhere </div> <code>AccountsCommon#userId()</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L122" target="_blank"> (accounts-base/accounts_common.js, line 122) </a> </div> </h3>   <p>Get the current user id, or <code>null</code> if no user is logged in. A reactive data source.</p>     <h3 class="api-heading" id="AccountsCommon-user"> <div class="locus"> Anywhere </div> <code>AccountsCommon#user([options])</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L166" target="_blank"> (accounts-base/accounts_common.js, line 166) </a> </div> </h3>   <p>Get the current user record, or <code>null</code> if no user is logged in. A reactive data source.</p>  <h4 class="subheading">Options</h4> <dl class="args"> <dt> <code>fields</code> <span class="type"><a href="collections#fieldspecifiers">Mongo Field Specifier</a></span> </dt> <dd> <p>Dictionary of fields to return or exclude.</p> </dd> </dl>    <h3 class="api-heading" id="AccountsCommon-config"> <div class="locus"> Anywhere </div> <code>AccountsCommon#config(options)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L226" target="_blank"> (accounts-base/accounts_common.js, line 226) </a> </div> </h3>   <p>Set global accounts options. You can also set these in <code>Meteor.settings.packages.accounts</code> without the need to call this function.</p>  <h4 class="subheading">Options</h4> <dl class="args"> <dt> <code>sendVerificationEmail</code> <span class="type">Boolean</span> </dt> <dd> <p>New users with an email address will receive an address verification email.</p> </dd> <dt> <code>forbidClientAccountCreation</code> <span class="type">Boolean</span> </dt> <dd> <p>Calls to <a href="#accounts_createuser"><code>createUser</code></a> from the client will be rejected. In addition, if you are using <a href="#accountsui">accounts-ui</a>, the "Create account" link will not be available.</p> </dd> <dt> <code>restrictCreationByEmailDomain</code> <span class="type">String or Function</span> </dt> <dd> <p>If set to a string, only allows new users if the domain part of their email address matches the string. If set to a function, only allows new users if the function returns true. The function is passed the full email address of the proposed new user. Works with password-based sign-in and external services that expose email addresses (Google, Facebook, GitHub). All existing users still can log in after enabling this option. Example: <code>Accounts.config({ restrictCreationByEmailDomain: 'school.edu' })</code>.</p> </dd> <dt> <code>loginExpirationInDays</code> <span class="type">Number</span> </dt> <dd> <p>The number of days from when a user logs in until their token expires and they are logged out. Defaults to 90. Set to <code>null</code> to disable login expiration.</p> </dd> <dt> <code>loginExpiration</code> <span class="type">Number</span> </dt> <dd> <p>The number of milliseconds from when a user logs in until their token expires and they are logged out, for a more granular control. If <code>loginExpirationInDays</code> is set, it takes precedent.</p> </dd> <dt> <code>oauthSecretKey</code> <span class="type">String</span> </dt> <dd> <p>When using the <code>oauth-encryption</code> package, the 16 byte key using to encrypt sensitive account credentials in the database, encoded in base64. This option may only be specified on the server. See packages/oauth-encryption/README.md for details.</p> </dd> <dt> <code>passwordResetTokenExpirationInDays</code> <span class="type">Number</span> </dt> <dd> <p>The number of days from when a link to reset password is sent until token expires and user can't reset password with the link anymore. Defaults to 3.</p> </dd> <dt> <code>passwordResetTokenExpiration</code> <span class="type">Number</span> </dt> <dd> <p>The number of milliseconds from when a link to reset password is sent until token expires and user can't reset password with the link anymore. If <code>passwordResetTokenExpirationInDays</code> is set, it takes precedent.</p> </dd> <dt> <code>passwordEnrollTokenExpirationInDays</code> <span class="type">Number</span> </dt> <dd> <p>The number of days from when a link to set initial password is sent until token expires and user can't set password with the link anymore. Defaults to 30.</p> </dd> <dt> <code>passwordEnrollTokenExpiration</code> <span class="type">Number</span> </dt> <dd> <p>The number of milliseconds from when a link to set initial password is sent until token expires and user can't set password with the link anymore. If <code>passwordEnrollTokenExpirationInDays</code> is set, it takes precedent.</p> </dd> <dt> <code>ambiguousErrorMessages</code> <span class="type">Boolean</span> </dt> <dd> <p>Return ambiguous error messages from login failures to prevent user enumeration. Defaults to false.</p> </dd> <dt> <code>defaultFieldSelector</code> <span class="type"><a href="collections#fieldspecifiers">Mongo Field Specifier</a></span> </dt> <dd> <p>To exclude by default large custom fields from <code>Meteor.user()</code> and <code>Meteor.findUserBy...()</code> functions when called without a field selector, and all <code>onLogin</code>, <code>onLoginFailure</code> and <code>onLogout</code> callbacks. Example: <code>Accounts.config({ defaultFieldSelector: { myBigArray: 0 }})</code>. Beware when using this. If, for instance, you do not include <code>email</code> when excluding the fields, you can have problems with functions like <code>forgotPassword</code> that will break because they won't have the required data available. It's recommend that you always keep the fields <code>_id</code>, <code>username</code>, and <code>email</code>.</p> </dd> <dt> <code>loginTokenExpirationHours</code> <span class="type">Number</span> </dt> <dd> <p>When using the package <code>accounts-2fa</code>, use this to set the amount of time a token sent is valid. As it's just a number, you can use, for example, 0.5 to make the token valid for just half hour. The default is 1 hour.</p> </dd> <dt> <code>tokenSequenceLength</code> <span class="type">Number</span> </dt> <dd> <p>When using the package <code>accounts-2fa</code>, use this to the size of the token sequence generated. The default is 6.</p> </dd> </dl>   <p>From Meteor 2.5 you can set these in your Meteor settings under <code>Meteor.settings.packages.accounts-base</code>. Note that due to the nature of settings file you won’t be able to set parameters that require functions.</p>  <h3 class="api-heading" id="AccountsCommon-onLogin"> <div class="locus"> Anywhere </div> <code>AccountsCommon#onLogin(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L293" target="_blank"> (accounts-base/accounts_common.js, line 293) </a> </div> </h3>   <p>Register a callback to be called after a login attempt succeeds.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>The callback to be called when login is successful. The callback receives a single object that holds login details. This object contains the login result type (password, resume, etc.) on both the client and server. <code>onLogin</code> callbacks registered on the server also receive extra data, such as user details, connection information, etc.</p> </dd> </dl>   <p>See description of <a href="#accounts_onloginfailure">AccountsCommon#onLoginFailure</a> for details.</p>  <h3 class="api-heading" id="AccountsCommon-onLoginFailure"> <div class="locus"> Anywhere </div> <code>AccountsCommon#onLoginFailure(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L305" target="_blank"> (accounts-base/accounts_common.js, line 305) </a> </div> </h3>   <p>Register a callback to be called after a login attempt fails.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>The callback to be called after the login has failed.</p> </dd> </dl>   <p>Either the <code>onLogin</code> or the <code>onLoginFailure</code> callbacks will be called for each login attempt. The <code>onLogin</code> callbacks are called after the user has been successfully logged in. The <code>onLoginFailure</code> callbacks are called after a login attempt is denied.</p> <p>These functions return an object with a single method, <code>stop</code>. Calling <code>stop()</code> unregisters the callback.</p> <p>On the server, the callbacks get a single argument, the same attempt info object as <a href="#accounts_validateloginattempt"><code>validateLoginAttempt</code></a>. On the client, the callback argument is an object containing a single <code>error</code> property set to the <code>Error</code>-object which was received from the failed login attempt.</p>  <h3 class="api-heading" id="AccountsCommon-onLogout"> <div class="locus"> Anywhere </div> <code>AccountsCommon#onLogout(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_common.js#L314" target="_blank"> (accounts-base/accounts_common.js, line 314) </a> </div> </h3>   <p>Register a callback to be called after a logout attempt succeeds.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>The callback to be called when logout is successful.</p> </dd> </dl>   <p>On the server, the <code>func</code> callback receives a single argument with the object below. On the client, no arguments are passed.</p> <dl class="objdesc"> <dt>
<span class="name">user</span><span class="type">Object</span>
</dt>
<dd>
<p>The Meteor user object of the user which just logged out.</p> </dd> <dt>
<span class="name">connection</span><span class="type">Object</span>
</dt>
<dd>
<p>The <code>connection</code> object the request came in on. See <a href="#meteor_onconnection"><code>Meteor.onConnection</code></a> for details.</p> </dd> </dl>  <h2 class="api-heading" id="AccountsClient"> <div class="locus"> Client </div> <code>new AccountsClient(options)</code> <div class="subtext-api"> <code>import { AccountsClient } from 'meteor/accounts-base'</code> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_client.js#L3" target="_blank"> (accounts-base/accounts_client.js, line 3) </a> </div> </h2>   <p>Constructor for the <code>Accounts</code> object on the client.</p>  <h4 class="subheading">Options</h4> <dl class="args"> <dt> <code>connection</code> <span class="type">Object</span> </dt> <dd> <p>Optional DDP connection to reuse.</p> </dd> <dt> <code>ddpUrl</code> <span class="type">String</span> </dt> <dd> <p>Optional URL for creating a new DDP connection.</p> </dd> </dl>   <p>At most one of <code>options.connection</code> and <code>options.ddpUrl</code> should be provided in any instantiation of <code>AccountsClient</code>. If neither is provided, <code>Meteor.connection</code> will be used as the <code>.connection</code> property of the <code>AccountsClient</code> instance.</p> <p>Note that <code>AccountsClient</code> is currently available only on the client, due to its use of browser APIs such as <code>window.localStorage</code>. In principle, though, it might make sense to establish a client connection from one server to another remote accounts server. Please <a href="https://github.com/meteor/meteor/wiki/Contributing-to-Meteor#feature-requests" target="_blank" rel="noopener">let us know</a> if you find yourself needing this server-to-server functionality.</p> <p>These methods are defined on <code>AccountsClient.prototype</code>, and are thus available only on the client:</p>  <h3 class="api-heading" id="AccountsClient-loggingIn"> <div class="locus"> Client </div> <code>AccountsClient#loggingIn()</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_client.js#L60" target="_blank"> (accounts-base/accounts_client.js, line 60) </a> </div> </h3>   <p>True if a login method (such as <code>Meteor.loginWithPassword</code>, <code>Meteor.loginWithFacebook</code>, or <code>Accounts.createUser</code>) is currently in progress. A reactive data source.</p>     <h3 class="api-heading" id="AccountsClient-logout"> <div class="locus"> Client </div> <code>AccountsClient#logout([callback])</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_client.js#L120" target="_blank"> (accounts-base/accounts_client.js, line 120) </a> </div> </h3>   <p>Log the user out.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>callback</code> <span class="type">Function</span> </dt> <dd> <p>Optional callback. Called with no arguments on success, or with a single <code>Error</code> argument on failure.</p> </dd> </dl>    <h3 class="api-heading" id="AccountsClient-logoutOtherClients"> <div class="locus"> Client </div> <code>AccountsClient#logoutOtherClients([callback])</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_client.js#L141" target="_blank"> (accounts-base/accounts_client.js, line 141) </a> </div> </h3>   <p>Log out other clients logged in as the current user, but does not log out the client that calls this function.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>callback</code> <span class="type">Function</span> </dt> <dd> <p>Optional callback. Called with no arguments on success, or with a single <code>Error</code> argument on failure.</p> </dd> </dl>    <h2 class="api-heading" id="AccountsServer"> <div class="locus"> Server </div> <code>new AccountsServer(server)</code> <div class="subtext-api"> <code>import { AccountsServer } from 'meteor/accounts-base'</code> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_server.js#L16" target="_blank"> (accounts-base/accounts_server.js, line 16) </a> </div> </h2>   <p>Constructor for the <code>Accounts</code> namespace on the server.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>server</code> <span class="type">Object</span> </dt> <dd> <p>A server object such as <code>Meteor.server</code>.</p> </dd> </dl>   <p>These methods are defined on <code>AccountsServer.prototype</code>, and are thus available only on the server:</p>  <h3 class="api-heading" id="AccountsServer-validateNewUser"> <div class="locus"> Server </div> <code>AccountsServer#validateNewUser(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_server.js#L147" target="_blank"> (accounts-base/accounts_server.js, line 147) </a> </div> </h3>   <p>Set restrictions on new user creation.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>Called whenever a new user is created. Takes the new user object, and returns true to allow the creation or false to abort.</p> </dd> </dl>   <p>This can be called multiple times. If any of the functions return <code>false</code> or throw an error, the new user creation is aborted. To set a specific error message (which will be displayed by <a href="#accountsui"><code>accounts-ui</code></a>), throw a new <a href="#meteor_error"><code>Meteor.Error</code></a>.</p> <p>Example:</p>  <pre class="line-numbers" style><code class="language-js">// Validate username, sending a specific error message on failure.
Accounts.validateNewUser((user) =&gt; {
  if (user.username &amp;&amp; user.username.length &gt;= 3) {
    return true;
  } else {
    throw new Meteor.Error(403, 'Username must have at least 3 characters');
  }
});

// Validate username, without a specific error message.
Accounts.validateNewUser((user) =&gt; {
  return user.username !== 'root';
});
</code></pre> <p>If the user is being created as part of a login attempt from a client (eg, calling <a href="#accounts_createuser"><code>Accounts.createUser</code></a> from the client, or <a href="#meteor_loginwithexternalservice">logging in for the first time with an external service</a>), these callbacks are called <em>before</em> the <a href="#accounts_validateloginattempt"><code>Accounts.validateLoginAttempt</code></a> callbacks. If these callbacks succeed but those fail, the user will still be created but the connection will not be logged in as that user.</p>  <h3 class="api-heading" id="AccountsServer-onCreateUser"> <div class="locus"> Server </div> <code>AccountsServer#onCreateUser(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_server.js#L187" target="_blank"> (accounts-base/accounts_server.js, line 187) </a> </div> </h3>   <p>Customize new user creation.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>Called whenever a new user is created. Return the new user object, or throw an <code>Error</code> to abort the creation.</p> </dd> </dl>   <p>Use this when you need to do more than simply accept or reject new user creation. With this function you can programatically control the contents of new user documents.</p> <p>The function you pass will be called with two arguments: <code>options</code> and <code>user</code>. The <code>options</code> argument comes from <a href="#accounts_createuser"><code>Accounts.createUser</code></a> for password-based users or from an external service login flow. <code>options</code> may come from an untrusted client so make sure to validate any values you read from it. The <code>user</code> argument is created on the server and contains a proposed user object with all the automatically generated fields required for the user to log in, including the <code>_id</code>.</p> <p>The function should return the user document (either the one passed in or a newly-created object) with whatever modifications are desired. The returned document is inserted directly into the <a href="#meteor_users"><code>Meteor.users</code></a> collection.</p> <p>The default create user function simply copies <code>options.profile</code> into the new user document. Calling <code>onCreateUser</code> overrides the default hook. This can only be called once.</p> <p>Example:</p>  <pre class="line-numbers" style><code class="language-js">// Support for playing D&amp;D: Roll 3d6 for dexterity.
Accounts.onCreateUser((options, user) =&gt; {
  const customizedUser = Object.assign({
    dexterity: _.random(1, 6) + _.random(1, 6) + _.random(1, 6),
  }, user);

  // We still want the default hook's 'profile' behavior.
  if (options.profile) {
    customizedUser.profile = options.profile;
  }

  return customizedUser;
});
</code></pre>  <h3 class="api-heading" id="AccountsServer-validateLoginAttempt"> <div class="locus"> Server </div> <code>AccountsServer#validateLoginAttempt(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_server.js#L137" target="_blank"> (accounts-base/accounts_server.js, line 137) </a> </div> </h3>   <p>Validate login attempts.</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>Called whenever a login is attempted (either successful or unsuccessful). A login can be aborted by returning a falsy value or throwing an exception.</p> </dd> </dl>   <p>Call <code>validateLoginAttempt</code> with a callback to be called on login attempts. It returns an object with a single method, <code>stop</code>. Calling <code>stop()</code> unregisters the callback.</p> <p>When a login attempt is made, the registered validate login callbacks are called with a single argument, the attempt info object:</p> <dl class="objdesc"> <dt>
<span class="name">type</span><span class="type">String</span>
</dt>
<dd>
<p>The service name, such as “password” or “twitter”.</p> </dd> <dt>
<span class="name">allowed</span><span class="type">Boolean</span>
</dt>
<dd>
<p>Whether this login is allowed and will be successful (if not aborted by any of the validateLoginAttempt callbacks). False if the login will not succeed (for example, an invalid password or the login was aborted by a previous validateLoginAttempt callback).</p> </dd> <dt>
<span class="name">error</span><span class="type">Exception</span>
</dt>
<dd>
<p>When <code>allowed</code> is false, the exception describing why the login failed. It will be a <code>Meteor.Error</code> for failures reported to the user (such as invalid password), and can be a another kind of exception for internal errors.</p> </dd> <dt>
<span class="name">user</span><span class="type">Object</span>
</dt>
<dd>
<p>When it is known which user was attempting to login, the Meteor user object. This will always be present for successful logins.</p> </dd> <dt>
<span class="name">connection</span><span class="type">Object</span>
</dt>
<dd>
<p>The <code>connection</code> object the request came in on. See <a href="#meteor_onconnection"><code>Meteor.onConnection</code></a> for details.</p> </dd> <dt>
<span class="name">methodName</span><span class="type">String</span>
</dt>
<dd>
<p>The name of the Meteor method being used to login.</p> </dd> <dt>
<span class="name">methodArguments</span><span class="type">Array</span>
</dt>
<dd>
<p>An array of the arguments passed to the login method.</p> </dd> </dl> <p>A validate login callback must return a truthy value for the login to proceed. If the callback returns a falsy value or throws an exception, the login is aborted. Throwing a <code>Meteor.Error</code> will report the error reason to the user.</p> <p>All registered validate login callbacks are called, even if one of the callbacks aborts the login. The later callbacks will see the <code>allowed</code> field set to <code>false</code> since the login will now not be successful. This allows later callbacks to override an error from a previous callback; for example, you could override the “Incorrect password” error with a different message.</p> <p>Validate login callbacks that aren’t explicitly trying to override a previous error generally have no need to run if the attempt has already been determined to fail, and should start with</p>  <pre class="line-numbers" style><code class="language-js">if (!attempt.allowed) {
  return false;
}
</code></pre>  <h3 class="api-heading" id="AccountsServer-beforeExternalLogin"> <div class="locus"> Server </div> <code>AccountsServer#beforeExternalLogin(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_server.js#L156" target="_blank"> (accounts-base/accounts_server.js, line 156) </a> </div> </h3>   <p>Validate login from external service</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>Called whenever login/user creation from external service is attempted. Login or user creation based on this login can be aborted by passing a falsy value or throwing an exception.</p> </dd> </dl>   <p>Use this hook if you need to validate that user from an external service should be allowed to login or create account.</p> <dl class="objdesc"> <dt>
<span class="name">type</span><span class="type">String</span>
</dt>
<dd>
<p>The service name, such as “google” or “twitter”.</p> </dd> <dt>
<span class="name">data</span><span class="type">Object</span>
</dt>
<dd>
<p>Data retrieved from the service</p> </dd> <dt>
<span class="name">user</span><span class="type">Object</span>
</dt>
<dd>
<p>If user was found in the database that matches the criteria from the service, their data will be provided here. </p> </dd> </dl> <p>You should return a <code>Boolean</code> value, <code>true</code> if the login/registration should proceed or <code>false</code> if it should terminate. In case of termination the login attempt will throw an error <code>403</code>, with the message: <code>Login forbidden</code>.</p>  <h3 class="api-heading" id="AccountsServer-setAdditionalFindUserOnExternalLogin"> <div class="locus"> Server </div> <code>AccountsServer#setAdditionalFindUserOnExternalLogin(func)</code> <div class="subtext-api"> <a class="src-code link secondary" href="https://github.com/meteor/meteor/blob/master/packages/accounts-base/accounts_server.js#L214" target="_blank"> (accounts-base/accounts_server.js, line 214) </a> </div> </h3>   <p>Customize user selection on external logins</p>  <h4 class="subheading">Arguments</h4> <dl class="args"> <dt> <code>func</code> <span class="type">Function</span> </dt> <dd> <p>Called whenever a user is logged in via oauth and a user is not found with the service id. Return the user or undefined.</p> </dd> </dl>   <p>When allowing your users to authenticate with an external service, the process will eventually call <code>Accounts.updateOrCreateUserFromExternalService</code>. By default, this will search for a user with the <code>service.&lt;servicename&gt;.id</code>, and if not found will create a new user. As that is not always desirable, you can use this hook as an escape hatch to look up a user with a different selector, probably by <code>emails.address</code> or <code>username</code>. Note the function will only be called if no user was found with the <code>service.&lt;servicename&gt;.id</code> selector.</p> <p>The function will be called with a single argument, the info object:</p> <dl class="objdesc"> <dt>
<span class="name">serviceName</span><span class="type">String</span>
</dt>
<dd>
<p>The external service name, such as “google” or “twitter”.</p> </dd> <dt>
<span class="name">serviceData</span><span class="type">Object</span>
</dt>
<dd>
<p>The data returned by the service oauth request.</p> </dd> <dt>
<span class="name">options</span><span class="type">Exception</span>
</dt>
<dd>
<p>An optional arugment passed down from the oauth service that may contain additional user profile information. As the data in <code>options</code> comes from an external source, make sure you validate any values you read from it.</p> </dd> </dl> <p>The function should return either a user document or <code>undefined</code>. Returning a user will result in the populating the <code>service.&lt;servicename&gt;</code> in your user document, while returning <code>undefined</code> will result in a new user account being created. If you would prefer that a new account not be created, you could throw an error instead of returning.</p> <p>Example:</p>  <pre class="line-numbers" style><code class="language-js">// If a user has already been created, and used their Google email, this will 
// allow them to sign in with the Meteor.loginWithGoogle method later, without
// creating a new user.
Accounts.setAdditionalFindUserOnExternalLogin(({serviceName, serviceData}) =&gt; {
  if (serviceName === "google") {
     // Note: Consider security implications. If someone other than the owner
     // gains access to the account on the third-party service they could use
     // the e-mail set there to access the account on your app.
     // Most often this is not an issue, but as a developer you should be aware
     // of how bad actors could play.
    return Accounts.findUserByEmail(serviceData.email)
  }
})
</code></pre> <h2 id="accounts_rate_limit">Rate Limiting</h2> <p>By default, there are rules added to the <a href="#ddpratelimiter"><code>DDPRateLimiter</code></a> that rate limit logins, new user registration and password reset calls to a limit of 5 requests per 10 seconds per session. These are a basic solution to dictionary attacks where a malicious user attempts to guess the passwords of legitimate users by attempting all possible passwords.</p> <p>These rate limiting rules can be removed by calling <code>Accounts.removeDefaultRateLimit()</code>. Please see the <a href="#ddpratelimiter"><code>DDPRateLimiter</code></a> docs for more information.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.meteor.com/api/accounts-multi.html" class="_attribution-link" target="_blank">https://docs.meteor.com/api/accounts-multi.html</a>
  </p>
</div>
