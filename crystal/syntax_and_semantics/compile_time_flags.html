 <h1 id="compile-time-flags">Compile-time flags</h1> <p>Compile-time flags are boolean values provided through the compiler via a macro method. They allow to conditionally include or exclude code based on compile time conditions.</p> <p>There are several default flags provided by the compiler with information about compiler options and the target platform. User-provided flags are passed to the compiler, which allow them to be used as feature flags.</p> <h2 id="querying-flags">Querying flags</h2> <p>A flag is just a named identifier which is either set or not. The status can be queried from code via the macro method <a href="https://crystal-lang.org/api/1.5.0/Crystal/Macros.html#flag%3F%28name%29%3ABoolLiteral-instance-method"><code>flag?</code></a>. It receives the name of a flag as a string or symbol literal and returns a bool literal indicating the flag's state.</p> <p>The following program shows the use of compile-time flags by printing the target OS family.</p> <div class="highlight"><pre data-language="crystal">{% if flag?(:unix) %}
  puts "This program is compiled for a UNIX-like operating system"
{% elsif flag?(:windows) %}
  puts "This program is compiled for Windows"
{% else %}
  # Currently, all supported targets are either UNIX or Windows platforms, so
  # this branch is practically unreachable.
  puts "Compiling for some other operating system"
{% end %}
</pre></div> <p>There's also the macro method <a href="https://crystal-lang.org/api/1.5.0/Crystal/Macros.html#host_flag%3F%28name%29%3ABoolLiteral-instance-method"><code>host_flag?</code></a> which returns whether a flag is set for the <em>host</em> platform, which can differ from the target platform (queried by <code>flag?</code>) during cross-compilation.</p> <h2 id="compiler-provided-flags">Compiler-provided flags</h2> <p>The compiler defines a couple of implicit flags. They describe either the target platform or compiler options.</p> <h3 id="target-platform-flags">Target platform flags</h3> <p>Platform-specific flags derive from the <a href="http://llvm.org/docs/LangRef.html#target-triple">target triple</a>. See <a href="../platform_support">Platform Support</a> for a list of supported target platforms.</p> <p><code>crystal --version</code> shows the default target triple of the compiler. It can be changed with the <code>--target</code> option.</p> <p>The flags in each of the following tables are mutually exclusive, except for those marked as <em>(derived)</em>.</p> <h4 id="architecture">Architecture</h4> <p>The target architecture is the first component of the target triple.</p> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>aarch64</code></td> <td>AArch64 architecture</td> </tr> <tr> <td><code>arm</code></td> <td>ARM architecture</td> </tr> <tr> <td><code>i386</code></td> <td>x86 architecture (32-bit)</td> </tr> <tr> <td><code>x86_64</code></td> <td>x86-64 architecture</td> </tr> <tr> <td>
<code>bits32</code> <em>(derived)</em>
</td> <td>32-bit architecture</td> </tr> <tr> <td>
<code>bits64</code> <em>(derived)</em>
</td> <td>64-bit architecture</td> </tr> </tbody> </table> <h4 id="vendor">Vendor</h4> <p>The vendor is the second component of the target triple. This is typically unused, so the most common vendor is <code>unknown</code>.</p> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>macosx</code></td> <td>Apple</td> </tr> <tr> <td><code>portbld</code></td> <td>FreeBSD variant</td> </tr> <tr> <td><code>unknown</code></td> <td>Unknown vendor</td> </tr> </tbody> </table> <h4 id="operating-system">Operating System</h4> <p>The operating system is derived from the third component of a the target triple.</p> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>
<code>bsd</code> <em>(derived)</em>
</td> <td>BSD family (DragonFlyBSD, FreeBSD, NetBSD, OpenBSD)</td> </tr> <tr> <td><code>darwin</code></td> <td>Darwin (MacOS)</td> </tr> <tr> <td><code>dragonfly</code></td> <td>DragonFlyBSD</td> </tr> <tr> <td><code>freebsd</code></td> <td>FreeBSD</td> </tr> <tr> <td><code>linux</code></td> <td>Linux</td> </tr> <tr> <td><code>netbsd</code></td> <td>NetBSD</td> </tr> <tr> <td><code>openbsd</code></td> <td>OpenBSD</td> </tr> <tr> <td>
<code>unix</code> <em>(derived)</em>
</td> <td>UNIX-like (BSD, Darwin, Linux)</td> </tr> <tr> <td><code>windows</code></td> <td>Windows</td> </tr> </tbody> </table> <h4 id="abi">ABI</h4> <p>The ABI is derived from the last component of the target triple.</p> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>
<code>armhf</code> <em>(derived)</em>
</td> <td>ARM EABI with hard float</td> </tr> <tr> <td><code>gnu</code></td> <td>GNU</td> </tr> <tr> <td><code>gnueabihf</code></td> <td>GNU EABI with hard float</td> </tr> <tr> <td><code>msvc</code></td> <td>Microsoft Visual C++</td> </tr> <tr> <td><code>musl</code></td> <td>musl</td> </tr> <tr> <td>
<code>win32</code> <em>(derived)</em>
</td> <td>Windows API</td> </tr> </tbody> </table> <h3 id="compiler-options">Compiler options</h3> <p>The compiler sets these flags based on compiler configuration.</p> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>release</code></td> <td>Compiler operates in release mode (<code>--release</code> CLI option)</td> </tr> <tr> <td><code>debug</code></td> <td>Compiler generates debug symbols (without <code>--no-debug</code> CLI option)</td> </tr> <tr> <td><code>static</code></td> <td>Compiler creates a statically linked executable (<code>--static</code> CLI option)</td> </tr> <tr> <td><code>docs</code></td> <td>Code is processed to generate API docs (<code>crystal docs</code> command)</td> </tr> </tbody> </table> <h2 id="user-provided-flags">User-provided flags</h2> <p>User-provided flags are not defined automatically. They can be passed to the compiler via the <code>--define</code> or <code>-D</code> command line options.</p> <p>These flags usually enable certain features which activate breaking new or legacy functionality, a preview for a new feature, or entirely alternative behaviour (e.g. for debugging purposes).</p> <div class="highlight"><pre data-language="crystal">$ crystal eval -Dfoo 'puts {{ flag?(:foo) }}'
true
</pre></div> <h3 id="stdlib-features">Stdlib features</h3> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>gc_none</code></td> <td>Disables garbage collection (<a href="https://github.com/crystal-lang/crystal/pull/5314">#5314</a>)</td> </tr> <tr> <td><code>debug_raise</code></td> <td>Debugging flag for <code>raise</code> logic. Prints the backtrace before raising.</td> </tr> <tr> <td><code>preview_mt</code></td> <td>Enables multithreading preview. Introduced in 0.28.0 (<a href="https://github.com/crystal-lang/crystal/pull/7546">#7546</a>)</td> </tr> <tr> <td><code>strict_multi_assign</code></td> <td>Enable strict semantics for <a href="assignment#one-to-many-assignment">one-to-many assignment</a>. Introduced in 1.3.0 (<a href="https://github.com/crystal-lang/crystal/pull/11145">#11145</a>, <a href="https://github.com/crystal-lang/crystal/pull/11545">#11545</a>)</td> </tr> <tr> <td><code>skip_crystal_compiler_rt</code></td> <td>Exclude Crystal's native <code>compiler-rt</code> implementation.</td> </tr> </tbody> </table> <h3 id="compiler-features">Compiler features</h3> <table> <thead> <tr> <th>Flag name</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>without_openssl</code></td> <td>Build the compiler without OpenSSL support</td> </tr> <tr> <td><code>without_zlib</code></td> <td>Build the compiler without Zlib support</td> </tr> <tr> <td><code>without_playground</code></td> <td>Build the compiler without playground (<code>crystal play</code>)</td> </tr> <tr> <td><code>i_know_what_im_doing</code></td> <td>Safety guard against involuntarily building the compiler</td> </tr> <tr> <td><code>no_number_autocast</code></td> <td>Will not <a href="autocasting#number-autocasting">autocast</a> numeric expressions, only literals</td> </tr> </tbody> </table> <h3 id="user-code-features">User code features</h3> <p>Custom flags can be freely used in user code as long as they don't collide with compiler-provided flags or other user-defined flags. When using a flag specific to a shard, it's recommended to use the shard name as a prefix.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/1.5/syntax_and_semantics/compile_time_flags.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/1.5/syntax_and_semantics/compile_time_flags.html</a>
  </p>
</div>
