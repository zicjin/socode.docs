 <h1>Built-in annotations</h1> <p>The Crystal standard library includes some pre-defined annotations:</p> <h2 id="link">Link</h2> <p>Tells the compiler how to link a C library. This is explained in the <a href="../c_bindings/lib">lib</a> section.</p> <h2 id="extern">Extern</h2> <p>Marking a Crystal struct with this annotation makes it possible to use it in lib declarations:</p> <div class="crystal highlight"><pre data-language="crystal">@[Extern]
struct MyStruct
end

lib MyLib
  fun my_func(s : MyStruct) # OK (gives an error without the Extern annotation)
end
</pre></div> <p>You can also make a struct behave like a C union (this can be pretty unsafe):</p> <div class="crystal highlight"><pre data-language="crystal"># A struct to easily convert between Int32 codepoints and Chars
@[Extern(union: true)]
struct Int32OrChar
  property int = 0
  property char = '\0'
end

s = Int32OrChar.new
s.char = 'A'
s.int # =&gt; 65

s.int = 66
s.char # =&gt; 'B'
</pre></div> <h2 id="threadlocal">ThreadLocal</h2> <p>The <code>@[ThreadLocal]</code> annotation can be applied to class variables and C external variables. It makes them be thread local.</p> <div class="crystal highlight"><pre data-language="crystal">class DontUseThis
  # One for each thread
  @[ThreadLocal]
  @@values = [] of Int32
end
</pre></div> <p>ThreadLocal is used in the standard library to implement the runtime and shouldn't be needed or used outside it.</p> <h2 id="packed">Packed</h2> <p>Marks a <a href="../c_bindings/struct">C struct</a> as packed, which prevents the automatic insertion of padding bytes between fields. This is typically only needed if the C library explicitly uses packed structs.</p> <h2 id="alwaysinline">AlwaysInline</h2> <p>Gives a hint to the compiler to always inline a method:</p> <div class="crystal highlight"><pre data-language="crystal">@[AlwaysInline]
def foo
  1
end
</pre></div> <h2 id="noinline">NoInline</h2> <p>Tells the compiler to never inline a method call. This has no effect if the method yields, since functions which yield are always inlined.</p> <div class="crystal highlight"><pre data-language="crystal">@[NoInline]
def foo
  1
end
</pre></div> <h2 id="returnstwice">ReturnsTwice</h2> <p>Marks a method or <a href="../c_bindings/fun">lib fun</a> as returning twice. The C <code>setjmp</code> is an example of such a function.</p> <h2 id="raises">Raises</h2> <p>Marks a method or <a href="../c_bindings/fun">lib fun</a> as potentially raising an exception. This is explained in the <a href="../c_bindings/callbacks">callbacks</a> section.</p> <h2 id="callconvention">CallConvention</h2> <p>Indicates the call convention of a <a href="../c_bindings/fun">lib fun</a>. For example:</p> <div class="crystal highlight"><pre data-language="crystal">lib LibFoo
  @[CallConvention("X86_StdCall")]
  fun foo : Int32
end
</pre></div> <p>The list of valid call conventions is:</p> <ul> <li>C (the default)</li> <li>Fast</li> <li>Cold</li> <li>WebKit_JS</li> <li>AnyReg</li> <li>X86_StdCall</li> <li>X86_FastCall</li> </ul> <p>They are explained <a href="http://llvm.org/docs/LangRef.html#calling-conventions">here</a>.</p> <h2 id="flags">Flags</h2> <p>Marks an <a href="../enum">enum</a> as a "flags enum", which changes the behaviour of some of its methods, like <code>to_s</code>.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/1.5/syntax_and_semantics/annotations/built_in_annotations.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/1.5/syntax_and_semantics/annotations/built_in_annotations.html</a>
  </p>
</div>
