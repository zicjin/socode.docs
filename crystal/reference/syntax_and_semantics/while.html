 <h1 id="while">while</h1> <p>A <code>while</code> executes its body as long as its condition is <em>truthy</em>.</p> <div class="crystal highlight"><pre data-language="crystal">while some_condition
  do_this
end
</pre></div> <p>The condition is first tested and, if <em>truthy</em>, the body is executed. That is, the body might never be executed.</p> <p>Similar to an <code>if</code>, if a <code>while</code>'s condition is a variable, the variable is guaranteed to not be <code>nil</code> inside the body. If the condition is an <code>var.is_a?(Type)</code> test, <code>var</code> is guaranteed to be of type <code>Type</code> inside the body. And if the condition is a <code>var.responds_to?(:method)</code>, <code>var</code> is guaranteed to be of a type that responds to that method.</p> <p>The type of a variable after a <code>while</code> depends on the type it had before the <code>while</code> and the type it had before leaving the <code>while</code>'s body:</p> <div class="crystal highlight"><pre data-language="crystal">a = 1
while some_condition
  # a : Int32 | String
  a = "hello"
  # a : String
  a.size
end
# a : Int32 | String
</pre></div> <h2 id="checking-the-condition-at-the-end-of-a-loop">Checking the condition at the end of a loop</h2> <p>If you need to execute the body at least once and then check for a breaking condition, you can do this:</p> <div class="crystal highlight"><pre data-language="crystal">while true
  do_something
  break if some_condition
end
</pre></div> <p>Or use <code>loop</code>, found in the standard library:</p> <div class="crystal highlight"><pre data-language="crystal">loop do
  do_something
  break if some_condition
end
</pre></div> <h2 id="as-an-expression">As an expression</h2> <p>The value of a <code>while</code> is the value of the <code>break</code> expression that exits the <code>while</code>'s body:</p> <div class="crystal highlight"><pre data-language="crystal">a = 0
x = while a &lt; 5
  a += 1
  break "four" if a == 4
  break "three" if a == 3
end
x # =&gt; "three"
</pre></div> <p>If the <code>while</code> loop ends normally (because its condition became false), the value is <code>nil</code>:</p> <div class="crystal highlight"><pre data-language="crystal">x = while 1 &gt; 2
  break 3
end
x # =&gt; nil
</pre></div> <p><code>break</code> expressions with no arguments also return <code>nil</code>:</p> <div class="crystal highlight"><pre data-language="crystal">x = while 2 &gt; 1
  break
end
x # =&gt; nil
</pre></div> <p><code>break</code> expressions with multiple arguments are packed into <a href="https://crystal-lang.org/api/latest/Tuple.html"><code>Tuple</code></a> instances:</p> <div class="crystal highlight"><pre data-language="crystal">x = while 2 &gt; 1
  break 3, 4
end
x         # =&gt; {3, 4}
typeof(x) # =&gt; Tuple(Int32, Int32)
</pre></div> <p>The type of a <code>while</code> is the union of the types of all <code>break</code> expressions in the body, plus <code>Nil</code> because the condition can fail:</p> <div class="crystal highlight"><pre data-language="crystal">x = while 1 &gt; 2
  if rand &lt; 0.5
    break 3
  else
    break '4'
  end
end
typeof(x) # =&gt; (Char | Int32 | Nil)
</pre></div> <p>However, if the condition is exactly the <code>true</code> literal, then its effect is excluded from the return value and return type:</p> <div class="crystal highlight"><pre data-language="crystal">x = while true
  break 1
end
x         # =&gt; 1
typeof(x) # =&gt; Int32
</pre></div> <p>In particular, a <code>while true</code> expression with no <code>break</code>s has the <code>NoReturn</code> type, since the loop can never be exited in the same scope:</p> <div class="crystal highlight"><pre data-language="crystal">x = while true
  puts "yes"
end
x         # unreachable
typeof(x) # =&gt; NoReturn
</pre></div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/syntax_and_semantics/while.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/syntax_and_semantics/while.html</a>
  </p>
</div>
