 <h1 id="command-literal">Command literal</h1> <p>A command literal is a string delimited by backticks <code>`</code> or a <code>%x</code> percent literal. It will be substituted at runtime by the captured output from executing the string in a subshell.</p> <p>The same <a href="string#escaping">escaping</a> and <a href="string#interpolation">interpolation rules</a> apply as for regular strings.</p> <p>Similar to percent string literals, valid delimiters for <code>%x</code> are parentheses <code>()</code>, square brackets <code>[]</code>, curly braces <code>{}</code>, angles <code>&lt;&gt;</code> and pipes <code>||</code>. Except for the pipes, all delimiters can be nested; meaning a start delimiter inside the string escapes the next end delimiter.</p> <p>The special variable <code>$?</code> holds the exit status of the command as a <a href="https://crystal-lang.org/api/latest/Process/Status.html"><code>Process::Status</code></a>. It is only available in the same scope as the command literal.</p> <div class="crystal highlight"><pre data-language="crystal">`echo foo`  # =&gt; "foo"
$?.success? # =&gt; true
</pre></div> <p>Internally, the compiler rewrites command literals to calls to the top-level method <a href="https://crystal-lang.org/api/latest/toplevel.html#%60(command):String-class-method"><code>`()</code></a> with a string literal containing the command as argument: <code>`echo #{argument}`</code> and <code>%x(echo #{argument})</code> are rewritten to <code>`("echo #{argument}")</code>.</p> <h2 id="security-concerns">Security concerns</h2> <p>While command literals may prove useful for simple script-like tools, special caution is advised when interpolating user input because it may easily lead to command injection.</p> <div class="crystal highlight"><pre data-language="crystal">user_input = "hello; rm -rf *"
`echo #{user_input}`
</pre></div> <p>This command will write <code>hello</code> and subsequently delete all files and folders in the current working directory.</p> <p>To avoid this, command literals should generally not be used with interpolated user input. <a href="https://crystal-lang.org/api/latest/Process.html"><code>Process</code></a> from the standard library offers a safe way to provide user input as command arguments:</p> <div class="crystal highlight"><pre data-language="crystal">user_input = "hello; rm -rf *"
process = Process.new("echo", [user_input], output: Process::Redirect::Pipe)
process.output.gets_to_end # =&gt; "hello; rm -rf *"
process.wait.success?      # =&gt; true
</pre></div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/syntax_and_semantics/literals/command.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/syntax_and_semantics/literals/command.html</a>
  </p>
</div>
