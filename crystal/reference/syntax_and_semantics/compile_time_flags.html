 <h1 id="compile-time-flags">Compile-time flags</h1> <p>Types, methods and generally any part of your code can be conditionally defined based on some flags available at compile time. These flags are by default read from the hosts <a href="http://llvm.org/docs/LangRef.html#target-triple">LLVM Target Triple</a>, split on <code>-</code>. To get the target you can execute <code>llvm-config --host-target</code>.</p> <div class="highlight"><pre data-language="crystal">$ llvm-config --host-target
x86_64-unknown-linux-gnu

# so the flags are: x86_64, unknown, linux, gnu
</pre></div> <p>To define a flag, simply use the <code>--define</code> or <code>-D</code> option, like so:</p> <div class="highlight"><pre data-language="crystal">crystal some_program.cr -Dflag
</pre></div> <p>Additionally, if a program is compiled with <code>--release</code>, the <code>release</code> flag will be set.</p> <p>You can check if a flag is defined with the <code>flag?</code> macro method:</p> <div class="crystal highlight"><pre data-language="crystal">{% if flag?(:x86_64) %}
  # some specific code for 64 bits platforms
{% else %}
  # some specific code for non-64 bits platforms
{% end %}
</pre></div> <p><code>flag?</code> returns a boolean, so you can use it with <code>&amp;&amp;</code> and <code>||</code>:</p> <div class="crystal highlight"><pre data-language="crystal">{% if flag?(:linux) &amp;&amp; flag?(:x86_64) %}
  # some specific code for linux 64 bits
{% end %}
</pre></div> <p>These flags are generally used in C bindings to conditionally define types and functions. For example, the very well known <code>size_t</code> type is defined like this in Crystal:</p> <div class="crystal highlight"><pre data-language="crystal">lib C
  {% if flag?(:x86_64) %}
    alias SizeT = UInt64
  {% else %}
    alias SizeT = UInt32
  {% end %}
end
</pre></div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/syntax_and_semantics/compile_time_flags.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/syntax_and_semantics/compile_time_flags.html</a>
  </p>
</div>
