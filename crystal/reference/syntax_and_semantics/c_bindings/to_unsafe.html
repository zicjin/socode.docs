 <h1 id="to_unsafe">to_unsafe</h1> <p>If a type defines a <code>to_unsafe</code> method, when passing it to C the value returned by this method will be passed. For example:</p> <div class="crystal highlight"><pre data-language="crystal">lib C
  fun exit(status : Int32) : NoReturn
end

class IntWrapper
  def initialize(@value)
  end

  def to_unsafe
    @value
  end
end

wrapper = IntWrapper.new(1)
C.exit(wrapper) # wrapper.to_unsafe is passed to C function which has type Int32
</pre></div> <p>This is very useful for defining wrappers of C types without having to explicitly transform them to their wrapped values.</p> <p>For example, the <code>String</code> class implements <code>to_unsafe</code> to return <code>UInt8*</code>:</p> <div class="crystal highlight"><pre data-language="crystal">lib C
  fun printf(format : UInt8*, ...) : Int32
end

a = 1
b = 2
C.printf "%d + %d = %d\n", a, b, a + b
</pre></div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/syntax_and_semantics/c_bindings/to_unsafe.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/syntax_and_semantics/c_bindings/to_unsafe.html</a>
  </p>
</div>
