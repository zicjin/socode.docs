<h1 class="type-name"> class HTTP::Server </h1> <ul class="superclass-hierarchy">
<li class="superclass"><a href="server">HTTP::Server</a></li>
<li class="superclass"><a href="../reference">Reference</a></li>
<li class="superclass"><a href="../object">Object</a></li>
</ul> <h2>  Overview </h2> <p>A concurrent HTTP server implementation.</p> <p>A server is initialized with a handler chain responsible for processing each incoming request.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new do |context|
  context.response.content_type = "text/plain"
  context.response.print "Hello world!"
end

address = server.bind_tcp 8080
puts "Listening on http://#{address}"
server.listen</pre> <h2>
Request processing</h2> <p>The handler chain receives an instance of <code><a href="server/context">HTTP::Server::Context</a></code> that holds the <code><a href="request">HTTP::Request</a></code> to process and a <code><a href="server/response">HTTP::Server::Response</a></code> which it can configure and write to.</p> <p>Each connection is processed concurrently in a separate <code><a href="../fiber">Fiber</a></code> and can handle multiple subsequent requests-response cycles with connection keep-alive.</p> <h3>
Handler chain</h3> <p>The handler given to a server can simply be a block that receives an <code><a href="server/context">HTTP::Server::Context</a></code>, or it can be an instance of <code><a href="handler">HTTP::Handler</a></code>. An <code><a href="handler">HTTP::Handler</a></code> has a <code>#next</code> method to forward processing to the next handler in the chain.</p> <p>For example, an initial handler might handle exceptions raised from subsequent handlers and return a <code>500 <a href="server">Server</a> Error</code> status (see <code><a href="errorhandler">HTTP::ErrorHandler</a></code>). The next handler might log all incoming requests (see <code><a href="loghandler">HTTP::LogHandler</a></code>). And the final handler deals with routing and application logic.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new([
  HTTP::ErrorHandler.new,
  HTTP::LogHandler.new,
  HTTP::CompressHandler.new,
  HTTP::StaticFileHandler.new("."),
])

server.bind_tcp "127.0.0.1", 8080
server.listen</pre> <h3>
Response object</h3> <p>The <code><a href="server/response">HTTP::Server::Response</a></code> object has <code>status</code> and <code>headers</code> properties that can be configured before writing the response body. Once any response output has been written, changing the <code>status</code> and <code>headers</code> properties has no effect.</p> <p>The <code><a href="server/response">HTTP::Server::Response</a></code> is a write-only <code><a href="../io">IO</a></code>, so all <code><a href="../io">IO</a></code> methods are available on it for sending the response body.</p> <h2>
Binding to sockets</h2> <p>The server can be bound to one or more server sockets (see <code><a href="server#bind(socket:Socket::Server):Nil-instance-method">#bind</a></code>)</p> <p>Supported types:</p> <ul>
<li>TCP socket: <code><a href="server#bind_tcp(host:String,port:Int32,reuse_port:Bool=false):Socket::IPAddress-instance-method">#bind_tcp</a></code>, <code><a href="server#bind_unused_port(host:String=Socket::IPAddress::LOOPBACK,reuse_port:Bool=false):Socket::IPAddress-instance-method">#bind_unused_port</a></code>
</li>
<li>TCP socket with TLS/SSL: <code><a href="server#bind_tls(host:String,port:Int32,context:OpenSSL::SSL::Context::Server,reuse_port:Bool=false):Socket::IPAddress-instance-method">#bind_tls</a></code>
</li>
<li>Unix socket <code><a href="server#bind_unix(path:String):Socket::UNIXAddress-instance-method">#bind_unix</a></code>
</li>
</ul> <p><code><a href="server#bind(socket:Socket::Server):Nil-instance-method">#bind(uri : URI)</a></code> and <code><a href="server#bind(socket:Socket::Server):Nil-instance-method">#bind(uri : String)</a></code> parse socket configuration for one of these types from an <code><a href="../uri">URI</a></code>. This can be useful for injecting plain text configuration values.</p> <p>Each of these methods returns the <code><a href="../socket/address">Socket::Address</a></code> that was added to this server.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new do |context|
  context.response.content_type = "text/plain"
  context.response.print "Hello world!"
end

address = server.bind_tcp "0.0.0.0", 8080
puts "Listening on http://#{address}"
server.listen</pre> <p>It is also possible to bind a generic <code><a href="../socket/server">Socket::Server</a></code> using <code><a href="server#bind(socket:Socket::Server):Nil-instance-method">#bind(socket : Socket::Server)</a></code> which can be used for custom network protocol configurations.</p> <h2>
Server loop</h2> <p>After defining all server sockets to listen to, the server can be started by calling <code><a href="server#listen-instance-method">#listen</a></code>. This call blocks until the server is closed.</p> <p>A server can be closed by calling <code><a href="server#close-instance-method">#close</a></code>. This closes the server sockets and stops processing any new requests, even on connections with keep-alive enabled. Currently processing requests are not interrupted but also not waited for. In order to give them some grace period for finishing, the calling context can add a timeout like <code>sleep 10.seconds</code> after <code><a href="server#listen-instance-method">#listen</a></code> returns.</p> <h3>
Reusing connections</h3> <p>The request processor supports reusing a connection for subsequent requests. This is used by default for HTTP/1.1 or when requested by the <code>Connection: keep-alive</code> header. This is signalled by this header being set on the <code><a href="server/response">HTTP::Server::Response</a></code> when it's passed into the handler chain.</p> <p>If in the handler chain this header is overridden to <code>Connection: close</code>, then the connection will not be reused after the request has been processed.</p> <p>Reusing the connection also requires that the request body (if present) is entirely consumed in the handler chain. Otherwise the connection will be closed.</p> <h2>  Defined in: </h2> <a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L131" target="_blank"> http/server.cr </a> <br> <a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server/context.cr#L4" target="_blank"> http/server/context.cr </a> <br> <a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server/response.cr#L5" target="_blank"> http/server/response.cr </a> <br> <h2>  Constant Summary </h2> <dl> <dt class="entry-const" id="Log"> <strong>Log</strong> = <code>::Log.for("http.server")</code> </dt> </dl> <h2>  Constructors </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#new(handlers:Array(HTTP::Handler),&amp;handler:HTTP::Handler::HandlerProc):self-class-method" class="signature"><strong>.new</strong>(handlers : Array(HTTP::Handler), &amp;handler : HTTP::Handler::HandlerProc) : self</a> <div class="summary"><p>Creates a new HTTP server with a handler chain constructed from the <em>handlers</em> array and the given block.</p></div> </li> <li class="entry-summary"> <a href="#new(&amp;handler:HTTP::Handler::HandlerProc):self-class-method" class="signature"><strong>.new</strong>(&amp;handler : HTTP::Handler::HandlerProc) : self</a> <div class="summary"><p>Creates a new HTTP server with the given block as handler.</p></div> </li> <li class="entry-summary"> <a href="#new(handlers:Array(HTTP::Handler)):self-class-method" class="signature"><strong>.new</strong>(handlers : Array(HTTP::Handler)) : self</a> <div class="summary"><p>Creates a new HTTP server with the <em>handlers</em> array as handler chain.</p></div> </li> <li class="entry-summary"> <a href="#new(handler:HTTP::Handler%7CHTTP::Handler::HandlerProc)-class-method" class="signature"><strong>.new</strong>(handler : HTTP::Handler | HTTP::Handler::HandlerProc)</a> <div class="summary"><p>Creates a new HTTP server with the given <em>handler</em>.</p></div> </li> </ul> <h2>  Class Method Summary </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#build_middleware(handlers,last_handler:Context-%3E?=nil)-class-method" class="signature"><strong>.build_middleware</strong>(handlers, last_handler : Context -&gt; ? = nil)</a> <div class="summary"><p>Builds all handlers as the middleware for <code><a href="server">HTTP::Server</a></code>.</p></div> </li> </ul> <h2>  Instance Method Summary </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#addresses:Array(Socket::Address)-instance-method" class="signature"><strong>#addresses</strong> : Array(Socket::Address)</a> </li> <li class="entry-summary"> <a href="#bind(socket:Socket::Server):Nil-instance-method" class="signature"><strong>#bind</strong>(socket : Socket::Server) : Nil</a> <div class="summary"><p>Adds a <code><a href="../socket/server">Socket::Server</a></code> <em>socket</em> to this server.</p></div> </li> <li class="entry-summary"> <a href="#bind(uri:URI):Socket::Address-instance-method" class="signature"><strong>#bind</strong>(uri : URI) : Socket::Address</a> <div class="summary"><p>Parses a socket configuration from <em>uri</em> and adds it to this server.</p></div> </li> <li class="entry-summary"> <a href="#bind(uri:String):Socket::Address-instance-method" class="signature"><strong>#bind</strong>(uri : String) : Socket::Address</a> <div class="summary"><p>Parses a socket configuration from <em>uri</em> and adds it to this server.</p></div> </li> <li class="entry-summary"> <a href="#bind_tcp(host:String,port:Int32,reuse_port:Bool=false):Socket::IPAddress-instance-method" class="signature"><strong>#bind_tcp</strong>(host : String, port : Int32, reuse_port : Bool = false) : Socket::IPAddress</a> <div class="summary"><p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>host:port</code> and adds it as a socket, returning the local address and port the server listens on.</p></div> </li> <li class="entry-summary"> <a href="#bind_tcp(port:Int32,reuse_port:Bool=false):Socket::IPAddress-instance-method" class="signature"><strong>#bind_tcp</strong>(port : Int32, reuse_port : Bool = false) : Socket::IPAddress</a> <div class="summary"><p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>127.0.0.1:port</code> and adds it as a socket, returning the local address and port the server listens on.</p></div> </li> <li class="entry-summary"> <a href="#bind_tcp(address:Socket::IPAddress,reuse_port:Bool=false):Socket::IPAddress-instance-method" class="signature"><strong>#bind_tcp</strong>(address : Socket::IPAddress, reuse_port : Bool = false) : Socket::IPAddress</a> <div class="summary"><p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <em>address</em> and adds it as a socket, returning the local address and port the server listens on.</p></div> </li> <li class="entry-summary"> <a href="#bind_tls(host:String,port:Int32,context:OpenSSL::SSL::Context::Server,reuse_port:Bool=false):Socket::IPAddress-instance-method" class="signature"><strong>#bind_tls</strong>(host : String, port : Int32, context : OpenSSL::SSL::Context::Server, reuse_port : Bool = false) : Socket::IPAddress</a> <div class="summary"><p>Creates an <code><a href="../openssl/ssl/server">OpenSSL::SSL::Server</a></code> and adds it as a socket.</p></div> </li> <li class="entry-summary"> <a href="#bind_tls(address:Socket::IPAddress,context:OpenSSL::SSL::Context::Server):Socket::IPAddress-instance-method" class="signature"><strong>#bind_tls</strong>(address : Socket::IPAddress, context : OpenSSL::SSL::Context::Server) : Socket::IPAddress</a> <div class="summary"><p>Creates an <code><a href="../openssl/ssl/server">OpenSSL::SSL::Server</a></code> and adds it as a socket.</p></div> </li> <li class="entry-summary"> <a href="#bind_tls(host:String,context:OpenSSL::SSL::Context::Server):Socket::IPAddress-instance-method" class="signature"><strong>#bind_tls</strong>(host : String, context : OpenSSL::SSL::Context::Server) : Socket::IPAddress</a> <div class="summary"><p>Creates an <code><a href="../openssl/ssl/server">OpenSSL::SSL::Server</a></code> and adds it as a socket.</p></div> </li> <li class="entry-summary"> <a href="#bind_unix(path:String):Socket::UNIXAddress-instance-method" class="signature"><strong>#bind_unix</strong>(path : String) : Socket::UNIXAddress</a> <div class="summary"><p>Creates a <code><a href="../unixserver">UNIXServer</a></code> bound to <em>path</em> and adds it as a socket.</p></div> </li> <li class="entry-summary"> <a href="#bind_unix(address:Socket::UNIXAddress):Socket::UNIXAddress-instance-method" class="signature"><strong>#bind_unix</strong>(address : Socket::UNIXAddress) : Socket::UNIXAddress</a> <div class="summary"><p>Creates a <code><a href="../unixserver">UNIXServer</a></code> bound to <em>address</em> and adds it as a socket.</p></div> </li> <li class="entry-summary"> <a href="#bind_unused_port(host:String=Socket::IPAddress::LOOPBACK,reuse_port:Bool=false):Socket::IPAddress-instance-method" class="signature"><strong>#bind_unused_port</strong>(host : String = Socket::IPAddress::LOOPBACK, reuse_port : Bool = false) : Socket::IPAddress</a> <div class="summary"><p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on an unused port and adds it as a socket.</p></div> </li> <li class="entry-summary"> <a href="#close-instance-method" class="signature"><strong>#close</strong></a> <div class="summary"><p>Gracefully terminates the server.</p></div> </li> <li class="entry-summary"> <a href="#closed?:Bool-instance-method" class="signature"><strong>#closed?</strong> : Bool</a> <div class="summary"><p>Returns <code>true</code> if this server is closed.</p></div> </li> <li class="entry-summary"> <a href="#each_address(&amp;block:Socket::Address-%3E)-instance-method" class="signature"><strong>#each_address</strong>(&amp;block : Socket::Address -&gt; )</a> <div class="summary"><p>Enumerates all addresses this server is bound to.</p></div> </li> <li class="entry-summary"> <a href="#listen(port:Int32,reuse_port:Bool=false)-instance-method" class="signature"><strong>#listen</strong>(port : Int32, reuse_port : Bool = false)</a> <div class="summary"><p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>127.0.0.1:port</code>, adds it as a socket and starts the server.</p></div> </li> <li class="entry-summary"> <a href="#listen(host:String,port:Int32,reuse_port:Bool=false)-instance-method" class="signature"><strong>#listen</strong>(host : String, port : Int32, reuse_port : Bool = false)</a> <div class="summary"><p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>host:port</code>, adds it as a socket and starts the server.</p></div> </li> <li class="entry-summary"> <a href="#listen-instance-method" class="signature"><strong>#listen</strong></a> <div class="summary"><p>Starts the server.</p></div> </li> <li class="entry-summary"> <a href="#listening?:Bool-instance-method" class="signature"><strong>#listening?</strong> : Bool</a> <div class="summary"><p>Returns <code>true</code> if this server is listening on its sockets.</p></div> </li> <li class="entry-summary"> <a href="#max_headers_size:Int32-instance-method" class="signature"><strong>#max_headers_size</strong> : Int32</a> <div class="summary"><p>Returns the maximum permitted combined size for the headers in an HTTP request.</p></div> </li> <li class="entry-summary"> <a href="#max_headers_size=(size:Int32)-instance-method" class="signature"><strong>#max_headers_size=</strong>(size : Int32)</a> <div class="summary"><p>Sets the maximum permitted combined size for the headers in an HTTP request.</p></div> </li> <li class="entry-summary"> <a href="#max_request_line_size:Int32-instance-method" class="signature"><strong>#max_request_line_size</strong> : Int32</a> <div class="summary"><p>Returns the maximum permitted size for the request line in an HTTP request.</p></div> </li> <li class="entry-summary"> <a href="#max_request_line_size=(size:Int32)-instance-method" class="signature"><strong>#max_request_line_size=</strong>(size : Int32)</a> <div class="summary"><p>Sets the maximum permitted size for the request line in an HTTP request.</p></div> </li> </ul> <div class="methods-inherited"> <h3>Instance methods inherited from class <code><a href="../reference">Reference</a></code>
</h3> <a href="../reference#==(other:self)-instance-method" class="tooltip"> ==(other : self)<br>==(other : JSON::Any)<br>==(other : YAML::Any)<br>==(other) ==</a>, <a href="../reference#dup-instance-method" class="tooltip"> dup dup</a>, <a href="../reference#hash(hasher)-instance-method" class="tooltip"> hash(hasher) hash</a>, <a href="../reference#inspect(io:IO):Nil-instance-method" class="tooltip"> inspect(io : IO) : Nil inspect</a>, <a href="../reference#object_id:UInt64-instance-method" class="tooltip"> object_id : UInt64 object_id</a>, <a href="../reference#pretty_print(pp):Nil-instance-method" class="tooltip"> pretty_print(pp) : Nil pretty_print</a>, <a href="../reference#same?(other:Reference)-instance-method" class="tooltip"> same?(other : Reference)<br>same?(other : Nil) same?</a>, <a href="../reference#to_s(io:IO):Nil-instance-method" class="tooltip"> to_s(io : IO) : Nil to_s</a> <h3>Constructor methods inherited from class <code><a href="../reference">Reference</a></code>
</h3> <a href="../reference#new-class-method" class="tooltip"> new new</a> <h3>Instance methods inherited from class <code><a href="../object">Object</a></code>
</h3> <a href="../object#!:Bool-instance-method" class="tooltip"> ! : Bool !</a>, <a href="../object#!=(other)-instance-method" class="tooltip"> !=(other) !=</a>, <a href="../object#!~(other)-instance-method" class="tooltip"> !~(other) !~</a>, <a href="../object#==(other)-instance-method" class="tooltip"> ==(other) ==</a>, <a href="../object#===(other:JSON::Any)-instance-method" class="tooltip"> ===(other : JSON::Any)<br>===(other : YAML::Any)<br>===(other) ===</a>, <a href="../object#=~(other)-instance-method" class="tooltip"> =~(other) =~</a>, <a href="../object#as(type:Class)-instance-method" class="tooltip"> as(type : Class) as</a>, <a href="../object#as?(type:Class)-instance-method" class="tooltip"> as?(type : Class) as?</a>, <a href="../object#class-instance-method" class="tooltip"> class class</a>, <a href="../object#dup-instance-method" class="tooltip"> dup dup</a>, <a href="../object#hash(hasher)-instance-method" class="tooltip"> hash(hasher)<br>hash hash</a>, <a href="../object#in?(*values:Object):Bool-instance-method" class="tooltip"> in?(*values : Object) : Bool<br>in?(collection) : Bool in?</a>, <a href="../object#inspect:String-instance-method" class="tooltip"> inspect : String<br>inspect(io : IO) : Nil inspect</a>, <a href="../object#is_a?(type:Class):Bool-instance-method" class="tooltip"> is_a?(type : Class) : Bool is_a?</a>, <a href="../object#itself-instance-method" class="tooltip"> itself itself</a>, <a href="../object#nil?:Bool-instance-method" class="tooltip"> nil? : Bool nil?</a>, <a href="../object#not_nil!-instance-method" class="tooltip"> not_nil! not_nil!</a>, <a href="#" class="tooltip"> pretty_inspect(width = 79, newline = "\n", indent = 0) : String pretty_inspect</a>, <a href="../object#pretty_print(pp:PrettyPrint):Nil-instance-method" class="tooltip"> pretty_print(pp : PrettyPrint) : Nil pretty_print</a>, <a href="../object#responds_to?(name:Symbol):Bool-instance-method" class="tooltip"> responds_to?(name : Symbol) : Bool responds_to?</a>, <a href="../object#tap(&amp;)-instance-method" class="tooltip"> tap(&amp;) tap</a>, <a href="../object#to_json(io:IO)-instance-method" class="tooltip"> to_json(io : IO)<br>to_json to_json</a>, <a href="#" class="tooltip"> to_pretty_json(io : IO, indent : String = " ")<br>to_pretty_json(indent : String = " ") to_pretty_json</a>, <a href="../object#to_s:String-instance-method" class="tooltip"> to_s : String<br>to_s(io : IO) : Nil to_s</a>, <a href="../object#to_yaml(io:IO)-instance-method" class="tooltip"> to_yaml(io : IO)<br>to_yaml to_yaml</a>, <a href="../object#try(&amp;)-instance-method" class="tooltip"> try(&amp;) try</a>, <a href="../object#unsafe_as(type:T.class)forallT-instance-method" class="tooltip"> unsafe_as(type : T.class) forall T unsafe_as</a> <h3>Class methods inherited from class <code><a href="../object">Object</a></code>
</h3> <a href="../object#from_json(string_or_io,root:String)-class-method" class="tooltip"> from_json(string_or_io, root : String)<br>from_json(string_or_io) from_json</a>, <a href="../object#from_yaml(string_or_io:String%7CIO)-class-method" class="tooltip"> from_yaml(string_or_io : String | IO) from_yaml</a> </div> <h2>  Constructor Detail </h2> <div class="entry-detail" id="new(handlers:Array(HTTP::Handler),&amp;handler:HTTP::Handler::HandlerProc):self-class-method"> <h3 class="signature">def self.<strong>new</strong>(handlers : <a href="../array">Array</a>(<a href="handler">HTTP::Handler</a>), &amp;handler : <a href="handler/handlerproc">HTTP::Handler::HandlerProc</a>) : self<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L149" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new HTTP server with a handler chain constructed from the <em>handlers</em> array and the given block.</p> </div>   </div> <div class="entry-detail" id="new(&amp;handler:HTTP::Handler::HandlerProc):self-class-method"> <h3 class="signature">def self.<strong>new</strong>(&amp;handler : <a href="handler/handlerproc">HTTP::Handler::HandlerProc</a>) : self<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L143" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new HTTP server with the given block as handler.</p> </div>   </div> <div class="entry-detail" id="new(handlers:Array(HTTP::Handler)):self-class-method"> <h3 class="signature">def self.<strong>new</strong>(handlers : <a href="../array">Array</a>(<a href="handler">HTTP::Handler</a>)) : self<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L154" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new HTTP server with the <em>handlers</em> array as handler chain.</p> </div>   </div> <div class="entry-detail" id="new(handler:HTTP::Handler|HTTP::Handler::HandlerProc)-class-method"> <h3 class="signature">def self.<strong>new</strong>(handler : <a href="handler">HTTP::Handler</a> | <a href="handler/handlerproc">HTTP::Handler::HandlerProc</a>)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L159" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new HTTP server with the given <em>handler</em>.</p> </div>   </div> <h2>  Class Method Detail </h2> <div class="entry-detail" id="build_middleware(handlers,last_handler:Context-&gt;?=nil)-class-method"> <h3 class="signature">def self.<strong>build_middleware</strong>(handlers, last_handler : <a href="server/context">Context</a> -&gt; ? = nil)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L527" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Builds all handlers as the middleware for <code><a href="server">HTTP::Server</a></code>.</p> </div>   </div> <h2>  Instance Method Detail </h2> <div class="entry-detail" id="addresses:Array(Socket::Address)-instance-method"> <h3 class="signature">def <strong>addresses</strong> : <a href="../array">Array</a>(<a href="../socket/address">Socket::Address</a>)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L418" target="_blank" class="view-source">Source</a>
</h3>   </div> <div class="entry-detail" id="bind(socket:Socket::Server):Nil-instance-method"> <h3 class="signature">def <strong>bind</strong>(socket : <a href="../socket/server">Socket::Server</a>) : <a href="../nil">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L404" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Adds a <code><a href="../socket/server">Socket::Server</a></code> <em>socket</em> to this server.</p> </div>   </div> <div class="entry-detail" id="bind(uri:URI):Socket::Address-instance-method"> <h3 class="signature">def <strong>bind</strong>(uri : <a href="../uri">URI</a>) : <a href="../socket/address">Socket::Address</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L383" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Parses a socket configuration from <em>uri</em> and adds it to this server. Returns the effective address it is bound to.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind("tcp://localhost:80")                                                  # =&gt; Socket::IPAddress.new("127.0.0.1", 8080)
server.bind("unix:///tmp/server.sock")                                             # =&gt; Socket::UNIXAddress.new("/tmp/server.sock")
server.bind("tls://127.0.0.1:443?key=private.key&amp;cert=certificate.cert&amp;ca=ca.crt") # =&gt; Socket::IPAddress.new("127.0.0.1", 443)</pre> </div>   </div> <div class="entry-detail" id="bind(uri:String):Socket::Address-instance-method"> <h3 class="signature">def <strong>bind</strong>(uri : <a href="../string">String</a>) : <a href="../socket/address">Socket::Address</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L378" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Parses a socket configuration from <em>uri</em> and adds it to this server. Returns the effective address it is bound to.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind("tcp://localhost:80")                                                  # =&gt; Socket::IPAddress.new("127.0.0.1", 8080)
server.bind("unix:///tmp/server.sock")                                             # =&gt; Socket::UNIXAddress.new("/tmp/server.sock")
server.bind("tls://127.0.0.1:443?key=private.key&amp;cert=certificate.cert&amp;ca=ca.crt") # =&gt; Socket::IPAddress.new("127.0.0.1", 443)</pre> </div>   </div> <div class="entry-detail" id="bind_tcp(host:String,port:Int32,reuse_port:Bool=false):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_tcp</strong>(host : <a href="../string">String</a>, port : <a href="../int32">Int32</a>, reuse_port : <a href="../bool">Bool</a> = false) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L210" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>host:port</code> and adds it as a socket, returning the local address and port the server listens on.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind_tcp("127.0.0.100", 8080) # =&gt; Socket::IPAddress.new("127.0.0.100", 8080)</pre> <p>If <em>reuse_port</em> is <code>true</code>, it enables the <code>SO_REUSEPORT</code> socket option, which allows multiple processes to bind to the same port.</p> </div>   </div> <div class="entry-detail" id="bind_tcp(port:Int32,reuse_port:Bool=false):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_tcp</strong>(port : <a href="../int32">Int32</a>, reuse_port : <a href="../bool">Bool</a> = false) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L235" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>127.0.0.1:port</code> and adds it as a socket, returning the local address and port the server listens on.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind_tcp(8080) # =&gt; Socket::IPAddress.new("127.0.0.1", 8080)</pre> <p>If <em>reuse_port</em> is <code>true</code>, it enables the <code>SO_REUSEPORT</code> socket option, which allows multiple processes to bind to the same port.</p> </div>   </div> <div class="entry-detail" id="bind_tcp(address:Socket::IPAddress,reuse_port:Bool=false):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_tcp</strong>(address : <a href="../socket/ipaddress">Socket::IPAddress</a>, reuse_port : <a href="../bool">Bool</a> = false) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L252" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <em>address</em> and adds it as a socket, returning the local address and port the server listens on.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind_tcp(Socket::IPAddress.new("127.0.0.100", 8080)) # =&gt; Socket::IPAddress.new("127.0.0.100", 8080)
server.bind_tcp(Socket::IPAddress.new("127.0.0.100", 0))    # =&gt; Socket::IPAddress.new("127.0.0.100", 35487)</pre> <p>If <em>reuse_port</em> is <code>true</code>, it enables the <code>SO_REUSEPORT</code> socket option, which allows multiple processes to bind to the same port.</p> </div>   </div> <div class="entry-detail" id="bind_tls(host:String,port:Int32,context:OpenSSL::SSL::Context::Server,reuse_port:Bool=false):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_tls</strong>(host : <a href="../string">String</a>, port : <a href="../int32">Int32</a>, context : <a href="../openssl/ssl/context/server">OpenSSL::SSL::Context::Server</a>, reuse_port : <a href="../bool">Bool</a> = false) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L303" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates an <code><a href="../openssl/ssl/server">OpenSSL::SSL::Server</a></code> and adds it as a socket.</p> <p>The SSL server wraps a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>host:port</code>.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
context = OpenSSL::SSL::Context::Server.new
context.certificate_chain = "openssl.crt"
context.private_key = "openssl.key"
server.bind_tls "127.0.0.1", 8080, context</pre> </div>   </div> <div class="entry-detail" id="bind_tls(address:Socket::IPAddress,context:OpenSSL::SSL::Context::Server):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_tls</strong>(address : <a href="../socket/ipaddress">Socket::IPAddress</a>, context : <a href="../openssl/ssl/context/server">OpenSSL::SSL::Context::Server</a>) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L303" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates an <code><a href="../openssl/ssl/server">OpenSSL::SSL::Server</a></code> and adds it as a socket.</p> <p>The SSL server wraps a <code><a href="../tcpserver">TCPServer</a></code> listening on an unused port on <em>host</em>.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
context = OpenSSL::SSL::Context::Server.new
context.certificate_chain = "openssl.crt"
context.private_key = "openssl.key"
address = server.bind_tls Socket::IPAddress.new("127.0.0.1", 8000), context</pre> </div>   </div> <div class="entry-detail" id="bind_tls(host:String,context:OpenSSL::SSL::Context::Server):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_tls</strong>(host : <a href="../string">String</a>, context : <a href="../openssl/ssl/context/server">OpenSSL::SSL::Context::Server</a>) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L303" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates an <code><a href="../openssl/ssl/server">OpenSSL::SSL::Server</a></code> and adds it as a socket.</p> <p>The SSL server wraps a <code><a href="../tcpserver">TCPServer</a></code> listening on an unused port on <em>host</em>.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
context = OpenSSL::SSL::Context::Server.new
context.certificate_chain = "openssl.crt"
context.private_key = "openssl.key"
address = server.bind_tls "127.0.0.1", context</pre> </div>   </div> <div class="entry-detail" id="bind_unix(path:String):Socket::UNIXAddress-instance-method"> <h3 class="signature">def <strong>bind_unix</strong>(path : <a href="../string">String</a>) : <a href="../socket/unixaddress">Socket::UNIXAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L278" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../unixserver">UNIXServer</a></code> bound to <em>path</em> and adds it as a socket.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind_unix "/tmp/my-socket.sock"</pre> </div>   </div> <div class="entry-detail" id="bind_unix(address:Socket::UNIXAddress):Socket::UNIXAddress-instance-method"> <h3 class="signature">def <strong>bind_unix</strong>(address : <a href="../socket/unixaddress">Socket::UNIXAddress</a>) : <a href="../socket/unixaddress">Socket::UNIXAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L299" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../unixserver">UNIXServer</a></code> bound to <em>address</em> and adds it as a socket.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind_unix(Socket::UNIXAddress.new("/tmp/my-socket.sock"))</pre> </div>   </div> <div class="entry-detail" id="bind_unused_port(host:String=Socket::IPAddress::LOOPBACK,reuse_port:Bool=false):Socket::IPAddress-instance-method"> <h3 class="signature">def <strong>bind_unused_port</strong>(host : <a href="../string">String</a> = Socket::IPAddress::LOOPBACK, reuse_port : <a href="../bool">Bool</a> = false) : <a href="../socket/ipaddress">Socket::IPAddress</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L266" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on an unused port and adds it as a socket.</p> <p>Returns the <code><a href="../socket/ipaddress">Socket::IPAddress</a></code> with the determined port number.</p> <pre data-language="crystal">require "http/server"

server = HTTP::Server.new { }
server.bind_unused_port # =&gt; Socket::IPAddress.new("127.0.0.1", 12345)</pre> </div>   </div> <div class="entry-detail" id="close-instance-method"> <h3 class="signature">def <strong>close</strong><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L481" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Gracefully terminates the server. It will process currently accepted requests, but it won't accept new connections.</p> </div>   </div> <div class="entry-detail" id="closed?:Bool-instance-method"> <h3 class="signature">def <strong>closed?</strong> : <a href="../bool">Bool</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L137" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns <code>true</code> if this server is closed.</p> </div>   </div> <div class="entry-detail" id="each_address(&amp;block:Socket::Address-&gt;)-instance-method"> <h3 class="signature">def <strong>each_address</strong>(&amp;block : <a href="../socket/address">Socket::Address</a> -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L412" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Enumerates all addresses this server is bound to.</p> </div>   </div> <div class="entry-detail" id="listen(port:Int32,reuse_port:Bool=false)-instance-method"> <h3 class="signature">def <strong>listen</strong>(port : <a href="../int32">Int32</a>, reuse_port : <a href="../bool">Bool</a> = false)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L430" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>127.0.0.1:port</code>, adds it as a socket and starts the server. Blocks until the server is closed.</p> <p>See <code><a href="server#bind(socket:Socket::Server):Nil-instance-method">#bind(port : Int32)</a></code> for details.</p> </div>   </div> <div class="entry-detail" id="listen(host:String,port:Int32,reuse_port:Bool=false)-instance-method"> <h3 class="signature">def <strong>listen</strong>(host : <a href="../string">String</a>, port : <a href="../int32">Int32</a>, reuse_port : <a href="../bool">Bool</a> = false)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L440" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a <code><a href="../tcpserver">TCPServer</a></code> listening on <code>host:port</code>, adds it as a socket and starts the server. Blocks until the server is closed.</p> <p>See <code>#bind(host : String, port : Int32)</code> for details.</p> </div>   </div> <div class="entry-detail" id="listen-instance-method"> <h3 class="signature">def <strong>listen</strong><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L447" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Starts the server. Blocks until the server is closed.</p> </div>   </div> <div class="entry-detail" id="listening?:Bool-instance-method"> <h3 class="signature">def <strong>listening?</strong> : <a href="../bool">Bool</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L140" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns <code>true</code> if this server is listening on its sockets.</p> </div>   </div> <div class="entry-detail" id="max_headers_size:Int32-instance-method"> <h3 class="signature">def <strong>max_headers_size</strong> : <a href="../int32">Int32</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L189" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns the maximum permitted combined size for the headers in an HTTP request.</p> <p>When parsing a request, the server keeps track of the amount of total bytes consumed for all headers (including line breaks). If combined byte size of all headers is larger than the permitted size, the server responds with the status code <code>432 <a href="request">Request</a> Header Fields Too Large</code> (see <code><a href="status#REQUEST_HEADER_FIELDS_TOO_LARGE">HTTP::Status::REQUEST_HEADER_FIELDS_TOO_LARGE</a></code>).</p> <p>Default: <code><a href="../http#MAX_HEADERS_SIZE">HTTP::MAX_HEADERS_SIZE</a></code></p> </div>   </div> <div class="entry-detail" id="max_headers_size=(size:Int32)-instance-method"> <h3 class="signature">def <strong>max_headers_size=</strong>(size : <a href="../int32">Int32</a>)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L194" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Sets the maximum permitted combined size for the headers in an HTTP request.</p> </div>   </div> <div class="entry-detail" id="max_request_line_size:Int32-instance-method"> <h3 class="signature">def <strong>max_request_line_size</strong> : <a href="../int32">Int32</a><a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L171" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns the maximum permitted size for the request line in an HTTP request.</p> <p>The request line is the first line of a request, consisting of method, resource and HTTP version and the delimiting line break. If the request line has a larger byte size than the permitted size, the server responds with the status code <code>414 <a href="../uri">URI</a> Too Long</code> (see <code><a href="status#URI_TOO_LONG">HTTP::Status::URI_TOO_LONG</a></code>).</p> <p>Default: <code><a href="../http#MAX_REQUEST_LINE_SIZE">HTTP::MAX_REQUEST_LINE_SIZE</a></code></p> </div>   </div> <div class="entry-detail" id="max_request_line_size=(size:Int32)-instance-method"> <h3 class="signature">def <strong>max_request_line_size=</strong>(size : <a href="../int32">Int32</a>)<a href="https://github.com/crystal-lang/crystal/blob/dd40a2442/src/http/server.cr#L176" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Sets the maximum permitted size for the request line in an HTTP request.</p> </div>   </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/api/1.0.0/HTTP/Server.html" class="_attribution-link" target="_blank">https://crystal-lang.org/api/1.0.0/HTTP/Server.html</a>
  </p>
</div>
