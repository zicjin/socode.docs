<h1 class="type-name"> class OptionParser </h1> <ul class="superclass-hierarchy">
<li class="superclass"><a href="optionparser">OptionParser</a></li>
<li class="superclass"><a href="reference">Reference</a></li>
<li class="superclass"><a href="object">Object</a></li>
</ul> <h2>  Overview </h2> <p><code><a href="optionparser">OptionParser</a></code> is a class for command-line options processing. It supports:</p> <ul> <li>Short and long modifier style options (example: <code>-h</code>, <code>--help</code>)</li> <li>Passing arguments to the flags (example: <code>-f filename.txt</code>)</li> <li>Subcommands</li> <li>Automatic help message generation</li> </ul> <p>Run <code>crystal</code> for an example of a CLI built with <code><a href="optionparser">OptionParser</a></code>.</p> <p>Short example:</p> <pre data-language="crystal">require "option_parser"

upcase = false
destination = "World"

OptionParser.parse do |parser|
  parser.banner = "Usage: salute [arguments]"
  parser.on("-u", "--upcase", "Upcases the salute") { upcase = true }
  parser.on("-t NAME", "--to=NAME", "Specifies the name to salute") { |name| destination = name }
  parser.on("-h", "--help", "Show this help") do
    puts parser
    exit
  end
  parser.invalid_option do |flag|
    STDERR.puts "ERROR: #{flag} is not a valid option."
    STDERR.puts parser
    exit(1)
  end
end

destination = destination.upcase if upcase
puts "Hello #{destination}!"</pre> <h1>
Subcommands</h1> <p><code><a href="optionparser">OptionParser</a></code> also supports subcommands.</p> <p>Short example:</p> <pre data-language="crystal">require "option_parser"

verbose = false
salute = false
welcome = false
name = "World"
parser = OptionParser.new do |parser|
  parser.banner = "Usage: example [subcommand] [arguments]"
  parser.on("salute", "Salute a name") do
    salute = true
    parser.banner = "Usage: example salute [arguments]"
    parser.on("-t NAME", "--to=NAME", "Specify the name to salute") { |_name| name = _name }
  end
  parser.on("welcome", "Print a greeting message") do
    welcome = true
    parser.banner = "Usage: example welcome"
  end
  parser.on("-v", "--verbose", "Enabled verbose output") { verbose = true }
  parser.on("-h", "--help", "Show this help") do
    puts parser
    exit
  end
end

parser.parse

if salute
  STDERR.puts "Saluting #{name}" if verbose
  puts "Hello #{name}"
elsif welcome
  STDERR.puts "Welcoming #{name}" if verbose
  puts "Welcome!"
else
  puts parser
  exit(1)
end</pre> <h2>  Defined in: </h2> <a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L81" target="_blank"> option_parser.cr </a> <br> <h2>  Constructors </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#new-class-method" class="signature"><strong>.new</strong></a> <div class="summary"><p>Creates a new parser.</p></div> </li> <li class="entry-summary"> <a href="#new%28%26%29-class-method" class="signature"><strong>.new</strong>(&amp;)</a> <div class="summary"><p>Creates a new parser, with its configuration specified in the block.</p></div> </li> <li class="entry-summary"> <a href="#parse%28args%3DARGV%2C%26%29%3Aself-class-method" class="signature"><strong>.parse</strong>(args = ARGV, &amp;) : self</a> <div class="summary"><p>Creates a new parser, with its configuration specified in the block, and uses it to parse the passed <em>args</em> (defaults to <code><a href="toplevel#ARGV">ARGV</a></code>).</p></div> </li> </ul> <h2>  Instance Method Summary </h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#banner%3D%28banner%3AString%3F%29-instance-method" class="signature"><strong>#banner=</strong>(banner : String?)</a> <div class="summary"><p>Establishes the initial message for the help printout.</p></div> </li> <li class="entry-summary"> <a href="#before_each%28%26before_each%3AString-%3E%29-instance-method" class="signature"><strong>#before_each</strong>(&amp;before_each : String -&gt; )</a> <div class="summary"><p>Sets a handler which runs before each argument is parsed.</p></div> </li> <li class="entry-summary"> <a href="#invalid_option%28%26invalid_option%3AString-%3E%29-instance-method" class="signature"><strong>#invalid_option</strong>(&amp;invalid_option : String -&gt; )</a> <div class="summary"><p>Sets a handler for option arguments that didn't match any of the setup options.</p></div> </li> <li class="entry-summary"> <a href="#missing_option%28%26missing_option%3AString-%3E%29-instance-method" class="signature"><strong>#missing_option</strong>(&amp;missing_option : String -&gt; )</a> <div class="summary"><p>Sets a handler for when a option that expects an argument wasn't given any.</p></div> </li> <li class="entry-summary"> <a href="#on%28short_flag%3AString%2Clong_flag%3AString%2Cdescription%3AString%2C%26block%3AString-%3E%29-instance-method" class="signature"><strong>#on</strong>(short_flag : String, long_flag : String, description : String, &amp;block : String -&gt; )</a> <div class="summary"><p>Establishes a handler for a pair of short and long flags.</p></div> </li> <li class="entry-summary"> <a href="#on%28flag%3AString%2Cdescription%3AString%2C%26block%3AString-%3E%29-instance-method" class="signature"><strong>#on</strong>(flag : String, description : String, &amp;block : String -&gt; )</a> <div class="summary"><p>Establishes a handler for a <em>flag</em> or subcommand.</p></div> </li> <li class="entry-summary"> <a href="#parse%28args%3DARGV%29%3ANil-instance-method" class="signature"><strong>#parse</strong>(args = ARGV) : Nil</a> <div class="summary"><p>Parses the passed <em>args</em> (defaults to <code><a href="toplevel#ARGV">ARGV</a></code>), running the handlers associated to each option.</p></div> </li> <li class="entry-summary"> <a href="#separator%28message%3D%22%22%29%3ANil-instance-method" class="signature"><strong>#separator</strong>(message = "") : Nil</a> <div class="summary"><p>Adds a separator, with an optional header message, that will be used to print the help.</p></div> </li> <li class="entry-summary"> <a href="#stop%3ANil-instance-method" class="signature"><strong>#stop</strong> : Nil</a> <div class="summary"><p>Stops the current parse and returns immediately, leaving the remaining flags unparsed.</p></div> </li> <li class="entry-summary"> <a href="#to_s%28io%3AIO%29%3ANil-instance-method" class="signature"><strong>#to_s</strong>(io : IO) : Nil</a> <div class="summary"><p>Returns all the setup options, formatted in a help message.</p></div> </li> <li class="entry-summary"> <a href="#unknown_args%28%26unknown_args%3AArray%28String%29%2CArray%28String%29-%3E%29-instance-method" class="signature"><strong>#unknown_args</strong>(&amp;unknown_args : Array(String), Array(String) -&gt; )</a> <div class="summary"><p>Sets a handler for regular arguments that didn't match any of the setup options.</p></div> </li> </ul> <div class="methods-inherited"> <h3>Instance methods inherited from class <code><a href="reference">Reference</a></code>
</h3> <a href="reference#%3D%3D%28other%3Aself%29-instance-method" class="tooltip"> ==(other : self)<br>==(other : JSON::Any)<br>==(other : YAML::Any)<br>==(other) ==</a>, <a href="reference#dup-instance-method" class="tooltip"> dup dup</a>, <a href="reference#hash%28hasher%29-instance-method" class="tooltip"> hash(hasher) hash</a>, <a href="reference#initialize-instance-method" class="tooltip"> initialize initialize</a>, <a href="reference#inspect%28io%3AIO%29%3ANil-instance-method" class="tooltip"> inspect(io : IO) : Nil inspect</a>, <a href="reference#object_id%3AUInt64-instance-method" class="tooltip"> object_id : UInt64 object_id</a>, <a href="reference#pretty_print%28pp%29%3ANil-instance-method" class="tooltip"> pretty_print(pp) : Nil pretty_print</a>, <a href="reference#same%3F%28other%3AReference%29%3ABool-instance-method" class="tooltip"> same?(other : Reference) : Bool<br>same?(other : Nil) same?</a>, <a href="reference#to_s%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_s(io : IO) : Nil to_s</a> <h3>Constructor methods inherited from class <code><a href="reference">Reference</a></code>
</h3> <a href="reference#new-class-method" class="tooltip"> new new</a> <h3>Instance methods inherited from class <code><a href="object">Object</a></code>
</h3> <a href="object#%21%3ABool-instance-method" class="tooltip"> ! : Bool !</a>, <a href="object#%21%3D%28other%29-instance-method" class="tooltip"> !=(other) !=</a>, <a href="object#%21~%28other%29-instance-method" class="tooltip"> !~(other) !~</a>, <a href="object#%3D%3D%28other%29-instance-method" class="tooltip"> ==(other) ==</a>, <a href="object#%3D%3D%3D%28other%3AJSON%3A%3AAny%29-instance-method" class="tooltip"> ===(other : JSON::Any)<br>===(other : YAML::Any)<br>===(other) ===</a>, <a href="object#%3D~%28other%29-instance-method" class="tooltip"> =~(other) =~</a>, <a href="object#as%28type%3AClass%29-instance-method" class="tooltip"> as(type : Class) as</a>, <a href="object#as%3F%28type%3AClass%29-instance-method" class="tooltip"> as?(type : Class) as?</a>, <a href="object#class-instance-method" class="tooltip"> class class</a>, <a href="object#dup-instance-method" class="tooltip"> dup dup</a>, <a href="object#hash%28hasher%29-instance-method" class="tooltip"> hash(hasher)<br>hash hash</a>, <a href="object#in%3F%28collection%3AObject%29%3ABool-instance-method" class="tooltip"> in?(collection : Object) : Bool<br>in?(*values : Object) : Bool in?</a>, <a href="object#inspect%28io%3AIO%29%3ANil-instance-method" class="tooltip"> inspect(io : IO) : Nil<br>inspect : String inspect</a>, <a href="object#is_a%3F%28type%3AClass%29%3ABool-instance-method" class="tooltip"> is_a?(type : Class) : Bool is_a?</a>, <a href="object#itself-instance-method" class="tooltip"> itself itself</a>, <a href="object#nil%3F%3ABool-instance-method" class="tooltip"> nil? : Bool nil?</a>, <a href="object#not_nil%21-instance-method" class="tooltip"> not_nil! not_nil!</a>, <a href="object#pretty_inspect%28width%3D79%2Cnewline%3D%22%5Cn%22%2Cindent%3D0%29%3AString-instance-method" class="tooltip"> pretty_inspect(width = 79, newline = "\n", indent = 0) : String pretty_inspect</a>, <a href="object#pretty_print%28pp%3APrettyPrint%29%3ANil-instance-method" class="tooltip"> pretty_print(pp : PrettyPrint) : Nil pretty_print</a>, <a href="object#responds_to%3F%28name%3ASymbol%29%3ABool-instance-method" class="tooltip"> responds_to?(name : Symbol) : Bool responds_to?</a>, <a href="object#tap%28%26%29-instance-method" class="tooltip"> tap(&amp;) tap</a>, <a href="object#to_json%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_json(io : IO) : Nil<br>to_json : String to_json</a>, <a href="object#to_pretty_json%28indent%3AString%3D%22%22%29%3AString-instance-method" class="tooltip"> to_pretty_json(indent : String = " ") : String<br>to_pretty_json(io : IO, indent : String = " ") : Nil to_pretty_json</a>, <a href="object#to_s%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_s(io : IO) : Nil<br>to_s : String to_s</a>, <a href="object#to_yaml%28io%3AIO%29%3ANil-instance-method" class="tooltip"> to_yaml(io : IO) : Nil<br>to_yaml : String to_yaml</a>, <a href="object#try%28%26%29-instance-method" class="tooltip"> try(&amp;) try</a>, <a href="object#unsafe_as%28type%3AT.class%29forallT-instance-method" class="tooltip"> unsafe_as(type : T.class) forall T unsafe_as</a> <h3>Class methods inherited from class <code><a href="object">Object</a></code>
</h3> <a href="object#from_json%28string_or_io%2Croot%3AString%29-class-method" class="tooltip"> from_json(string_or_io, root : String)<br>from_json(string_or_io) from_json</a>, <a href="object#from_yaml%28string_or_io%3AString%7CIO%29-class-method" class="tooltip"> from_yaml(string_or_io : String | IO) from_yaml</a> </div> <h2>  Constructor Detail </h2> <div class="entry-detail" id="new-class-method"> <h3 class="signature">def self.<strong>new</strong><a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L119" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new parser.</p> </div>   </div> <div class="entry-detail" id="new(&amp;)-class-method"> <h3 class="signature">def self.<strong>new</strong>(&amp;)<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L128" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new parser, with its configuration specified in the block.</p> </div>   </div> <div class="entry-detail" id="parse(args=ARGV,&amp;):self-class-method"> <h3 class="signature">def self.<strong>parse</strong>(args = ARGV, &amp;) : self<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L111" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Creates a new parser, with its configuration specified in the block, and uses it to parse the passed <em>args</em> (defaults to <code><a href="toplevel#ARGV">ARGV</a></code>).</p> </div>   </div> <h2>  Instance Method Detail </h2> <div class="entry-detail" id="banner=(banner:String?)-instance-method"> <h3 class="signature">def <strong>banner=</strong>(banner : <a href="string">String</a>?)<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L144" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Establishes the initial message for the help printout. Typically, you want to write here the name of your program, and a one-line template of its invocation.</p> <p>Example:</p> <pre data-language="crystal">require "option_parser"

parser = OptionParser.new
parser.banner = "Usage: crystal [command] [switches] [program file] [--] [arguments]"</pre> </div>   </div> <div class="entry-detail" id="before_each(&amp;before_each:String-&gt;)-instance-method"> <h3 class="signature">def <strong>before_each</strong>(&amp;before_each : <a href="string">String</a> -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L256" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Sets a handler which runs before each argument is parsed. This callback is not passed flag arguments. For example, <code>--foo=foo_arg --bar bar_arg</code> would pass <code>--foo=foo_arg</code> and <code>--bar</code> to the callback only.</p> <p>You typically use this to implement advanced option parsing behaviour such as treating all options after a filename differently (along with <code><a href="optionparser#stop%3ANil-instance-method">#stop</a></code>).</p> </div>   </div> <div class="entry-detail" id="invalid_option(&amp;invalid_option:String-&gt;)-instance-method"> <h3 class="signature">def <strong>invalid_option</strong>(&amp;invalid_option : <a href="string">String</a> -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L247" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Sets a handler for option arguments that didn't match any of the setup options.</p> <p>You typically use this to display a help message. The default behaviour is to raise <code><a href="optionparser/invalidoption">InvalidOption</a></code>.</p> </div>   </div> <div class="entry-detail" id="missing_option(&amp;missing_option:String-&gt;)-instance-method"> <h3 class="signature">def <strong>missing_option</strong>(&amp;missing_option : <a href="string">String</a> -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L240" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Sets a handler for when a option that expects an argument wasn't given any.</p> <p>You typically use this to display a help message. The default behaviour is to raise <code><a href="optionparser/missingoption">MissingOption</a></code>.</p> </div>   </div> <div class="entry-detail" id="on(short_flag:String,long_flag:String,description:String,&amp;block:String-&gt;)-instance-method"> <h3 class="signature">def <strong>on</strong>(short_flag : <a href="string">String</a>, long_flag : <a href="string">String</a>, description : <a href="string">String</a>, &amp;block : <a href="string">String</a> -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L177" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Establishes a handler for a pair of short and long flags.</p> <p>See the other definition of <code><a href="optionparser#on%28short_flag%3AString%2Clong_flag%3AString%2Cdescription%3AString%2C%26block%3AString-%3E%29-instance-method">#on</a></code> for examples. This method does not support subcommands.</p> </div>   </div> <div class="entry-detail" id="on(flag:String,description:String,&amp;block:String-&gt;)-instance-method"> <h3 class="signature">def <strong>on</strong>(flag : <a href="string">String</a>, description : <a href="string">String</a>, &amp;block : <a href="string">String</a> -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L166" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Establishes a handler for a <em>flag</em> or subcommand.</p> <p>Flags must start with a dash or double dash. They can also have an optional argument, which will get passed to the block. Each flag has a description, which will be used for the help message.</p> <p>Subcommands are any <em>flag</em> passed which does not start with a dash. They cannot take arguments. When a subcommand is parsed, all subcommands are removed from the OptionParser, simulating a "tree" of subcommands. All flags remain valid. For a longer example, see the examples at the top of the page.</p> <p>Examples of valid flags:</p> <ul> <li>
<code>-a</code>, <code>-B</code>
</li> <li><code>--something-longer</code></li> <li>
<code>-f FILE</code>, <code>--file FILE</code>, <code>--file=FILE</code> (these will yield the passed value to the block as a string)</li> </ul> <p>Examples of valid subcommands:</p> <ul> <li>
<code>foo</code>, <code>run</code>
</li> </ul> </div>   </div> <div class="entry-detail" id="parse(args=ARGV):Nil-instance-method"> <h3 class="signature">def <strong>parse</strong>(args = ARGV) : <a href="nil">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L317" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Parses the passed <em>args</em> (defaults to <code><a href="toplevel#ARGV">ARGV</a></code>), running the handlers associated to each option.</p> </div>   </div> <div class="entry-detail" id='separator(message=""):Nil-instance-method'> <h3 class="signature">def <strong>separator</strong>(message = "") : <a href="nil">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L223" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Adds a separator, with an optional header message, that will be used to print the help. The separator is placed between the flags registered (<code><a href="optionparser#on%28short_flag%3AString%2Clong_flag%3AString%2Cdescription%3AString%2C%26block%3AString-%3E%29-instance-method">#on</a></code>) before, and the flags registered after the call.</p> <p>This way, you can group the different options in an easier to read way.</p> </div>   </div> <div class="entry-detail" id="stop:Nil-instance-method"> <h3 class="signature">def <strong>stop</strong> : <a href="nil">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L262" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Stops the current parse and returns immediately, leaving the remaining flags unparsed. This is treated identically to <code>--</code> being inserted <em>behind</em> the current parsed flag.</p> </div>   </div> <div class="entry-detail" id="to_s(io:IO):Nil-instance-method"> <h3 class="signature">def <strong>to_s</strong>(io : <a href="io">IO</a>) : <a href="nil">Nil</a><a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L267" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Returns all the setup options, formatted in a help message.</p> </div>   </div> <div class="entry-detail" id="unknown_args(&amp;unknown_args:Array(String),Array(String)-&gt;)-instance-method"> <h3 class="signature">def <strong>unknown_args</strong>(&amp;unknown_args : <a href="array">Array</a>(<a href="string">String</a>), <a href="array">Array</a>(<a href="string">String</a>) -&gt; )<a href="https://github.com/crystal-lang/crystal/blob/a3ee70ca0/src/option_parser.cr#L233" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"> <p>Sets a handler for regular arguments that didn't match any of the setup options.</p> <p>You typically use this to get the main arguments (not modifiers) that your program expects (for example, filenames). The default behaviour is to do nothing. The arguments can also be extracted from the <em>args</em> array passed to <code><a href="optionparser#parse%28args%3DARGV%29%3ANil-instance-method">#parse</a></code> after parsing.</p> </div>   </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/api/1.3.0/OptionParser.html" class="_attribution-link" target="_blank">https://crystal-lang.org/api/1.3.0/OptionParser.html</a>
  </p>
</div>
