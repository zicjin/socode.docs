 <h1 id="writing-shards">Writing Shards</h1> <p>How to write and release Crystal Shards.</p> <h2 id="whats-a-shard"><em>What's a Shard?</em></h2> <p>Simply put, a Shard is a package of Crystal code, made to be shared-with and used-by other projects.</p> <p>See <a href="../the_shards_command/index">the Shards command</a> for details.</p> <h2 id="introduction">Introduction</h2> <p>In this tutorial, we'll be making a Crystal library called <em>palindrome-example</em>.</p> <blockquote> <p>For those who don't know, a palindrome is a word which is spelled the same way forwards as it is backwards. e.g. racecar, mom, dad, kayak, madam</p> </blockquote> <h3 id="requirements">Requirements</h3> <p>In order to release a Crystal Shard, and follow along with this tutorial, you will need the following:</p> <ul> <li>A working installation of the <a href="../using_the_compiler/index">Crystal compiler</a>
</li> <li>A working installation of <a href="https://git-scm.com">Git</a>
</li> <li>A <a href="https://github.com">GitHub</a> or <a href="https://gitlab.com/">GitLab</a> account</li> </ul> <h3 id="creating-the-project">Creating the Project</h3> <p>Begin by using <a href="../using_the_compiler/index">the Crystal compiler</a>'s <code>init lib</code> command to create a Crystal library with the standard directory structure.</p> <p>In your terminal: <code>crystal init lib &lt;YOUR-SHARD-NAME&gt;</code></p> <p>e.g.</p> <div class="highlight"><pre data-language="crystal">$ crystal init lib palindrome-example
    create  palindrome-example/.gitignore
    create  palindrome-example/.editorconfig
    create  palindrome-example/LICENSE
    create  palindrome-example/README.md
    create  palindrome-example/shard.yml
    create  palindrome-example/src/palindrome-example.cr
    create  palindrome-example/spec/spec_helper.cr
    create  palindrome-example/spec/palindrome-example_spec.cr
Initialized empty Git repository in /&lt;YOUR-DIRECTORY&gt;/.../palindrome-example/.git/
</pre></div> <p>...and <code>cd</code> into the directory:</p> <p>e.g.</p> <div class="highlight"><pre data-language="crystal">cd palindrome-example
</pre></div> <p>Then <code>add</code> &amp; <code>commit</code> to start tracking the files with Git:</p> <div class="highlight"><pre data-language="crystal">$ git add -A
$ git commit -am "First Commit"
[master (root-commit) 77bad84] First Commit
 8 files changed, 104 insertions(+)
 create mode 100644 .editorconfig
 create mode 100644 .gitignore
 create mode 100644 LICENSE
 create mode 100644 README.md
 create mode 100644 shard.yml
 create mode 100644 spec/palindrome-example_spec.cr
 create mode 100644 spec/spec_helper.cr
 create mode 100644 src/palindrome-example.cr
</pre></div> <h3 id="writing-the-code">Writing the Code</h3> <p>The code you write is up to you, but how you write it impacts whether people want to use your library and/or help you maintain it.</p> <h4 id="testing-the-code">Testing the Code</h4> <ul> <li>Test your code. All of it. It's the only way for anyone, including you, to know if it works.</li> <li>Crystal has <a href="https://crystal-lang.org/api/1.5.0/Spec.html">a built-in testing library</a>. Use it!</li> </ul> <h4 id="documentation">Documentation</h4> <ul> <li>Document your code with comments. All of it. Even the private methods.</li> <li>Crystal has <a href="../syntax_and_semantics/documenting_code">a built-in documentation generator</a>. Use it!</li> </ul> <p>Run <code>crystal docs</code> to convert your code and comments into interlinking API documentation. Open the files in the <code>/docs/</code> directory with a web browser to see how your documentation is looking along the way.</p> <p>See below for instructions on hosting your compiler-generated docs on GitHub/GitLab Pages.</p> <p>Once your documentation is ready and available, you can add a documentation badge to your repository so users know that it exists. In GitLab this badge belongs to the project so we'll cover it in the GitLab instructions below, for GitHub it is common to place it below the description in your README.md like so: (Be sure to replace <code>&lt;LINK-TO-YOUR-DOCUMENTATION&gt;</code> accordingly)</p> <div class="highlight"><pre data-language="crystal">[![Docs](https://img.shields.io/badge/docs-available-brightgreen.svg)](&lt;LINK-TO-YOUR-DOCUMENTATION&gt;)
</pre></div> <h3 id="writing-a-readme">Writing a README</h3> <p>A good README can make or break your project. <a href="https://github.com/matiassingers/awesome-readme">Awesome README</a> is a nice curation of examples and resources on the topic.</p> <p>Most importantly, your README should explain:</p> <ol> <li>What your library is</li> <li>What it does</li> <li>How to use it</li> </ol> <p>This explanation should include a few examples along with subheadings.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Be sure to replace all instances of <code>[your-github-name]</code> in the Crystal-generated README template with your GitHub/GitLab username. If you're using GitLab, you'll also want to change all instances of <code>github</code> with <code>gitlab</code>.</p> </div> <h4 id="coding-style">Coding Style</h4> <ul> <li>It's fine to have your own style, but sticking to <a href="../conventions/coding_style">some core rubrics defined by the Crystal team</a> can help keep your code consistent, readable and usable for other developers.</li> <li>Utilize Crystal's <a href="../syntax_and_semantics/documenting_code">built-in code formatter</a> to automatically format all <code>.cr</code> files in a directory.</li> </ul> <p>e.g.</p> <div class="highlight"><pre data-language="crystal">crystal tool format
</pre></div> <p>To check if your code is formatted correctly, or to check if using the formatter wouldn't produce any changes, simply add <code>--check</code> to the end of this command.</p> <p>e.g.</p> <div class="highlight"><pre data-language="crystal">crystal tool format --check
</pre></div> <p>This check is good to add as a step in <a href="ci/index">continuous integration</a>.</p> <h3 id="writing-a-shardyml">Writing a <code>shard.yml</code>
</h3> <p><a href="https://github.com/crystal-lang/shards/blob/master/docs/shard.yml.adoc">The spec</a> is your rulebook. Follow it.</p> <h4 id="name">Name</h4> <p>Your <code>shard.yml</code>'s <code>name</code> property should be concise and descriptive.</p> <ul> <li>Search <a href="https://crystalshards.xyz/">crystalshards.xyz</a> to check if your name is already taken.</li> </ul> <p>e.g.</p> <div class="highlight"><pre data-language="crystal">name: palindrome-example
</pre></div> <h4 id="description">Description</h4> <p>Add a <code>description</code> to your <code>shard.yml</code>.</p> <p>A <code>description</code> is a single line description used to search for and find your shard.</p> <p>A description should be:</p> <ol> <li>Informative</li> <li>Discoverable</li> </ol> <h4 id="optimizing">Optimizing</h4> <p>It's hard for anyone to use your project if they can't find it. There are several services for discovering shards, a list is available on the <a href="https://crystal-lang.org/community/#shards">Crystal Community page</a>.</p> <p>There are people looking for the <em>exact</em> functionality of our library and the <em>general</em> functionality of our library. e.g. Bob needs a palindrome library, but Felipe is just looking for libraries involving text and Susan is looking for libraries involving spelling.</p> <p>Our <code>name</code> is already descriptive enough for Bob's search of "palindrome". We don't need to repeat the <em>palindrome</em> keyword. Instead, we'll catch Susan's search for "spelling" and Felipe's search for "text".</p> <div class="highlight"><pre data-language="crystal">description: |
  A textual algorithm to tell if a word is spelled the same way forwards as it is backwards.
</pre></div> <h3 id="hosting">Hosting</h3> <p>From here the guide differs depending on whether you are hosting your repo on GitHub or GitLab. If you're hosting somewhere else, please feel free to write up a guide and add it to this book!</p> <ul> <li><a href="hosting/github">Hosting on GitHub</a></li> <li><a href="hosting/gitlab">Hosting on GitLab</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://crystal-lang.org/reference/1.5/guides/writing_shards.html" class="_attribution-link" target="_blank">https://crystal-lang.org/reference/1.5/guides/writing_shards.html</a>
  </p>
</div>
