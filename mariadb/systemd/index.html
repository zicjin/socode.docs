<h1>systemd</h1> <div> <div class="node creole"> <div class="answer formatted"> <div class="mariadb_from_10_1_8 mariadb from_10_1_8 product">
<strong class="product_title">MariaDB starting with <a href="https://mariadb.com/kb/en/mariadb-1018-release-notes/">10.1.8</a></strong><p>The MariaDB <code>systemd</code> service was first released in <a href="https://mariadb.com/kb/en/mariadb-1018-release-notes/">MariaDB 10.1.8</a> on supported Linux distributions.</p> </div>
<p><code>systemd</code> is a <code><a href="../sysvinit/index">sysVinit</a></code> replacement that is the default service manager on the following Linux distributions:</p> <ul start="1">
<li>RHEL 7 and above </li>
<li>CentOS 7 and above </li>
<li>Fedora 15 and above </li>
<li>Debian 8 and above </li>
<li>Ubuntu 15.04 and above </li>
<li>SLES 12 and above </li>
<li>OpenSUSE 12.2 and above </li>
</ul> <p>MariaDB's <code>systemd</code> unit file is included in the server packages for <a href="../rpm/index">RPMs</a> and <a href="../installing-mariadb-deb-files/index">DEBs</a>. It is also included in certain <a href="../installing-mariadb-binary-tarballs/index">binary tarballs</a>.</p> <p>The service name is <code>mariadb.service</code>. Aliases to <code>mysql.service</code> and <code>mysqld.service</code> are also installed for convenience.</p> <p>When MariaDB is started with the <code>systemd</code> unit file, it directly starts the <code><a href="../mysqld-options/index">mysqld</a></code> process as the <code>mysql</code> user. Unlike with <code><a href="../sysvinit/index">sysVinit</a></code>, the <code><a href="../mysqld-options/index">mysqld</a></code> process is not started with <code><a href="../mysqld_safe/index">mysqld_safe</a></code>. As a consequence, options will not be read from the <code>[mysqld_safe]</code> <a href="../configuring-mariadb-with-option-files/index#option-groups">option group</a> from <a href="../configuring-mariadb-with-option-files/index">option files</a>.</p>  <h2 class="anchored_heading" id="locating-the-mariadb-services-unit-file">Locating the MariaDB Service's Unit File</h2> <p>By default, the unit file for the service will be installed in a directory defined at build time by the <code>INSTALL_SYSTEMD_UNITDIR</code> option provided to <code><a href="../generic-build-instructions/index#using-cmake">cmake</a></code>.</p> <p>For example, on RHEL, CentOS, Fedora, and other similar Linux distributions, <code>INSTALL_SYSTEMD_UNITDIR</code> is defined as <code>/usr/lib/systemd/system/</code>, so it will be installed to:</p> <ul start="1"><li>
<code>/usr/lib/systemd/system/mariadb.service</code> </li></ul> <p>And on Debian, Ubuntu, and other similar Linux distributions, <code>INSTALL_SYSTEMD_UNITDIR</code> is defined as <code>/lib/systemd/system/</code>, so it will be installed to:</p> <ul start="1"><li>
<code>/lib/systemd/system/mariadb.service</code> </li></ul> <h2 class="anchored_heading" id="interacting-with-the-mariadb-server-process">Interacting with the MariaDB Server Process</h2> <p>The service can be interacted with by using the <code><a href="https://www.freedesktop.org/software/systemd/man/systemctl.html">systemctl</a></code> command.</p> <h3 class="anchored_heading" id="starting-the-mariadb-server-process-on-boot">Starting the MariaDB Server Process on Boot</h3> <p>MariaDB's <code>systemd</code> service can be configured to start at boot by executing the following:</p> <pre class="fixed" data-language="sql">sudo systemctl enable mariadb
</pre>
<h3 class="anchored_heading" id="starting-the-mariadb-server-process">Starting the MariaDB Server Process</h3> <p>MariaDB's <code>systemd</code> service can be started by executing the following:</p> <pre class="fixed" data-language="sql">sudo systemctl start mariadb
</pre>
<p>MariaDB's <code>systemd</code> unit file has a default startup timeout of about 90 seconds on most systems. If certain startup tasks, such as crash recovery, take longer than this default startup timeout, then <code>systemd</code> will assume that <code>mysqld</code> has failed to startup, which causes <code>systemd</code> to kill the <code>mysqld</code> process. To work around this, you can reconfigure the MariaDB <code>systemd</code> unit to have an <a href="#configuring-the-systemd-service-timeout">infinite timeout</a>.</p> <p>Note that <a href="https://lists.freedesktop.org/archives/systemd-devel/2017-December/039996.html">systemd 236 added the <code>EXTEND_TIMEOUT_USEC</code> environment variable</a> that allows services to extend the startup timeout during long-running processes. Starting with <a href="https://mariadb.com/kb/en/mariadb-10133-release-notes/">MariaDB 10.1.33</a>, <a href="https://mariadb.com/kb/en/mariadb-10215-release-notes/">MariaDB 10.2.15</a>, and <a href="https://mariadb.com/kb/en/mariadb-1036-release-notes/">MariaDB 10.3.6</a>, on systems with systemd versions that support it, MariaDB uses this feature to extend the startup timeout during certain startup processes that can run long. Therefore, if you are using <code>systemd</code> 236 or later, then you should not need to manually override <code>TimeoutStartSec</code>, even if your startup tasks, such as crash recovery, run for longer than the configured value. See <a href="https://jira.mariadb.org/browse/MDEV-14705">MDEV-14705</a> for more information.</p> <h3 class="anchored_heading" id="stopping-the-mariadb-server-process">Stopping the MariaDB Server Process</h3> <p>MariaDB's <code>systemd</code> service can be stopped by executing the following:</p> <pre class="fixed" data-language="sql">sudo systemctl stop mariadb
</pre>
<h3 class="anchored_heading" id="restarting-the-mariadb-server-process">Restarting the MariaDB Server Process</h3> <p>MariaDB's <code>systemd</code> service can be restarted by executing the following:</p> <pre class="fixed" data-language="sql">sudo systemctl restart mariadb
</pre>
<h3 class="anchored_heading" id="checking-the-status-of-the-mariadb-server-process">Checking the Status of the MariaDB Server Process</h3> <p>The status of MariaDB's <code>systemd</code> service can be obtained by executing the following:</p> <pre class="fixed" data-language="sql">sudo systemctl status mariadb
</pre>
<h3 class="anchored_heading" id="interacting-with-multiple-mariadb-server-processes">Interacting with Multiple MariaDB Server Processes</h3> <p>A <code>systemd</code> <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">template unit file</a> with the name <code>mariadb@.service</code> is installed in <code>INSTALL_SYSTEMD_UNITDIR</code> on some systems. See <a href="#locating-the-mariadb-services-unit-file">Locating the MariaDB Service's Unit File</a> to see what directory that refers to on each distribution.</p> <p>This template unit file allows you to interact with multiple MariaDB instances on the same system using the same template unit file. When you interact with a MariaDB instance using this template unit file, you have to provide an instance name as a suffix. For example, the following command tries to start a MariaDB instance with the name <code>node1</code>:</p> <pre class="fixed" data-language="sql">sudo systemctl start mariadb@node1
</pre>
<div class="cstm-style greenbox">
<p>MariaDB's build system cannot include the <code>mariadb@.service</code> template unit file in <a href="../rpm/index">RPM</a> packages on platforms that have <code><a href="../generic-build-instructions/index#using-cmake">cmake</a></code> versions older than 3.3.0, because these <code><a href="../generic-build-instructions/index#using-cmake">cmake</a></code> versions have a <a href="https://public.kitware.com/Bug/view.php?id=14782">bug</a> that causes it to encounter errors when packaging a file in RPMs if the file name contains the <code>@</code> character. MariaDB's RHEL 7 and CentOS 7 RPM build hosts only got a new enough <code><a href="../generic-build-instructions/index#using-cmake">cmake</a></code> version starting with <a href="https://mariadb.com/kb/en/mariadb-10139-release-notes/">MariaDB 10.1.39</a>, <a href="https://mariadb.com/kb/en/mariadb-10223-release-notes/">MariaDB 10.2.23</a>, and <a href="https://mariadb.com/kb/en/mariadb-10314-release-notes/">MariaDB 10.3.14</a>. To use this functionality on a MariaDB version that does not have the file, you can copy the file from a package that does have the file.</p> </div>
<p><code>systemd</code> will also look for an <a href="../configuring-mariadb-with-option-files/index">option file</a> for a specific MariaDB instance based on the instance name. By default, it will look for the option file in a directory defined at build time by the <code>INSTALL_SYSCONF2DIR</code> option provided to <code><a href="../generic-build-instructions/index#using-cmake">cmake</a></code>.</p> <p>For example, on RHEL, CentOS, Fedora, and other similar Linux distributions, <code>INSTALL_SYSCONF2DIR</code> is defined as <code>/etc/my.cnf.d/</code>, so it will look for an option file that matches the format:</p> <ul start="1"><li>
<code>/etc/my.cnf.d/my%I.cnf</code> </li></ul> <p>And on Debian, Ubuntu, and other similar Linux distributions, <code>INSTALL_SYSCONF2DIR</code> is defined as <code>/etc/mysql/conf.d//</code>, so it will look for an option file that matches the format:</p> <ul start="1"><li>
<code>/etc/mysql/conf.d/my%I.cnf</code> </li></ul> <p>In all distributions, the <code>%I</code> is the MariaDB instance name. In the above <code>node1</code> case, it would use the <a href="../configuring-mariadb-with-option-files/index">option file</a> at the path<code>/etc/my.cnf.d/mynode1.cnf</code> for RHEL-like distributions and <code>/etc/mysql/conf.d/mynode1.cnf</code> for Debian-like distributions.</p> <p>When using multiple instances, each instance will of course also need their own <code><a href="../server-system-variables/index#datadir">datadir</a></code>. See <a href="../mysql_install_db/index">mysql_install_db</a> for information on how to initialize the <code><a href="../server-system-variables/index#datadir">datadir</a></code> for additional MariaDB instances.</p> <h2 class="anchored_heading" id="systemd-and-galera-cluster">Systemd and Galera Cluster</h2> <h3 class="anchored_heading" id="bootstrapping-a-new-cluster">Bootstrapping a New Cluster</h3> <p>When using <a href="../galera/index">Galera Cluster</a> with systemd, the first node in a cluster has to be started with <code>galera_new_cluster</code>. See <a href="../getting-started-with-mariadb-galera-cluster/index#bootstrapping-a-new-cluster">Getting Started with MariaDB Galera Cluster: Bootstrapping a New Cluster</a> for more information.</p> <h3 class="anchored_heading" id="recovering-a-nodes-cluster-position">Recovering a Node's Cluster Position</h3> <p>When using <a href="../galera/index">Galera Cluster</a> with systemd, a node's position in the cluster can be recovered with <code>galera_recovery</code>. See <a href="../getting-started-with-mariadb-galera-cluster/index#determining-the-most-advanced-node">Getting Started with MariaDB Galera Cluster: Determining the Most Advanced Node</a> for more information.</p> <h3 class="anchored_heading" id="ssts-and-systemd">SSTs and Systemd</h3> <p>MariaDB's <code>systemd</code> unit file has a default startup timeout of about 90 seconds on most systems. If an SST takes longer than this default startup timeout on a joiner node, then <code>systemd</code> will assume that <code>mysqld</code> has failed to startup, which causes <code>systemd</code> to kill the <code>mysqld</code> process on the joiner node. To work around this, you can reconfigure the MariaDB <code>systemd</code> unit to have an <a href="#configuring-the-systemd-service-timeout">infinite timeout</a>. See <a href="../introduction-to-state-snapshot-transfers-ssts/index#ssts-and-systemd">Introduction to State Snapshot Transfers (SSTs): SSTs and Systemd</a> for more information.</p> <p>Note that <a href="https://lists.freedesktop.org/archives/systemd-devel/2017-December/039996.html">systemd 236 added the <code>EXTEND_TIMEOUT_USEC</code> environment variable</a> that allows services to extend the startup timeout during long-running processes. Starting with <a href="https://mariadb.com/kb/en/mariadb-10135-release-notes/">MariaDB 10.1.35</a>, <a href="https://mariadb.com/kb/en/mariadb-10217-release-notes/">MariaDB 10.2.17</a>, and <a href="https://mariadb.com/kb/en/mariadb-1038-release-notes/">MariaDB 10.3.8</a>, on systems with systemd versions that support it, MariaDB uses this feature to extend the startup timeout during long SSTs. Therefore, if you are using <code>systemd</code> 236 or later, then you should not need to manually override <code>TimeoutStartSec</code>, even if your SSTs run for longer than the configured value. See <a href="https://jira.mariadb.org/browse/MDEV-15607">MDEV-15607</a> for more information.</p> <h2 class="anchored_heading" id="configuring-the-systemd-service">Configuring the Systemd Service</h2> <p>You can configure MariaDB's <code>systemd</code> service by creating a "drop-in" configuration file for the <code>systemd</code> service. On most systems, the <code>systemd</code> service's directory for "drop-in" configuration files is <code>/etc/systemd/system/mariadb.service.d/</code>. You can confirm the directory and see what "drop-in" configuration files are currently loaded by executing:</p> <pre class="fixed" data-language="sql">$ sudo systemctl status mariadb.service
● mariadb.service - MariaDB 10.1.37 database server
   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; vendor preset: disabled)
  Drop-In: /etc/systemd/system/mariadb.service.d
           └─migrated-from-my.cnf-settings.conf, timeoutstartsec.conf
...
</pre>
<p>If you want to configure the <code>systemd</code> service, then you can create a file with the <code>.conf</code> extension in that directory. The configuration option(s) that you would like to change would need to be placed in an appropriate section within the file, usually <code>[Service]</code>. If a <code>systemd</code> option is a list, then you may need to set the option to empty before you set the replacement values. For example:</p> <pre class="fixed" data-language="sql">[Service]

ExecStart=
ExecStart=/usr/bin/numactl --interleave=all  /usr/sbin/mysqld ${MYSQLD_OPTS} ${_WSREP_NEW_CLUSTER} ${_WSREP_START_POSITION}
</pre>
<p>After any configuration change, you will need to execute the following for the change to go into effect:</p> <pre class="fixed" data-language="sql">sudo systemctl daemon-reload
</pre>
<h3 class="anchored_heading" id="useful-systemd-options">Useful Systemd Options</h3> <p>Useful <code>systemd</code> options are listed below. If an option is equivalent to a common <code><a href="../mysqld_safe/index">mysqld_safe</a></code> option, then that is also listed.</p> <div class="cstm-style darkheader-nospace-borders">
<table>
<tr>
<th>mysqld_safe option</th>
<th>systemd option</th>
<th>Comments</th>
</tr> <tr>
<td>no option</td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectHome=">ProtectHome=false</a></code></td>
<td>If any MariaDB files are in /home/</td>
</tr> <tr>
<td>no option</td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#PrivateDevices=">PrivateDevices=false</a></code></td>
<td>If any MariaDB storage references raw block devices</td>
</tr> <tr>
<td>no option</td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectSystem=">ProtectSystem=</a></code></td>
<td>If any MariaDB write any files to anywhere under /boot, /usr or /etc</td>
</tr> <tr>
<td>no option</td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html#TimeoutStartSec=">TimeoutStartSec={time}</a></code></td>
<td>Service startup timeout. See <a href="#configuring-the-systemd-service-timeout">Configuring the Systemd Service Timeout</a>.</td>
</tr> <tr>
<td>no option (see <a href="https://jira.mariadb.org/browse/MDEV-9264">MDEV-9264</a>)</td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#OOMScoreAdjust=">OOMScoreAdjust={priority}</a></code></td>
<td>e.g. -600 to lower priority of OOM killer for mysqld</td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">open-files-limit</a></code></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#LimitCPU=">LimitNOFILE={limit}</a></code></td>
<td>Limit on number of open files. See <a href="#configuring-the-open-files-limit">Configuring the Open Files Limit</a>.</td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">core-file-size</a></code></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#LimitCPU=">LimitCORE={size}</a></code></td>
<td>Limit on core file size. Useful when <a href="../enabling-core-dumps/index">enabling core dumps</a>. See <a href="#configuring-the-core-file-size">Configuring the Core File Size</a>.</td>
</tr> <tr>
<td></td>
<td>
<code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#LimitCPU=">LimitMEMLOCK={size}</a></code> or <code>infinity</code>
</td>
<td>Limit on how much can be locked in memory. Useful when <a href="../server-system-variables/index#large_pages">large-pages</a> or <a href="../mysqld-options/index#-memlock">memlock</a> is used</td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">nice</a></code></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Nice=">Nice={nice value}</a></code></td>
<td></td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">syslog</a></code></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#StandardOutput=">StandardOutput=syslog</a></code></td>
<td>See <a href="#configuring-mariadb-to-write-the-error-log-to-syslog">Configuring MariaDB to Write the Error Log to Syslog</a>.</td>
</tr> <tr>
<td></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#StandardError=">StandardError=syslog</a></code></td>
<td></td>
</tr> <tr>
<td></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#SyslogFacility=">SyslogFacility=daemon</a></code></td>
<td></td>
</tr> <tr>
<td></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#SyslogLevel=">SyslogLevel=err</a></code></td>
<td></td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">syslog-tag</a></code></td>
<td><code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#SyslogIdentifier=">SyslogIdentifier</a></code></td>
<td></td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">flush-caches</a></code></td>
<td>ExecStartPre=/usr/bin/sync</td>
<td></td>
</tr> <tr>
<td></td>
<td>ExecStartPre=/usr/sbin/sysctl -q -w vm.drop_caches=3</td>
<td></td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">numa-interleave</a></code></td>
<td>ExecStart=/usr/bin/numactl --interleave=all /usr/sbin/mysqld ${MYSQLD_OPTS} ${_WSREP_NEW_CLUSTER} ${_WSREP_START_POSITION}</td>
<td></td>
</tr> <tr>
<td><code><a href="../mysqld_safe/index#mysqld_safe-options">no-auto-restart</a></code></td>
<td>Restart={exit-status}</td>
<td></td>
</tr> </table> </div>
<p>Note: the <code><a href="http://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd</a></code> manual contains the official meanings for these options. The manual also lists considerably more options than the ones listed above.</p> <p>There are other options and the <code>mariadb-service-convert</code> script will attempt to convert these as accurately as possible.</p> <h3 class="anchored_heading" id="configuring-the-systemd-service-timeout">Configuring the Systemd Service Timeout</h3> <p>MariaDB's <code><a href="index">systemd</a></code> unit file has a default startup timeout of about 90 seconds on most systems. If a service startup takes longer than this default startup timeout, then <code>systemd</code> will assume that <code>mysqld</code> has failed to startup, which causes <code>systemd</code> to kill the <code>mysqld</code> process. To work around this, it can be changed by configuring the <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html#TimeoutStartSec=">TimeoutStartSec</a></code> option for the <code>systemd</code> service.</p> <p>A similar problem can happen when stopping the MariaDB service. Therefore, it may also be a good idea to set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html#TimeoutStopSec=">TimeoutStopSec</a></code>.</p> <p>For example, you can reconfigure the MariaDB <code>systemd</code> service to have an infinite timeout by executing one of the following commands:</p> <p>If you are using <code>systemd</code> 228 or older, then you can execute the following to set an infinite timeout:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/timeoutsec.conf &lt;&lt;EOF
[Service]

TimeoutStartSec=0
TimeoutStopSec=0
EOF
sudo systemctl daemon-reload
</pre>
<p><a href="https://lists.freedesktop.org/archives/systemd-devel/2016-February/035748.html">Systemd 229 added the infinity option</a>, so if you are using <code>systemd</code> 229 or later, then you can execute the following to set an infinite timeout:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/timeoutsec.conf &lt;&lt;EOF
[Service]

TimeoutStartSec=infinity
TimeoutStopSec=infinity
EOF
sudo systemctl daemon-reload
</pre>
<p>Note that <a href="https://lists.freedesktop.org/archives/systemd-devel/2017-December/039996.html">systemd 236 added the EXTEND_TIMEOUT_USEC environment variable</a> that allows services to extend the startup timeout during long-running processes. On systems with systemd versions that support it, MariaDB uses this feature to extend the startup timeout during certain startup processes that can run long.</p> <h3 class="anchored_heading" id="configuring-the-open-files-limit">Configuring the Open Files Limit</h3> <p>When using <code>systemd</code>, rather than setting the open files limit by setting the <code><a href="../mysqld_safe/index#mysqld_safe-options">open-files-limit</a></code> option for <code>mysqld_safe</code> or the <code><a href="../server-system-variables/index#open_files_limit">open_files_limit</a></code> system variable, the limit can be changed by configuring the <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#LimitCPU=">LimitNOFILE</a></code> option for the MariaDB <code>systemd</code> service.</p> <p>For example, you can reconfigure the MariaDB <code>systemd</code> service to have a larger limit for open files by executing the following commands:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/limitnofile.conf &lt;&lt;EOF
[Service]

LimitNOFILE=infinity
EOF
sudo systemctl daemon-reload
</pre>
<p>An important note is that setting <code>LimitNOFILE=infinity</code> doesn't actually set the open file limit to <em>infinite</em>.</p> <p>In <code>systemd</code> 234 and later, setting <code>LimitNOFILE=infinity</code> actually sets the open file limit to the value of the kernel's <code>fs.nr_open</code> parameter. Therefore, in these <code>systemd</code> versions, you may have to change this parameter's value.</p> <p>The value of the <code>fs.nr_open</code> parameter can be changed permanently by setting the value in <code><a href="https://linux.die.net/man/5/sysctl.conf">/etc/sysctl.conf</a></code> and restarting the server.</p> <p>The value of the <code>fs.nr_open</code> parameter can be changed temporarily by executing the <code><a href="https://linux.die.net/man/8/sysctl">sysctl</a></code> utility. For example:</p> <pre class="fixed" data-language="sql">sudo sysctl -w fs.nr_open=1048576‬
</pre>
<p>In <code>systemd</code> 233 and before, setting <code>LimitNOFILE=infinity</code> actually sets the open file limit to <code>65536</code>. See <a href="https://github.com/systemd/systemd/issues/6559">systemd issue #6559</a> for more information. Therefore, in these <code>systemd</code> versions, it is not generally recommended to set <code>LimitNOFILE=infinity</code>. Instead, it is generally better to set <code>LimitNOFILE</code> to a very large integer. For example:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/limitnofile.conf &lt;&lt;EOF
[Service]

LimitNOFILE=1048576
EOF
sudo systemctl daemon-reload
</pre>
<h3 class="anchored_heading" id="configuring-the-core-file-size">Configuring the Core File Size</h3> <p>When using <code>systemd</code>, if you would like to <a href="../enabling-core-dumps/index">enable core dumps</a>, rather than setting the core file size by setting the <code><a href="../mysqld_safe/index#mysqld_safe-options">core-file-size</a></code> option for <code>mysqld_safe</code>, the limit can be changed by configuring the <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#LimitCPU=">LimitCORE</a></code> option for the MariaDB <code>systemd</code> service. For example, you can reconfigure the MariaDB <code>systemd</code> service to have an infinite size for core files by executing the following commands:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/limitcore.conf &lt;&lt;EOF
[Service]

LimitCORE=infinity
EOF
sudo systemctl daemon-reload
</pre>
<h3 class="anchored_heading" id="configuring-mariadb-to-write-the-error-log-to-syslog">Configuring MariaDB to Write the Error Log to Syslog</h3> <p>When using <code>systemd</code>, if you would like to redirect the <a href="../error-log/index">error log</a> to the <a href="https://linux.die.net/man/8/rsyslogd">syslog</a>, then that can easily be done by doing the following:</p> <ul start="1">
<li>Ensure that <code><a href="../server-system-variables/index#log_error">log_error</a></code> system variable is <strong>not</strong> set. </li>
<li>Set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#StandardOutput=">StandardOutput=syslog</a></code>. </li>
<li>Set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#StandardError=">StandardError=syslog</a></code>. </li>
<li>Set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#SyslogFacility=">SyslogFacility=daemon</a></code>. </li>
<li>Set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#SyslogLevel=">SysLogLevel=err</a></code>. </li>
</ul> <p>For example:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/syslog.conf &lt;&lt;EOF
[Service]

StandardOutput=syslog
StandardError=syslog
SyslogFacility=daemon
SysLogLevel=err
EOF
sudo systemctl daemon-reload
</pre>
<p>If you have multiple instances of MariaDB, then you may also want to set <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#SyslogIdentifier=">SyslogIdentifier</a></code> with a different tag for each instance.</p> <h3 class="anchored_heading" id="configuring-access-to-home-directories">Configuring Access to Home Directories</h3> <p>MariaDB's <code><a href="index">systemd</a></code> unit file restricts access to <code>/home</code>, <code>/root</code>, and <code>/run/user</code> by default. This restriction can be removed by setting the <code><a href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectHome=">ProtectHome</a></code> option to <code>false</code> for the MariaDB <code>systemd</code> service. For example, you can reconfigure the MariaDB <code>systemd</code> service to allow access to <code>/home</code> by executing the following commands:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/dontprotecthome.conf &lt;&lt;EOF
[Service]

ProtectHome=false
EOF
sudo systemctl daemon-reload
</pre>
<h3 class="anchored_heading" id="configuring-the-umask">Configuring the umask</h3> <p>When using <code>systemd</code>, the default file permissions of <code>mysqld</code> can be set by setting the <code>UMASK</code> and <code>UMASK_DIR</code> environment variables for the <code>systemd</code> service. For example, you can configure the MariaDB <code>systemd</code> service's umask by executing the following commands:</p> <pre class="fixed" data-language="sql">sudo tee /etc/systemd/system/mariadb.service.d/umask.conf &lt;&lt;EOF
[Service]

Environment="UMASK=0750"
Environment="UMASK_DIR=0750"
EOF
sudo systemctl daemon-reload
</pre>
<div class="cstm-style greenbox">
<p>These environment variables do not set the umask. They set the default file system permissions. See <a href="https://jira.mariadb.org/browse/MDEV-23058">MDEV-23058</a> for more information.</p> </div>
<div class="cstm-style greenbox">
<p>Keep in mind that configuring the umask this way will only affect the permissions of files created by the <code>mysqld</code> process that is managed by <code>systemd</code>. The permissions of files created by components that are not managed by <code>systemd</code>, such as <code><a href="../mysql_install_db/index">mysql_install_db</a></code>, will not be effected.</p> </div>
<p>See <a href="../specifying-permissions-for-schema-data-directories-and-tables/index">Specifying Permissions for Schema (Data) Directories and Tables</a> for more information.</p> <h2 class="anchored_heading" id="systemd-journal">Systemd Journal</h2> <p><code>systemd</code> has its own logging system called the <code>systemd</code> journal. The <code>systemd</code> journal contains information about the service startup process. It is a good place to look when a failure has occurred.</p> <p>The MariaDB <code>systemd</code> service's journal can be queried by using the <code><a href="https://www.freedesktop.org/software/systemd/man/journalctl.html">journalctl</a></code> command. For example:</p> <pre class="fixed" data-language="sql">$ sudo journalctl -u mariadb
-- Logs begin at Fri 2019-01-25 13:49:04 EST, end at Fri 2019-01-25 18:07:02 EST. --
Jan 25 13:49:15 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Starting MariaDB 10.1.37 database server...
Jan 25 13:49:16 ip-172-30-0-249.us-west-2.compute.internal mysqld[2364]: 2019-01-25 13:49:16 140547528317120 [Note] /usr/sbin/mysqld (mysqld 10.1.37-MariaDB) starting as process 2364 ...
Jan 25 13:49:17 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Started MariaDB 10.1.37 database server.
Jan 25 18:06:42 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Stopping MariaDB 10.1.37 database server...
Jan 25 18:06:44 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Stopped MariaDB 10.1.37 database server.
Jan 25 18:06:57 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Starting MariaDB 10.1.37 database server...
Jan 25 18:08:32 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: mariadb.service start-pre operation timed out. Terminating.
Jan 25 18:08:32 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Failed to start MariaDB 10.1.37 database server.
Jan 25 18:08:32 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: Unit mariadb.service entered failed state.
Jan 25 18:08:32 ip-172-30-0-249.us-west-2.compute.internal systemd[1]: mariadb.service failed.
</pre>
<h2 class="anchored_heading" id="converting-mysqld_safe-options-to-systemd-options">Converting mysqld_safe Options to Systemd Options</h2> <p><code>mariadb-service-convert</code> is a script included in many MariaDB packages that is used by the package manager to convert <code><a href="../mysqld_safe/index#mysqld_safe-options">mysqld_safe</a></code> options to <code>systemd</code> options. It reads any explicit settings in the <code>[mysqld_safe]</code> <a href="../configuring-mariadb-with-option-files/index#option-groups">option group</a> from <a href="../configuring-mariadb-with-option-files/index">option files</a>, and its output is directed to <code>/etc/systemd/system/mariadb.service.d/migrated-from-my.cnf-settings.conf</code>. This helps to keep the configuration the same when upgrading from a version of MariaDB that does not use <code>systemd</code> to one that does.</p> <p>Implicitly high defaults of <code><a href="../mysqld_safe/index#mysqld_safe-options">open-files-limit</a></code> may be missed by the conversion script and require explicit configuration. See <a href="#configuring-the-open-files-limit">Configuring the Open Files Limit</a>.</p> <h2 class="anchored_heading" id="known-issues">Known Issues</h2> <h3 class="anchored_heading" id="memlock">Memlock</h3> <p>Prior to <a href="https://mariadb.com/kb/en/mariadb-10110-release-notes/">MariaDB 10.1.10</a>, the <a href="../mysqld-options/index#-memlock">--memlock</a> option could not be used with the MariaDB <code>systemd</code> service.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://mariadb.com/kb/en/systemd/" class="_attribution-link" target="_blank">https://mariadb.com/kb/en/systemd/</a>
  </p>
</div>
