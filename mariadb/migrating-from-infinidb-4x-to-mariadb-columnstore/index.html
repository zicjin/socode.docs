<h1>Migrating from InfiniDB 4.x to MariaDB ColumnStore</h1> <div> <div class="node creole"> <div class="answer formatted">  <h2 class="anchored_heading" id="overview">Overview</h2> <p>The columnar disk storage format is unchanged between InfiniDB 4.X and MariaDB ColumnStore allowing for relatively straightforward data migration utilizing backup and restore logic. This document outlines an approach to perform the migration that can be adapted to your particular needs.</p> <p>The examples in this document assume a root install with the packages installed in /usr/local. For non-root system, just substitute /usr/local with $HOME, which is the non-root user home directory.</p> <h2 class="anchored_heading" id="single-server-install">Single Server Install</h2> <h3 class="anchored_heading" id="backup-data-in-infinidb">Backup Data in InfiniDB</h3> <p>Suspend writes if this is a live system:</p> <pre data-language="sql">
# cc suspendDatabaseWrites y
</pre> <h5 class="anchored_heading" id="backup-front-end-schemas">Backup Front-End schemas</h5> <p>Use mysqldump to create schema files from appropriate databases:</p> <pre data-language="sql">
/usr/local/Calpont/mysql/bin/mysqldump --defaults-file=/usr/local/Calpont/mysql/my.cnf --skip-lock-tables --no-data loans &gt; loans_schema.sql
</pre> <p>Update schema file to utilize correct engine and add schema sync only comment:</p> <pre data-language="sql">
# sed "s/ENGINE=InfiniDB/ENGINE=columnstore COMMENT='schema sync only'/gI" loans_schema.sql &gt; loans_schema_columnstore.sql
</pre> <h5 class="anchored_heading" id="backup-back-end-data">Backup Back-End data</h5> <p>Take a backup of the columnar data files pm1 which are stored in the data&lt;N&gt; directories. The exact folder list can be confirmed by looking at the SystemConfig section of the configuration file /usr/local/Calpont/etc/Calpont.xml. Each data&lt;n&gt; directory corresponds to a specific DBRoot containing the actual columnar data in the 000.dir and system metadata under systemFiles/dbrm. In addition you may also want to take a copy of the data directory if this contains custom scripts for bulk loading:</p> <pre data-language="sql">
cp -r /usr/local/Calpont/data? .
</pre> <h3 class="anchored_heading" id="restoring-backup-into-columnstore">Restoring Backup into ColumnStore:</h3> <h5 class="anchored_heading" id="restore-front-end-schemas">Restore Front-End schemas</h5> <p>First install a new fresh install of ColumnStore then create the schema using the mysqldump file:</p> <pre data-language="sql">
# mcsmysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 5
Server version: 10.1.19-MariaDB Columnstore 1.0.5-1

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; create database loans;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]&gt; use loans
Database changed
MariaDB [loans]&gt; source loans_schema_columnstore.sql
Query OK, 0 rows affected (0.00 sec)

...

MariaDB [loans]&gt; exit
</pre> <h5 class="anchored_heading" id="restore-back-end-data">Restore Back-End data</h5> <p>Now replace the data&lt;N&gt; directories with the backup on pm1 as appropriate for each directory:</p> <pre data-language="sql">
# mcsadmin shutdownSystem y
# cd /usr/local/mariadb/columnstore/
# mv data1 data1.bkp
# mv /backupdir/data1 .
# cd data1/systemFiles/dbrm/
# mv BRM_saves_current BRM_saves_current.bkp
# cp ../../../data1.bkp/systemFiles/dbrm/BRM_saves_current .
# mcsadmin startSystem
</pre> <p>The system should start cleanly and the data should now be accessible in the database.</p> <h2 class="anchored_heading" id="multi-server-install-combined-umpm">Multi Server Install - Combined UM/PM</h2> <h3 class="anchored_heading" id="backup-data-in-infinidb">Backup Data in InfiniDB</h3> <p>Suspend writes if this is a live system, enter on pm1:</p> <pre data-language="sql">
# cc suspendDatabaseWrites y
</pre> <h5 class="anchored_heading" id="backup-front-end-schemas">Backup Front-End schemas</h5> <p>Use mysqldump to create schema files from appropriate databases from pm1</p> <pre data-language="sql">
/usr/local/Calpont/mysql/bin/mysqldump --defaults-file=/usr/local/Calpont/mysql/my.cnf --skip-lock-tables --no-data loans &gt; loans_schema.sql
</pre> <p>Update schema file to utilize correct engine and add schema sync only comment:</p> <pre data-language="sql">
# sed "s/ENGINE=InfiniDB/ENGINE=columnstore COMMENT='schema sync only'/gI" loans_schema.sql &gt; loans_schema_columnstore.sql
</pre> <h5 class="anchored_heading" id="backup-back-end-data">Backup Back-End data</h5> <p>Take a backup of the columnar data files from each PM which are stored in the data&lt;N&gt; directories of each PM server. The exact folder list can be confirmed by looking at the SystemConfig section of the configuration file /usr/local/Calpont/etc/Calpont.xml. Each data&lt;n&gt; directory corresponds to a specific DBRoot containing the actual columnar data in the 000.dir and system metadata under systemFiles/dbrm. In addition you may also want to take a copy of the data directory if this contains custom scripts for bulk loading:</p> <pre data-language="sql">
cp -r /usr/local/Calpont/data? .
</pre> <h3 class="anchored_heading" id="restoring-backup-into-columnstore">Restoring Backup into ColumnStore</h3> <h5 class="anchored_heading" id="restore-front-end-schemas">Restore Front-End schemas</h5> <p>First install a new fresh install of ColumnStore then create the schema using the mysqldump file:</p> <pre data-language="sql">
# mcsmysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 5
Server version: 10.1.19-MariaDB Columnstore 1.0.5-1

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; create database loans;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]&gt; use loans
Database changed
MariaDB [loans]&gt; source loans_schema_columnstore.sql
Query OK, 0 rows affected (0.00 sec)

...

MariaDB [loans]&gt; exit
</pre> <h5 class="anchored_heading" id="restore-back-end-data">Restore Back-end Data</h5> <p>Now replace the data&lt;N&gt; directories with the backup on each PM as appropriate for each directory:</p> <pre data-language="sql">
# mcsadmin shutdownSystem y
# cd /usr/local/mariadb/columnstore/
# mv data1 data1.bkp
# mv /backupdir/data1 .
# cd data1/systemFiles/dbrm/
# mv BRM_saves_current BRM_saves_current.bkp
# cp ../../../data1.bkp/systemFiles/dbrm/BRM_saves_current .
# mcsadmin startSystem
</pre> <p>The system should start cleanly and the data should now be accessible in the database.</p> <h2 class="anchored_heading" id="multi-server-install-separate-umpm">Multi Server Install - Separate UM/PM</h2> <h3 class="anchored_heading" id="backup-data-in-infinidb">Backup Data in InfiniDB</h3> <p>Suspend writes if this is a live system, enter on pm1:</p> <pre data-language="sql">
# cc suspendDatabaseWrites y
</pre> <h5 class="anchored_heading" id="backup-front-end-schemas">Backup Front-End schemas</h5> <p>On um1:</p> <p>Use mysqldump to create schema files from appropriate databases from pm1</p> <pre data-language="sql">
/usr/local/Calpont/mysql/bin/mysqldump --defaults-file=/usr/local/Calpont/mysql/my.cnf --skip-lock-tables --no-data loans &gt; loans_schema.sql
</pre> <p>Update schema file to utilize correct engine and add schema sync only comment:</p> <pre data-language="sql">
# sed "s/ENGINE=InfiniDB/ENGINE=columnstore COMMENT='schema sync only'/gI" loans_schema.sql &gt; loans_schema_columnstore.sql
</pre> <h5 class="anchored_heading" id="backup-back-end-data">Backup Back-End data</h5> <p>Take a backup of the columnar data files from each PM which are stored in the data&lt;N&gt; directories of each PM server. The exact folder list can be confirmed by looking at the SystemConfig section of the configuration file /usr/local/Calpont/etc/Calpont.xml. Each data&lt;n&gt; directory corresponds to a specific DBRoot containing the actual columnar data in the 000.dir and system metadata under systemFiles/dbrm. In addition you may also want to take a copy of the data directory if this contains custom scripts for bulk loading:</p> <pre data-language="sql">
cp -r /usr/local/Calpont/data? .
</pre> <h3 class="anchored_heading" id="restoring-backup-into-columnstore">Restoring Backup into ColumnStore</h3> <h5 class="anchored_heading" id="restore-front-end-schemas">Restore Front-End schemas</h5> <p>On um1:</p> <p>First install a new fresh install of ColumnStore then create the schema using the mysqldump file:</p> <pre data-language="sql">
# mcsmysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 5
Server version: 10.1.19-MariaDB Columnstore 1.0.5-1

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; create database loans;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]&gt; use loans
Database changed
MariaDB [loans]&gt; source loans_schema_columnstore.sql
Query OK, 0 rows affected (0.00 sec)

...

MariaDB [loans]&gt; exit
</pre> <h5 class="anchored_heading" id="restore-back-end-data">Restore Back-end Data</h5> <p>Now replace the data&lt;N&gt; directories with the backup on each PM as appropriate for each directory:</p> <pre data-language="sql">
# mcsadmin shutdownSystem y
# cd /usr/local/mariadb/columnstore/
# mv data1 data1.bkp
# mv /backupdir/data1 .
# cd data1/systemFiles/dbrm/
# mv BRM_saves_current BRM_saves_current.bkp
# cp ../../../data1.bkp/systemFiles/dbrm/BRM_saves_current .
# mcsadmin startSystem
</pre> <p>The system should start cleanly and the data should now be accessible in the database.</p> </div>     </div> <div id="content_disclaimer" class="graybox"> Content reproduced on this site is the property of its respective owners, and this content is not reviewed in advance by MariaDB. The views, information and opinions expressed by this content do not necessarily represent those of MariaDB or any other party. </div> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://mariadb.com/kb/en/migrating-from-infinidb-4x-to-mariadb-columnstore/" class="_attribution-link" target="_blank">https://mariadb.com/kb/en/migrating-from-infinidb-4x-to-mariadb-columnstore/</a>
  </p>
</div>
