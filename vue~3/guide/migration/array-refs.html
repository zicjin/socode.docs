 <div class="theme-default-content content__default">
<h1 id="frontmatter-title"> v-for Array Refs <div class="migration-badge-wrapper" data-v-cb310528><span class="migration-badge is-breaking" data-v-cb310528> breaking </span></div>
</h1> <p>In Vue 2, using the <code>ref</code> attribute inside <code>v-for</code> will populate the corresponding <code>$refs</code> property with an array of refs. This behavior becomes ambiguous and inefficient when there are nested <code>v-for</code>s present.</p> <p>In Vue 3, such usage will no longer automatically create an array in <code>$refs</code>. To retrieve multiple refs from a single binding, bind <code>ref</code> to a function which provides more flexibility (this is a new feature):</p> <div class="language-html line-numbers-mode">
<pre class="language-html" data-language="javascript">&lt;div v-for="item in list" :ref="setItemRef"&gt;&lt;/div&gt;</pre> </div>
<p>With Options API:</p> <div class="language-js line-numbers-mode">
<pre class="language-js" data-language="javascript">export default {
  data() {
    return {
      itemRefs: []
    }
  },
  methods: {
    setItemRef(el) {
      if (el) {
        this.itemRefs.push(el)
      }
    }
  },
  beforeUpdate() {
    this.itemRefs = []
  },
  updated() {
    console.log(this.itemRefs)
  }
}</pre> </div>
<p>With Composition API:</p> <div class="language-js line-numbers-mode">
<pre class="language-js" data-language="javascript">import { onBeforeUpdate, onUpdated } from 'vue'

export default {
  setup() {
    let itemRefs = []
    const setItemRef = el =&gt; {
      if (el) {
        itemRefs.push(el)
      }
    }
    onBeforeUpdate(() =&gt; {
      itemRefs = []
    })
    onUpdated(() =&gt; {
      console.log(itemRefs)
    })
    return {
      setItemRef
    }
  }
}</pre> </div>
<p>Note that:</p> <ul>
<li><p><code>itemRefs</code> doesn't have to be an array: it can also be an object where the refs are set by their iteration keys.</p></li> <li><p>This also allows <code>itemRefs</code> to be made reactive and watched, if needed.</p></li>
</ul> <h2 id="migration-strategy"> Migration Strategy</h2> <p><a href="migration-build#compat-configuration">Migration build flags:</a></p> <ul>
<li><code>V_FOR_REF</code></li> <li><code>COMPILER_V_FOR_REF</code></li>
</ul>
</div>   <div class="_attribution">
  <p class="_attribution-p">
    <a href="https://v3.vuejs.org/guide/migration/array-refs.html" class="_attribution-link" target="_blank">https://v3.vuejs.org/guide/migration/array-refs.html</a>
  </p>
</div>
