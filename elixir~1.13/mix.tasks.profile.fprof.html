<h1>   <span translate="no">mix profile.fprof</span>  </h1> <section id="moduledoc"> <p>Profiles the given file or expression using Erlang's <code class="inline">fprof</code> tool.</p>
<p><code class="inline">fprof</code> can be useful when you want to discover the bottlenecks of a sequential code.</p>
<p>Before running the code, it invokes the <code class="inline">app.start</code> task which compiles and loads your project. After that, the target expression is profiled, together with all processes which are spawned by it. Other processes (for example, those residing in the OTP application supervision tree) are not profiled.</p>
<p>To profile the code, you can use syntax similar to the <a href="mix.tasks.run"><code class="inline">mix run</code></a> task:</p>
<pre data-language="elixir">mix profile.fprof -e Hello.world
mix profile.fprof my_script.exs arg1 arg2 arg3</pre>
<p>This task is automatically reenabled, so you can profile multiple times in the same Mix invocation.</p>
<h2 id="module-command-line-options" class="section-heading">  Command line options </h2> <ul>
<li>
<code class="inline">--callers</code> - prints detailed information about immediate callers and called functions</li>
<li>
<code class="inline">--details</code> - includes profile data for each profiled process</li>
<li>
<code class="inline">--sort key</code> - sorts the output by given key: <code class="inline">acc</code> (default) or <code class="inline">own</code>
</li>
<li>
<code class="inline">--eval</code>, <code class="inline">-e</code> - evaluates the given code</li>
<li>
<code class="inline">--require</code>, <code class="inline">-r</code> - requires pattern before running the command</li>
<li>
<code class="inline">--parallel</code>, <code class="inline">-p</code> - makes all requires parallel</li>
<li>
<code class="inline">--no-compile</code> - does not compile even if files require compilation</li>
<li>
<code class="inline">--no-deps-check</code> - does not check dependencies</li>
<li>
<code class="inline">--no-archives-check</code> - does not check archives</li>
<li>
<code class="inline">--no-start</code> - does not start applications after compilation</li>
<li>
<code class="inline">--no-elixir-version-check</code> - does not check the Elixir version from mix.exs</li>
<li>
<code class="inline">--no-warmup</code> - does not execute code once before profiling</li>
</ul>
<h2 id="module-profile-output" class="section-heading">  Profile output </h2> <p>Example output:</p>
<pre data-language="elixir">#                                        CNT    ACC (ms)    OWN (ms)
Total                                 200279    1972.188    1964.579
:fprof.apply_start_stop/4                  0    1972.188       0.012
anonymous fn/0 in :elixir_compiler_2       1    1972.167       0.001
Test.run/0                                 1    1972.166       0.007
Test.do_something/1                        3    1972.131       0.040
Test.bottleneck/0                          1    1599.490       0.007
...</pre>
<p>The default output contains data gathered from all profiled processes. All times are wall clock milliseconds. The columns have the following meaning:</p>
<ul>
<li>CNT - total number of invocations of the given function</li>
<li>ACC - total time spent in the function</li>
<li>OWN - time spent in the function, excluding the time of called functions</li>
</ul>
<p>The first row (Total) is the sum of all functions executed in all profiled processes. For the given output, we had a total of 200279 function calls and spent about 2 seconds running the code.</p>
<p>More detailed information is returned if you provide the <code class="inline">--callers</code> and <code class="inline">--details</code> options.</p>
<p>When <code class="inline">--callers</code> option is specified, you'll see expanded function entries:</p>
<pre data-language="elixir">Mod.caller1/0                             3     200.000       0.017
Mod.caller2/0                             2     100.000       0.017
  Mod.some_function/0                     5     300.000       0.017  &lt;--
    Mod.called1/0                         4     250.000       0.010
    Mod.called2/0                         1      50.000       0.030</pre>
<p>Here, the arrow (<code class="inline">&lt;--</code>) indicates the <strong>marked</strong> function - the function described by this paragraph. You also see its immediate callers (above) and called functions (below).</p>
<p>All the values of caller functions describe the marked function. For example, the first row means that <code class="inline">Mod.caller1/0</code> invoked <code class="inline">Mod.some_function/0</code> 3 times. 200ms of the total time spent in <code class="inline">Mod.some_function/0</code> was spent processing calls from this particular caller.</p>
<p>In contrast, the values for the called functions describe those functions, but in the context of the marked function. For example, the last row means that <code class="inline">Mod.called2/0</code> was called once by <code class="inline">Mod.some_function/0</code>, and in that case the total time spent in the function was 50ms.</p>
<p>For a detailed explanation it's worth reading the analysis in <a href="https://erlang.org/doc/man/fprof.html#analysis">Erlang/OTP documentation for fprof</a>.</p>
<h2 id="module-caveats" class="section-heading">  Caveats </h2> <p>You should be aware that the code being profiled is running in an anonymous function which is invoked by <a href="https://erlang.org/doc/man/fprof.html"><code class="inline">:fprof</code> module</a>. Thus, you'll see some additional entries in your profile output, such as <code class="inline">:fprof</code> calls, an anonymous function with high ACC time, or an <code class="inline">:undefined</code> function which represents the outer caller (non-profiled code which started the profiler).</p>
<p>Also, keep in mind that profiling might significantly increase the running time of the profiled processes. This might skew your results if, for example, those processes perform some I/O operations, since running time of those operations will remain unchanged, while CPU bound operations of the profiled processes might take significantly longer. Thus, when profiling some intensive program, try to reduce such dependencies, or be aware of the resulting bias.</p>
<p>Finally, it's advised to profile your program with the <code class="inline">prod</code> environment, since this should provide more realistic insights into bottlenecks.</p> </section> <section id="summary" class="details-list"> <h1 class="section-heading">  Summary </h1> <h2> Functions </h2>
<dl class="summary-functions summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#profile/2" translate="no">profile(fun, opts \\ [])</a> </dt> <dd class="summary-synopsis"><p>Allows to programmatically run the <code class="inline">fprof</code> profiler on expression in <code class="inline">fun</code>.</p></dd> </div> </dl> </section> <section id="functions" class="details-list"> <h1 class="section-heading">  Functions </h1> <div class="functions-list"> <section class="detail">  <h3 class="detail-header" id="profile/2">profile(fun, opts \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.13.4/lib/mix/lib/mix/tasks/profile.fprof.ex#L176" class="source">Source</a>
</h3> <section class="docstring"> <p>Allows to programmatically run the <code class="inline">fprof</code> profiler on expression in <code class="inline">fun</code>.</p>
<h4 id="profile/2-options" class="section-heading">  Options </h4> <ul>
<li>
<code class="inline">:callers</code> - prints detailed information about immediate callers and called functions</li>
<li>
<code class="inline">:details</code> - includes profile data for each profiled process</li>
<li>
<code class="inline">:sort</code> - sorts the output by given key: <code class="inline">:acc</code> (default) or <code class="inline">:own</code>
</li>
</ul> </section> </section> </div> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://hexdocs.pm/mix/1.13.4/Mix.Tasks.Profile.Fprof.html" class="_attribution-link" target="_blank">https://hexdocs.pm/mix/1.13.4/Mix.Tasks.Profile.Fprof.html</a>
  </p>
</div>
