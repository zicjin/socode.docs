<h1>   <span translate="no">mix profile.eprof</span>  </h1> <section id="moduledoc"> <p>Profiles the given file or expression using Erlang's <code class="inline">eprof</code> tool.</p>
<p><code class="inline">:eprof</code> provides time information of each function call and can be useful when you want to discover the bottlenecks related to this.</p>
<p>Before running the code, it invokes the <code class="inline">app.start</code> task which compiles and loads your project. After that, the target expression is profiled together with all matching function calls using the Erlang trace BIFs. The tracing of the function calls for that is enabled when the profiling is begun, and disabled when profiling is stopped.</p>
<p>To profile the code, you can use syntax similar to the <a href="mix.tasks.run"><code class="inline">mix run</code></a> task:</p>
<pre data-language="elixir">mix profile.eprof -e Hello.world
mix profile.eprof -e "[1, 2, 3] |&gt; Enum.reverse |&gt; Enum.map(&amp;Integer.to_string/1)"
mix profile.eprof my_script.exs arg1 arg2 arg3</pre>
<p>This task is automatically reenabled, so you can profile multiple times in the same Mix invocation.</p>
<h2 id="module-command-line-options" class="section-heading">  Command line options </h2> <ul>
<li>
<code class="inline">--matching</code> - only profile calls matching the given <code class="inline">Module.function/arity</code> pattern</li>
<li>
<code class="inline">--calls</code> - filters out any results with a call count lower than this</li>
<li>
<code class="inline">--time</code> - filters out any results that took lower than specified (in µs)</li>
<li>
<code class="inline">--sort</code> - sorts the results by <code class="inline">time</code> or <code class="inline">calls</code> (default: <code class="inline">time</code>)</li>
<li>
<code class="inline">--eval</code>, <code class="inline">-e</code> - evaluates the given code</li>
<li>
<code class="inline">--require</code>, <code class="inline">-r</code> - requires pattern before running the command</li>
<li>
<code class="inline">--parallel</code>, <code class="inline">-p</code> - makes all requires parallel</li>
<li>
<code class="inline">--no-warmup</code> - skips the warmup step before profiling</li>
<li>
<code class="inline">--no-compile</code> - does not compile even if files require compilation</li>
<li>
<code class="inline">--no-deps-check</code> - does not check dependencies</li>
<li>
<code class="inline">--no-archives-check</code> - does not check archives</li>
<li>
<code class="inline">--no-halt</code> - does not halt the system after running the command</li>
<li>
<code class="inline">--no-start</code> - does not start applications after compilation</li>
<li>
<code class="inline">--no-elixir-version-check</code> - does not check the Elixir version from mix.exs</li>
</ul>
<h2 id="module-profile-output" class="section-heading">  Profile output </h2> <p>Example output:</p>
<pre data-language="elixir">#                                               CALLS     % TIME µS/CALL
Total                                              24 100.0   26    1.08
Enum.reduce_range_inc/4                             5  3.85    1    0.20
:erlang.make_fun/3                                  1  7.69    2    2.00
Enum.each/2                                         1  7.69    2    2.00
anonymous fn/0 in :elixir_compiler_0.__FILE__/1     1  7.69    2    2.00
:erlang.integer_to_binary/1                         5 15.39    4    0.80
:erlang.apply/2                                     1 15.39    4    4.00
anonymous fn/3 in Enum.each/2                       5 19.23    5    1.00
String.Chars.Integer.to_string/1                    5 23.08    6    1.20

Profile done over 8 matching functions</pre>
<p>The default output contains data gathered from all matching functions. The first row after the header contains the sums of the partial results and the average time for all the function calls listed. The following rows contain the function call, followed by the number of times that the function was called, then by the percentage of time that the call uses, then the total time for that function in microseconds, and, finally, the average time per call in microseconds.</p>
<p>When <code class="inline">--matching</code> option is specified, call count tracing will be started only for the functions matching the given pattern:</p>
<pre data-language="elixir">#                                               CALLS     % TIME µS/CALL
Total                                               5 100.0    6    1.20
String.Chars.Integer.to_string/1                    5 100.0    6    1.20

Profile done over 1 matching functions</pre>
<p>The pattern can be a module name, such as <a href="https://hexdocs.pm/elixir/1.13/String.html"><code class="inline">String</code></a> to count all calls to that module, a call without arity, such as <code class="inline">String.split</code>, to count all calls to that function regardless of arity, or a call with arity, such as <a href="https://hexdocs.pm/elixir/1.13/String.html#split/2"><code class="inline">String.split/2</code></a>, to count all calls to that exact module, function and arity.</p>
<h2 id="module-caveats" class="section-heading">  Caveats </h2> <p>You should be aware that the code being profiled is running in an anonymous function which is invoked by <a href="https://erlang.org/doc/man/eprof.html"><code class="inline">:eprof</code> module</a>. Thus, you'll see some additional entries in your profile output. It is also important to note that the profiler is stopped as soon as the code has finished running, and this may need special attention, when: running asynchronous code as function calls which were called before the profiler stopped will not be counted; running synchronous code as long running computations and a profiler without a proper MFA trace pattern or filter may lead to a result set which is difficult to comprehend.</p>
<p>You should expect a slowdown in your code execution using this tool since <code class="inline">:eprof</code> has some performance impact on the execution, but the impact is considerably lower than <a href="mix.tasks.profile.fprof"><code class="inline">Mix.Tasks.Profile.Fprof</code></a>. If you have a large system try to profile a limited scenario or focus on the main modules or processes. Another alternative is to use <a href="mix.tasks.profile.cprof"><code class="inline">Mix.Tasks.Profile.Cprof</code></a> that uses <code class="inline">:cprof</code> and has a low performance degradation effect.</p> </section> <section id="summary" class="details-list"> <h1 class="section-heading">  Summary </h1> <h2> Functions </h2>
<dl class="summary-functions summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#profile/2" translate="no">profile(fun, opts \\ [])</a> </dt> <dd class="summary-synopsis"><p>Allows to programmatically run the <code class="inline">eprof</code> profiler on expression in <code class="inline">fun</code>.</p></dd> </div> </dl> </section> <section id="functions" class="details-list"> <h1 class="section-heading">  Functions </h1> <div class="functions-list"> <section class="detail">  <h3 class="detail-header" id="profile/2">profile(fun, opts \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.13.4/lib/mix/lib/mix/tasks/profile.eprof.ex#L184" class="source">Source</a>
</h3> <section class="docstring"> <p>Allows to programmatically run the <code class="inline">eprof</code> profiler on expression in <code class="inline">fun</code>.</p>
<h4 id="profile/2-options" class="section-heading">  Options </h4> <ul>
<li>
<code class="inline">:matching</code> - only profile calls matching the given pattern in form of <code class="inline">{module, function, arity}</code>, where each element may be replaced by <code class="inline">:_</code> to allow any value</li>
<li>
<code class="inline">:calls</code> - filters out any results with a call count lower than this</li>
<li>
<code class="inline">:time</code> - filters out any results that took lower than specified (in µs)</li>
<li>
<code class="inline">:sort</code> - sort the results by <code class="inline">:time</code> or <code class="inline">:calls</code> (default: <code class="inline">:time</code>)</li>
</ul> </section> </section> </div> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://hexdocs.pm/mix/1.13.4/Mix.Tasks.Profile.Eprof.html" class="_attribution-link" target="_blank">https://hexdocs.pm/mix/1.13.4/Mix.Tasks.Profile.Eprof.html</a>
  </p>
</div>
