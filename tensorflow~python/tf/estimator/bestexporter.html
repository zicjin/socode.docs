<h1 class="devsite-page-title">tf.estimator.BestExporter</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.estimator.BestExporter"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="name"> <meta itemprop="property" content="__init__"> <meta itemprop="property" content="export"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/estimator/BestExporter">  TensorFlow 1 version</a> </td> <td> <a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/exporter.py">  View source on GitHub </a> </td>
</table>  <h2 id="class_bestexporter">Class <code translate="no" dir="ltr">BestExporter</code>
</h2> <p>This class exports the serving graph and checkpoints of the best models.</p> <p>Inherits From: <a href="exporter"><code translate="no" dir="ltr">Exporter</code></a></p>  <p>This class performs a model export everytime the new model is better than any existing model.</p> <h2 id="__init__"><code translate="no" dir="ltr">__init__</code></h2> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/exporter.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">__init__(
    name='best_exporter',
    serving_input_receiver_fn=None,
    event_file_pattern='eval/*.tfevents.*',
    compare_fn=_loss_smaller,
    assets_extra=None,
    as_text=False,
    exports_to_keep=5
)
</pre> <p>Create an <code translate="no" dir="ltr">Exporter</code> to use with <a href="evalspec"><code translate="no" dir="ltr">tf.estimator.EvalSpec</code></a>.</p> <p>Example of creating a BestExporter for training and evaluation:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">def make_train_and_eval_fn():
  # Set up feature columns.
  categorical_feature_a = (
      tf.feature_column.categorical_column_with_hash_bucket(...))
  categorical_feature_a_emb = embedding_column(
      categorical_column=categorical_feature_a, ...)
  ...  # other feature columns

  estimator = tf.estimator.DNNClassifier(
      config=tf.estimator.RunConfig(
          model_dir='/my_model', save_summary_steps=100),
      feature_columns=[categorical_feature_a_emb, ...],
      hidden_units=[1024, 512, 256])

  serving_feature_spec = tf.feature_column.make_parse_example_spec(
      categorical_feature_a_emb)
  serving_input_receiver_fn = (
      tf.estimator.export.build_parsing_serving_input_receiver_fn(
      serving_feature_spec))

  exporter = tf.estimator.BestExporter(
      name="best_exporter",
      serving_input_receiver_fn=serving_input_receiver_fn,
      exports_to_keep=5)

  train_spec = tf.estimator.TrainSpec(...)

  eval_spec = [tf.estimator.EvalSpec(
    input_fn=eval_input_fn,
    steps=100,
    exporters=exporter,
    start_delay_secs=0,
    throttle_secs=5)]

  tf.estimator.train_and_evaluate(estimator, train_spec, eval_spec)

</pre> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">name</code></b>: unique name of this <code translate="no" dir="ltr">Exporter</code> that is going to be used in the export path.</li> <li>
<b><code translate="no" dir="ltr">serving_input_receiver_fn</code></b>: a function that takes no arguments and returns a <code translate="no" dir="ltr">ServingInputReceiver</code>.</li> <li>
<b><code translate="no" dir="ltr">event_file_pattern</code></b>: event file name pattern relative to model_dir. If None, however, the exporter would not be preemption-safe. To be preemption-safe, event_file_pattern must be specified.</li> <li>
<b><code translate="no" dir="ltr">compare_fn</code></b>: a function that compares two evaluation results and returns true if current evaluation result is better. Follows the signature: <ul> <li>Args:</li> <li>
<code translate="no" dir="ltr">best_eval_result</code>: This is the evaluation result of the best model.</li> <li>
<code translate="no" dir="ltr">current_eval_result</code>: This is the evaluation result of current candidate model.</li> <li>Returns: True if current evaluation result is better; otherwise, False.</li> </ul>
</li> <li>
<b><code translate="no" dir="ltr">assets_extra</code></b>: An optional dict specifying how to populate the assets.extra directory within the exported SavedModel. Each key should give the destination path (including the filename) relative to the assets.extra directory. The corresponding value gives the full path of the source file to be copied. For example, the simple case of copying a single file without renaming it is specified as <code translate="no" dir="ltr">{'my_asset_file.txt': '/path/to/my_asset_file.txt'}</code>.</li> <li>
<b><code translate="no" dir="ltr">as_text</code></b>: whether to write the SavedModel proto in text format. Defaults to <code translate="no" dir="ltr">False</code>.</li> <li>
<b><code translate="no" dir="ltr">exports_to_keep</code></b>: Number of exports to keep. Older exports will be garbage-collected. Defaults to 5. Set to <code translate="no" dir="ltr">None</code> to disable garbage collection.</li> </ul> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: if any argument is invalid.</li> </ul> <h2 id="properties">Properties</h2> <h3 id="name"><code translate="no" dir="ltr">name</code></h3> <p>Directory name.</p> <p>A directory name under the export base directory where exports of this type are written. Should not be <code translate="no" dir="ltr">None</code> nor empty.</p> <h2 id="methods">Methods</h2> <h3 id="export"><code translate="no" dir="ltr">export</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/exporter.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">export(
    estimator,
    export_path,
    checkpoint_path,
    eval_result,
    is_the_final_export
)
</pre> <p>Exports the given <code translate="no" dir="ltr">Estimator</code> to a specific format.</p> <h4 id="args_2">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">estimator</code></b>: the <code translate="no" dir="ltr">Estimator</code> to export.</li> <li>
<b><code translate="no" dir="ltr">export_path</code></b>: A string containing a directory where to write the export.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_path</code></b>: The checkpoint path to export.</li> <li>
<b><code translate="no" dir="ltr">eval_result</code></b>: The output of <a href="../compat/v1/estimator/estimator#evaluate"><code translate="no" dir="ltr">Estimator.evaluate</code></a> on this checkpoint.</li> <li>
<b><code translate="no" dir="ltr">is_the_final_export</code></b>: This boolean is True when this is an export in the end of training. It is False for the intermediate exports during the training. When passing <code translate="no" dir="ltr">Exporter</code> to <a href="train_and_evaluate"><code translate="no" dir="ltr">tf.estimator.train_and_evaluate</code></a> <code translate="no" dir="ltr">is_the_final_export</code> is always False if <a href="trainspec#max_steps"><code translate="no" dir="ltr">TrainSpec.max_steps</code></a> is <code translate="no" dir="ltr">None</code>.</li> </ul> <h4 id="returns">Returns:</h4> <p>The string path to the exported directory or <code translate="no" dir="ltr">None</code> if export is skipped.</p> <h2 id="compat_aliases">Compat aliases</h2> <ul> <li><a href="bestexporter"><code translate="no" dir="ltr">tf.compat.v1.estimator.BestExporter</code></a></li> <li><a href="bestexporter"><code translate="no" dir="ltr">tf.compat.v2.estimator.BestExporter</code></a></li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/BestExporter" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/estimator/BestExporter</a>
  </p>
</div>
