<h1 class="devsite-page-title">tf.estimator.Head</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.estimator.Head"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="logits_dimension"> <meta itemprop="property" content="loss_reduction"> <meta itemprop="property" content="name"> <meta itemprop="property" content="create_estimator_spec"> <meta itemprop="property" content="loss"> <meta itemprop="property" content="metrics"> <meta itemprop="property" content="predictions"> <meta itemprop="property" content="update_metrics"> </div>   <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/estimator/Head">  TensorFlow 1 version</a> </td> <td> <a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/head/base_head.py">  View source on GitHub </a> </td>
</table>  <h2 id="class_head_2">Class <code translate="no" dir="ltr">Head</code>
</h2> <p>Interface for the head/top of a model.</p>  <p>Head sits on top of the model network and handles computing the outputs of the network. Given logits (or output of a hidden layer), a Head knows how to compute predictions, loss, train_op, metrics and export outputs. It is meant to:</p> <ol> <li>Simplify writing model_fn and to make model_fn more configurable for Estimator.</li> <li>Simpilfy creating loss and metrics for the train and test loop in Eager execution.</li> <li>Support wide range of machine learning models. Since most heads can work with logits, they can support DNN, RNN, Wide, Wide&amp;Deep, Global objectives, Gradient boosted trees and many other types of machine learning models.</li> </ol> <h4 id="common_usage_2">Common usage:</h4> <p>Here is simplified model_fn to build a DNN regression model.</p> <pre class="prettyprint" translate="no" dir="ltr" data-language="python">def _my_dnn_model_fn(features, labels, mode, params, config=None):
  # Optionally your callers can pass head to model_fn as a param.
  head = tf.estimator.RegressionHead(...)

  feature_columns = tf.feature_column.numeric_column(...)
  feature_layer = tf.keras.layers.DenseFeatures(feature_columns)
  inputs = feature_layer(features)

  # Compute logits with tf.keras.layers API
  hidden_layer0 = tf.keras.layers.Dense(
      units=1000, activation="relu")(inputs)
  hidden_layer1 = tf.keras.layers.Dense(
      units=500, activation="relu")(hidden_layer0)
  logits = tf.keras.layers.Dense(
      units=head.logits_dimension, activation=None)(hidden_layer1)

  # Or use Keras model for logits computation
  model = tf.keras.Sequential()
  model.add(tf.keras.layers.Dense(units=1000, activation="relu"))
  model.add(tf.keras.layers.Dense(units=500, activation="relu"))
  model.add(tf.keras.layers.Dense(
     units=head.logits_dimension, activation=None))
  logits = model(inputs)

  return head.create_estimator_spec(
      features=features,
      labels=labels,
      mode=mode,
      logits=logits,
      optimizer=optimizer)
</pre> <h2 id="properties_2">Properties</h2> <h3 id="logits_dimension"><code translate="no" dir="ltr">logits_dimension</code></h3> <p>Size of the last dimension of the logits <code translate="no" dir="ltr">Tensor</code>.</p> <p>Often is the number of classes, labels, or real values to be predicted. Typically, logits is of shape <code translate="no" dir="ltr">[batch_size, logits_dimension]</code>.</p> <h4 id="returns_9">Returns:</h4> <p>The expected size of the <code translate="no" dir="ltr">logits</code> tensor.</p> <h3 id="loss_reduction"><code translate="no" dir="ltr">loss_reduction</code></h3> <p>One of <a href="../keras/losses/reduction"><code translate="no" dir="ltr">tf.losses.Reduction</code></a>.</p> <p>Describes how to reduce training loss over batch, such as mean or sum.</p> <h4 id="returns_10">Returns:</h4> <p>The type of loss reduction used in the head.</p> <h3 id="name"><code translate="no" dir="ltr">name</code></h3> <p>The name of this head.</p> <h4 id="returns_11">Returns:</h4> <p>A string.</p> <h2 id="methods_2">Methods</h2> <h3 id="create_estimator_spec"><code translate="no" dir="ltr">create_estimator_spec</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/head/base_head.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">create_estimator_spec(
    features,
    mode,
    logits,
    labels=None,
    optimizer=None,
    trainable_variables=None,
    train_op_fn=None,
    update_ops=None,
    regularization_losses=None
)
</pre> <p>Returns <code translate="no" dir="ltr">EstimatorSpec</code> that a model_fn can return.</p> <p>It is recommended to pass all args via name.</p> <h4 id="args_6">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">features</code></b>: Input <code translate="no" dir="ltr">dict</code> mapping string feature names to <code translate="no" dir="ltr">Tensor</code> or <code translate="no" dir="ltr">SparseTensor</code> objects containing the values for that feature in a minibatch. Often to be used to fetch example-weight tensor.</li> <li>
<b><code translate="no" dir="ltr">mode</code></b>: Estimator's <code translate="no" dir="ltr">ModeKeys</code>.</li> <li>
<b><code translate="no" dir="ltr">logits</code></b>: Logits <code translate="no" dir="ltr">Tensor</code> to be used by the head.</li> <li>
<b><code translate="no" dir="ltr">labels</code></b>: Labels <code translate="no" dir="ltr">Tensor</code>, or <code translate="no" dir="ltr">dict</code> mapping string label names to <code translate="no" dir="ltr">Tensor</code> objects of the label values.</li> <li>
<b><code translate="no" dir="ltr">optimizer</code></b>: An <a href="../keras/optimizers/optimizer"><code translate="no" dir="ltr">tf.keras.optimizers.Optimizer</code></a> instance to optimize the loss in TRAIN mode. Namely, sets <code translate="no" dir="ltr">train_op = optimizer.get_updates(loss, trainable_variables)</code>, which updates variables to minimize <code translate="no" dir="ltr">loss</code>.</li> <li>
<b><code translate="no" dir="ltr">trainable_variables</code></b>: A list or tuple of <code translate="no" dir="ltr">Variable</code> objects to update to minimize <code translate="no" dir="ltr">loss</code>. In Tensorflow 1.x, by default these are the list of variables collected in the graph under the key <code translate="no" dir="ltr">GraphKeys.TRAINABLE_VARIABLES</code>. As Tensorflow 2.x doesn't have collections and GraphKeys, trainable_variables need to be passed explicitly here.</li> <li>
<b><code translate="no" dir="ltr">train_op_fn</code></b>: Function that takes a scalar loss <code translate="no" dir="ltr">Tensor</code> and returns an op to optimize the model with the loss in TRAIN mode. Used if <code translate="no" dir="ltr">optimizer</code> is <code translate="no" dir="ltr">None</code>. Exactly one of <code translate="no" dir="ltr">train_op_fn</code> and <code translate="no" dir="ltr">optimizer</code> must be set in TRAIN mode. By default, it is <code translate="no" dir="ltr">None</code> in other modes. If you want to optimize loss yourself, you can pass <code translate="no" dir="ltr">lambda _: tf.no_op()</code> and then use <a href="estimatorspec#loss"><code translate="no" dir="ltr">EstimatorSpec.loss</code></a> to compute and apply gradients.</li> <li>
<b><code translate="no" dir="ltr">update_ops</code></b>: A list or tuple of update ops to be run at training time. For example, layers such as BatchNormalization create mean and variance update ops that need to be run at training time. In Tensorflow 1.x, these are thrown into an UPDATE_OPS collection. As Tensorflow 2.x doesn't have collections, update_ops need to be passed explicitly here.</li> <li>
<b><code translate="no" dir="ltr">regularization_losses</code></b>: A list of additional scalar losses to be added to the training loss, such as regularization losses.</li> </ul> <h4 id="returns_12">Returns:</h4> <p><code translate="no" dir="ltr">EstimatorSpec</code>.</p> <h3 id="loss"><code translate="no" dir="ltr">loss</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/head/base_head.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">loss(
    labels,
    logits,
    features=None,
    mode=None,
    regularization_losses=None
)
</pre> <p>Returns a loss <code translate="no" dir="ltr">Tensor</code> from provided arguments.</p> <p>Note that, the args of <code translate="no" dir="ltr">features</code> and <code translate="no" dir="ltr">mode</code> are most likely not used, but some Head implementations may require them.</p> <h4 id="args_7">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">labels</code></b>: Labels <code translate="no" dir="ltr">Tensor</code>, or <code translate="no" dir="ltr">dict</code> mapping string label names to <code translate="no" dir="ltr">Tensor</code> objects of the label values.</li> <li>
<b><code translate="no" dir="ltr">logits</code></b>: Logits <code translate="no" dir="ltr">Tensor</code> to be used for loss construction.</li> <li>
<b><code translate="no" dir="ltr">features</code></b>: Input <code translate="no" dir="ltr">dict</code> mapping string feature names to <code translate="no" dir="ltr">Tensor</code> or <code translate="no" dir="ltr">SparseTensor</code> objects containing the values for that feature in a minibatch. Often to be used to fetch example-weight tensor.</li> <li>
<b><code translate="no" dir="ltr">mode</code></b>: Estimator's <code translate="no" dir="ltr">ModeKeys</code>. To be used in case loss calculation is different in Train and Eval mode.</li> <li>
<b><code translate="no" dir="ltr">regularization_losses</code></b>: A list of additional scalar losses to be added to the training loss, such as regularization losses.</li> </ul> <h4 id="returns_13">Returns:</h4> <p>A scalar <code translate="no" dir="ltr">Tensor</code> representing regularized training loss used in train and eval.</p> <h3 id="metrics"><code translate="no" dir="ltr">metrics</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/head/base_head.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">metrics(regularization_losses=None)
</pre> <p>Returns a <code translate="no" dir="ltr">dict</code> of metric objects.</p> <h4 id="args_8">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">regularization_losses</code></b>: A list of additional scalar losses to be added to the training loss, such as regularization losses.</li> </ul> <h4 id="returns_14">Returns:</h4> <p>A <code translate="no" dir="ltr">dict</code> of metrics keyed by string name. The value is an instance of <code translate="no" dir="ltr">Metric</code> class.</p> <h3 id="predictions"><code translate="no" dir="ltr">predictions</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/head/base_head.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">predictions(
    logits,
    keys=None
)
</pre> <p>Returns a <code translate="no" dir="ltr">dict</code> of predictions from provided logits.</p> <h4 id="args_9">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">logits</code></b>: Logits <code translate="no" dir="ltr">Tensor</code> to be used for prediction construction.</li> <li>
<b><code translate="no" dir="ltr">keys</code></b>: A list of <code translate="no" dir="ltr">string</code> for prediction keys. Defaults to <code translate="no" dir="ltr">None</code>, meaning if not specified, predictions will be created for all the pre-defined valid keys in the head.</li> </ul> <h4 id="returns_15">Returns:</h4> <p>A <code translate="no" dir="ltr">dict</code> of predicted <code translate="no" dir="ltr">Tensor</code> keyed by prediction name.</p> <h3 id="update_metrics"><code translate="no" dir="ltr">update_metrics</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/head/base_head.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">update_metrics(
    eval_metrics,
    features,
    logits,
    labels,
    mode=None,
    regularization_losses=None
)
</pre> <p>Updates metric objects and returns a <code translate="no" dir="ltr">dict</code> of the updated metrics.</p> <h4 id="args_10">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">eval_metrics</code></b>: A <code translate="no" dir="ltr">dict</code> of metrics to be updated.</li> <li>
<b><code translate="no" dir="ltr">features</code></b>: Input <code translate="no" dir="ltr">dict</code> mapping string feature names to <code translate="no" dir="ltr">Tensor</code> or <code translate="no" dir="ltr">SparseTensor</code> objects containing the values for that feature in a minibatch. Often to be used to fetch example-weight tensor.</li> <li>
<b><code translate="no" dir="ltr">logits</code></b>: logits <code translate="no" dir="ltr">Tensor</code> to be used for metrics update.</li> <li>
<b><code translate="no" dir="ltr">labels</code></b>: Labels <code translate="no" dir="ltr">Tensor</code>, or <code translate="no" dir="ltr">dict</code> mapping string label names to <code translate="no" dir="ltr">Tensor</code> objects of the label values.</li> <li>
<b><code translate="no" dir="ltr">mode</code></b>: Estimator's <code translate="no" dir="ltr">ModeKeys</code>.</li> <li>
<b><code translate="no" dir="ltr">regularization_losses</code></b>: A list of additional scalar losses to be added to the training and evaluation loss, such as regularization losses.</li> </ul> <h4 id="returns_16">Returns:</h4> <p>A <code translate="no" dir="ltr">dict</code> of updated metrics keyed by name. The value is an instance of <code translate="no" dir="ltr">Metric</code> class.</p> <h2 id="compat_aliases_2">Compat aliases</h2> <ul> <li><a href="head"><code translate="no" dir="ltr">tf.compat.v1.estimator.Head</code></a></li> <li><a href="head"><code translate="no" dir="ltr">tf.compat.v2.estimator.Head</code></a></li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/Head" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/estimator/Head</a>
  </p>
</div>
