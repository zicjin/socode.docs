<h1 class="devsite-page-title">tf.estimator.EstimatorSpec</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.estimator.EstimatorSpec"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="mode"> <meta itemprop="property" content="predictions"> <meta itemprop="property" content="loss"> <meta itemprop="property" content="train_op"> <meta itemprop="property" content="eval_metric_ops"> <meta itemprop="property" content="export_outputs"> <meta itemprop="property" content="training_chief_hooks"> <meta itemprop="property" content="training_hooks"> <meta itemprop="property" content="scaffold"> <meta itemprop="property" content="evaluation_hooks"> <meta itemprop="property" content="prediction_hooks"> <meta itemprop="property" content="__new__"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/estimator/EstimatorSpec">  TensorFlow 1 version</a> </td> <td> <a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/model_fn.py">  View source on GitHub </a> </td>
</table>  <h2 id="class_estimatorspec">Class <code translate="no" dir="ltr">EstimatorSpec</code>
</h2> <p>Ops and objects returned from a <code translate="no" dir="ltr">model_fn</code> and passed to an <code translate="no" dir="ltr">Estimator</code>.</p> <h3 id="used_in_the_guide">Used in the guide:</h3> <ul> <li><a href="https://www.tensorflow.org/guide/migrate">Migrate your TensorFlow 1 code to TensorFlow 2</a></li> <li><a href="https://www.tensorflow.org/guide/checkpoint">Training checkpoints</a></li> </ul> <h3 id="used_in_the_tutorials">Used in the tutorials:</h3> <ul> <li><a href="https://www.tensorflow.org/tutorials/distribute/multi_worker_with_estimator">Multi-worker training with Estimator</a></li> </ul> <p><code translate="no" dir="ltr">EstimatorSpec</code> fully defines the model to be run by an <code translate="no" dir="ltr">Estimator</code>.</p> <h2 id="__new__"><code translate="no" dir="ltr">__new__</code></h2> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/model_fn.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">@staticmethod
__new__(
    cls,
    mode,
    predictions=None,
    loss=None,
    train_op=None,
    eval_metric_ops=None,
    export_outputs=None,
    training_chief_hooks=None,
    training_hooks=None,
    scaffold=None,
    evaluation_hooks=None,
    prediction_hooks=None
)
</pre> <p>Creates a validated <code translate="no" dir="ltr">EstimatorSpec</code> instance.</p> <p>Depending on the value of <code translate="no" dir="ltr">mode</code>, different arguments are required. Namely</p> <ul> <li>For <code translate="no" dir="ltr">mode == ModeKeys.TRAIN</code>: required fields are <code translate="no" dir="ltr">loss</code> and <code translate="no" dir="ltr">train_op</code>.</li> <li>For <code translate="no" dir="ltr">mode == ModeKeys.EVAL</code>: required field is <code translate="no" dir="ltr">loss</code>.</li> <li>For <code translate="no" dir="ltr">mode == ModeKeys.PREDICT</code>: required fields are <code translate="no" dir="ltr">predictions</code>.</li> </ul> <p>model_fn can populate all arguments independent of mode. In this case, some arguments will be ignored by an <code translate="no" dir="ltr">Estimator</code>. E.g. <code translate="no" dir="ltr">train_op</code> will be ignored in eval and infer modes. Example:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">def my_model_fn(features, labels, mode):
  predictions = ...
  loss = ...
  train_op = ...
  return tf.estimator.EstimatorSpec(
      mode=mode,
      predictions=predictions,
      loss=loss,
      train_op=train_op)
</pre> <p>Alternatively, model_fn can just populate the arguments appropriate to the given mode. Example:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">def my_model_fn(features, labels, mode):
  if (mode == tf.estimator.ModeKeys.TRAIN or
      mode == tf.estimator.ModeKeys.EVAL):
    loss = ...
  else:
    loss = None
  if mode == tf.estimator.ModeKeys.TRAIN:
    train_op = ...
  else:
    train_op = None
  if mode == tf.estimator.ModeKeys.PREDICT:
    predictions = ...
  else:
    predictions = None

  return tf.estimator.EstimatorSpec(
      mode=mode,
      predictions=predictions,
      loss=loss,
      train_op=train_op)
</pre> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">mode</code></b>: A <code translate="no" dir="ltr">ModeKeys</code>. Specifies if this is training, evaluation or prediction.</li> <li>
<b><code translate="no" dir="ltr">predictions</code></b>: Predictions <code translate="no" dir="ltr">Tensor</code> or dict of <code translate="no" dir="ltr">Tensor</code>.</li> <li>
<b><code translate="no" dir="ltr">loss</code></b>: Training loss <code translate="no" dir="ltr">Tensor</code>. Must be either scalar, or with shape <code translate="no" dir="ltr">[1]</code>.</li> <li>
<b><code translate="no" dir="ltr">train_op</code></b>: Op for the training step.</li> <li>
<b><code translate="no" dir="ltr">eval_metric_ops</code></b>: Dict of metric results keyed by name. The values of the dict can be one of the following: (1) instance of <code translate="no" dir="ltr">Metric</code> class. (2) Results of calling a metric function, namely a <code translate="no" dir="ltr">(metric_tensor, update_op)</code> tuple. <code translate="no" dir="ltr">metric_tensor</code> should be evaluated without any impact on state (typically is a pure computation results based on variables.). For example, it should not trigger the <code translate="no" dir="ltr">update_op</code> or requires any input fetching.</li> <li>
<b><code translate="no" dir="ltr">export_outputs</code></b>: Describes the output signatures to be exported to <code translate="no" dir="ltr">SavedModel</code> and used during serving. A dict <code translate="no" dir="ltr">{name: output}</code> where: <ul> <li>name: An arbitrary name for this output.</li> <li>output: an <code translate="no" dir="ltr">ExportOutput</code> object such as <code translate="no" dir="ltr">ClassificationOutput</code>, <code translate="no" dir="ltr">RegressionOutput</code>, or <code translate="no" dir="ltr">PredictOutput</code>. Single-headed models only need to specify one entry in this dictionary. Multi-headed models should specify one entry for each head, one of which must be named using <code translate="no" dir="ltr">tf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY</code>. If no entry is provided, a default <code translate="no" dir="ltr">PredictOutput</code> mapping to <code translate="no" dir="ltr">predictions</code> will be created.</li> </ul>
</li> <li>
<b><code translate="no" dir="ltr">training_chief_hooks</code></b>: Iterable of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> objects to run on the chief worker during training.</li> <li>
<b><code translate="no" dir="ltr">training_hooks</code></b>: Iterable of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> objects to run on all workers during training.</li> <li>
<b><code translate="no" dir="ltr">scaffold</code></b>: A <code translate="no" dir="ltr">tf.train.Scaffold</code> object that can be used to set initialization, saver, and more to be used in training.</li> <li>
<b><code translate="no" dir="ltr">evaluation_hooks</code></b>: Iterable of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> objects to run during evaluation.</li> <li>
<b><code translate="no" dir="ltr">prediction_hooks</code></b>: Iterable of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> objects to run during predictions.</li> </ul> <h4 id="returns">Returns:</h4> <p>A validated <code translate="no" dir="ltr">EstimatorSpec</code> object.</p> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If validation fails.</li> <li>
<b><code translate="no" dir="ltr">TypeError</code></b>: If any of the arguments is not the expected type.</li> </ul> <h2 id="properties">Properties</h2> <h3 id="mode"><code translate="no" dir="ltr">mode</code></h3> <h3 id="predictions"><code translate="no" dir="ltr">predictions</code></h3> <h3 id="loss"><code translate="no" dir="ltr">loss</code></h3> <h3 id="train_op"><code translate="no" dir="ltr">train_op</code></h3> <h3 id="eval_metric_ops"><code translate="no" dir="ltr">eval_metric_ops</code></h3> <h3 id="export_outputs"><code translate="no" dir="ltr">export_outputs</code></h3> <h3 id="training_chief_hooks"><code translate="no" dir="ltr">training_chief_hooks</code></h3> <h3 id="training_hooks"><code translate="no" dir="ltr">training_hooks</code></h3> <h3 id="scaffold"><code translate="no" dir="ltr">scaffold</code></h3> <h3 id="evaluation_hooks"><code translate="no" dir="ltr">evaluation_hooks</code></h3> <h3 id="prediction_hooks"><code translate="no" dir="ltr">prediction_hooks</code></h3> <h2 id="compat_aliases">Compat aliases</h2> <ul> <li><a href="estimatorspec"><code translate="no" dir="ltr">tf.compat.v1.estimator.EstimatorSpec</code></a></li> <li><a href="estimatorspec"><code translate="no" dir="ltr">tf.compat.v2.estimator.EstimatorSpec</code></a></li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/EstimatorSpec" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/estimator/EstimatorSpec</a>
  </p>
</div>
