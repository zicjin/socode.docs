<h1 class="devsite-page-title">tf.compat.v1.data.Iterator</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.compat.v1.data.Iterator"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="element_spec"> <meta itemprop="property" content="initializer"> <meta itemprop="property" content="output_classes"> <meta itemprop="property" content="output_shapes"> <meta itemprop="property" content="output_types"> <meta itemprop="property" content="__init__"> <meta itemprop="property" content="from_string_handle"> <meta itemprop="property" content="from_structure"> <meta itemprop="property" content="get_next"> <meta itemprop="property" content="make_initializer"> <meta itemprop="property" content="string_handle"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L75-L503">  View source on GitHub </a> </td>
</table>  <h2 id="class_iterator">Class <code translate="no" dir="ltr">Iterator</code>
</h2> <p>Represents the state of iterating through a <code translate="no" dir="ltr">Dataset</code>.</p>  <h2 id="__init__"><code translate="no" dir="ltr">__init__</code></h2> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L78-L116">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">__init__(
    iterator_resource,
    initializer,
    output_types,
    output_shapes,
    output_classes
)
</pre> <p>Creates a new iterator from the given iterator resource.</p> <blockquote class="note">
<strong>Note:</strong><span> Most users will not call this initializer directly, and will instead use <code translate="no" dir="ltr">Dataset.make_initializable_iterator()</code> or <code translate="no" dir="ltr">Dataset.make_one_shot_iterator()</code>.</span>
</blockquote> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">iterator_resource</code></b>: A <a href="../../../../tf#resource"><code translate="no" dir="ltr">tf.resource</code></a> scalar <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> representing the iterator.</li> <li>
<b><code translate="no" dir="ltr">initializer</code></b>: A <a href="../../../operation"><code translate="no" dir="ltr">tf.Operation</code></a> that should be run to initialize this iterator.</li> <li>
<b><code translate="no" dir="ltr">output_types</code></b>: A nested structure of <a href="../../../dtypes/dtype"><code translate="no" dir="ltr">tf.DType</code></a> objects corresponding to each component of an element of this iterator.</li> <li>
<b><code translate="no" dir="ltr">output_shapes</code></b>: A nested structure of <a href="../../../tensorshape"><code translate="no" dir="ltr">tf.TensorShape</code></a> objects corresponding to each component of an element of this iterator.</li> <li>
<b><code translate="no" dir="ltr">output_classes</code></b>: A nested structure of Python <code translate="no" dir="ltr">type</code> objects corresponding to each component of an element of this iterator.</li> </ul> <h2 id="properties">Properties</h2> <h3 id="element_spec"><code translate="no" dir="ltr">element_spec</code></h3> <p>The type specification of an element of this iterator.</p> <h4 id="returns">Returns:</h4> <p>A nested structure of <a href="../../../typespec"><code translate="no" dir="ltr">tf.TypeSpec</code></a> objects matching the structure of an element of this iterator and specifying the type of individual components.</p> <h3 id="initializer"><code translate="no" dir="ltr">initializer</code></h3> <p>A <a href="../../../operation"><code translate="no" dir="ltr">tf.Operation</code></a> that should be run to initialize this iterator.</p> <h4 id="returns_2">Returns:</h4> <p>A <a href="../../../operation"><code translate="no" dir="ltr">tf.Operation</code></a> that should be run to initialize this iterator</p> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If this iterator initializes itself automatically.</li> </ul> <h3 id="output_classes"><code translate="no" dir="ltr">output_classes</code></h3> <p>Returns the class of each component of an element of this iterator. (deprecated)</p> <aside class="warning"><strong>Warning:</strong><span> THIS FUNCTION IS DEPRECATED. It will be removed in a future version. Instructions for updating: Use <a href="get_output_classes"><code translate="no" dir="ltr">tf.compat.v1.data.get_output_classes(iterator)</code></a>.</span></aside> <p>The expected values are <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> and <a href="../../../sparse/sparsetensor"><code translate="no" dir="ltr">tf.SparseTensor</code></a>.</p> <h4 id="returns_3">Returns:</h4> <p>A nested structure of Python <code translate="no" dir="ltr">type</code> objects corresponding to each component of an element of this dataset.</p> <h3 id="output_shapes"><code translate="no" dir="ltr">output_shapes</code></h3> <p>Returns the shape of each component of an element of this iterator. (deprecated)</p> <aside class="warning"><strong>Warning:</strong><span> THIS FUNCTION IS DEPRECATED. It will be removed in a future version. Instructions for updating: Use <a href="get_output_shapes"><code translate="no" dir="ltr">tf.compat.v1.data.get_output_shapes(iterator)</code></a>.</span></aside> <h4 id="returns_4">Returns:</h4> <p>A nested structure of <a href="../../../tensorshape"><code translate="no" dir="ltr">tf.TensorShape</code></a> objects corresponding to each component of an element of this dataset.</p> <h3 id="output_types"><code translate="no" dir="ltr">output_types</code></h3> <p>Returns the type of each component of an element of this iterator. (deprecated)</p> <aside class="warning"><strong>Warning:</strong><span> THIS FUNCTION IS DEPRECATED. It will be removed in a future version. Instructions for updating: Use <a href="get_output_types"><code translate="no" dir="ltr">tf.compat.v1.data.get_output_types(iterator)</code></a>.</span></aside> <h4 id="returns_5">Returns:</h4> <p>A nested structure of <a href="../../../dtypes/dtype"><code translate="no" dir="ltr">tf.DType</code></a> objects corresponding to each component of an element of this dataset.</p> <h2 id="methods">Methods</h2> <h3 id="from_string_handle"><code translate="no" dir="ltr">from_string_handle</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L222-L298">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">@staticmethod
from_string_handle(
    string_handle,
    output_types,
    output_shapes=None,
    output_classes=None
)
</pre> <p>Creates a new, uninitialized <code translate="no" dir="ltr">Iterator</code> based on the given handle.</p> <p>This method allows you to define a "feedable" iterator where you can choose between concrete iterators by feeding a value in a <code translate="no" dir="ltr">tf.Session.run</code> call. In that case, <code translate="no" dir="ltr">string_handle</code> would be a <a href="../placeholder"><code translate="no" dir="ltr">tf.compat.v1.placeholder</code></a>, and you would feed it with the value of <code translate="no" dir="ltr">tf.data.Iterator.string_handle</code> in each step.</p> <p>For example, if you had two iterators that marked the current position in a training dataset and a test dataset, you could choose which to use in each step as follows:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">train_iterator = tf.data.Dataset(...).make_one_shot_iterator()
train_iterator_handle = sess.run(train_iterator.string_handle())

test_iterator = tf.data.Dataset(...).make_one_shot_iterator()
test_iterator_handle = sess.run(test_iterator.string_handle())

handle = tf.compat.v1.placeholder(tf.string, shape=[])
iterator = tf.data.Iterator.from_string_handle(
    handle, train_iterator.output_types)

next_element = iterator.get_next()
loss = f(next_element)

train_loss = sess.run(loss, feed_dict={handle: train_iterator_handle})
test_loss = sess.run(loss, feed_dict={handle: test_iterator_handle})
</pre> <h4 id="args_2">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">string_handle</code></b>: A scalar <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> of type <a href="../../../../tf#string"><code translate="no" dir="ltr">tf.string</code></a> that evaluates to a handle produced by the <code translate="no" dir="ltr">Iterator.string_handle()</code> method.</li> <li>
<b><code translate="no" dir="ltr">output_types</code></b>: A nested structure of <a href="../../../dtypes/dtype"><code translate="no" dir="ltr">tf.DType</code></a> objects corresponding to each component of an element of this dataset.</li> <li>
<b><code translate="no" dir="ltr">output_shapes</code></b>: (Optional.) A nested structure of <a href="../../../tensorshape"><code translate="no" dir="ltr">tf.TensorShape</code></a> objects corresponding to each component of an element of this dataset. If omitted, each component will have an unconstrainted shape.</li> <li>
<b><code translate="no" dir="ltr">output_classes</code></b>: (Optional.) A nested structure of Python <code translate="no" dir="ltr">type</code> objects corresponding to each component of an element of this iterator. If omitted, each component is assumed to be of type <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a>.</li> </ul> <h4 id="returns_6">Returns:</h4> <p>An <code translate="no" dir="ltr">Iterator</code>.</p> <h3 id="from_structure"><code translate="no" dir="ltr">from_structure</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L118-L220">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">@staticmethod
from_structure(
    output_types,
    output_shapes=None,
    shared_name=None,
    output_classes=None
)
</pre> <p>Creates a new, uninitialized <code translate="no" dir="ltr">Iterator</code> with the given structure.</p> <p>This iterator-constructing method can be used to create an iterator that is reusable with many different datasets.</p> <p>The returned iterator is not bound to a particular dataset, and it has no <code translate="no" dir="ltr">initializer</code>. To initialize the iterator, run the operation returned by <code translate="no" dir="ltr">Iterator.make_initializer(dataset)</code>.</p> <p>The following is an example</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">iterator = Iterator.from_structure(tf.int64, tf.TensorShape([]))

dataset_range = Dataset.range(10)
range_initializer = iterator.make_initializer(dataset_range)

dataset_evens = dataset_range.filter(lambda x: x % 2 == 0)
evens_initializer = iterator.make_initializer(dataset_evens)

# Define a model based on the iterator; in this example, the model_fn
# is expected to take scalar tf.int64 Tensors as input (see
# the definition of 'iterator' above).
prediction, loss = model_fn(iterator.get_next())

# Train for `num_epochs`, where for each epoch, we first iterate over
# dataset_range, and then iterate over dataset_evens.
for _ in range(num_epochs):
  # Initialize the iterator to `dataset_range`
  sess.run(range_initializer)
  while True:
    try:
      pred, loss_val = sess.run([prediction, loss])
    except tf.errors.OutOfRangeError:
      break

  # Initialize the iterator to `dataset_evens`
  sess.run(evens_initializer)
  while True:
    try:
      pred, loss_val = sess.run([prediction, loss])
    except tf.errors.OutOfRangeError:
      break
</pre> <h4 id="args_3">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">output_types</code></b>: A nested structure of <a href="../../../dtypes/dtype"><code translate="no" dir="ltr">tf.DType</code></a> objects corresponding to each component of an element of this dataset.</li> <li>
<b><code translate="no" dir="ltr">output_shapes</code></b>: (Optional.) A nested structure of <a href="../../../tensorshape"><code translate="no" dir="ltr">tf.TensorShape</code></a> objects corresponding to each component of an element of this dataset. If omitted, each component will have an unconstrainted shape.</li> <li>
<b><code translate="no" dir="ltr">shared_name</code></b>: (Optional.) If non-empty, this iterator will be shared under the given name across multiple sessions that share the same devices (e.g. when using a remote server).</li> <li>
<b><code translate="no" dir="ltr">output_classes</code></b>: (Optional.) A nested structure of Python <code translate="no" dir="ltr">type</code> objects corresponding to each component of an element of this iterator. If omitted, each component is assumed to be of type <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a>.</li> </ul> <h4 id="returns_7">Returns:</h4> <p>An <code translate="no" dir="ltr">Iterator</code>.</p> <h4 id="raises_2">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">TypeError</code></b>: If the structures of <code translate="no" dir="ltr">output_shapes</code> and <code translate="no" dir="ltr">output_types</code> are not the same.</li> </ul> <h3 id="get_next"><code translate="no" dir="ltr">get_next</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L373-L427">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">get_next(name=None)
</pre> <p>Returns a nested structure of <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a>s representing the next element.</p> <p>In graph mode, you should typically call this method <em>once</em> and use its result as the input to another computation. A typical loop will then call <code translate="no" dir="ltr">tf.Session.run</code> on the result of that computation. The loop will terminate when the <code translate="no" dir="ltr">Iterator.get_next()</code> operation raises <a href="../../../errors/outofrangeerror"><code translate="no" dir="ltr">tf.errors.OutOfRangeError</code></a>. The following skeleton shows how to use this method when building a training loop:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">dataset = ...  # A `tf.data.Dataset` object.
iterator = dataset.make_initializable_iterator()
next_element = iterator.get_next()

# Build a TensorFlow graph that does something with each element.
loss = model_function(next_element)
optimizer = ...  # A `tf.compat.v1.train.Optimizer` object.
train_op = optimizer.minimize(loss)

with tf.compat.v1.Session() as sess:
  try:
    while True:
      sess.run(train_op)
  except tf.errors.OutOfRangeError:
    pass
</pre> <p>NOTE: It is legitimate to call <code translate="no" dir="ltr">Iterator.get_next()</code> multiple times, e.g. when you are distributing different elements to multiple devices in a single step. However, a common pitfall arises when users call <code translate="no" dir="ltr">Iterator.get_next()</code> in each iteration of their training loop. <code translate="no" dir="ltr">Iterator.get_next()</code> adds ops to the graph, and executing each op allocates resources (including threads); as a consequence, invoking it in every iteration of a training loop causes slowdown and eventual resource exhaustion. To guard against this outcome, we log a warning when the number of uses crosses a fixed threshold of suspiciousness.</p> <h4 id="args_4">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">name</code></b>: (Optional.) A name for the created operation.</li> </ul> <h4 id="returns_8">Returns:</h4> <p>A nested structure of <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> objects.</p> <h3 id="make_initializer"><code translate="no" dir="ltr">make_initializer</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L317-L371">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">make_initializer(
    dataset,
    name=None
)
</pre> <p>Returns a <a href="../../../operation"><code translate="no" dir="ltr">tf.Operation</code></a> that initializes this iterator on <code translate="no" dir="ltr">dataset</code>.</p> <h4 id="args_5">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">dataset</code></b>: A <code translate="no" dir="ltr">Dataset</code> with compatible structure to this iterator.</li> <li>
<b><code translate="no" dir="ltr">name</code></b>: (Optional.) A name for the created operation.</li> </ul> <h4 id="returns_9">Returns:</h4> <p>A <a href="../../../operation"><code translate="no" dir="ltr">tf.Operation</code></a> that can be run to initialize this iterator on the given <code translate="no" dir="ltr">dataset</code>.</p> <h4 id="raises_3">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">TypeError</code></b>: If <code translate="no" dir="ltr">dataset</code> and this iterator do not have a compatible element structure.</li> </ul> <h3 id="string_handle"><code translate="no" dir="ltr">string_handle</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/data/ops/iterator_ops.py#L429-L442">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">string_handle(name=None)
</pre> <p>Returns a string-valued <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> that represents this iterator.</p> <h4 id="args_6">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">name</code></b>: (Optional.) A name for the created operation.</li> </ul> <h4 id="returns_10">Returns:</h4> <p>A scalar <a href="../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> of type <a href="../../../../tf#string"><code translate="no" dir="ltr">tf.string</code></a>.</p>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/data/Iterator" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/compat/v1/data/Iterator</a>
  </p>
</div>
