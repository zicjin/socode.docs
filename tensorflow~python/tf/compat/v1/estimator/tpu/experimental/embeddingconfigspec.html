<h1 class="devsite-page-title">tf.compat.v1.estimator.tpu.experimental.EmbeddingConfigSpec</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.compat.v1.estimator.tpu.experimental.EmbeddingConfigSpec"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="feature_columns"> <meta itemprop="property" content="optimization_parameters"> <meta itemprop="property" content="clipping_limit"> <meta itemprop="property" content="pipeline_execution_with_tensor_core"> <meta itemprop="property" content="experimental_gradient_multiplier_fn"> <meta itemprop="property" content="feature_to_config_dict"> <meta itemprop="property" content="table_to_config_dict"> <meta itemprop="property" content="partition_strategy"> <meta itemprop="property" content="__new__"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/tpu/_tpu_estimator_embedding.py">  View source on GitHub </a> </td>
</table>  <h2 id="class_embeddingconfigspec">Class <code translate="no" dir="ltr">EmbeddingConfigSpec</code>
</h2> <p>Class to keep track of the specification for TPU embeddings.</p>  <p>Pass this class to <code translate="no" dir="ltr">tf.estimator.tpu.TPUEstimator</code> via the <code translate="no" dir="ltr">embedding_config_spec</code> parameter. At minimum you need to specify <code translate="no" dir="ltr">feature_columns</code> and <code translate="no" dir="ltr">optimization_parameters</code>. The feature columns passed should be created with some combination of <code translate="no" dir="ltr">tf.tpu.experimental.embedding_column</code> and <code translate="no" dir="ltr">tf.tpu.experimental.shared_embedding_columns</code>.</p> <p>TPU embeddings do not support arbitrary Tensorflow optimizers and the main optimizer you use for your model will be ignored for the embedding table variables. Instead TPU embeddigns support a fixed set of predefined optimizers that you can select from and set the parameters of. These include adagrad, adam and stochastic gradient descent. Each supported optimizer has a <code translate="no" dir="ltr">Parameters</code> class in the <a href="../../../../../tpu/experimental"><code translate="no" dir="ltr">tf.tpu.experimental</code></a> namespace.</p> <pre class="prettyprint" translate="no" dir="ltr" data-language="python">column_a = tf.feature_column.categorical_column_with_identity(...)
column_b = tf.feature_column.categorical_column_with_identity(...)
column_c = tf.feature_column.categorical_column_with_identity(...)
tpu_shared_columns = tf.tpu.experimental.shared_embedding_columns(
    [column_a, column_b], 10)
tpu_non_shared_column = tf.tpu.experimental.embedding_column(
    column_c, 10)
tpu_columns = [tpu_non_shared_column] + tpu_shared_columns
...
def model_fn(features):
  dense_features = tf.keras.layers.DenseFeature(tpu_columns)
  embedded_feature = dense_features(features)
  ...

estimator = tf.estimator.tpu.TPUEstimator(
    model_fn=model_fn,
    ...
    embedding_config_spec=tf.estimator.tpu.experimental.EmbeddingConfigSpec(
        column=tpu_columns,
        optimization_parameters=(
            tf.estimator.tpu.experimental.AdagradParameters(0.1))))

&lt;h2 id="__new__"&gt;&lt;code&gt;__new__&lt;/code&gt;&lt;/h2&gt;

&lt;a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/tpu/_tpu_estimator_embedding.py"&gt;View source&lt;/a&gt;

``` python
@staticmethod
__new__(
    cls,
    feature_columns=None,
    optimization_parameters=None,
    clipping_limit=None,
    pipeline_execution_with_tensor_core=False,
    experimental_gradient_multiplier_fn=None,
    feature_to_config_dict=None,
    table_to_config_dict=None,
    partition_strategy='div'
)
</pre> <p>Creates an <code translate="no" dir="ltr">EmbeddingConfigSpec</code> instance.</p> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">feature_columns</code></b>: All embedding <code translate="no" dir="ltr">FeatureColumn</code>s used by model.</li> <li>
<b><code translate="no" dir="ltr">optimization_parameters</code></b>: An instance of <code translate="no" dir="ltr">AdagradParameters</code>, <code translate="no" dir="ltr">AdamParameters</code> or <code translate="no" dir="ltr">StochasticGradientDescentParameters</code>. This optimizer will be applied to all embedding variables specified by <code translate="no" dir="ltr">feature_columns</code>.</li> <li>
<b><code translate="no" dir="ltr">clipping_limit</code></b>: (Optional) Clipping limit (absolute value).</li> <li>
<b><code translate="no" dir="ltr">pipeline_execution_with_tensor_core</code></b>: setting this to <code translate="no" dir="ltr">True</code> makes training faster, but trained model will be different if step N and step N+1 involve the same set of embedding IDs. Please see <code translate="no" dir="ltr">tpu_embedding_configuration.proto</code> for details.</li> <li>
<b><code translate="no" dir="ltr">experimental_gradient_multiplier_fn</code></b>: (Optional) A Fn taking global step as input returning the current multiplier for all embedding gradients.</li> <li>
<b><code translate="no" dir="ltr">feature_to_config_dict</code></b>: A dictionary mapping features names to instances of the class <code translate="no" dir="ltr">FeatureConfig</code>. Either features_columns or the pair of <code translate="no" dir="ltr">feature_to_config_dict</code> and <code translate="no" dir="ltr">table_to_config_dict</code> must be specified.</li> <li>
<b><code translate="no" dir="ltr">table_to_config_dict</code></b>: A dictionary mapping features names to instances of the class <code translate="no" dir="ltr">TableConfig</code>. Either features_columns or the pair of <code translate="no" dir="ltr">feature_to_config_dict</code> and <code translate="no" dir="ltr">table_to_config_dict</code> must be specified.</li> <li>
<b><code translate="no" dir="ltr">partition_strategy</code></b>: A string, determining how tensors are sharded to the tpu hosts. See <a href="../../../../../nn/safe_embedding_lookup_sparse"><code translate="no" dir="ltr">tf.nn.safe_embedding_lookup_sparse</code></a> for more details. Allowed value are <code translate="no" dir="ltr">"div"</code> and <code translate="no" dir="ltr">"mod"'. If</code>"mod"` is used, evaluation and exporting the model to CPU will not work as expected.</li> </ul> <h4 id="returns">Returns:</h4> <p>An <code translate="no" dir="ltr">EmbeddingConfigSpec</code> instance.</p> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If the feature_columns are not specified.</li> <li>
<b><code translate="no" dir="ltr">TypeError</code></b>: If the feature columns are not of ths correct type (one of _SUPPORTED_FEATURE_COLUMNS, _TPU_EMBEDDING_COLUMN_CLASSES OR _EMBEDDING_COLUMN_CLASSES).</li> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If <code translate="no" dir="ltr">optimization_parameters</code> is not one of the required types.</li> </ul> <h2 id="properties">Properties</h2> <h3 id="feature_columns"><code translate="no" dir="ltr">feature_columns</code></h3> <h3 id="optimization_parameters"><code translate="no" dir="ltr">optimization_parameters</code></h3> <h3 id="clipping_limit"><code translate="no" dir="ltr">clipping_limit</code></h3> <h3 id="pipeline_execution_with_tensor_core"><code translate="no" dir="ltr">pipeline_execution_with_tensor_core</code></h3> <h3 id="experimental_gradient_multiplier_fn"><code translate="no" dir="ltr">experimental_gradient_multiplier_fn</code></h3> <h3 id="feature_to_config_dict"><code translate="no" dir="ltr">feature_to_config_dict</code></h3> <h3 id="table_to_config_dict"><code translate="no" dir="ltr">table_to_config_dict</code></h3> <h3 id="partition_strategy"><code translate="no" dir="ltr">partition_strategy</code></h3>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/estimator/tpu/experimental/EmbeddingConfigSpec" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/compat/v1/estimator/tpu/experimental/EmbeddingConfigSpec</a>
  </p>
</div>
