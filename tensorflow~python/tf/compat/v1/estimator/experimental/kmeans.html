<h1 class="devsite-page-title">tf.compat.v1.estimator.experimental.KMeans</h1>    <devsite-mathjax config="TeX-AMS-MML_SVG"></devsite-mathjax>  <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.compat.v1.estimator.experimental.KMeans"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="config"> <meta itemprop="property" content="model_dir"> <meta itemprop="property" content="model_fn"> <meta itemprop="property" content="params"> <meta itemprop="property" content="__init__"> <meta itemprop="property" content="cluster_centers"> <meta itemprop="property" content="eval_dir"> <meta itemprop="property" content="evaluate"> <meta itemprop="property" content="experimental_export_all_saved_models"> <meta itemprop="property" content="export_saved_model"> <meta itemprop="property" content="export_savedmodel"> <meta itemprop="property" content="get_variable_names"> <meta itemprop="property" content="get_variable_value"> <meta itemprop="property" content="latest_checkpoint"> <meta itemprop="property" content="predict"> <meta itemprop="property" content="predict_cluster_index"> <meta itemprop="property" content="score"> <meta itemprop="property" content="train"> <meta itemprop="property" content="transform"> <meta itemprop="property" content="ALL_DISTANCES"> <meta itemprop="property" content="CLUSTER_CENTERS_VAR_NAME"> <meta itemprop="property" content="CLUSTER_INDEX"> <meta itemprop="property" content="COSINE_DISTANCE"> <meta itemprop="property" content="KMEANS_PLUS_PLUS_INIT"> <meta itemprop="property" content="RANDOM_INIT"> <meta itemprop="property" content="SCORE"> <meta itemprop="property" content="SQUARED_EUCLIDEAN_DISTANCE"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/kmeans.py">  View source on GitHub </a> </td>
</table>  <h2 id="class_kmeans">Class <code translate="no" dir="ltr">KMeans</code>
</h2> <p>An Estimator for K-Means clustering.</p> <p>Inherits From: <a href="../estimator"><code translate="no" dir="ltr">Estimator</code></a></p>  <h4 id="example">Example:</h4> <pre class="prettyprint" translate="no" dir="ltr" data-language="python">import numpy as np
import tensorflow as tf

num_points = 100
dimensions = 2
points = np.random.uniform(0, 1000, [num_points, dimensions])

def input_fn():
  return tf.train.limit_epochs(
      tf.convert_to_tensor(points, dtype=tf.float32), num_epochs=1)

num_clusters = 5
kmeans = tf.estimator.experimental.KMeans(
    num_clusters=num_clusters, use_mini_batch=False)

# train
num_iterations = 10
previous_centers = None
for _ in xrange(num_iterations):
  kmeans.train(input_fn)
  cluster_centers = kmeans.cluster_centers()
  if previous_centers is not None:
    print 'delta:', cluster_centers - previous_centers
  previous_centers = cluster_centers
  print 'score:', kmeans.score(input_fn)
print 'cluster centers:', cluster_centers

# map the input points to their clusters
cluster_indices = list(kmeans.predict_cluster_index(input_fn))
for i, point in enumerate(points):
  cluster_index = cluster_indices[i]
  center = cluster_centers[cluster_index]
  print 'point:', point, 'is in cluster', cluster_index, 'centered at', center
</pre> <p>The <code translate="no" dir="ltr">SavedModel</code> saved by the <code translate="no" dir="ltr">export_saved_model</code> method does not include the cluster centers. However, the cluster centers may be retrieved by the latest checkpoint saved during training. Specifically,</p> <pre class="prettyprint" translate="no" dir="ltr" data-language="python">kmeans.cluster_centers()
</pre> <p>is equivalent to</p> <pre class="prettyprint" translate="no" dir="ltr" data-language="python">tf.train.load_variable(
    kmeans.model_dir, KMeansClustering.CLUSTER_CENTERS_VAR_NAME)
</pre> <h2 id="__init__"><code translate="no" dir="ltr">__init__</code></h2> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/kmeans.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">__init__(
    num_clusters,
    model_dir=None,
    initial_clusters=RANDOM_INIT,
    distance_metric=SQUARED_EUCLIDEAN_DISTANCE,
    seed=None,
    use_mini_batch=True,
    mini_batch_steps_per_iteration=1,
    kmeans_plus_plus_num_retries=2,
    relative_tolerance=None,
    config=None,
    feature_columns=None
)
</pre> <p>Creates an Estimator for running KMeans training and inference.</p> <p>This Estimator implements the following variants of the K-means algorithm:</p> <p>If <code translate="no" dir="ltr">use_mini_batch</code> is False, it runs standard full batch K-means. Each training step runs a single iteration of K-Means and must process the full input at once. To run in this mode, the <code translate="no" dir="ltr">input_fn</code> passed to <code translate="no" dir="ltr">train</code> must return the entire input dataset.</p> <p>If <code translate="no" dir="ltr">use_mini_batch</code> is True, it runs a generalization of the mini-batch K-means algorithm. It runs multiple iterations, where each iteration is composed of <code translate="no" dir="ltr">mini_batch_steps_per_iteration</code> steps. Each training step accumulates the contribution from one mini-batch into temporary storage. Every <code translate="no" dir="ltr">mini_batch_steps_per_iteration</code> steps, the cluster centers are updated and the temporary storage cleared for the next iteration. For example: the entire dataset contains 64k examples, where the batch size is 64. User can choose mini_batch_steps_per_iteration = 100 to run 10% of the entire data every iteration in order to update the cluster centers. Note that: * If <code translate="no" dir="ltr">mini_batch_steps_per_iteration=1</code>, the algorithm reduces to the standard K-means mini-batch algorithm. * If <code translate="no" dir="ltr">mini_batch_steps_per_iteration = num_inputs / batch_size</code>, the algorithm becomes an asynchronous version of the full-batch algorithm. However, there is no guarantee by this implementation that each input is seen exactly once per iteration. Also, different updates are applied asynchronously without locking. So this asynchronous version may not behave exactly like a full-batch version.</p> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">num_clusters</code></b>: An integer tensor specifying the number of clusters. This argument is ignored if <code translate="no" dir="ltr">initial_clusters</code> is a tensor or numpy array.</li> <li>
<b><code translate="no" dir="ltr">model_dir</code></b>: The directory to save the model results and log files.</li> <li>
<b><code translate="no" dir="ltr">initial_clusters</code></b>: Specifies how the initial cluster centers are chosen. One of the following: * a tensor or numpy array with the initial cluster centers. * a callable <code translate="no" dir="ltr">f(inputs, k)</code> that selects and returns up to <code translate="no" dir="ltr">k</code> centers from an input batch. <code translate="no" dir="ltr">f</code> is free to return any number of centers from <code translate="no" dir="ltr">0</code> to <code translate="no" dir="ltr">k</code>. It will be invoked on successive input batches as necessary until all <code translate="no" dir="ltr">num_clusters</code> centers are chosen. <ul> <li>
<code translate="no" dir="ltr">KMeansClustering.RANDOM_INIT</code>: Choose centers randomly from an input batch. If the batch size is less than <code translate="no" dir="ltr">num_clusters</code> then the entire batch is chosen to be initial cluster centers and the remaining centers are chosen from successive input batches.</li> <li>
<code translate="no" dir="ltr">KMeansClustering.KMEANS_PLUS_PLUS_INIT</code>: Use kmeans++ to choose centers from the first input batch. If the batch size is less than <code translate="no" dir="ltr">num_clusters</code>, a TensorFlow runtime error occurs.</li> </ul>
</li> <li>
<b><code translate="no" dir="ltr">distance_metric</code></b>: The distance metric used for clustering. One of: <ul> <li>
<code translate="no" dir="ltr">KMeansClustering.SQUARED_EUCLIDEAN_DISTANCE</code>: Euclidean distance between vectors <code translate="no" dir="ltr">u</code> and <code translate="no" dir="ltr">v</code> is defined as \(||u - v||_2\) which is the square root of the sum of the absolute squares of the elements' difference.</li> <li>
<code translate="no" dir="ltr">KMeansClustering.COSINE_DISTANCE</code>: Cosine distance between vectors <code translate="no" dir="ltr">u</code> and <code translate="no" dir="ltr">v</code> is defined as \(1 - (u . v) / (||u||_2 ||v||_2)\).</li> </ul>
</li> <li>
<b><code translate="no" dir="ltr">seed</code></b>: Python integer. Seed for PRNG used to initialize centers.</li> <li>
<b><code translate="no" dir="ltr">use_mini_batch</code></b>: A boolean specifying whether to use the mini-batch k-means algorithm. See explanation above.</li> <li>
<b><code translate="no" dir="ltr">mini_batch_steps_per_iteration</code></b>: The number of steps after which the updated cluster centers are synced back to a master copy. Used only if <code translate="no" dir="ltr">use_mini_batch=True</code>. See explanation above.</li> <li>
<b><code translate="no" dir="ltr">kmeans_plus_plus_num_retries</code></b>: For each point that is sampled during kmeans++ initialization, this parameter specifies the number of additional points to draw from the current distribution before selecting the best. If a negative value is specified, a heuristic is used to sample <code translate="no" dir="ltr">O(log(num_to_sample))</code> additional points. Used only if <code translate="no" dir="ltr">initial_clusters=KMeansClustering.KMEANS_PLUS_PLUS_INIT</code>.</li> <li>
<b><code translate="no" dir="ltr">relative_tolerance</code></b>: A relative tolerance of change in the loss between iterations. Stops learning if the loss changes less than this amount. This may not work correctly if <code translate="no" dir="ltr">use_mini_batch=True</code>.</li> <li>
<b><code translate="no" dir="ltr">config</code></b>: See <a href="../../../../estimator/estimator"><code translate="no" dir="ltr">tf.estimator.Estimator</code></a>.</li> <li>
<b><code translate="no" dir="ltr">feature_columns</code></b>: An optionable iterable containing all the feature columns used by the model. All items in the set should be feature column instances that can be passed to <code translate="no" dir="ltr">tf.feature_column.input_layer</code>. If this is None, all features will be used.</li> </ul> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: An invalid argument was passed to <code translate="no" dir="ltr">initial_clusters</code> or <code translate="no" dir="ltr">distance_metric</code>.</li> </ul> <h2 id="properties">Properties</h2> <h3 id="config"><code translate="no" dir="ltr">config</code></h3> <h3 id="model_dir"><code translate="no" dir="ltr">model_dir</code></h3> <h3 id="model_fn"><code translate="no" dir="ltr">model_fn</code></h3> <p>Returns the <code translate="no" dir="ltr">model_fn</code> which is bound to <code translate="no" dir="ltr">self.params</code>.</p> <h4 id="returns">Returns:</h4> <p>The <code translate="no" dir="ltr">model_fn</code> with following signature: <code translate="no" dir="ltr">def model_fn(features, labels, mode, config)</code></p> <h3 id="params"><code translate="no" dir="ltr">params</code></h3> <h2 id="methods">Methods</h2> <h3 id="cluster_centers"><code translate="no" dir="ltr">cluster_centers</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/kmeans.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">cluster_centers()
</pre> <p>Returns the cluster centers.</p> <h3 id="eval_dir"><code translate="no" dir="ltr">eval_dir</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">eval_dir(name=None)
</pre> <p>Shows the directory name where evaluation metrics are dumped.</p> <h4 id="args_2">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">name</code></b>: Name of the evaluation if user needs to run multiple evaluations on different data sets, such as on training data vs test data. Metrics for different evaluations are saved in separate folders, and appear separately in tensorboard.</li> </ul> <h4 id="returns_2">Returns:</h4> <p>A string which is the path of directory contains evaluation metrics.</p> <h3 id="evaluate"><code translate="no" dir="ltr">evaluate</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">evaluate(
    input_fn,
    steps=None,
    hooks=None,
    checkpoint_path=None,
    name=None
)
</pre> <p>Evaluates the model given evaluation data <code translate="no" dir="ltr">input_fn</code>.</p> <p>For each step, calls <code translate="no" dir="ltr">input_fn</code>, which returns one batch of data. Evaluates until:</p> <ul> <li>
<code translate="no" dir="ltr">steps</code> batches are processed, or</li> <li>
<code translate="no" dir="ltr">input_fn</code> raises an end-of-input exception (<a href="../../../../errors/outofrangeerror"><code translate="no" dir="ltr">tf.errors.OutOfRangeError</code></a> or <code translate="no" dir="ltr">StopIteration</code>).</li> </ul> <h4 id="args_3">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">input_fn</code></b>: A function that constructs the input data for evaluation. See <a href="https://tensorflow.org/guide/premade_estimators#create_input_functions">Premade Estimators</a> for more information. The function should construct and return one of the following: * A <a href="../../../../data/dataset"><code translate="no" dir="ltr">tf.data.Dataset</code></a> object: Outputs of <code translate="no" dir="ltr">Dataset</code> object must be a tuple <code translate="no" dir="ltr">(features, labels)</code> with same constraints as below. * A tuple <code translate="no" dir="ltr">(features, labels)</code>: Where <code translate="no" dir="ltr">features</code> is a <a href="../../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> or a dictionary of string feature name to <code translate="no" dir="ltr">Tensor</code> and <code translate="no" dir="ltr">labels</code> is a <code translate="no" dir="ltr">Tensor</code> or a dictionary of string label name to <code translate="no" dir="ltr">Tensor</code>. Both <code translate="no" dir="ltr">features</code> and <code translate="no" dir="ltr">labels</code> are consumed by <code translate="no" dir="ltr">model_fn</code>. They should satisfy the expectation of <code translate="no" dir="ltr">model_fn</code> from inputs.</li> <li>
<b><code translate="no" dir="ltr">steps</code></b>: Number of steps for which to evaluate model. If <code translate="no" dir="ltr">None</code>, evaluates until <code translate="no" dir="ltr">input_fn</code> raises an end-of-input exception.</li> <li>
<b><code translate="no" dir="ltr">hooks</code></b>: List of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> subclass instances. Used for callbacks inside the evaluation call.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_path</code></b>: Path of a specific checkpoint to evaluate. If <code translate="no" dir="ltr">None</code>, the latest checkpoint in <code translate="no" dir="ltr">model_dir</code> is used. If there are no checkpoints in <code translate="no" dir="ltr">model_dir</code>, evaluation is run with newly initialized <code translate="no" dir="ltr">Variables</code> instead of ones restored from checkpoint.</li> <li>
<b><code translate="no" dir="ltr">name</code></b>: Name of the evaluation if user needs to run multiple evaluations on different data sets, such as on training data vs test data. Metrics for different evaluations are saved in separate folders, and appear separately in tensorboard.</li> </ul> <h4 id="returns_3">Returns:</h4> <p>A dict containing the evaluation metrics specified in <code translate="no" dir="ltr">model_fn</code> keyed by name, as well as an entry <code translate="no" dir="ltr">global_step</code> which contains the value of the global step for which this evaluation was performed. For canned estimators, the dict contains the <code translate="no" dir="ltr">loss</code> (mean loss per mini-batch) and the <code translate="no" dir="ltr">average_loss</code> (mean loss per sample). Canned classifiers also return the <code translate="no" dir="ltr">accuracy</code>. Canned regressors also return the <code translate="no" dir="ltr">label/mean</code> and the <code translate="no" dir="ltr">prediction/mean</code>.</p> <h4 id="raises_2">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If <code translate="no" dir="ltr">steps &lt;= 0</code>.</li> </ul> <h3 id="experimental_export_all_saved_models"><code translate="no" dir="ltr">experimental_export_all_saved_models</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">experimental_export_all_saved_models(
    export_dir_base,
    input_receiver_fn_map,
    assets_extra=None,
    as_text=False,
    checkpoint_path=None
)
</pre> <p>Exports a <code translate="no" dir="ltr">SavedModel</code> with <code translate="no" dir="ltr">tf.MetaGraphDefs</code> for each requested mode.</p> <p>For each mode passed in via the <code translate="no" dir="ltr">input_receiver_fn_map</code>, this method builds a new graph by calling the <code translate="no" dir="ltr">input_receiver_fn</code> to obtain feature and label <code translate="no" dir="ltr">Tensor</code>s. Next, this method calls the <code translate="no" dir="ltr">Estimator</code>'s <code translate="no" dir="ltr">model_fn</code> in the passed mode to generate the model graph based on those features and labels, and restores the given checkpoint (or, lacking that, the most recent checkpoint) into the graph. Only one of the modes is used for saving variables to the <code translate="no" dir="ltr">SavedModel</code> (order of preference: <a href="../../../../estimator/modekeys#TRAIN"><code translate="no" dir="ltr">tf.estimator.ModeKeys.TRAIN</code></a>, <a href="../../../../estimator/modekeys#EVAL"><code translate="no" dir="ltr">tf.estimator.ModeKeys.EVAL</code></a>, then <a href="../../../../estimator/modekeys#PREDICT"><code translate="no" dir="ltr">tf.estimator.ModeKeys.PREDICT</code></a>), such that up to three <code translate="no" dir="ltr">tf.MetaGraphDefs</code> are saved with a single set of variables in a single <code translate="no" dir="ltr">SavedModel</code> directory.</p> <p>For the variables and <code translate="no" dir="ltr">tf.MetaGraphDefs</code>, a timestamped export directory below <code translate="no" dir="ltr">export_dir_base</code>, and writes a <code translate="no" dir="ltr">SavedModel</code> into it containing the <code translate="no" dir="ltr">tf.MetaGraphDef</code> for the given mode and its associated signatures.</p> <p>For prediction, the exported <code translate="no" dir="ltr">MetaGraphDef</code> will provide one <code translate="no" dir="ltr">SignatureDef</code> for each element of the <code translate="no" dir="ltr">export_outputs</code> dict returned from the <code translate="no" dir="ltr">model_fn</code>, named using the same keys. One of these keys is always <code translate="no" dir="ltr">tf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY</code>, indicating which signature will be served when a serving request does not specify one. For each signature, the outputs are provided by the corresponding <a href="../../../../estimator/export/exportoutput"><code translate="no" dir="ltr">tf.estimator.export.ExportOutput</code></a>s, and the inputs are always the input receivers provided by the <code translate="no" dir="ltr">serving_input_receiver_fn</code>.</p> <p>For training and evaluation, the <code translate="no" dir="ltr">train_op</code> is stored in an extra collection, and loss, metrics, and predictions are included in a <code translate="no" dir="ltr">SignatureDef</code> for the mode in question.</p> <p>Extra assets may be written into the <code translate="no" dir="ltr">SavedModel</code> via the <code translate="no" dir="ltr">assets_extra</code> argument. This should be a dict, where each key gives a destination path (including the filename) relative to the assets.extra directory. The corresponding value gives the full path of the source file to be copied. For example, the simple case of copying a single file without renaming it is specified as <code translate="no" dir="ltr">{'my_asset_file.txt': '/path/to/my_asset_file.txt'}</code>.</p> <h4 id="args_4">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">export_dir_base</code></b>: A string containing a directory in which to create timestamped subdirectories containing exported <code translate="no" dir="ltr">SavedModel</code>s.</li> <li>
<b><code translate="no" dir="ltr">input_receiver_fn_map</code></b>: dict of <a href="../../../../estimator/modekeys"><code translate="no" dir="ltr">tf.estimator.ModeKeys</code></a> to <code translate="no" dir="ltr">input_receiver_fn</code> mappings, where the <code translate="no" dir="ltr">input_receiver_fn</code> is a function that takes no arguments and returns the appropriate subclass of <code translate="no" dir="ltr">InputReceiver</code>.</li> <li>
<b><code translate="no" dir="ltr">assets_extra</code></b>: A dict specifying how to populate the assets.extra directory within the exported <code translate="no" dir="ltr">SavedModel</code>, or <code translate="no" dir="ltr">None</code> if no extra assets are needed.</li> <li>
<b><code translate="no" dir="ltr">as_text</code></b>: whether to write the <code translate="no" dir="ltr">SavedModel</code> proto in text format.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_path</code></b>: The checkpoint path to export. If <code translate="no" dir="ltr">None</code> (the default), the most recent checkpoint found within the model directory is chosen.</li> </ul> <h4 id="returns_4">Returns:</h4> <p>The string path to the exported directory.</p> <h4 id="raises_3">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: if any <code translate="no" dir="ltr">input_receiver_fn</code> is <code translate="no" dir="ltr">None</code>, no <code translate="no" dir="ltr">export_outputs</code> are provided, or no checkpoint can be found.</li> </ul> <h3 id="export_saved_model"><code translate="no" dir="ltr">export_saved_model</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">export_saved_model(
    export_dir_base,
    serving_input_receiver_fn,
    assets_extra=None,
    as_text=False,
    checkpoint_path=None,
    experimental_mode=ModeKeys.PREDICT
)
</pre> <p>Exports inference graph as a <code translate="no" dir="ltr">SavedModel</code> into the given dir.</p> <p>For a detailed guide, see <a href="https://tensorflow.org/guide/saved_model#using_savedmodel_with_estimators">Using SavedModel with Estimators</a>.</p> <p>This method builds a new graph by first calling the <code translate="no" dir="ltr">serving_input_receiver_fn</code> to obtain feature <code translate="no" dir="ltr">Tensor</code>s, and then calling this <code translate="no" dir="ltr">Estimator</code>'s <code translate="no" dir="ltr">model_fn</code> to generate the model graph based on those features. It restores the given checkpoint (or, lacking that, the most recent checkpoint) into this graph in a fresh session. Finally it creates a timestamped export directory below the given <code translate="no" dir="ltr">export_dir_base</code>, and writes a <code translate="no" dir="ltr">SavedModel</code> into it containing a single <code translate="no" dir="ltr">tf.MetaGraphDef</code> saved from this session.</p> <p>The exported <code translate="no" dir="ltr">MetaGraphDef</code> will provide one <code translate="no" dir="ltr">SignatureDef</code> for each element of the <code translate="no" dir="ltr">export_outputs</code> dict returned from the <code translate="no" dir="ltr">model_fn</code>, named using the same keys. One of these keys is always <code translate="no" dir="ltr">tf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY</code>, indicating which signature will be served when a serving request does not specify one. For each signature, the outputs are provided by the corresponding <a href="../../../../estimator/export/exportoutput"><code translate="no" dir="ltr">tf.estimator.export.ExportOutput</code></a>s, and the inputs are always the input receivers provided by the <code translate="no" dir="ltr">serving_input_receiver_fn</code>.</p> <p>Extra assets may be written into the <code translate="no" dir="ltr">SavedModel</code> via the <code translate="no" dir="ltr">assets_extra</code> argument. This should be a dict, where each key gives a destination path (including the filename) relative to the assets.extra directory. The corresponding value gives the full path of the source file to be copied. For example, the simple case of copying a single file without renaming it is specified as <code translate="no" dir="ltr">{'my_asset_file.txt': '/path/to/my_asset_file.txt'}</code>.</p> <p>The experimental_mode parameter can be used to export a single train/eval/predict graph as a <code translate="no" dir="ltr">SavedModel</code>. See <code translate="no" dir="ltr">experimental_export_all_saved_models</code> for full docs.</p> <h4 id="args_5">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">export_dir_base</code></b>: A string containing a directory in which to create timestamped subdirectories containing exported <code translate="no" dir="ltr">SavedModel</code>s.</li> <li>
<b><code translate="no" dir="ltr">serving_input_receiver_fn</code></b>: A function that takes no argument and returns a <a href="../../../../estimator/export/servinginputreceiver"><code translate="no" dir="ltr">tf.estimator.export.ServingInputReceiver</code></a> or <a href="../../../../estimator/export/tensorservinginputreceiver"><code translate="no" dir="ltr">tf.estimator.export.TensorServingInputReceiver</code></a>.</li> <li>
<b><code translate="no" dir="ltr">assets_extra</code></b>: A dict specifying how to populate the assets.extra directory within the exported <code translate="no" dir="ltr">SavedModel</code>, or <code translate="no" dir="ltr">None</code> if no extra assets are needed.</li> <li>
<b><code translate="no" dir="ltr">as_text</code></b>: whether to write the <code translate="no" dir="ltr">SavedModel</code> proto in text format.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_path</code></b>: The checkpoint path to export. If <code translate="no" dir="ltr">None</code> (the default), the most recent checkpoint found within the model directory is chosen.</li> <li>
<b><code translate="no" dir="ltr">experimental_mode</code></b>: <a href="../../../../estimator/modekeys"><code translate="no" dir="ltr">tf.estimator.ModeKeys</code></a> value indicating with mode will be exported. Note that this feature is experimental.</li> </ul> <h4 id="returns_5">Returns:</h4> <p>The string path to the exported directory.</p> <h4 id="raises_4">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: if no <code translate="no" dir="ltr">serving_input_receiver_fn</code> is provided, no <code translate="no" dir="ltr">export_outputs</code> are provided, or no checkpoint can be found.</li> </ul> <h3 id="export_savedmodel"><code translate="no" dir="ltr">export_savedmodel</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">export_savedmodel(
    export_dir_base,
    serving_input_receiver_fn,
    assets_extra=None,
    as_text=False,
    checkpoint_path=None,
    strip_default_attrs=False
)
</pre> <p>Exports inference graph as a <code translate="no" dir="ltr">SavedModel</code> into the given dir. (deprecated)</p> <aside class="warning"><strong>Warning:</strong><span> THIS FUNCTION IS DEPRECATED. It will be removed in a future version. Instructions for updating: This function has been renamed, use <code translate="no" dir="ltr">export_saved_model</code> instead.</span></aside> <p>For a detailed guide, see <a href="https://tensorflow.org/guide/saved_model#using_savedmodel_with_estimators">Using SavedModel with Estimators</a>.</p> <p>This method builds a new graph by first calling the <code translate="no" dir="ltr">serving_input_receiver_fn</code> to obtain feature <code translate="no" dir="ltr">Tensor</code>s, and then calling this <code translate="no" dir="ltr">Estimator</code>'s <code translate="no" dir="ltr">model_fn</code> to generate the model graph based on those features. It restores the given checkpoint (or, lacking that, the most recent checkpoint) into this graph in a fresh session. Finally it creates a timestamped export directory below the given <code translate="no" dir="ltr">export_dir_base</code>, and writes a <code translate="no" dir="ltr">SavedModel</code> into it containing a single <code translate="no" dir="ltr">tf.MetaGraphDef</code> saved from this session.</p> <p>The exported <code translate="no" dir="ltr">MetaGraphDef</code> will provide one <code translate="no" dir="ltr">SignatureDef</code> for each element of the <code translate="no" dir="ltr">export_outputs</code> dict returned from the <code translate="no" dir="ltr">model_fn</code>, named using the same keys. One of these keys is always <code translate="no" dir="ltr">tf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY</code>, indicating which signature will be served when a serving request does not specify one. For each signature, the outputs are provided by the corresponding <a href="../../../../estimator/export/exportoutput"><code translate="no" dir="ltr">tf.estimator.export.ExportOutput</code></a>s, and the inputs are always the input receivers provided by the <code translate="no" dir="ltr">serving_input_receiver_fn</code>.</p> <p>Extra assets may be written into the <code translate="no" dir="ltr">SavedModel</code> via the <code translate="no" dir="ltr">assets_extra</code> argument. This should be a dict, where each key gives a destination path (including the filename) relative to the assets.extra directory. The corresponding value gives the full path of the source file to be copied. For example, the simple case of copying a single file without renaming it is specified as <code translate="no" dir="ltr">{'my_asset_file.txt': '/path/to/my_asset_file.txt'}</code>.</p> <h4 id="args_6">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">export_dir_base</code></b>: A string containing a directory in which to create timestamped subdirectories containing exported <code translate="no" dir="ltr">SavedModel</code>s.</li> <li>
<b><code translate="no" dir="ltr">serving_input_receiver_fn</code></b>: A function that takes no argument and returns a <a href="../../../../estimator/export/servinginputreceiver"><code translate="no" dir="ltr">tf.estimator.export.ServingInputReceiver</code></a> or <a href="../../../../estimator/export/tensorservinginputreceiver"><code translate="no" dir="ltr">tf.estimator.export.TensorServingInputReceiver</code></a>.</li> <li>
<b><code translate="no" dir="ltr">assets_extra</code></b>: A dict specifying how to populate the assets.extra directory within the exported <code translate="no" dir="ltr">SavedModel</code>, or <code translate="no" dir="ltr">None</code> if no extra assets are needed.</li> <li>
<b><code translate="no" dir="ltr">as_text</code></b>: whether to write the <code translate="no" dir="ltr">SavedModel</code> proto in text format.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_path</code></b>: The checkpoint path to export. If <code translate="no" dir="ltr">None</code> (the default), the most recent checkpoint found within the model directory is chosen.</li> <li>
<b><code translate="no" dir="ltr">strip_default_attrs</code></b>: Boolean. If <code translate="no" dir="ltr">True</code>, default-valued attributes will be removed from the <code translate="no" dir="ltr">NodeDef</code>s. For a detailed guide, see <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/saved_model/README.md#stripping-default-valued-attributes">Stripping Default-Valued Attributes</a>.</li> </ul> <h4 id="returns_6">Returns:</h4> <p>The string path to the exported directory.</p> <h4 id="raises_5">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: if no <code translate="no" dir="ltr">serving_input_receiver_fn</code> is provided, no <code translate="no" dir="ltr">export_outputs</code> are provided, or no checkpoint can be found.</li> </ul> <h3 id="get_variable_names"><code translate="no" dir="ltr">get_variable_names</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">get_variable_names()
</pre> <p>Returns list of all variable names in this model.</p> <h4 id="returns_7">Returns:</h4> <p>List of names.</p> <h4 id="raises_6">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If the <code translate="no" dir="ltr">Estimator</code> has not produced a checkpoint yet.</li> </ul> <h3 id="get_variable_value"><code translate="no" dir="ltr">get_variable_value</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">get_variable_value(name)
</pre> <p>Returns value of the variable given by name.</p> <h4 id="args_7">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">name</code></b>: string or a list of string, name of the tensor.</li> </ul> <h4 id="returns_8">Returns:</h4> <p>Numpy array - value of the tensor.</p> <h4 id="raises_7">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If the <code translate="no" dir="ltr">Estimator</code> has not produced a checkpoint yet.</li> </ul> <h3 id="latest_checkpoint"><code translate="no" dir="ltr">latest_checkpoint</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">latest_checkpoint()
</pre> <p>Finds the filename of the latest saved checkpoint file in <code translate="no" dir="ltr">model_dir</code>.</p> <h4 id="returns_9">Returns:</h4> <p>The full path to the latest checkpoint or <code translate="no" dir="ltr">None</code> if no checkpoint was found.</p> <h3 id="predict"><code translate="no" dir="ltr">predict</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">predict(
    input_fn,
    predict_keys=None,
    hooks=None,
    checkpoint_path=None,
    yield_single_examples=True
)
</pre> <p>Yields predictions for given features.</p> <p>Please note that interleaving two predict outputs does not work. See: <a href="https://github.com/tensorflow/tensorflow/issues/20506#issuecomment-422208517">issue/20506</a></p> <h4 id="args_8">Args:</h4> <ul> <li>
<p><b><code translate="no" dir="ltr">input_fn</code></b>: A function that constructs the features. Prediction continues until <code translate="no" dir="ltr">input_fn</code> raises an end-of-input exception (<a href="../../../../errors/outofrangeerror"><code translate="no" dir="ltr">tf.errors.OutOfRangeError</code></a> or <code translate="no" dir="ltr">StopIteration</code>). See <a href="https://tensorflow.org/guide/premade_estimators#create_input_functions">Premade Estimators</a> for more information. The function should construct and return one of the following:</p> <ul> <li>A <a href="../../../../data/dataset"><code translate="no" dir="ltr">tf.data.Dataset</code></a> object: Outputs of <code translate="no" dir="ltr">Dataset</code> object must have same constraints as below.</li> <li>features: A <a href="../../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> or a dictionary of string feature name to <code translate="no" dir="ltr">Tensor</code>. features are consumed by <code translate="no" dir="ltr">model_fn</code>. They should satisfy the expectation of <code translate="no" dir="ltr">model_fn</code> from inputs.</li> <li>A tuple, in which case the first item is extracted as features.</li> </ul>
</li> <li><p><b><code translate="no" dir="ltr">predict_keys</code></b>: list of <code translate="no" dir="ltr">str</code>, name of the keys to predict. It is used if the <a href="../../../../estimator/estimatorspec#predictions"><code translate="no" dir="ltr">tf.estimator.EstimatorSpec.predictions</code></a> is a <code translate="no" dir="ltr">dict</code>. If <code translate="no" dir="ltr">predict_keys</code> is used then rest of the predictions will be filtered from the dictionary. If <code translate="no" dir="ltr">None</code>, returns all.</p></li> <li><p><b><code translate="no" dir="ltr">hooks</code></b>: List of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> subclass instances. Used for callbacks inside the prediction call.</p></li> <li><p><b><code translate="no" dir="ltr">checkpoint_path</code></b>: Path of a specific checkpoint to predict. If <code translate="no" dir="ltr">None</code>, the latest checkpoint in <code translate="no" dir="ltr">model_dir</code> is used. If there are no checkpoints in <code translate="no" dir="ltr">model_dir</code>, prediction is run with newly initialized <code translate="no" dir="ltr">Variables</code> instead of ones restored from checkpoint.</p></li> <li><p><b><code translate="no" dir="ltr">yield_single_examples</code></b>: If <code translate="no" dir="ltr">False</code>, yields the whole batch as returned by the <code translate="no" dir="ltr">model_fn</code> instead of decomposing the batch into individual elements. This is useful if <code translate="no" dir="ltr">model_fn</code> returns some tensors whose first dimension is not equal to the batch size.</p></li> </ul> <h4 id="yields">Yields:</h4> <p>Evaluated values of <code translate="no" dir="ltr">predictions</code> tensors.</p> <h4 id="raises_8">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If batch length of predictions is not the same and <code translate="no" dir="ltr">yield_single_examples</code> is <code translate="no" dir="ltr">True</code>.</li> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If there is a conflict between <code translate="no" dir="ltr">predict_keys</code> and <code translate="no" dir="ltr">predictions</code>. For example if <code translate="no" dir="ltr">predict_keys</code> is not <code translate="no" dir="ltr">None</code> but <a href="../../../../estimator/estimatorspec#predictions"><code translate="no" dir="ltr">tf.estimator.EstimatorSpec.predictions</code></a> is not a <code translate="no" dir="ltr">dict</code>.</li> </ul> <h3 id="predict_cluster_index"><code translate="no" dir="ltr">predict_cluster_index</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/kmeans.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">predict_cluster_index(input_fn)
</pre> <p>Finds the index of the closest cluster center to each input point.</p> <h4 id="args_9">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">input_fn</code></b>: Input points. See <a href="../../../../estimator/estimator#predict"><code translate="no" dir="ltr">tf.estimator.Estimator.predict</code></a>.</li> </ul> <h4 id="yields_2">Yields:</h4> <p>The index of the closest cluster center for each input point.</p> <h3 id="score"><code translate="no" dir="ltr">score</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/kmeans.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">score(input_fn)
</pre> <p>Returns the sum of squared distances to nearest clusters.</p> <p>Note that this function is different from the corresponding one in sklearn which returns the negative sum.</p> <h4 id="args_10">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">input_fn</code></b>: Input points. See <a href="../../../../estimator/estimator#evaluate"><code translate="no" dir="ltr">tf.estimator.Estimator.evaluate</code></a>. Only one batch is retrieved.</li> </ul> <h4 id="returns_10">Returns:</h4> <p>The sum of the squared distance from each point in the first batch of inputs to its nearest cluster center.</p> <h3 id="train"><code translate="no" dir="ltr">train</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/estimator.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">train(
    input_fn,
    hooks=None,
    steps=None,
    max_steps=None,
    saving_listeners=None
)
</pre> <p>Trains a model given training data <code translate="no" dir="ltr">input_fn</code>.</p> <h4 id="args_11">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">input_fn</code></b>: A function that provides input data for training as minibatches. See <a href="https://tensorflow.org/guide/premade_estimators#create_input_functions">Premade Estimators</a> for more information. The function should construct and return one of the following: <ul> <li>A <a href="../../../../data/dataset"><code translate="no" dir="ltr">tf.data.Dataset</code></a> object: Outputs of <code translate="no" dir="ltr">Dataset</code> object must be a tuple <code translate="no" dir="ltr">(features, labels)</code> with same constraints as below.</li> <li>A tuple <code translate="no" dir="ltr">(features, labels)</code>: Where <code translate="no" dir="ltr">features</code> is a <a href="../../../../tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> or a dictionary of string feature name to <code translate="no" dir="ltr">Tensor</code> and <code translate="no" dir="ltr">labels</code> is a <code translate="no" dir="ltr">Tensor</code> or a dictionary of string label name to <code translate="no" dir="ltr">Tensor</code>. Both <code translate="no" dir="ltr">features</code> and <code translate="no" dir="ltr">labels</code> are consumed by <code translate="no" dir="ltr">model_fn</code>. They should satisfy the expectation of <code translate="no" dir="ltr">model_fn</code> from inputs.</li> </ul>
</li> <li>
<b><code translate="no" dir="ltr">hooks</code></b>: List of <code translate="no" dir="ltr">tf.train.SessionRunHook</code> subclass instances. Used for callbacks inside the training loop.</li> <li>
<b><code translate="no" dir="ltr">steps</code></b>: Number of steps for which to train the model. If <code translate="no" dir="ltr">None</code>, train forever or train until <code translate="no" dir="ltr">input_fn</code> generates the <code translate="no" dir="ltr">tf.errors.OutOfRange</code> error or <code translate="no" dir="ltr">StopIteration</code> exception. <code translate="no" dir="ltr">steps</code> works incrementally. If you call two times <code translate="no" dir="ltr">train(steps=10)</code> then training occurs in total 20 steps. If <code translate="no" dir="ltr">OutOfRange</code> or <code translate="no" dir="ltr">StopIteration</code> occurs in the middle, training stops before 20 steps. If you don't want to have incremental behavior please set <code translate="no" dir="ltr">max_steps</code> instead. If set, <code translate="no" dir="ltr">max_steps</code> must be <code translate="no" dir="ltr">None</code>.</li> <li>
<b><code translate="no" dir="ltr">max_steps</code></b>: Number of total steps for which to train model. If <code translate="no" dir="ltr">None</code>, train forever or train until <code translate="no" dir="ltr">input_fn</code> generates the <code translate="no" dir="ltr">tf.errors.OutOfRange</code> error or <code translate="no" dir="ltr">StopIteration</code> exception. If set, <code translate="no" dir="ltr">steps</code> must be <code translate="no" dir="ltr">None</code>. If <code translate="no" dir="ltr">OutOfRange</code> or <code translate="no" dir="ltr">StopIteration</code> occurs in the middle, training stops before <code translate="no" dir="ltr">max_steps</code> steps. Two calls to <code translate="no" dir="ltr">train(steps=100)</code> means 200 training iterations. On the other hand, two calls to <code translate="no" dir="ltr">train(max_steps=100)</code> means that the second call will not do any iteration since first call did all 100 steps.</li> <li>
<b><code translate="no" dir="ltr">saving_listeners</code></b>: list of <code translate="no" dir="ltr">CheckpointSaverListener</code> objects. Used for callbacks that run immediately before or after checkpoint savings.</li> </ul> <h4 id="returns_11">Returns:</h4> <p><code translate="no" dir="ltr">self</code>, for chaining.</p> <h4 id="raises_9">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If both <code translate="no" dir="ltr">steps</code> and <code translate="no" dir="ltr">max_steps</code> are not <code translate="no" dir="ltr">None</code>.</li> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If either <code translate="no" dir="ltr">steps</code> or <code translate="no" dir="ltr">max_steps &lt;= 0</code>.</li> </ul> <h3 id="transform"><code translate="no" dir="ltr">transform</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/estimator/tree/master/tensorflow_estimator/python/estimator/canned/kmeans.py">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">transform(input_fn)
</pre> <p>Transforms each input point to its distances to all cluster centers.</p> <p>Note that if <code translate="no" dir="ltr">distance_metric=KMeansClustering.SQUARED_EUCLIDEAN_DISTANCE</code>, this function returns the squared Euclidean distance while the corresponding sklearn function returns the Euclidean distance.</p> <h4 id="args_12">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">input_fn</code></b>: Input points. See <a href="../../../../estimator/estimator#predict"><code translate="no" dir="ltr">tf.estimator.Estimator.predict</code></a>.</li> </ul> <h4 id="yields_3">Yields:</h4> <p>The distances from each input point to each cluster center.</p> <h2 id="class_members">Class Members</h2> <ul> <li>
<code translate="no" dir="ltr">ALL_DISTANCES = 'all_distances'</code> 
</li> <li>
<code translate="no" dir="ltr">CLUSTER_CENTERS_VAR_NAME = 'clusters'</code> 
</li> <li>
<code translate="no" dir="ltr">CLUSTER_INDEX = 'cluster_index'</code> 
</li> <li>
<code translate="no" dir="ltr">COSINE_DISTANCE = 'cosine'</code> 
</li> <li>
<code translate="no" dir="ltr">KMEANS_PLUS_PLUS_INIT = 'kmeans_plus_plus'</code> 
</li> <li>
<code translate="no" dir="ltr">RANDOM_INIT = 'random'</code> 
</li> <li>
<code translate="no" dir="ltr">SCORE = 'score'</code> 
</li> <li>
<code translate="no" dir="ltr">SQUARED_EUCLIDEAN_DISTANCE = 'squared_euclidean'</code> 
</li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/estimator/experimental/KMeans" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/compat/v1/estimator/experimental/KMeans</a>
  </p>
</div>
