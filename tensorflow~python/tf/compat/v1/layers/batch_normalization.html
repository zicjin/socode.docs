<h1 class="devsite-page-title">tf.compat.v1.layers.batch_normalization</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.compat.v1.layers.batch_normalization"> <meta itemprop="path" content="Stable"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/layers/normalization.py#L170-L327">  View source on GitHub </a> </td>
</table>  <p>Functional interface for the batch normalization layer. (deprecated)</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">tf.compat.v1.layers.batch_normalization(
    inputs,
    axis=-1,
    momentum=0.99,
    epsilon=0.001,
    center=True,
    scale=True,
    beta_initializer=tf.zeros_initializer(),
    gamma_initializer=tf.ones_initializer(),
    moving_mean_initializer=tf.zeros_initializer(),
    moving_variance_initializer=tf.ones_initializer(),
    beta_regularizer=None,
    gamma_regularizer=None,
    beta_constraint=None,
    gamma_constraint=None,
    training=False,
    trainable=True,
    name=None,
    reuse=None,
    renorm=False,
    renorm_clipping=None,
    renorm_momentum=0.99,
    fused=None,
    virtual_batch_size=None,
    adjustment=None
)
</pre>  <aside class="warning"><strong>Warning:</strong><span> THIS FUNCTION IS DEPRECATED. It will be removed in a future version. Instructions for updating: Use keras.layers.BatchNormalization instead. In particular, <a href="../../../control_dependencies"><code translate="no" dir="ltr">tf.control_dependencies(tf.GraphKeys.UPDATE_OPS)</code></a> should not be used (consult the <a href="../../../keras/layers/batchnormalization"><code translate="no" dir="ltr">tf.keras.layers.BatchNormalization</code></a> documentation).</span></aside> <p>Reference: http://arxiv.org/abs/1502.03167</p> <p>"Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift"</p> <p>Sergey Ioffe, Christian Szegedy</p> <blockquote class="note">
<strong>Note:</strong><span> when training, the moving_mean and moving_variance need to be updated. By default the update ops are placed in <code translate="no" dir="ltr">tf.GraphKeys.UPDATE_OPS</code>, so they need to be executed alongside the <code translate="no" dir="ltr">train_op</code>. Also, be sure to add any batch_normalization ops before getting the update_ops collection. Otherwise, update_ops will be empty, and training/inference will not work properly. For example:</span>
</blockquote>
<pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">x_norm = tf.compat.v1.layers.batch_normalization(x, training=training)

# ...

update_ops = tf.compat.v1.get_collection(tf.GraphKeys.UPDATE_OPS)
train_op = optimizer.minimize(loss)
train_op = tf.group([train_op, update_ops])
</pre> <h4 id="arguments">Arguments:</h4> <ul> <li>
<b><code translate="no" dir="ltr">inputs</code></b>: Tensor input.</li> <li>
<b><code translate="no" dir="ltr">axis</code></b>: An <code translate="no" dir="ltr">int</code>, the axis that should be normalized (typically the features axis). For instance, after a <code translate="no" dir="ltr">Convolution2D</code> layer with <code translate="no" dir="ltr">data_format="channels_first"</code>, set <code translate="no" dir="ltr">axis=1</code> in <code translate="no" dir="ltr">BatchNormalization</code>.</li> <li>
<b><code translate="no" dir="ltr">momentum</code></b>: Momentum for the moving average.</li> <li>
<b><code translate="no" dir="ltr">epsilon</code></b>: Small float added to variance to avoid dividing by zero.</li> <li>
<b><code translate="no" dir="ltr">center</code></b>: If True, add offset of <code translate="no" dir="ltr">beta</code> to normalized tensor. If False, <code translate="no" dir="ltr">beta</code> is ignored.</li> <li>
<b><code translate="no" dir="ltr">scale</code></b>: If True, multiply by <code translate="no" dir="ltr">gamma</code>. If False, <code translate="no" dir="ltr">gamma</code> is not used. When the next layer is linear (also e.g. <a href="../../../nn/relu"><code translate="no" dir="ltr">nn.relu</code></a>), this can be disabled since the scaling can be done by the next layer.</li> <li>
<b><code translate="no" dir="ltr">beta_initializer</code></b>: Initializer for the beta weight.</li> <li>
<b><code translate="no" dir="ltr">gamma_initializer</code></b>: Initializer for the gamma weight.</li> <li>
<b><code translate="no" dir="ltr">moving_mean_initializer</code></b>: Initializer for the moving mean.</li> <li>
<b><code translate="no" dir="ltr">moving_variance_initializer</code></b>: Initializer for the moving variance.</li> <li>
<b><code translate="no" dir="ltr">beta_regularizer</code></b>: Optional regularizer for the beta weight.</li> <li>
<b><code translate="no" dir="ltr">gamma_regularizer</code></b>: Optional regularizer for the gamma weight.</li> <li>
<b><code translate="no" dir="ltr">beta_constraint</code></b>: An optional projection function to be applied to the <code translate="no" dir="ltr">beta</code> weight after being updated by an <code translate="no" dir="ltr">Optimizer</code> (e.g. used to implement norm constraints or value constraints for layer weights). The function must take as input the unprojected variable and must return the projected variable (which must have the same shape). Constraints are not safe to use when doing asynchronous distributed training.</li> <li>
<b><code translate="no" dir="ltr">gamma_constraint</code></b>: An optional projection function to be applied to the <code translate="no" dir="ltr">gamma</code> weight after being updated by an <code translate="no" dir="ltr">Optimizer</code>.</li> <li>
<b><code translate="no" dir="ltr">training</code></b>: Either a Python boolean, or a TensorFlow boolean scalar tensor (e.g. a placeholder). Whether to return the output in training mode (normalized with statistics of the current batch) or in inference mode (normalized with moving statistics). <strong>NOTE</strong>: make sure to set this parameter correctly, or else your training/inference will not work properly.</li> <li>
<b><code translate="no" dir="ltr">trainable</code></b>: Boolean, if <code translate="no" dir="ltr">True</code> also add variables to the graph collection <code translate="no" dir="ltr">GraphKeys.TRAINABLE_VARIABLES</code> (see tf.Variable).</li> <li>
<b><code translate="no" dir="ltr">name</code></b>: String, the name of the layer.</li> <li>
<b><code translate="no" dir="ltr">reuse</code></b>: Boolean, whether to reuse the weights of a previous layer by the same name.</li> <li>
<b><code translate="no" dir="ltr">renorm</code></b>: Whether to use Batch Renormalization (https://arxiv.org/abs/1702.03275). This adds extra variables during training. The inference is the same for either value of this parameter.</li> <li>
<b><code translate="no" dir="ltr">renorm_clipping</code></b>: A dictionary that may map keys 'rmax', 'rmin', 'dmax' to scalar <code translate="no" dir="ltr">Tensors</code> used to clip the renorm correction. The correction <code translate="no" dir="ltr">(r, d)</code> is used as <code translate="no" dir="ltr">corrected_value = normalized_value * r + d</code>, with <code translate="no" dir="ltr">r</code> clipped to [rmin, rmax], and <code translate="no" dir="ltr">d</code> to [-dmax, dmax]. Missing rmax, rmin, dmax are set to inf, 0, inf, respectively.</li> <li>
<b><code translate="no" dir="ltr">renorm_momentum</code></b>: Momentum used to update the moving means and standard deviations with renorm. Unlike <code translate="no" dir="ltr">momentum</code>, this affects training and should be neither too small (which would add noise) nor too large (which would give stale estimates). Note that <code translate="no" dir="ltr">momentum</code> is still applied to get the means and variances for inference.</li> <li>
<b><code translate="no" dir="ltr">fused</code></b>: if <code translate="no" dir="ltr">None</code> or <code translate="no" dir="ltr">True</code>, use a faster, fused implementation if possible. If <code translate="no" dir="ltr">False</code>, use the system recommended implementation.</li> <li>
<b><code translate="no" dir="ltr">virtual_batch_size</code></b>: An <code translate="no" dir="ltr">int</code>. By default, <code translate="no" dir="ltr">virtual_batch_size</code> is <code translate="no" dir="ltr">None</code>, which means batch normalization is performed across the whole batch. When <code translate="no" dir="ltr">virtual_batch_size</code> is not <code translate="no" dir="ltr">None</code>, instead perform "Ghost Batch Normalization", which creates virtual sub-batches which are each normalized separately (with shared gamma, beta, and moving statistics). Must divide the actual batch size during execution.</li> <li>
<b><code translate="no" dir="ltr">adjustment</code></b>: A function taking the <code translate="no" dir="ltr">Tensor</code> containing the (dynamic) shape of the input tensor and returning a pair (scale, bias) to apply to the normalized values (before gamma and beta), only during training. For example, if axis==-1, <code translate="no" dir="ltr">adjustment = lambda shape: ( tf.random.uniform(shape[-1:], 0.93, 1.07), tf.random.uniform(shape[-1:], -0.1, 0.1))</code> will scale the normalized value by up to 7% up or down, then shift the result by up to 0.1 (with independent scaling and bias for each feature but shared across all examples), and finally apply gamma and/or beta. If <code translate="no" dir="ltr">None</code>, no adjustment is applied. Cannot be specified if virtual_batch_size is specified.</li> </ul> <h4 id="returns">Returns:</h4> <p>Output tensor.</p> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: if eager execution is enabled.</li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/layers/batch_normalization" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/compat/v1/layers/batch_normalization</a>
  </p>
</div>
