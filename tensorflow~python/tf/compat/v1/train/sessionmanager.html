<h1 class="devsite-page-title">tf.compat.v1.train.SessionManager</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.compat.v1.train.SessionManager"> <meta itemprop="path" content="Stable"> <meta itemprop="property" content="__init__"> <meta itemprop="property" content="prepare_session"> <meta itemprop="property" content="recover_session"> <meta itemprop="property" content="wait_for_session"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/training/session_manager.py#L50-L511">  View source on GitHub </a> </td>
</table>  <h2 id="class_sessionmanager">Class <code translate="no" dir="ltr">SessionManager</code>
</h2> <p>Training helper that restores from checkpoint and creates session.</p>  <p>This class is a small wrapper that takes care of session creation and checkpoint recovery. It also provides functions that to facilitate coordination among multiple training threads or processes.</p> <ul> <li>Checkpointing trained variables as the training progresses.</li> <li>Initializing variables on startup, restoring them from the most recent checkpoint after a crash, or wait for checkpoints to become available.</li> </ul> <h3 id="usage">Usage:</h3> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">with tf.Graph().as_default():
   ...add operations to the graph...
  # Create a SessionManager that will checkpoint the model in '/tmp/mydir'.
  sm = SessionManager()
  sess = sm.prepare_session(master, init_op, saver, checkpoint_dir)
  # Use the session to train the graph.
  while True:
    sess.run(&lt;my_train_op&gt;)
</pre> <p><code translate="no" dir="ltr">prepare_session()</code> initializes or restores a model. It requires <code translate="no" dir="ltr">init_op</code> and <code translate="no" dir="ltr">saver</code> as an argument.</p> <p>A second process could wait for the model to be ready by doing the following:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">with tf.Graph().as_default():
   ...add operations to the graph...
  # Create a SessionManager that will wait for the model to become ready.
  sm = SessionManager()
  sess = sm.wait_for_session(master)
  # Use the session to train the graph.
  while True:
    sess.run(&lt;my_train_op&gt;)
</pre> <p><code translate="no" dir="ltr">wait_for_session()</code> waits for a model to be initialized by other processes.</p> <h2 id="__init__"><code translate="no" dir="ltr">__init__</code></h2> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/training/session_manager.py#L94-L157">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">__init__(
    local_init_op=None,
    ready_op=None,
    ready_for_local_init_op=None,
    graph=None,
    recovery_wait_secs=30,
    local_init_run_options=None,
    local_init_feed_dict=None
)
</pre> <p>Creates a SessionManager.</p> <p>The <code translate="no" dir="ltr">local_init_op</code> is an <code translate="no" dir="ltr">Operation</code> that is run always after a new session was created. If <code translate="no" dir="ltr">None</code>, this step is skipped.</p> <p>The <code translate="no" dir="ltr">ready_op</code> is an <code translate="no" dir="ltr">Operation</code> used to check if the model is ready. The model is considered ready if that operation returns an empty 1D string tensor. If the operation returns a non empty 1D string tensor, the elements are concatenated and used to indicate to the user why the model is not ready.</p> <p>The <code translate="no" dir="ltr">ready_for_local_init_op</code> is an <code translate="no" dir="ltr">Operation</code> used to check if the model is ready to run local_init_op. The model is considered ready if that operation returns an empty 1D string tensor. If the operation returns a non empty 1D string tensor, the elements are concatenated and used to indicate to the user why the model is not ready.</p> <p>If <code translate="no" dir="ltr">ready_op</code> is <code translate="no" dir="ltr">None</code>, the model is not checked for readiness.</p> <p><code translate="no" dir="ltr">recovery_wait_secs</code> is the number of seconds between checks that the model is ready. It is used by processes to wait for a model to be initialized or restored. Defaults to 30 seconds.</p> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">local_init_op</code></b>: An <code translate="no" dir="ltr">Operation</code> run immediately after session creation. Usually used to initialize tables and local variables.</li> <li>
<b><code translate="no" dir="ltr">ready_op</code></b>: An <code translate="no" dir="ltr">Operation</code> to check if the model is initialized.</li> <li>
<b><code translate="no" dir="ltr">ready_for_local_init_op</code></b>: An <code translate="no" dir="ltr">Operation</code> to check if the model is ready to run local_init_op.</li> <li>
<b><code translate="no" dir="ltr">graph</code></b>: The <code translate="no" dir="ltr">Graph</code> that the model will use.</li> <li>
<b><code translate="no" dir="ltr">recovery_wait_secs</code></b>: Seconds between checks for the model to be ready.</li> <li>
<b><code translate="no" dir="ltr">local_init_run_options</code></b>: RunOptions to be passed to session.run when executing the local_init_op.</li> <li>
<b><code translate="no" dir="ltr">local_init_feed_dict</code></b>: Optional session feed dictionary to use when running the local_init_op.</li> </ul> <h4 id="raises">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If ready_for_local_init_op is not None but local_init_op is None</li> </ul> <h2 id="methods">Methods</h2> <h3 id="prepare_session"><code translate="no" dir="ltr">prepare_session</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/training/session_manager.py#L228-L318">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">prepare_session(
    master,
    init_op=None,
    saver=None,
    checkpoint_dir=None,
    checkpoint_filename_with_path=None,
    wait_for_checkpoint=False,
    max_wait_secs=7200,
    config=None,
    init_feed_dict=None,
    init_fn=None
)
</pre> <p>Creates a <code translate="no" dir="ltr">Session</code>. Makes sure the model is ready to be used.</p> <p>Creates a <code translate="no" dir="ltr">Session</code> on 'master'. If a <code translate="no" dir="ltr">saver</code> object is passed in, and <code translate="no" dir="ltr">checkpoint_dir</code> points to a directory containing valid checkpoint files, then it will try to recover the model from checkpoint. If no checkpoint files are available, and <code translate="no" dir="ltr">wait_for_checkpoint</code> is <code translate="no" dir="ltr">True</code>, then the process would check every <code translate="no" dir="ltr">recovery_wait_secs</code>, up to <code translate="no" dir="ltr">max_wait_secs</code>, for recovery to succeed.</p> <p>If the model cannot be recovered successfully then it is initialized by running the <code translate="no" dir="ltr">init_op</code> and calling <code translate="no" dir="ltr">init_fn</code> if they are provided. The <code translate="no" dir="ltr">local_init_op</code> is also run after init_op and init_fn, regardless of whether the model was recovered successfully, but only if <code translate="no" dir="ltr">ready_for_local_init_op</code> passes.</p> <p>If the model is recovered from a checkpoint it is assumed that all global variables have been initialized, in particular neither <code translate="no" dir="ltr">init_op</code> nor <code translate="no" dir="ltr">init_fn</code> will be executed.</p> <p>It is an error if the model cannot be recovered and no <code translate="no" dir="ltr">init_op</code> or <code translate="no" dir="ltr">init_fn</code> or <code translate="no" dir="ltr">local_init_op</code> are passed.</p> <h4 id="args_2">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">master</code></b>: <code translate="no" dir="ltr">String</code> representation of the TensorFlow master to use.</li> <li>
<b><code translate="no" dir="ltr">init_op</code></b>: Optional <code translate="no" dir="ltr">Operation</code> used to initialize the model.</li> <li>
<b><code translate="no" dir="ltr">saver</code></b>: A <code translate="no" dir="ltr">Saver</code> object used to restore a model.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_dir</code></b>: Path to the checkpoint files. The latest checkpoint in the dir will be used to restore.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_filename_with_path</code></b>: Full file name path to the checkpoint file.</li> <li>
<b><code translate="no" dir="ltr">wait_for_checkpoint</code></b>: Whether to wait for checkpoint to become available.</li> <li>
<b><code translate="no" dir="ltr">max_wait_secs</code></b>: Maximum time to wait for checkpoints to become available.</li> <li>
<b><code translate="no" dir="ltr">config</code></b>: Optional <code translate="no" dir="ltr">ConfigProto</code> proto used to configure the session.</li> <li>
<b><code translate="no" dir="ltr">init_feed_dict</code></b>: Optional dictionary that maps <code translate="no" dir="ltr">Tensor</code> objects to feed values. This feed dictionary is passed to the session <code translate="no" dir="ltr">run()</code> call when running the init op.</li> <li>
<b><code translate="no" dir="ltr">init_fn</code></b>: Optional callable used to initialize the model. Called after the optional <code translate="no" dir="ltr">init_op</code> is called. The callable must accept one argument, the session being initialized.</li> </ul> <h4 id="returns">Returns:</h4> <p>A <code translate="no" dir="ltr">Session</code> object that can be used to drive the model.</p> <h4 id="raises_2">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">RuntimeError</code></b>: If the model cannot be initialized or recovered.</li> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If both checkpoint_dir and checkpoint_filename_with_path are set.</li> </ul> <h3 id="recover_session"><code translate="no" dir="ltr">recover_session</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/training/session_manager.py#L320-L382">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">recover_session(
    master,
    saver=None,
    checkpoint_dir=None,
    checkpoint_filename_with_path=None,
    wait_for_checkpoint=False,
    max_wait_secs=7200,
    config=None
)
</pre> <p>Creates a <code translate="no" dir="ltr">Session</code>, recovering if possible.</p> <p>Creates a new session on 'master'. If the session is not initialized and can be recovered from a checkpoint, recover it.</p> <h4 id="args_3">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">master</code></b>: <code translate="no" dir="ltr">String</code> representation of the TensorFlow master to use.</li> <li>
<b><code translate="no" dir="ltr">saver</code></b>: A <code translate="no" dir="ltr">Saver</code> object used to restore a model.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_dir</code></b>: Path to the checkpoint files. The latest checkpoint in the dir will be used to restore.</li> <li>
<b><code translate="no" dir="ltr">checkpoint_filename_with_path</code></b>: Full file name path to the checkpoint file.</li> <li>
<b><code translate="no" dir="ltr">wait_for_checkpoint</code></b>: Whether to wait for checkpoint to become available.</li> <li>
<b><code translate="no" dir="ltr">max_wait_secs</code></b>: Maximum time to wait for checkpoints to become available.</li> <li>
<b><code translate="no" dir="ltr">config</code></b>: Optional <code translate="no" dir="ltr">ConfigProto</code> proto used to configure the session.</li> </ul> <h4 id="returns_2">Returns:</h4> <p>A pair (sess, initialized) where 'initialized' is <code translate="no" dir="ltr">True</code> if the session could be recovered and initialized, <code translate="no" dir="ltr">False</code> otherwise.</p> <h4 id="raises_3">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">ValueError</code></b>: If both checkpoint_dir and checkpoint_filename_with_path are set.</li> </ul> <h3 id="wait_for_session"><code translate="no" dir="ltr">wait_for_session</code></h3> <p><a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/training/session_manager.py#L384-L441">View source</a></p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">wait_for_session(
    master,
    config=None,
    max_wait_secs=float('Inf')
)
</pre> <p>Creates a new <code translate="no" dir="ltr">Session</code> and waits for model to be ready.</p> <p>Creates a new <code translate="no" dir="ltr">Session</code> on 'master'. Waits for the model to be initialized or recovered from a checkpoint. It's expected that another thread or process will make the model ready, and that this is intended to be used by threads/processes that participate in a distributed training configuration where a different thread/process is responsible for initializing or recovering the model being trained.</p> <p>NB: The amount of time this method waits for the session is bounded by max_wait_secs. By default, this function will wait indefinitely.</p> <h4 id="args_4">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">master</code></b>: <code translate="no" dir="ltr">String</code> representation of the TensorFlow master to use.</li> <li>
<b><code translate="no" dir="ltr">config</code></b>: Optional ConfigProto proto used to configure the session.</li> <li>
<b><code translate="no" dir="ltr">max_wait_secs</code></b>: Maximum time to wait for the session to become available.</li> </ul> <h4 id="returns_3">Returns:</h4> <p>A <code translate="no" dir="ltr">Session</code>. May be None if the operation exceeds the timeout specified by config.operation_timeout_in_ms.</p> <h4 id="raises_4">Raises:</h4> <ul> <li>
<b><code translate="no" dir="ltr">tf.DeadlineExceededError</code></b>: if the session is not available after max_wait_secs.</li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/compat/v1/train/SessionManager" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/compat/v1/train/SessionManager</a>
  </p>
</div>
