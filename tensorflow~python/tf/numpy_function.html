<h1 class="devsite-page-title">tf.numpy_function</h1>     <div itemscope itemtype="http://developers.google.com/ReferenceObject"> <meta itemprop="name" content="tf.numpy_function"> <meta itemprop="path" content="Stable"> </div>  <table class="tfo-notebook-buttons tfo-api" align="left"> <td> <a target="_blank" href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/numpy_function">  TensorFlow 1 version</a> </td> <td> <a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/r2.1/tensorflow/python/ops/script_ops.py#L522-L591">  View source on GitHub </a> </td>
</table>  <p>Wraps a python function and uses it as a TensorFlow op.</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">tf.numpy_function(
    func,
    inp,
    Tout,
    name=None
)
</pre> <h3 id="used_in_the_tutorials">Used in the tutorials:</h3> <ul> <li><a href="https://www.tensorflow.org/tutorials/text/image_captioning">Image captioning with visual attention</a></li> </ul> <p>Given a python function <code translate="no" dir="ltr">func</code> wrap this function as an operation in a TensorFlow function. <code translate="no" dir="ltr">func</code> must take numpy arrays as its arguments and return numpy arrays as its outputs.</p> <p>The following example creates a TensorFlow graph with <code translate="no" dir="ltr">np.sinh()</code> as an operation in the graph:</p> <pre class="devsite-click-to-copy prettyprint lang-py" translate="no" dir="ltr" data-language="python">
def my_numpy_func(x): 
  # x will be a numpy array with the contents of the input to the 
  # tf.function 
  return np.sinh(x) 
@tf.function(input_signature=[tf.TensorSpec(None, tf.float32)]) 
def tf_function(input): 
  y = tf.numpy_function(my_numpy_func, [input], tf.float32) 
  return y * y 
tf_function(tf.constant(1.)) 
&lt;tf.Tensor: shape=(), dtype=float32, numpy=1.3810978&gt; 
</pre> <p>Comparison to <a href="py_function"><code translate="no" dir="ltr">tf.py_function</code></a>: <a href="py_function"><code translate="no" dir="ltr">tf.py_function</code></a> and <a href="numpy_function"><code translate="no" dir="ltr">tf.numpy_function</code></a> are very similar, except that <a href="numpy_function"><code translate="no" dir="ltr">tf.numpy_function</code></a> takes numpy arrays, and not <a href="tensor"><code translate="no" dir="ltr">tf.Tensor</code></a>s. If you want the function to contain <code translate="no" dir="ltr">tf.Tensors</code>, and have any TensorFlow operations executed in the function be differentiable, please use <a href="py_function"><code translate="no" dir="ltr">tf.py_function</code></a>.</p> <blockquote class="note">
<strong>Note:</strong><span> The <a href="numpy_function"><code translate="no" dir="ltr">tf.numpy_function</code></a> operation has the following known limitations:</span>
</blockquote> <ul> <li><p>The body of the function (i.e. <code translate="no" dir="ltr">func</code>) will not be serialized in a <code translate="no" dir="ltr">tf.SavedModel</code>. Therefore, you should not use this function if you need to serialize your model and restore it in a different environment.</p></li> <li><p>The operation must run in the same address space as the Python program that calls <a href="numpy_function"><code translate="no" dir="ltr">tf.numpy_function()</code></a>. If you are using distributed TensorFlow, you must run a <a href="distribute/server"><code translate="no" dir="ltr">tf.distribute.Server</code></a> in the same process as the program that calls <a href="numpy_function"><code translate="no" dir="ltr">tf.numpy_function</code></a> you must pin the created operation to a device in that server (e.g. using <code translate="no" dir="ltr">with tf.device():</code>).</p></li> <li><p>Since the function takes numpy arrays, you cannot take gradients through a numpy_function. If you require something that is differentiable, please consider using tf.py_function.</p></li> </ul> <h4 id="args">Args:</h4> <ul> <li>
<b><code translate="no" dir="ltr">func</code></b>: A Python function, which accepts <code translate="no" dir="ltr">numpy.ndarray</code> objects as arguments and returns a list of <code translate="no" dir="ltr">numpy.ndarray</code> objects (or a single <code translate="no" dir="ltr">numpy.ndarray</code>). This function must accept as many arguments as there are tensors in <code translate="no" dir="ltr">inp</code>, and these argument types will match the corresponding <a href="tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> objects in <code translate="no" dir="ltr">inp</code>. The returns <code translate="no" dir="ltr">numpy.ndarray</code>s must match the number and types defined <code translate="no" dir="ltr">Tout</code>. Important Note: Input and output <code translate="no" dir="ltr">numpy.ndarray</code>s of <code translate="no" dir="ltr">func</code> are not guaranteed to be copies. In some cases their underlying memory will be shared with the corresponding TensorFlow tensors. In-place modification or storing <code translate="no" dir="ltr">func</code> input or return values in python datastructures without explicit (np.)copy can have non-deterministic consequences.</li> <li>
<b><code translate="no" dir="ltr">inp</code></b>: A list of <a href="tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> objects.</li> <li>
<b><code translate="no" dir="ltr">Tout</code></b>: A list or tuple of tensorflow data types or a single tensorflow data type if there is only one, indicating what <code translate="no" dir="ltr">func</code> returns. stateful (bool): If True, the function should be considered stateful. If a function is stateless, when given the same input it will return the same output and have no observable side effects. Optimizations such as common subexpression elimination are only performed on stateless operations.</li> <li>
<b><code translate="no" dir="ltr">name</code></b>: (Optional) A name for the operation.</li> </ul> <h4 id="returns">Returns:</h4> <p>Single or list of <a href="tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> which <code translate="no" dir="ltr">func</code> computes.</p> <h2 id="compat_aliases">Compat aliases</h2> <ul> <li><a href="numpy_function"><code translate="no" dir="ltr">tf.compat.v1.numpy_function</code></a></li> <li><a href="numpy_function"><code translate="no" dir="ltr">tf.compat.v2.numpy_function</code></a></li> </ul>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/api_docs/python/tf/numpy_function" class="_attribution-link">https://www.tensorflow.org/api_docs/python/tf/numpy_function</a>
  </p>
</div>
