<h1 id="test-regression-tests-package-for-python">test — Regression tests package for Python</h1> <div class="admonition note" id="module-test"> <p class="admonition-title">Note</p> <p>The <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> package is meant for internal use by Python only. It is documented for the benefit of the core developers of Python. Any use of this package outside of Python’s standard library is discouraged as code mentioned here can change or be removed without notice between releases of Python.</p> </div>  <p>The <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> package contains all regression tests for Python as well as the modules <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> and <code>test.regrtest</code>. <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> is used to enhance your tests while <code>test.regrtest</code> drives the testing suite.</p> <p>Each module in the <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> package whose name starts with <code>test_</code> is a testing suite for a specific module or feature. All new tests should be written using the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> or <a class="reference internal" href="doctest#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> module. Some older tests are written using a “traditional” testing style that compares output printed to <code>sys.stdout</code>; this style of test is considered deprecated.</p> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt>
<code>Module</code> <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a>
</dt>
<dd>
<p>Writing PyUnit regression tests.</p> </dd> <dt>
<code>Module</code> <a class="reference internal" href="doctest#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a>
</dt>
<dd>
<p>Tests embedded in documentation strings.</p> </dd> </dl> </div>  <h2 id="writing-tests">Writing Unit Tests for the test package</h2> <p id="writing-unit-tests-for-the-test-package">It is preferred that tests that use the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> module follow a few guidelines. One is to name the test module by starting it with <code>test_</code> and end it with the name of the module being tested. The test methods in the test module should start with <code>test_</code> and end with a description of what the method is testing. This is needed so that the methods are recognized by the test driver as test methods. Also, no documentation string for the method should be included. A comment (such as <code># Tests function returns only True or False</code>) should be used to provide documentation for test methods. This is done because documentation strings get printed out if they exist and thus what test is being run is not stated.</p> <p>A basic boilerplate is often used:</p> <pre data-language="python">import unittest
from test import support

class MyTestCase1(unittest.TestCase):

    # Only use setUp() and tearDown() if necessary

    def setUp(self):
        ... code to execute in preparation for tests ...

    def tearDown(self):
        ... code to execute to clean up after tests ...

    def test_feature_one(self):
        # Test feature one.
        ... testing code ...

    def test_feature_two(self):
        # Test feature two.
        ... testing code ...

    ... more test methods ...

class MyTestCase2(unittest.TestCase):
    ... same structure as MyTestCase1 ...

... more test classes ...

if __name__ == '__main__':
    unittest.main()
</pre> <p>This code pattern allows the testing suite to be run by <code>test.regrtest</code>, on its own as a script that supports the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> CLI, or via the <code>python -m unittest</code> CLI.</p> <p>The goal for regression testing is to try to break code. This leads to a few guidelines to be followed:</p> <ul> <li>The testing suite should exercise all classes, functions, and constants. This includes not just the external API that is to be presented to the outside world but also “private” code.</li> <li>Whitebox testing (examining the code being tested when the tests are being written) is preferred. Blackbox testing (testing only the published user interface) is not complete enough to make sure all boundary and edge cases are tested.</li> <li>Make sure all possible values are tested including invalid ones. This makes sure that not only all valid values are acceptable but also that improper values are handled correctly.</li> <li>Exhaust as many code paths as possible. Test where branching occurs and thus tailor input to make sure as many different paths through the code are taken.</li> <li>Add an explicit test for any bugs discovered for the tested code. This will make sure that the error does not crop up again if the code is changed in the future.</li> <li>Make sure to clean up after your tests (such as close and remove all temporary files).</li> <li>If a test is dependent on a specific condition of the operating system then verify the condition already exists before attempting the test.</li> <li>Import as few modules as possible and do it as soon as possible. This minimizes external dependencies of tests and also minimizes possible anomalous behavior from side-effects of importing a module.</li> <li>
<p>Try to maximize code reuse. On occasion, tests will vary by something as small as what type of input is used. Minimize code duplication by subclassing a basic test class with a class that specifies the input:</p> <pre data-language="python">class TestFuncAcceptsSequencesMixin:

    func = mySuperWhammyFunction

    def test_func(self):
        self.func(self.arg)

class AcceptLists(TestFuncAcceptsSequencesMixin, unittest.TestCase):
    arg = [1, 2, 3]

class AcceptStrings(TestFuncAcceptsSequencesMixin, unittest.TestCase):
    arg = 'abc'

class AcceptTuples(TestFuncAcceptsSequencesMixin, unittest.TestCase):
    arg = (1, 2, 3)
</pre> <p>When using this pattern, remember that all classes that inherit from <a class="reference internal" href="unittest#unittest.TestCase" title="unittest.TestCase"><code>unittest.TestCase</code></a> are run as tests. The <code>Mixin</code> class in the example above does not have any data and so can’t be run by itself, thus it does not inherit from <a class="reference internal" href="unittest#unittest.TestCase" title="unittest.TestCase"><code>unittest.TestCase</code></a>.</p> </li> </ul> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt>Test Driven Development</dt>
<dd>
<p>A book by Kent Beck on writing tests before code.</p> </dd> </dl> </div>   <h2 id="regrtest">Running tests using the command-line interface</h2> <p id="running-tests-using-the-command-line-interface">The <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> package can be run as a script to drive Python’s regression test suite, thanks to the <a class="reference internal" href="https://docs.python.org/3.9/using/cmdline.html#cmdoption-m"><code>-m</code></a> option: <strong class="program">python -m test</strong>. Under the hood, it uses <code>test.regrtest</code>; the call <strong class="program">python -m test.regrtest</strong> used in previous Python versions still works. Running the script by itself automatically starts running all regression tests in the <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> package. It does this by finding all modules in the package whose name starts with <code>test_</code>, importing them, and executing the function <code>test_main()</code> if present or loading the tests via unittest.TestLoader.loadTestsFromModule if <code>test_main</code> does not exist. The names of tests to execute may also be passed to the script. Specifying a single regression test (<strong class="program">python -m test test_spam</strong>) will minimize output and only print whether the test passed or failed.</p> <p>Running <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> directly allows what resources are available for tests to use to be set. You do this by using the <code>-u</code> command-line option. Specifying <code>all</code> as the value for the <code>-u</code> option enables all possible resources: <strong class="program">python -m test -uall</strong>. If all but one resource is desired (a more common case), a comma-separated list of resources that are not desired may be listed after <code>all</code>. The command <strong class="program">python -m test -uall,-audio,-largefile</strong> will run <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code>test</code></a> with all resources except the <code>audio</code> and <code>largefile</code> resources. For a list of all resources and more command-line options, run <strong class="program">python -m test -h</strong>.</p> <p>Some other ways to execute the regression tests depend on what platform the tests are being executed on. On Unix, you can run <strong class="program">make test</strong> at the top-level directory where Python was built. On Windows, executing <strong class="program">rt.bat</strong> from your <code>PCbuild</code> directory will run all regression tests.</p>    <h1 id="test-support-utilities-for-the-python-test-suite">test.support — Utilities for the Python test suite</h1> <p id="module-test.support">The <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> module provides support for Python’s regression test suite.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> is not a public module. It is documented here to help Python developers write tests. The API of this module is subject to change without backwards compatibility concerns between releases.</p> </div> <p>This module defines the following exceptions:</p> <dl class="exception"> <dt id="test.support.TestFailed">
<code>exception test.support.TestFailed</code> </dt> <dd>
<p>Exception to be raised when a test fails. This is deprecated in favor of <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a>-based tests and <a class="reference internal" href="unittest#unittest.TestCase" title="unittest.TestCase"><code>unittest.TestCase</code></a>’s assertion methods.</p> </dd>
</dl> <dl class="exception"> <dt id="test.support.ResourceDenied">
<code>exception test.support.ResourceDenied</code> </dt> <dd>
<p>Subclass of <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a>. Raised when a resource (such as a network connection) is not available. Raised by the <a class="reference internal" href="#test.support.requires" title="test.support.requires"><code>requires()</code></a> function.</p> </dd>
</dl> <p>The <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> module defines the following constants:</p> <dl class="data"> <dt id="test.support.verbose">
<code>test.support.verbose</code> </dt> <dd>
<p><code>True</code> when verbose output is enabled. Should be checked when more detailed information is desired about a running test. <em>verbose</em> is set by <code>test.regrtest</code>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.is_jython">
<code>test.support.is_jython</code> </dt> <dd>
<p><code>True</code> if the running interpreter is Jython.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.is_android">
<code>test.support.is_android</code> </dt> <dd>
<p><code>True</code> if the system is Android.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.unix_shell">
<code>test.support.unix_shell</code> </dt> <dd>
<p>Path for shell if not on Windows; otherwise <code>None</code>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.FS_NONASCII">
<code>test.support.FS_NONASCII</code> </dt> <dd>
<p>A non-ASCII character encodable by <a class="reference internal" href="os#os.fsencode" title="os.fsencode"><code>os.fsencode()</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TESTFN">
<code>test.support.TESTFN</code> </dt> <dd>
<p>Set to a name that is safe to use as the name of a temporary file. Any temporary file that is created should be closed and unlinked (removed).</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TESTFN_UNICODE">
<code>test.support.TESTFN_UNICODE</code> </dt> <dd>
<p>Set to a non-ASCII name for a temporary file.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TESTFN_ENCODING">
<code>test.support.TESTFN_ENCODING</code> </dt> <dd>
<p>Set to <a class="reference internal" href="sys#sys.getfilesystemencoding" title="sys.getfilesystemencoding"><code>sys.getfilesystemencoding()</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TESTFN_UNENCODABLE">
<code>test.support.TESTFN_UNENCODABLE</code> </dt> <dd>
<p>Set to a filename (str type) that should not be able to be encoded by file system encoding in strict mode. It may be <code>None</code> if it’s not possible to generate such a filename.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TESTFN_UNDECODABLE">
<code>test.support.TESTFN_UNDECODABLE</code> </dt> <dd>
<p>Set to a filename (bytes type) that should not be able to be decoded by file system encoding in strict mode. It may be <code>None</code> if it’s not possible to generate such a filename.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TESTFN_NONASCII">
<code>test.support.TESTFN_NONASCII</code> </dt> <dd>
<p>Set to a filename containing the <a class="reference internal" href="#test.support.FS_NONASCII" title="test.support.FS_NONASCII"><code>FS_NONASCII</code></a> character.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.LOOPBACK_TIMEOUT">
<code>test.support.LOOPBACK_TIMEOUT</code> </dt> <dd>
<p>Timeout in seconds for tests using a network server listening on the network local loopback interface like <code>127.0.0.1</code>.</p> <p>The timeout is long enough to prevent test failure: it takes into account that the client and the server can run in different threads or even different processes.</p> <p>The timeout should be long enough for <a class="reference internal" href="socket#socket.socket.connect" title="socket.socket.connect"><code>connect()</code></a>, <a class="reference internal" href="socket#socket.socket.recv" title="socket.socket.recv"><code>recv()</code></a> and <a class="reference internal" href="socket#socket.socket.send" title="socket.socket.send"><code>send()</code></a> methods of <a class="reference internal" href="socket#socket.socket" title="socket.socket"><code>socket.socket</code></a>.</p> <p>Its default value is 5 seconds.</p> <p>See also <a class="reference internal" href="#test.support.INTERNET_TIMEOUT" title="test.support.INTERNET_TIMEOUT"><code>INTERNET_TIMEOUT</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.INTERNET_TIMEOUT">
<code>test.support.INTERNET_TIMEOUT</code> </dt> <dd>
<p>Timeout in seconds for network requests going to the Internet.</p> <p>The timeout is short enough to prevent a test to wait for too long if the Internet request is blocked for whatever reason.</p> <p>Usually, a timeout using <a class="reference internal" href="#test.support.INTERNET_TIMEOUT" title="test.support.INTERNET_TIMEOUT"><code>INTERNET_TIMEOUT</code></a> should not mark a test as failed, but skip the test instead: see <a class="reference internal" href="#test.support.socket_helper.transient_internet" title="test.support.socket_helper.transient_internet"><code>transient_internet()</code></a>.</p> <p>Its default value is 1 minute.</p> <p>See also <a class="reference internal" href="#test.support.LOOPBACK_TIMEOUT" title="test.support.LOOPBACK_TIMEOUT"><code>LOOPBACK_TIMEOUT</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.SHORT_TIMEOUT">
<code>test.support.SHORT_TIMEOUT</code> </dt> <dd>
<p>Timeout in seconds to mark a test as failed if the test takes “too long”.</p> <p>The timeout value depends on the regrtest <code>--timeout</code> command line option.</p> <p>If a test using <a class="reference internal" href="#test.support.SHORT_TIMEOUT" title="test.support.SHORT_TIMEOUT"><code>SHORT_TIMEOUT</code></a> starts to fail randomly on slow buildbots, use <a class="reference internal" href="#test.support.LONG_TIMEOUT" title="test.support.LONG_TIMEOUT"><code>LONG_TIMEOUT</code></a> instead.</p> <p>Its default value is 30 seconds.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.LONG_TIMEOUT">
<code>test.support.LONG_TIMEOUT</code> </dt> <dd>
<p>Timeout in seconds to detect when a test hangs.</p> <p>It is long enough to reduce the risk of test failure on the slowest Python buildbots. It should not be used to mark a test as failed if the test takes “too long”. The timeout value depends on the regrtest <code>--timeout</code> command line option.</p> <p>Its default value is 5 minutes.</p> <p>See also <a class="reference internal" href="#test.support.LOOPBACK_TIMEOUT" title="test.support.LOOPBACK_TIMEOUT"><code>LOOPBACK_TIMEOUT</code></a>, <a class="reference internal" href="#test.support.INTERNET_TIMEOUT" title="test.support.INTERNET_TIMEOUT"><code>INTERNET_TIMEOUT</code></a> and <a class="reference internal" href="#test.support.SHORT_TIMEOUT" title="test.support.SHORT_TIMEOUT"><code>SHORT_TIMEOUT</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.SAVEDCWD">
<code>test.support.SAVEDCWD</code> </dt> <dd>
<p>Set to <a class="reference internal" href="os#os.getcwd" title="os.getcwd"><code>os.getcwd()</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.PGO">
<code>test.support.PGO</code> </dt> <dd>
<p>Set when tests can be skipped when they are not useful for PGO.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.PIPE_MAX_SIZE">
<code>test.support.PIPE_MAX_SIZE</code> </dt> <dd>
<p>A constant that is likely larger than the underlying OS pipe buffer size, to make writes blocking.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.SOCK_MAX_SIZE">
<code>test.support.SOCK_MAX_SIZE</code> </dt> <dd>
<p>A constant that is likely larger than the underlying OS socket buffer size, to make writes blocking.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TEST_SUPPORT_DIR">
<code>test.support.TEST_SUPPORT_DIR</code> </dt> <dd>
<p>Set to the top level directory that contains <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TEST_HOME_DIR">
<code>test.support.TEST_HOME_DIR</code> </dt> <dd>
<p>Set to the top level directory for the test package.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TEST_DATA_DIR">
<code>test.support.TEST_DATA_DIR</code> </dt> <dd>
<p>Set to the <code>data</code> directory within the test package.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.MAX_Py_ssize_t">
<code>test.support.MAX_Py_ssize_t</code> </dt> <dd>
<p>Set to <a class="reference internal" href="sys#sys.maxsize" title="sys.maxsize"><code>sys.maxsize</code></a> for big memory tests.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.max_memuse">
<code>test.support.max_memuse</code> </dt> <dd>
<p>Set by <a class="reference internal" href="#test.support.set_memlimit" title="test.support.set_memlimit"><code>set_memlimit()</code></a> as the memory limit for big memory tests. Limited by <a class="reference internal" href="#test.support.MAX_Py_ssize_t" title="test.support.MAX_Py_ssize_t"><code>MAX_Py_ssize_t</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.real_max_memuse">
<code>test.support.real_max_memuse</code> </dt> <dd>
<p>Set by <a class="reference internal" href="#test.support.set_memlimit" title="test.support.set_memlimit"><code>set_memlimit()</code></a> as the memory limit for big memory tests. Not limited by <a class="reference internal" href="#test.support.MAX_Py_ssize_t" title="test.support.MAX_Py_ssize_t"><code>MAX_Py_ssize_t</code></a>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.MISSING_C_DOCSTRINGS">
<code>test.support.MISSING_C_DOCSTRINGS</code> </dt> <dd>
<p>Return <code>True</code> if running on CPython, not on Windows, and configuration not set with <code>WITH_DOC_STRINGS</code>.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.HAVE_DOCSTRINGS">
<code>test.support.HAVE_DOCSTRINGS</code> </dt> <dd>
<p>Check for presence of docstrings.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.TEST_HTTP_URL">
<code>test.support.TEST_HTTP_URL</code> </dt> <dd>
<p>Define the URL of a dedicated HTTP server for the network tests.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.ALWAYS_EQ">
<code>test.support.ALWAYS_EQ</code> </dt> <dd>
<p>Object that is equal to anything. Used to test mixed type comparison.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.NEVER_EQ">
<code>test.support.NEVER_EQ</code> </dt> <dd>
<p>Object that is not equal to anything (even to <a class="reference internal" href="#test.support.ALWAYS_EQ" title="test.support.ALWAYS_EQ"><code>ALWAYS_EQ</code></a>). Used to test mixed type comparison.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.LARGEST">
<code>test.support.LARGEST</code> </dt> <dd>
<p>Object that is greater than anything (except itself). Used to test mixed type comparison.</p> </dd>
</dl> <dl class="data"> <dt id="test.support.SMALLEST">
<code>test.support.SMALLEST</code> </dt> <dd>
<p>Object that is less than anything (except itself). Used to test mixed type comparison.</p> </dd>
</dl> <p>The <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> module defines the following functions:</p> <dl class="function"> <dt id="test.support.forget">
<code>test.support.forget(module_name)</code> </dt> <dd>
<p>Remove the module named <em>module_name</em> from <code>sys.modules</code> and delete any byte-compiled files of the module.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.unload">
<code>test.support.unload(name)</code> </dt> <dd>
<p>Delete <em>name</em> from <code>sys.modules</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.unlink">
<code>test.support.unlink(filename)</code> </dt> <dd>
<p>Call <a class="reference internal" href="os#os.unlink" title="os.unlink"><code>os.unlink()</code></a> on <em>filename</em>. On Windows platforms, this is wrapped with a wait loop that checks for the existence fo the file.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.rmdir">
<code>test.support.rmdir(filename)</code> </dt> <dd>
<p>Call <a class="reference internal" href="os#os.rmdir" title="os.rmdir"><code>os.rmdir()</code></a> on <em>filename</em>. On Windows platforms, this is wrapped with a wait loop that checks for the existence of the file.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.rmtree">
<code>test.support.rmtree(path)</code> </dt> <dd>
<p>Call <a class="reference internal" href="shutil#shutil.rmtree" title="shutil.rmtree"><code>shutil.rmtree()</code></a> on <em>path</em> or call <a class="reference internal" href="os#os.lstat" title="os.lstat"><code>os.lstat()</code></a> and <a class="reference internal" href="os#os.rmdir" title="os.rmdir"><code>os.rmdir()</code></a> to remove a path and its contents. On Windows platforms, this is wrapped with a wait loop that checks for the existence of the files.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.make_legacy_pyc">
<code>test.support.make_legacy_pyc(source)</code> </dt> <dd>
<p>Move a <a class="pep reference external" href="https://www.python.org/dev/peps/pep-3147" id="index-0"><strong>PEP 3147</strong></a>/<a class="pep reference external" href="https://www.python.org/dev/peps/pep-0488" id="index-1"><strong>PEP 488</strong></a> pyc file to its legacy pyc location and return the file system path to the legacy pyc file. The <em>source</em> value is the file system path to the source file. It does not need to exist, however the PEP 3147/488 pyc file must exist.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.is_resource_enabled">
<code>test.support.is_resource_enabled(resource)</code> </dt> <dd>
<p>Return <code>True</code> if <em>resource</em> is enabled and available. The list of available resources is only set when <code>test.regrtest</code> is executing the tests.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.python_is_optimized">
<code>test.support.python_is_optimized()</code> </dt> <dd>
<p>Return <code>True</code> if Python was not built with <code>-O0</code> or <code>-Og</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.with_pymalloc">
<code>test.support.with_pymalloc()</code> </dt> <dd>
<p>Return <code>_testcapi.WITH_PYMALLOC</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires">
<code>test.support.requires(resource, msg=None)</code> </dt> <dd>
<p>Raise <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code>ResourceDenied</code></a> if <em>resource</em> is not available. <em>msg</em> is the argument to <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code>ResourceDenied</code></a> if it is raised. Always returns <code>True</code> if called by a function whose <code>__name__</code> is <code>'__main__'</code>. Used when tests are executed by <code>test.regrtest</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.system_must_validate_cert">
<code>test.support.system_must_validate_cert(f)</code> </dt> <dd>
<p>Raise <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a> on TLS certification validation failures.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.sortdict">
<code>test.support.sortdict(dict)</code> </dt> <dd>
<p>Return a repr of <em>dict</em> with keys sorted.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.findfile">
<code>test.support.findfile(filename, subdir=None)</code> </dt> <dd>
<p>Return the path to the file named <em>filename</em>. If no match is found <em>filename</em> is returned. This does not equal a failure since it could be the path to the file.</p> <p>Setting <em>subdir</em> indicates a relative path to use to find the file rather than looking directly in the path directories.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.create_empty_file">
<code>test.support.create_empty_file(filename)</code> </dt> <dd>
<p>Create an empty file with <em>filename</em>. If it already exists, truncate it.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.fd_count">
<code>test.support.fd_count()</code> </dt> <dd>
<p>Count the number of open file descriptors.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.match_test">
<code>test.support.match_test(test)</code> </dt> <dd>
<p>Match <em>test</em> to patterns set in <a class="reference internal" href="#test.support.set_match_tests" title="test.support.set_match_tests"><code>set_match_tests()</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.set_match_tests">
<code>test.support.set_match_tests(patterns)</code> </dt> <dd>
<p>Define match test with regular expression <em>patterns</em>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.run_unittest">
<code>test.support.run_unittest(*classes)</code> </dt> <dd>
<p>Execute <a class="reference internal" href="unittest#unittest.TestCase" title="unittest.TestCase"><code>unittest.TestCase</code></a> subclasses passed to the function. The function scans the classes for methods starting with the prefix <code>test_</code> and executes the tests individually.</p> <p>It is also legal to pass strings as parameters; these should be keys in <code>sys.modules</code>. Each associated module will be scanned by <code>unittest.TestLoader.loadTestsFromModule()</code>. This is usually seen in the following <code>test_main()</code> function:</p> <pre data-language="python">def test_main():
    support.run_unittest(__name__)
</pre> <p>This will run all tests defined in the named module.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.run_doctest">
<code>test.support.run_doctest(module, verbosity=None, optionflags=0)</code> </dt> <dd>
<p>Run <a class="reference internal" href="doctest#doctest.testmod" title="doctest.testmod"><code>doctest.testmod()</code></a> on the given <em>module</em>. Return <code>(failure_count, test_count)</code>.</p> <p>If <em>verbosity</em> is <code>None</code>, <a class="reference internal" href="doctest#doctest.testmod" title="doctest.testmod"><code>doctest.testmod()</code></a> is run with verbosity set to <a class="reference internal" href="#test.support.verbose" title="test.support.verbose"><code>verbose</code></a>. Otherwise, it is run with verbosity set to <code>None</code>. <em>optionflags</em> is passed as <code>optionflags</code> to <a class="reference internal" href="doctest#doctest.testmod" title="doctest.testmod"><code>doctest.testmod()</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.setswitchinterval">
<code>test.support.setswitchinterval(interval)</code> </dt> <dd>
<p>Set the <a class="reference internal" href="sys#sys.setswitchinterval" title="sys.setswitchinterval"><code>sys.setswitchinterval()</code></a> to the given <em>interval</em>. Defines a minimum interval for Android systems to prevent the system from hanging.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.check_impl_detail">
<code>test.support.check_impl_detail(**guards)</code> </dt> <dd>
<p>Use this check to guard CPython’s implementation-specific tests or to run them only on the implementations guarded by the arguments:</p> <pre data-language="python">check_impl_detail()               # Only on CPython (default).
check_impl_detail(jython=True)    # Only on Jython.
check_impl_detail(cpython=False)  # Everywhere except CPython.
</pre> </dd>
</dl> <dl class="function"> <dt id="test.support.check_warnings">
<code>test.support.check_warnings(*filters, quiet=True)</code> </dt> <dd>
<p>A convenience wrapper for <a class="reference internal" href="warnings#warnings.catch_warnings" title="warnings.catch_warnings"><code>warnings.catch_warnings()</code></a> that makes it easier to test that a warning was correctly raised. It is approximately equivalent to calling <code>warnings.catch_warnings(record=True)</code> with <a class="reference internal" href="warnings#warnings.simplefilter" title="warnings.simplefilter"><code>warnings.simplefilter()</code></a> set to <code>always</code> and with the option to automatically validate the results that are recorded.</p> <p><code>check_warnings</code> accepts 2-tuples of the form <code>("message regexp",
WarningCategory)</code> as positional arguments. If one or more <em>filters</em> are provided, or if the optional keyword argument <em>quiet</em> is <code>False</code>, it checks to make sure the warnings are as expected: each specified filter must match at least one of the warnings raised by the enclosed code or the test fails, and if any warnings are raised that do not match any of the specified filters the test fails. To disable the first of these checks, set <em>quiet</em> to <code>True</code>.</p> <p>If no arguments are specified, it defaults to:</p> <pre data-language="python">check_warnings(("", Warning), quiet=True)
</pre> <p>In this case all warnings are caught and no errors are raised.</p> <p>On entry to the context manager, a <code>WarningRecorder</code> instance is returned. The underlying warnings list from <a class="reference internal" href="warnings#warnings.catch_warnings" title="warnings.catch_warnings"><code>catch_warnings()</code></a> is available via the recorder object’s <a class="reference internal" href="warnings#module-warnings" title="warnings: Issue warning messages and control their disposition."><code>warnings</code></a> attribute. As a convenience, the attributes of the object representing the most recent warning can also be accessed directly through the recorder object (see example below). If no warning has been raised, then any of the attributes that would otherwise be expected on an object representing a warning will return <code>None</code>.</p> <p>The recorder object also has a <code>reset()</code> method, which clears the warnings list.</p> <p>The context manager is designed to be used like this:</p> <pre data-language="python">with check_warnings(("assertion is always true", SyntaxWarning),
                    ("", UserWarning)):
    exec('assert(False, "Hey!")')
    warnings.warn(UserWarning("Hide me!"))
</pre> <p>In this case if either warning was not raised, or some other warning was raised, <a class="reference internal" href="#test.support.check_warnings" title="test.support.check_warnings"><code>check_warnings()</code></a> would raise an error.</p> <p>When a test needs to look more deeply into the warnings, rather than just checking whether or not they occurred, code like this can be used:</p> <pre data-language="python">with check_warnings(quiet=True) as w:
    warnings.warn("foo")
    assert str(w.args[0]) == "foo"
    warnings.warn("bar")
    assert str(w.args[0]) == "bar"
    assert str(w.warnings[0].args[0]) == "foo"
    assert str(w.warnings[1].args[0]) == "bar"
    w.reset()
    assert len(w.warnings) == 0
</pre> <p>Here all warnings will be caught, and the test code tests the captured warnings directly.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.2: </span>New optional arguments <em>filters</em> and <em>quiet</em>.</p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.check_no_resource_warning">
<code>test.support.check_no_resource_warning(testcase)</code> </dt> <dd>
<p>Context manager to check that no <a class="reference internal" href="exceptions#ResourceWarning" title="ResourceWarning"><code>ResourceWarning</code></a> was raised. You must remove the object which may emit <a class="reference internal" href="exceptions#ResourceWarning" title="ResourceWarning"><code>ResourceWarning</code></a> before the end of the context manager.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.set_memlimit">
<code>test.support.set_memlimit(limit)</code> </dt> <dd>
<p>Set the values for <a class="reference internal" href="#test.support.max_memuse" title="test.support.max_memuse"><code>max_memuse</code></a> and <a class="reference internal" href="#test.support.real_max_memuse" title="test.support.real_max_memuse"><code>real_max_memuse</code></a> for big memory tests.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.record_original_stdout">
<code>test.support.record_original_stdout(stdout)</code> </dt> <dd>
<p>Store the value from <em>stdout</em>. It is meant to hold the stdout at the time the regrtest began.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.get_original_stdout">
<code>test.support.get_original_stdout()</code> </dt> <dd>
<p>Return the original stdout set by <a class="reference internal" href="#test.support.record_original_stdout" title="test.support.record_original_stdout"><code>record_original_stdout()</code></a> or <code>sys.stdout</code> if it’s not set.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.args_from_interpreter_flags">
<code>test.support.args_from_interpreter_flags()</code> </dt> <dd>
<p>Return a list of command line arguments reproducing the current settings in <code>sys.flags</code> and <code>sys.warnoptions</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.optim_args_from_interpreter_flags">
<code>test.support.optim_args_from_interpreter_flags()</code> </dt> <dd>
<p>Return a list of command line arguments reproducing the current optimization settings in <code>sys.flags</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.captured_stdin">
<code>test.support.captured_stdin()</code> </dt> <dt id="test.support.captured_stdout">
<code>test.support.captured_stdout()</code> </dt> <dt id="test.support.captured_stderr">
<code>test.support.captured_stderr()</code> </dt> <dd>
<p>A context managers that temporarily replaces the named stream with <a class="reference internal" href="io#io.StringIO" title="io.StringIO"><code>io.StringIO</code></a> object.</p> <p>Example use with output streams:</p> <pre data-language="python">with captured_stdout() as stdout, captured_stderr() as stderr:
    print("hello")
    print("error", file=sys.stderr)
assert stdout.getvalue() == "hello\n"
assert stderr.getvalue() == "error\n"
</pre> <p>Example use with input stream:</p> <pre data-language="python">with captured_stdin() as stdin:
    stdin.write('hello\n')
    stdin.seek(0)
    # call test code that consumes from sys.stdin
    captured = input()
self.assertEqual(captured, "hello")
</pre> </dd>
</dl> <dl class="function"> <dt id="test.support.temp_dir">
<code>test.support.temp_dir(path=None, quiet=False)</code> </dt> <dd>
<p>A context manager that creates a temporary directory at <em>path</em> and yields the directory.</p> <p>If <em>path</em> is <code>None</code>, the temporary directory is created using <a class="reference internal" href="tempfile#tempfile.mkdtemp" title="tempfile.mkdtemp"><code>tempfile.mkdtemp()</code></a>. If <em>quiet</em> is <code>False</code>, the context manager raises an exception on error. Otherwise, if <em>path</em> is specified and cannot be created, only a warning is issued.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.change_cwd">
<code>test.support.change_cwd(path, quiet=False)</code> </dt> <dd>
<p>A context manager that temporarily changes the current working directory to <em>path</em> and yields the directory.</p> <p>If <em>quiet</em> is <code>False</code>, the context manager raises an exception on error. Otherwise, it issues only a warning and keeps the current working directory the same.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.temp_cwd">
<code>test.support.temp_cwd(name='tempcwd', quiet=False)</code> </dt> <dd>
<p>A context manager that temporarily creates a new directory and changes the current working directory (CWD).</p> <p>The context manager creates a temporary directory in the current directory with name <em>name</em> before temporarily changing the current working directory. If <em>name</em> is <code>None</code>, the temporary directory is created using <a class="reference internal" href="tempfile#tempfile.mkdtemp" title="tempfile.mkdtemp"><code>tempfile.mkdtemp()</code></a>.</p> <p>If <em>quiet</em> is <code>False</code> and it is not possible to create or change the CWD, an error is raised. Otherwise, only a warning is raised and the original CWD is used.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.temp_umask">
<code>test.support.temp_umask(umask)</code> </dt> <dd>
<p>A context manager that temporarily sets the process umask.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.disable_faulthandler">
<code>test.support.disable_faulthandler()</code> </dt> <dd>
<p>A context manager that replaces <code>sys.stderr</code> with <code>sys.__stderr__</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.gc_collect">
<code>test.support.gc_collect()</code> </dt> <dd>
<p>Force as many objects as possible to be collected. This is needed because timely deallocation is not guaranteed by the garbage collector. This means that <code>__del__</code> methods may be called later than expected and weakrefs may remain alive for longer than expected.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.disable_gc">
<code>test.support.disable_gc()</code> </dt> <dd>
<p>A context manager that disables the garbage collector upon entry and reenables it upon exit.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.swap_attr">
<code>test.support.swap_attr(obj, attr, new_val)</code> </dt> <dd>
<p>Context manager to swap out an attribute with a new object.</p> <p>Usage:</p> <pre data-language="python">with swap_attr(obj, "attr", 5):
    ...
</pre> <p>This will set <code>obj.attr</code> to 5 for the duration of the <code>with</code> block, restoring the old value at the end of the block. If <code>attr</code> doesn’t exist on <code>obj</code>, it will be created and then deleted at the end of the block.</p> <p>The old value (or <code>None</code> if it doesn’t exist) will be assigned to the target of the “as” clause, if there is one.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.swap_item">
<code>test.support.swap_item(obj, attr, new_val)</code> </dt> <dd>
<p>Context manager to swap out an item with a new object.</p> <p>Usage:</p> <pre data-language="python">with swap_item(obj, "item", 5):
    ...
</pre> <p>This will set <code>obj["item"]</code> to 5 for the duration of the <code>with</code> block, restoring the old value at the end of the block. If <code>item</code> doesn’t exist on <code>obj</code>, it will be created and then deleted at the end of the block.</p> <p>The old value (or <code>None</code> if it doesn’t exist) will be assigned to the target of the “as” clause, if there is one.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.print_warning">
<code>test.support.print_warning(msg)</code> </dt> <dd>
<p>Print a warning into <a class="reference internal" href="sys#sys.__stderr__" title="sys.__stderr__"><code>sys.__stderr__</code></a>. Format the message as: <code>f"Warning -- {msg}"</code>. If <em>msg</em> is made of multiple lines, add <code>"Warning -- "</code> prefix to each line.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.9.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.wait_process">
<code>test.support.wait_process(pid, *, exitcode, timeout=None)</code> </dt> <dd>
<p>Wait until process <em>pid</em> completes and check that the process exit code is <em>exitcode</em>.</p> <p>Raise an <a class="reference internal" href="exceptions#AssertionError" title="AssertionError"><code>AssertionError</code></a> if the process exit code is not equal to <em>exitcode</em>.</p> <p>If the process runs longer than <em>timeout</em> seconds (<a class="reference internal" href="#test.support.SHORT_TIMEOUT" title="test.support.SHORT_TIMEOUT"><code>SHORT_TIMEOUT</code></a> by default), kill the process and raise an <a class="reference internal" href="exceptions#AssertionError" title="AssertionError"><code>AssertionError</code></a>. The timeout feature is not available on Windows.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.9.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.wait_threads_exit">
<code>test.support.wait_threads_exit(timeout=60.0)</code> </dt> <dd>
<p>Context manager to wait until all threads created in the <code>with</code> statement exit.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.start_threads">
<code>test.support.start_threads(threads, unlock=None)</code> </dt> <dd>
<p>Context manager to start <em>threads</em>. It attempts to join the threads upon exit.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.calcobjsize">
<code>test.support.calcobjsize(fmt)</code> </dt> <dd>
<p>Return <a class="reference internal" href="struct#struct.calcsize" title="struct.calcsize"><code>struct.calcsize()</code></a> for <code>nP{fmt}0n</code> or, if <code>gettotalrefcount</code> exists, <code>2PnP{fmt}0P</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.calcvobjsize">
<code>test.support.calcvobjsize(fmt)</code> </dt> <dd>
<p>Return <a class="reference internal" href="struct#struct.calcsize" title="struct.calcsize"><code>struct.calcsize()</code></a> for <code>nPn{fmt}0n</code> or, if <code>gettotalrefcount</code> exists, <code>2PnPn{fmt}0P</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.checksizeof">
<code>test.support.checksizeof(test, o, size)</code> </dt> <dd>
<p>For testcase <em>test</em>, assert that the <code>sys.getsizeof</code> for <em>o</em> plus the GC header size equals <em>size</em>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.can_symlink">
<code>test.support.can_symlink()</code> </dt> <dd>
<p>Return <code>True</code> if the OS supports symbolic links, <code>False</code> otherwise.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.can_xattr">
<code>test.support.can_xattr()</code> </dt> <dd>
<p>Return <code>True</code> if the OS supports xattr, <code>False</code> otherwise.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.skip_unless_symlink">
<code>@test.support.skip_unless_symlink</code> </dt> <dd>
<p>A decorator for running tests that require support for symbolic links.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.skip_unless_xattr">
<code>@test.support.skip_unless_xattr</code> </dt> <dd>
<p>A decorator for running tests that require support for xattr.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.anticipate_failure">
<code>@test.support.anticipate_failure(condition)</code> </dt> <dd>
<p>A decorator to conditionally mark tests with <a class="reference internal" href="unittest#unittest.expectedFailure" title="unittest.expectedFailure"><code>unittest.expectedFailure()</code></a>. Any use of this decorator should have an associated comment identifying the relevant tracker issue.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.run_with_locale">
<code>@test.support.run_with_locale(catstr, *locales)</code> </dt> <dd>
<p>A decorator for running a function in a different locale, correctly resetting it after it has finished. <em>catstr</em> is the locale category as a string (for example <code>"LC_ALL"</code>). The <em>locales</em> passed will be tried sequentially, and the first valid locale will be used.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.run_with_tz">
<code>@test.support.run_with_tz(tz)</code> </dt> <dd>
<p>A decorator for running a function in a specific timezone, correctly resetting it after it has finished.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_freebsd_version">
<code>@test.support.requires_freebsd_version(*min_version)</code> </dt> <dd>
<p>Decorator for the minimum version when running test on FreeBSD. If the FreeBSD version is less than the minimum, raise <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_linux_version">
<code>@test.support.requires_linux_version(*min_version)</code> </dt> <dd>
<p>Decorator for the minimum version when running test on Linux. If the Linux version is less than the minimum, raise <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_mac_version">
<code>@test.support.requires_mac_version(*min_version)</code> </dt> <dd>
<p>Decorator for the minimum version when running test on Mac OS X. If the MAC OS X version is less than the minimum, raise <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_IEEE_754">
<code>@test.support.requires_IEEE_754</code> </dt> <dd>
<p>Decorator for skipping tests on non-IEEE 754 platforms.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_zlib">
<code>@test.support.requires_zlib</code> </dt> <dd>
<p>Decorator for skipping tests if <a class="reference internal" href="zlib#module-zlib" title="zlib: Low-level interface to compression and decompression routines compatible with gzip."><code>zlib</code></a> doesn’t exist.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_gzip">
<code>@test.support.requires_gzip</code> </dt> <dd>
<p>Decorator for skipping tests if <a class="reference internal" href="gzip#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code>gzip</code></a> doesn’t exist.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_bz2">
<code>@test.support.requires_bz2</code> </dt> <dd>
<p>Decorator for skipping tests if <a class="reference internal" href="bz2#module-bz2" title="bz2: Interfaces for bzip2 compression and decompression."><code>bz2</code></a> doesn’t exist.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_lzma">
<code>@test.support.requires_lzma</code> </dt> <dd>
<p>Decorator for skipping tests if <a class="reference internal" href="lzma#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code>lzma</code></a> doesn’t exist.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_resource">
<code>@test.support.requires_resource(resource)</code> </dt> <dd>
<p>Decorator for skipping tests if <em>resource</em> is not available.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.requires_docstrings">
<code>@test.support.requires_docstrings</code> </dt> <dd>
<p>Decorator for only running the test if <a class="reference internal" href="#test.support.HAVE_DOCSTRINGS" title="test.support.HAVE_DOCSTRINGS"><code>HAVE_DOCSTRINGS</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.cpython_only">
<code>@test.support.cpython_only(test)</code> </dt> <dd>
<p>Decorator for tests only applicable to CPython.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.impl_detail">
<code>@test.support.impl_detail(msg=None, **guards)</code> </dt> <dd>
<p>Decorator for invoking <a class="reference internal" href="#test.support.check_impl_detail" title="test.support.check_impl_detail"><code>check_impl_detail()</code></a> on <em>guards</em>. If that returns <code>False</code>, then uses <em>msg</em> as the reason for skipping the test.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.no_tracing">
<code>@test.support.no_tracing(func)</code> </dt> <dd>
<p>Decorator to temporarily turn off tracing for the duration of the test.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.refcount_test">
<code>@test.support.refcount_test(test)</code> </dt> <dd>
<p>Decorator for tests which involve reference counting. The decorator does not run the test if it is not run by CPython. Any trace function is unset for the duration of the test to prevent unexpected refcounts caused by the trace function.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.reap_threads">
<code>@test.support.reap_threads(func)</code> </dt> <dd>
<p>Decorator to ensure the threads are cleaned up even if the test fails.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.bigmemtest">
<code>@test.support.bigmemtest(size, memuse, dry_run=True)</code> </dt> <dd>
<p>Decorator for bigmem tests.</p> <p><em>size</em> is a requested size for the test (in arbitrary, test-interpreted units.) <em>memuse</em> is the number of bytes per unit for the test, or a good estimate of it. For example, a test that needs two byte buffers, of 4 GiB each, could be decorated with <code>@bigmemtest(size=_4G, memuse=2)</code>.</p> <p>The <em>size</em> argument is normally passed to the decorated test method as an extra argument. If <em>dry_run</em> is <code>True</code>, the value passed to the test method may be less than the requested value. If <em>dry_run</em> is <code>False</code>, it means the test doesn’t support dummy runs when <code>-M</code> is not specified.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.bigaddrspacetest">
<code>@test.support.bigaddrspacetest(f)</code> </dt> <dd>
<p>Decorator for tests that fill the address space. <em>f</em> is the function to wrap.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.make_bad_fd">
<code>test.support.make_bad_fd()</code> </dt> <dd>
<p>Create an invalid file descriptor by opening and closing a temporary file, and returning its descriptor.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.check_syntax_error">
<code>test.support.check_syntax_error(testcase, statement, errtext='', *, lineno=None, offset=None)</code> </dt> <dd>
<p>Test for syntax errors in <em>statement</em> by attempting to compile <em>statement</em>. <em>testcase</em> is the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> instance for the test. <em>errtext</em> is the regular expression which should match the string representation of the raised <a class="reference internal" href="exceptions#SyntaxError" title="SyntaxError"><code>SyntaxError</code></a>. If <em>lineno</em> is not <code>None</code>, compares to the line of the exception. If <em>offset</em> is not <code>None</code>, compares to the offset of the exception.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.check_syntax_warning">
<code>test.support.check_syntax_warning(testcase, statement, errtext='', *, lineno=1, offset=None)</code> </dt> <dd>
<p>Test for syntax warning in <em>statement</em> by attempting to compile <em>statement</em>. Test also that the <a class="reference internal" href="exceptions#SyntaxWarning" title="SyntaxWarning"><code>SyntaxWarning</code></a> is emitted only once, and that it will be converted to a <a class="reference internal" href="exceptions#SyntaxError" title="SyntaxError"><code>SyntaxError</code></a> when turned into error. <em>testcase</em> is the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> instance for the test. <em>errtext</em> is the regular expression which should match the string representation of the emitted <a class="reference internal" href="exceptions#SyntaxWarning" title="SyntaxWarning"><code>SyntaxWarning</code></a> and raised <a class="reference internal" href="exceptions#SyntaxError" title="SyntaxError"><code>SyntaxError</code></a>. If <em>lineno</em> is not <code>None</code>, compares to the line of the warning and exception. If <em>offset</em> is not <code>None</code>, compares to the offset of the exception.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.8.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.open_urlresource">
<code>test.support.open_urlresource(url, *args, **kw)</code> </dt> <dd>
<p>Open <em>url</em>. If open fails, raises <a class="reference internal" href="#test.support.TestFailed" title="test.support.TestFailed"><code>TestFailed</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.import_module">
<code>test.support.import_module(name, deprecated=False, *, required_on())</code> </dt> <dd>
<p>This function imports and returns the named module. Unlike a normal import, this function raises <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a> if the module cannot be imported.</p> <p>Module and package deprecation messages are suppressed during this import if <em>deprecated</em> is <code>True</code>. If a module is required on a platform but optional for others, set <em>required_on</em> to an iterable of platform prefixes which will be compared against <a class="reference internal" href="sys#sys.platform" title="sys.platform"><code>sys.platform</code></a>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.1.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.import_fresh_module">
<code>test.support.import_fresh_module(name, fresh=(), blocked=(), deprecated=False)</code> </dt> <dd>
<p>This function imports and returns a fresh copy of the named Python module by removing the named module from <code>sys.modules</code> before doing the import. Note that unlike <code>reload()</code>, the original module is not affected by this operation.</p> <p><em>fresh</em> is an iterable of additional module names that are also removed from the <code>sys.modules</code> cache before doing the import.</p> <p><em>blocked</em> is an iterable of module names that are replaced with <code>None</code> in the module cache during the import to ensure that attempts to import them raise <a class="reference internal" href="exceptions#ImportError" title="ImportError"><code>ImportError</code></a>.</p> <p>The named module and any modules named in the <em>fresh</em> and <em>blocked</em> parameters are saved before starting the import and then reinserted into <code>sys.modules</code> when the fresh import is complete.</p> <p>Module and package deprecation messages are suppressed during this import if <em>deprecated</em> is <code>True</code>.</p> <p>This function will raise <a class="reference internal" href="exceptions#ImportError" title="ImportError"><code>ImportError</code></a> if the named module cannot be imported.</p> <p>Example use:</p> <pre data-language="python"># Get copies of the warnings module for testing without affecting the
# version being used by the rest of the test suite. One copy uses the
# C implementation, the other is forced to use the pure Python fallback
# implementation
py_warnings = import_fresh_module('warnings', blocked=['_warnings'])
c_warnings = import_fresh_module('warnings', fresh=['_warnings'])
</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.1.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.modules_setup">
<code>test.support.modules_setup()</code> </dt> <dd>
<p>Return a copy of <a class="reference internal" href="sys#sys.modules" title="sys.modules"><code>sys.modules</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.modules_cleanup">
<code>test.support.modules_cleanup(oldmodules)</code> </dt> <dd>
<p>Remove modules except for <em>oldmodules</em> and <code>encodings</code> in order to preserve internal cache.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.threading_setup">
<code>test.support.threading_setup()</code> </dt> <dd>
<p>Return current thread count and copy of dangling threads.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.threading_cleanup">
<code>test.support.threading_cleanup(*original_values)</code> </dt> <dd>
<p>Cleanup up threads not specified in <em>original_values</em>. Designed to emit a warning if a test leaves running threads in the background.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.join_thread">
<code>test.support.join_thread(thread, timeout=30.0)</code> </dt> <dd>
<p>Join a <em>thread</em> within <em>timeout</em>. Raise an <a class="reference internal" href="exceptions#AssertionError" title="AssertionError"><code>AssertionError</code></a> if thread is still alive after <em>timeout</em> seconds.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.reap_children">
<code>test.support.reap_children()</code> </dt> <dd>
<p>Use this at the end of <code>test_main</code> whenever sub-processes are started. This will help ensure that no extra children (zombies) stick around to hog resources and create problems when looking for refleaks.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.get_attribute">
<code>test.support.get_attribute(obj, name)</code> </dt> <dd>
<p>Get an attribute, raising <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a> if <a class="reference internal" href="exceptions#AttributeError" title="AttributeError"><code>AttributeError</code></a> is raised.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.catch_threading_exception">
<code>test.support.catch_threading_exception()</code> </dt> <dd>
<p>Context manager catching <a class="reference internal" href="threading#threading.Thread" title="threading.Thread"><code>threading.Thread</code></a> exception using <a class="reference internal" href="threading#threading.excepthook" title="threading.excepthook"><code>threading.excepthook()</code></a>.</p> <p>Attributes set when an exception is catched:</p> <ul class="simple"> <li><code>exc_type</code></li> <li><code>exc_value</code></li> <li><code>exc_traceback</code></li> <li><code>thread</code></li> </ul> <p>See <a class="reference internal" href="threading#threading.excepthook" title="threading.excepthook"><code>threading.excepthook()</code></a> documentation.</p> <p>These attributes are deleted at the context manager exit.</p> <p>Usage:</p> <pre data-language="python">with support.catch_threading_exception() as cm:
    # code spawning a thread which raises an exception
    ...

    # check the thread exception, use cm attributes:
    # exc_type, exc_value, exc_traceback, thread
    ...

# exc_type, exc_value, exc_traceback, thread attributes of cm no longer
# exists at this point
# (to avoid reference cycles)
</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.8.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.catch_unraisable_exception">
<code>test.support.catch_unraisable_exception()</code> </dt> <dd>
<p>Context manager catching unraisable exception using <a class="reference internal" href="sys#sys.unraisablehook" title="sys.unraisablehook"><code>sys.unraisablehook()</code></a>.</p> <p>Storing the exception value (<code>cm.unraisable.exc_value</code>) creates a reference cycle. The reference cycle is broken explicitly when the context manager exits.</p> <p>Storing the object (<code>cm.unraisable.object</code>) can resurrect it if it is set to an object which is being finalized. Exiting the context manager clears the stored object.</p> <p>Usage:</p> <pre data-language="python">with support.catch_unraisable_exception() as cm:
    # code creating an "unraisable exception"
    ...

    # check the unraisable exception: use cm.unraisable
    ...

# cm.unraisable attribute no longer exists at this point
# (to break a reference cycle)
</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.8.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.load_package_tests">
<code>test.support.load_package_tests(pkg_dir, loader, standard_tests, pattern)</code> </dt> <dd>
<p>Generic implementation of the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> <code>load_tests</code> protocol for use in test packages. <em>pkg_dir</em> is the root directory of the package; <em>loader</em>, <em>standard_tests</em>, and <em>pattern</em> are the arguments expected by <code>load_tests</code>. In simple cases, the test package’s <code>__init__.py</code> can be the following:</p> <pre data-language="python">import os
from test.support import load_package_tests

def load_tests(*args):
    return load_package_tests(os.path.dirname(__file__), *args)
</pre> </dd>
</dl> <dl class="function"> <dt id="test.support.fs_is_case_insensitive">
<code>test.support.fs_is_case_insensitive(directory)</code> </dt> <dd>
<p>Return <code>True</code> if the file system for <em>directory</em> is case-insensitive.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.detect_api_mismatch">
<code>test.support.detect_api_mismatch(ref_api, other_api, *, ignore=())</code> </dt> <dd>
<p>Returns the set of attributes, functions or methods of <em>ref_api</em> not found on <em>other_api</em>, except for a defined list of items to be ignored in this check specified in <em>ignore</em>.</p> <p>By default this skips private attributes beginning with ‘_’ but includes all magic methods, i.e. those starting and ending in ‘__’.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.5.</span></p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.patch">
<code>test.support.patch(test_instance, object_to_patch, attr_name, new_value)</code> </dt> <dd>
<p>Override <em>object_to_patch.attr_name</em> with <em>new_value</em>. Also add cleanup procedure to <em>test_instance</em> to restore <em>object_to_patch</em> for <em>attr_name</em>. The <em>attr_name</em> should be a valid attribute for <em>object_to_patch</em>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.run_in_subinterp">
<code>test.support.run_in_subinterp(code)</code> </dt> <dd>
<p>Run <em>code</em> in subinterpreter. Raise <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a> if <a class="reference internal" href="tracemalloc#module-tracemalloc" title="tracemalloc: Trace memory allocations."><code>tracemalloc</code></a> is enabled.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.check_free_after_iterating">
<code>test.support.check_free_after_iterating(test, iter, cls, args=())</code> </dt> <dd>
<p>Assert that <em>iter</em> is deallocated after iterating.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.missing_compiler_executable">
<code>test.support.missing_compiler_executable(cmd_names=[])</code> </dt> <dd>
<p>Check for the existence of the compiler executables whose names are listed in <em>cmd_names</em> or all the compiler executables when <em>cmd_names</em> is empty and return the first missing executable or <code>None</code> when none is found missing.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.check__all__">
<code>test.support.check__all__(test_case, module, name_of_module=None, extra=(), blacklist=())</code> </dt> <dd>
<p>Assert that the <code>__all__</code> variable of <em>module</em> contains all public names.</p> <p>The module’s public names (its API) are detected automatically based on whether they match the public name convention and were defined in <em>module</em>.</p> <p>The <em>name_of_module</em> argument can specify (as a string or tuple thereof) what module(s) an API could be defined in order to be detected as a public API. One case for this is when <em>module</em> imports part of its public API from other modules, possibly a C backend (like <code>csv</code> and its <code>_csv</code>).</p> <p>The <em>extra</em> argument can be a set of names that wouldn’t otherwise be automatically detected as “public”, like objects without a proper <code>__module__</code> attribute. If provided, it will be added to the automatically detected ones.</p> <p>The <em>blacklist</em> argument can be a set of names that must not be treated as part of the public API even though their names indicate otherwise.</p> <p>Example use:</p> <pre data-language="python">import bar
import foo
import unittest
from test import support

class MiscTestCase(unittest.TestCase):
    def test__all__(self):
        support.check__all__(self, foo)

class OtherTestCase(unittest.TestCase):
    def test__all__(self):
        extra = {'BAR_CONST', 'FOO_CONST'}
        blacklist = {'baz'}  # Undocumented name.
        # bar imports part of its API from _bar.
        support.check__all__(self, bar, ('bar', '_bar'),
                             extra=extra, blacklist=blacklist)
</pre> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.6.</span></p> </div> </dd>
</dl> <p>The <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code>test.support</code></a> module defines the following classes:</p> <dl class="class"> <dt id="test.support.TransientResource">
<code>class test.support.TransientResource(exc, **kwargs)</code> </dt> <dd>
<p>Instances are a context manager that raises <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code>ResourceDenied</code></a> if the specified exception type is raised. Any keyword arguments are treated as attribute/value pairs to be compared against any exception raised within the <a class="reference internal" href="https://docs.python.org/3.9/reference/compound_stmts.html#with"><code>with</code></a> statement. Only if all pairs match properly against attributes on the exception is <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code>ResourceDenied</code></a> raised.</p> </dd>
</dl> <dl class="class"> <dt id="test.support.EnvironmentVarGuard">
<code>class test.support.EnvironmentVarGuard</code> </dt> <dd>
<p>Class used to temporarily set or unset environment variables. Instances can be used as a context manager and have a complete dictionary interface for querying/modifying the underlying <code>os.environ</code>. After exit from the context manager all changes to environment variables done through this instance will be rolled back.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.1: </span>Added dictionary interface.</p> </div> </dd>
</dl> <dl class="method"> <dt id="test.support.EnvironmentVarGuard.set">
<code>EnvironmentVarGuard.set(envvar, value)</code> </dt> <dd>
<p>Temporarily set the environment variable <code>envvar</code> to the value of <code>value</code>.</p> </dd>
</dl> <dl class="method"> <dt id="test.support.EnvironmentVarGuard.unset">
<code>EnvironmentVarGuard.unset(envvar)</code> </dt> <dd>
<p>Temporarily unset the environment variable <code>envvar</code>.</p> </dd>
</dl> <dl class="class"> <dt id="test.support.SuppressCrashReport">
<code>class test.support.SuppressCrashReport</code> </dt> <dd>
<p>A context manager used to try to prevent crash dialog popups on tests that are expected to crash a subprocess.</p> <p>On Windows, it disables Windows Error Reporting dialogs using <a class="reference external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms680621.aspx">SetErrorMode</a>.</p> <p>On UNIX, <a class="reference internal" href="resource#resource.setrlimit" title="resource.setrlimit"><code>resource.setrlimit()</code></a> is used to set <a class="reference internal" href="resource#resource.RLIMIT_CORE" title="resource.RLIMIT_CORE"><code>resource.RLIMIT_CORE</code></a>’s soft limit to 0 to prevent coredump file creation.</p> <p>On both platforms, the old value is restored by <a class="reference internal" href="https://docs.python.org/3.9/reference/datamodel.html#object.__exit__" title="object.__exit__"><code>__exit__()</code></a>.</p> </dd>
</dl> <dl class="class"> <dt id="test.support.CleanImport">
<code>class test.support.CleanImport(*module_names)</code> </dt> <dd>
<p>A context manager to force import to return a new module reference. This is useful for testing module-level behaviors, such as the emission of a DeprecationWarning on import. Example usage:</p> <pre data-language="python">with CleanImport('foo'):
    importlib.import_module('foo')  # New reference.
</pre> </dd>
</dl> <dl class="class"> <dt id="test.support.DirsOnSysPath">
<code>class test.support.DirsOnSysPath(*paths)</code> </dt> <dd>
<p>A context manager to temporarily add directories to sys.path.</p> <p>This makes a copy of <a class="reference internal" href="sys#sys.path" title="sys.path"><code>sys.path</code></a>, appends any directories given as positional arguments, then reverts <a class="reference internal" href="sys#sys.path" title="sys.path"><code>sys.path</code></a> to the copied settings when the context ends.</p> <p>Note that <em>all</em> <a class="reference internal" href="sys#sys.path" title="sys.path"><code>sys.path</code></a> modifications in the body of the context manager, including replacement of the object, will be reverted at the end of the block.</p> </dd>
</dl> <dl class="class"> <dt id="test.support.SaveSignals">
<code>class test.support.SaveSignals</code> </dt> <dd>
<p>Class to save and restore signal handlers registered by the Python signal handler.</p> </dd>
</dl> <dl class="class"> <dt id="test.support.Matcher">
<code>class test.support.Matcher</code> </dt> <dd>
<dl class="method"> <dt id="test.support.Matcher.matches">
<code>matches(self, d, **kwargs)</code> </dt> <dd>
<p>Try to match a single dict with the supplied arguments.</p> </dd>
</dl> <dl class="method"> <dt id="test.support.Matcher.match_value">
<code>match_value(self, k, dv, v)</code> </dt> <dd>
<p>Try to match a single stored value (<em>dv</em>) with a supplied value (<em>v</em>).</p> </dd>
</dl> </dd>
</dl> <dl class="class"> <dt id="test.support.WarningsRecorder">
<code>class test.support.WarningsRecorder</code> </dt> <dd>
<p>Class used to record warnings for unit tests. See documentation of <a class="reference internal" href="#test.support.check_warnings" title="test.support.check_warnings"><code>check_warnings()</code></a> above for more details.</p> </dd>
</dl> <dl class="class"> <dt id="test.support.BasicTestRunner">
<code>class test.support.BasicTestRunner</code> </dt> <dd>
<dl class="method"> <dt id="test.support.BasicTestRunner.run">
<code>run(test)</code> </dt> <dd>
<p>Run <em>test</em> and return the result.</p> </dd>
</dl> </dd>
</dl> <dl class="class"> <dt id="test.support.FakePath">
<code>class test.support.FakePath(path)</code> </dt> <dd>
<p>Simple <a class="reference internal" href="https://docs.python.org/3.9/glossary.html#term-path-like-object"><span class="xref std std-term">path-like object</span></a>. It implements the <code>__fspath__()</code> method which just returns the <em>path</em> argument. If <em>path</em> is an exception, it will be raised in <code>__fspath__()</code>.</p> </dd>
</dl>   <h1 id="test-support-socket-helper-utilities-for-socket-tests">test.support.socket_helper — Utilities for socket tests</h1> <p id="module-test.support.socket_helper">The <a class="reference internal" href="#module-test.support.socket_helper" title="test.support.socket_helper: Support for socket tests."><code>test.support.socket_helper</code></a> module provides support for socket tests.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.9.</span></p> </div> <dl class="data"> <dt id="test.support.socket_helper.IPV6_ENABLED">
<code>test.support.socket_helper.IPV6_ENABLED</code> </dt> <dd>
<p>Set to <code>True</code> if IPv6 is enabled on this host, <code>False</code> otherwise.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.socket_helper.find_unused_port">
<code>test.support.socket_helper.find_unused_port(family=socket.AF_INET, socktype=socket.SOCK_STREAM)</code> </dt> <dd>
<p>Returns an unused port that should be suitable for binding. This is achieved by creating a temporary socket with the same family and type as the <code>sock</code> parameter (default is <a class="reference internal" href="socket#socket.AF_INET" title="socket.AF_INET"><code>AF_INET</code></a>, <a class="reference internal" href="socket#socket.SOCK_STREAM" title="socket.SOCK_STREAM"><code>SOCK_STREAM</code></a>), and binding it to the specified host address (defaults to <code>0.0.0.0</code>) with the port set to 0, eliciting an unused ephemeral port from the OS. The temporary socket is then closed and deleted, and the ephemeral port is returned.</p> <p>Either this method or <a class="reference internal" href="#test.support.socket_helper.bind_port" title="test.support.socket_helper.bind_port"><code>bind_port()</code></a> should be used for any tests where a server socket needs to be bound to a particular port for the duration of the test. Which one to use depends on whether the calling code is creating a Python socket, or if an unused port needs to be provided in a constructor or passed to an external program (i.e. the <code>-accept</code> argument to openssl’s s_server mode). Always prefer <a class="reference internal" href="#test.support.socket_helper.bind_port" title="test.support.socket_helper.bind_port"><code>bind_port()</code></a> over <a class="reference internal" href="#test.support.socket_helper.find_unused_port" title="test.support.socket_helper.find_unused_port"><code>find_unused_port()</code></a> where possible. Using a hard coded port is discouraged since it can make multiple instances of the test impossible to run simultaneously, which is a problem for buildbots.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.socket_helper.bind_port">
<code>test.support.socket_helper.bind_port(sock, host=HOST)</code> </dt> <dd>
<p>Bind the socket to a free port and return the port number. Relies on ephemeral ports in order to ensure we are using an unbound port. This is important as many tests may be running simultaneously, especially in a buildbot environment. This method raises an exception if the <code>sock.family</code> is <a class="reference internal" href="socket#socket.AF_INET" title="socket.AF_INET"><code>AF_INET</code></a> and <code>sock.type</code> is <a class="reference internal" href="socket#socket.SOCK_STREAM" title="socket.SOCK_STREAM"><code>SOCK_STREAM</code></a>, and the socket has <code>SO_REUSEADDR</code> or <code>SO_REUSEPORT</code> set on it. Tests should never set these socket options for TCP/IP sockets. The only case for setting these options is testing multicasting via multiple UDP sockets.</p> <p>Additionally, if the <code>SO_EXCLUSIVEADDRUSE</code> socket option is available (i.e. on Windows), it will be set on the socket. This will prevent anyone else from binding to our host/port for the duration of the test.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.socket_helper.bind_unix_socket">
<code>test.support.socket_helper.bind_unix_socket(sock, addr)</code> </dt> <dd>
<p>Bind a unix socket, raising <a class="reference internal" href="unittest#unittest.SkipTest" title="unittest.SkipTest"><code>unittest.SkipTest</code></a> if <a class="reference internal" href="exceptions#PermissionError" title="PermissionError"><code>PermissionError</code></a> is raised.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.socket_helper.skip_unless_bind_unix_socket">
<code>@test.support.socket_helper.skip_unless_bind_unix_socket</code> </dt> <dd>
<p>A decorator for running tests that require a functional <code>bind()</code> for Unix sockets.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.socket_helper.transient_internet">
<code>test.support.socket_helper.transient_internet(resource_name, *, timeout=30.0, errnos=())</code> </dt> <dd>
<p>A context manager that raises <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code>ResourceDenied</code></a> when various issues with the internet connection manifest themselves as exceptions.</p> </dd>
</dl>   <h1 id="test-support-script-helper-utilities-for-the-python-execution-tests">test.support.script_helper — Utilities for the Python execution tests</h1> <p id="module-test.support.script_helper">The <a class="reference internal" href="#module-test.support.script_helper" title="test.support.script_helper: Support for Python's script execution tests."><code>test.support.script_helper</code></a> module provides support for Python’s script execution tests.</p> <dl class="function"> <dt id="test.support.script_helper.interpreter_requires_environment">
<code>test.support.script_helper.interpreter_requires_environment()</code> </dt> <dd>
<p>Return <code>True</code> if <code>sys.executable interpreter</code> requires environment variables in order to be able to run at all.</p> <p>This is designed to be used with <code>@unittest.skipIf()</code> to annotate tests that need to use an <code>assert_python*()</code> function to launch an isolated mode (<code>-I</code>) or no environment mode (<code>-E</code>) sub-interpreter process.</p> <p>A normal build &amp; test does not run into this situation but it can happen when trying to run the standard library test suite from an interpreter that doesn’t have an obvious home with Python’s current home finding logic.</p> <p>Setting <a class="reference internal" href="https://docs.python.org/3.9/using/cmdline.html#envvar-PYTHONHOME" id="index-2"><code>PYTHONHOME</code></a> is one way to get most of the testsuite to run in that situation. <a class="reference internal" href="https://docs.python.org/3.9/using/cmdline.html#envvar-PYTHONPATH" id="index-3"><code>PYTHONPATH</code></a> or <code id="index-4">PYTHONUSERSITE</code> are other common environment variables that might impact whether or not the interpreter can start.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.run_python_until_end">
<code>test.support.script_helper.run_python_until_end(*args, **env_vars)</code> </dt> <dd>
<p>Set up the environment based on <em>env_vars</em> for running the interpreter in a subprocess. The values can include <code>__isolated</code>, <code>__cleanenv</code>, <code>__cwd</code>, and <code>TERM</code>.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.9: </span>The function no longer strips whitespaces from <em>stderr</em>.</p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.assert_python_ok">
<code>test.support.script_helper.assert_python_ok(*args, **env_vars)</code> </dt> <dd>
<p>Assert that running the interpreter with <em>args</em> and optional environment variables <em>env_vars</em> succeeds (<code>rc == 0</code>) and return a <code>(return code,
stdout, stderr)</code> tuple.</p> <p>If the <code>__cleanenv</code> keyword is set, <em>env_vars</em> is used as a fresh environment.</p> <p>Python is started in isolated mode (command line option <code>-I</code>), except if the <code>__isolated</code> keyword is set to <code>False</code>.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.9: </span>The function no longer strips whitespaces from <em>stderr</em>.</p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.assert_python_failure">
<code>test.support.script_helper.assert_python_failure(*args, **env_vars)</code> </dt> <dd>
<p>Assert that running the interpreter with <em>args</em> and optional environment variables <em>env_vars</em> fails (<code>rc != 0</code>) and return a <code>(return code,
stdout, stderr)</code> tuple.</p> <p>See <a class="reference internal" href="#test.support.script_helper.assert_python_ok" title="test.support.script_helper.assert_python_ok"><code>assert_python_ok()</code></a> for more options.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.9: </span>The function no longer strips whitespaces from <em>stderr</em>.</p> </div> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.spawn_python">
<code>test.support.script_helper.spawn_python(*args, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, **kw)</code> </dt> <dd>
<p>Run a Python subprocess with the given arguments.</p> <p><em>kw</em> is extra keyword args to pass to <a class="reference internal" href="subprocess#subprocess.Popen" title="subprocess.Popen"><code>subprocess.Popen()</code></a>. Returns a <a class="reference internal" href="subprocess#subprocess.Popen" title="subprocess.Popen"><code>subprocess.Popen</code></a> object.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.kill_python">
<code>test.support.script_helper.kill_python(p)</code> </dt> <dd>
<p>Run the given <a class="reference internal" href="subprocess#subprocess.Popen" title="subprocess.Popen"><code>subprocess.Popen</code></a> process until completion and return stdout.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.make_script">
<code>test.support.script_helper.make_script(script_dir, script_basename, source, omit_suffix=False)</code> </dt> <dd>
<p>Create script containing <em>source</em> in path <em>script_dir</em> and <em>script_basename</em>. If <em>omit_suffix</em> is <code>False</code>, append <code>.py</code> to the name. Return the full script path.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.make_zip_script">
<code>test.support.script_helper.make_zip_script(zip_dir, zip_basename, script_name, name_in_zip=None)</code> </dt> <dd>
<p>Create zip file at <em>zip_dir</em> and <em>zip_basename</em> with extension <code>zip</code> which contains the files in <em>script_name</em>. <em>name_in_zip</em> is the archive name. Return a tuple containing <code>(full path, full path of archive name)</code>.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.make_pkg">
<code>test.support.script_helper.make_pkg(pkg_dir, init_source='')</code> </dt> <dd>
<p>Create a directory named <em>pkg_dir</em> containing an <code>__init__</code> file with <em>init_source</em> as its contents.</p> </dd>
</dl> <dl class="function"> <dt id="test.support.script_helper.make_zip_pkg">
<code>test.support.script_helper.make_zip_pkg(zip_dir, zip_basename, pkg_name, script_basename, source, depth=1, compiled=False)</code> </dt> <dd>
<p>Create a zip package directory with a path of <em>zip_dir</em> and <em>zip_basename</em> containing an empty <code>__init__</code> file and a file <em>script_basename</em> containing the <em>source</em>. If <em>compiled</em> is <code>True</code>, both source files will be compiled and added to the zip package. Return a tuple of the full zip path and the archive name for the zip file.</p> </dd>
</dl>   <h1 id="test-support-bytecode-helper-support-tools-for-testing-correct-bytecode-generation">test.support.bytecode_helper — Support tools for testing correct bytecode generation</h1> <p id="module-test.support.bytecode_helper">The <a class="reference internal" href="#module-test.support.bytecode_helper" title="test.support.bytecode_helper: Support tools for testing correct bytecode generation."><code>test.support.bytecode_helper</code></a> module provides support for testing and inspecting bytecode generation.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.9.</span></p> </div> <p>The module defines the following class:</p> <dl class="class"> <dt id="test.support.bytecode_helper.BytecodeTestCase">
<code>class test.support.bytecode_helper.BytecodeTestCase(unittest.TestCase)</code> </dt> <dd>
<p>This class has custom assertion methods for inspecting bytecode.</p> </dd>
</dl> <dl class="method"> <dt id="test.support.bytecode_helper.BytecodeTestCase.get_disassembly_as_string">
<code>BytecodeTestCase.get_disassembly_as_string(co)</code> </dt> <dd>
<p>Return the disassembly of <em>co</em> as string.</p> </dd>
</dl> <dl class="method"> <dt id="test.support.bytecode_helper.BytecodeTestCase.assertInBytecode">
<code>BytecodeTestCase.assertInBytecode(x, opname, argval=_UNSPECIFIED)</code> </dt> <dd>
<p>Return instr if <em>opname</em> is found, otherwise throws <a class="reference internal" href="exceptions#AssertionError" title="AssertionError"><code>AssertionError</code></a>.</p> </dd>
</dl> <dl class="method"> <dt id="test.support.bytecode_helper.BytecodeTestCase.assertNotInBytecode">
<code>BytecodeTestCase.assertNotInBytecode(x, opname, argval=_UNSPECIFIED)</code> </dt> <dd>
<p>Throws <a class="reference internal" href="exceptions#AssertionError" title="AssertionError"><code>AssertionError</code></a> if <em>opname</em> is found.</p> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2021 Python Software Foundation<br>Licensed under the PSF License.<br>
    <a href="https://docs.python.org/3.9/library/test.html" class="_attribution-link">https://docs.python.org/3.9/library/test.html</a>
  </p>
</div>
