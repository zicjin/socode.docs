<h2 id="diagnostics-channel">Diagnostics Channel
</h2> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a> - Experimental</div>
 <p><strong>Source Code:</strong> <a href="https://github.com/nodejs/node/blob/v18.7.0/lib/diagnostics_channel.js">lib/diagnostics_channel.js</a></p> <p>The <code>node:diagnostics_channel</code> module provides an API to create named channels to report arbitrary message data for diagnostics purposes.</p> <p>It can be accessed using:</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');</pre> <p>It is intended that a module writer wanting to report diagnostics messages will create one or many top-level channels to report messages through. Channels may also be acquired at runtime but it is not encouraged due to the additional overhead of doing so. Channels may be exported for convenience, but as long as the name is known it can be acquired anywhere.</p> <p>If you intend for your module to produce diagnostics data for others to consume it is recommended that you include documentation of what named channels are used along with the shape of the message data. Channel names should generally include the module name to avoid collisions with data from other modules.</p> <section><h3 id="public-api">Public API
</h3> <h4 id="overview">Overview
</h4> <p>Following is a simple overview of the public API.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

// Get a reusable channel object
const channel = diagnostics_channel.channel('my-channel');

function onMessage(message, name) {
  // Received data
}

// Subscribe to the channel
diagnostics_channel.subscribe('my-channel', onMessage);

// Check if the channel has an active subscriber
if (channel.hasSubscribers) {
  // Publish data to the channel
  channel.publish({
    some: 'data'
  });
}

// Unsubscribe from the channel
diagnostics_channel.unsubscribe('my-channel', onMessage);</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

// Get a reusable channel object
const channel = diagnostics_channel.channel('my-channel');

function onMessage(message, name) {
  // Received data
}

// Subscribe to the channel
diagnostics_channel.subscribe('my-channel', onMessage);

// Check if the channel has an active subscriber
if (channel.hasSubscribers) {
  // Publish data to the channel
  channel.publish({
    some: 'data'
  });
}

// Unsubscribe from the channel
diagnostics_channel.unsubscribe('my-channel', onMessage);</pre> <h5 id="diagnostics_channel.hasSubscribers()">
<code>diagnostics_channel.hasSubscribers(name)</code>
</h5> <div class="api_metadata"> <span>Added in: v15.1.0, v14.17.0</span> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The channel name</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If there are active subscribers</li> </ul> <p>Check if there are active subscribers to the named channel. This is helpful if the message you want to send might be expensive to prepare.</p> <p>This API is optional but helpful when trying to publish messages from very performance-sensitive code.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

if (diagnostics_channel.hasSubscribers('my-channel')) {
  // There are subscribers, prepare and publish message
}</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

if (diagnostics_channel.hasSubscribers('my-channel')) {
  // There are subscribers, prepare and publish message
}</pre> <h5 id="diagnostics_channel.channel()">
<code>diagnostics_channel.channel(name)</code>
</h5> <div class="api_metadata"> <span>Added in: v15.1.0, v14.17.0</span> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The channel name</li> <li>Returns: <a href="diagnostics_channel#class-channel" class="type">&lt;Channel&gt;</a> The named channel object</li> </ul> <p>This is the primary entry-point for anyone wanting to publish to a named channel. It produces a channel object which is optimized to reduce overhead at publish time as much as possible.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

const channel = diagnostics_channel.channel('my-channel');</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

const channel = diagnostics_channel.channel('my-channel');</pre> <h5 id="diagnostics_channel.subscribe()">
<code>diagnostics_channel.subscribe(name, onMessage)</code>
</h5> <div class="api_metadata"> <span>Added in: v18.7.0</span> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The channel name</li> <li>
<code>onMessage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> The handler to receive channel messages <ul> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The message data</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The name of the channel</li> </ul> </li> </ul> <p>Register a message handler to subscribe to this channel. This message handler will be run synchronously whenever a message is published to the channel. Any errors thrown in the message handler will trigger an <a href="process#event-uncaughtexception"><code>'uncaughtException'</code></a>.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'diagnostics_channel';

diagnostics_channel.subscribe('my-channel', (message, name) =&gt; {
  // Received data
});</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('diagnostics_channel');

diagnostics_channel.subscribe('my-channel', (message, name) =&gt; {
  // Received data
});</pre> <h5 id="diagnostics_channel.unsubscribe()">
<code>diagnostics_channel.unsubscribe(name, onMessage)</code>
</h5> <div class="api_metadata"> <span>Added in: v18.7.0</span> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The channel name</li> <li>
<code>onMessage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> The previous subscribed handler to remove</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> <code>true</code> if the handler was found, <code>false</code> otherwise.</li> </ul> <p>Remove a message handler previously registered to this channel with <a href="#diagnostics_channelsubscribename-onmessage"><code>diagnostics_channel.subscribe(name, onMessage)</code></a>.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'diagnostics_channel';

function onMessage(message, name) {
  // Received data
}

diagnostics_channel.subscribe('my-channel', onMessage);

diagnostics_channel.unsubscribe('my-channel', onMessage);</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('diagnostics_channel');

function onMessage(message, name) {
  // Received data
}

diagnostics_channel.subscribe('my-channel', onMessage);

diagnostics_channel.unsubscribe('my-channel', onMessage);</pre> <h4 id="Channel">Class: <code>Channel</code>
</h4> <div class="api_metadata"> <span>Added in: v15.1.0, v14.17.0</span> </div> <p>The class <code>Channel</code> represents an individual named channel within the data pipeline. It is use to track subscribers and to publish messages when there are subscribers present. It exists as a separate object to avoid channel lookups at publish time, enabling very fast publish speeds and allowing for heavy use while incurring very minimal cost. Channels are created with <a href="#diagnostics_channelchannelname"><code>diagnostics_channel.channel(name)</code></a>, constructing a channel directly with <code>new Channel(name)</code> is not supported.</p> <h5 id="channel.hasSubscribers">
<code>channel.hasSubscribers</code>
</h5> <div class="api_metadata"> <span>Added in: v15.1.0, v14.17.0</span> </div> <ul> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If there are active subscribers</li> </ul> <p>Check if there are active subscribers to this channel. This is helpful if the message you want to send might be expensive to prepare.</p> <p>This API is optional but helpful when trying to publish messages from very performance-sensitive code.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

const channel = diagnostics_channel.channel('my-channel');

if (channel.hasSubscribers) {
  // There are subscribers, prepare and publish message
}</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

const channel = diagnostics_channel.channel('my-channel');

if (channel.hasSubscribers) {
  // There are subscribers, prepare and publish message
}</pre> <h5 id="channel.publish()">
<code>channel.publish(message)</code>
</h5> <div class="api_metadata"> <span>Added in: v15.1.0, v14.17.0</span> </div> <ul> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The message to send to the channel subscribers</li> </ul> <p>Publish a message to any subscribers to the channel. This will trigger message handlers synchronously so they will execute within the same context.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

const channel = diagnostics_channel.channel('my-channel');

channel.publish({
  some: 'message'
});</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

const channel = diagnostics_channel.channel('my-channel');

channel.publish({
  some: 'message'
});</pre> <h5 id="channel.subscribe()">
<code>channel.subscribe(onMessage)</code>
</h5> <div class="api_metadata"> <span>Added in: v15.1.0, v14.17.0</span><span>Deprecated since: v18.7.0</span> </div> 
<div class="api_stability api_stability_0">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 0</a> - Deprecated: Use <a href="#diagnostics_channelsubscribename-onmessage"><code>diagnostics_channel.subscribe(name, onMessage)</code></a>
</div>
 <ul> <li>
<code>onMessage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> The handler to receive channel messages <ul> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The message data</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The name of the channel</li> </ul> </li> </ul> <p>Register a message handler to subscribe to this channel. This message handler will be run synchronously whenever a message is published to the channel. Any errors thrown in the message handler will trigger an <a href="process#event-uncaughtexception"><code>'uncaughtException'</code></a>.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

const channel = diagnostics_channel.channel('my-channel');

channel.subscribe((message, name) =&gt; {
  // Received data
});</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

const channel = diagnostics_channel.channel('my-channel');

channel.subscribe((message, name) =&gt; {
  // Received data
});</pre> <h5 id="channel.unsubscribe()">
<code>channel.unsubscribe(onMessage)</code>
</h5> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v18.7.0</td> <td><p><span>Deprecated since: v18.7.0</span></p></td>
</tr> <tr>
<td>v15.1.0, v14.17.0</td> <td><p><span>Added in: v15.1.0, v14.17.0</span></p></td>
</tr> <tr>
<td>v17.1.0, v16.14.0, v14.19.0</td> <td><p>Added return value. Added to channels without subscribers.</p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_0">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 0</a> - Deprecated: Use <a href="#diagnostics_channelunsubscribename-onmessage"><code>diagnostics_channel.unsubscribe(name, onMessage)</code></a>
</div>
 <ul> <li>
<code>onMessage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> The previous subscribed handler to remove</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> <code>true</code> if the handler was found, <code>false</code> otherwise.</li> </ul> <p>Remove a message handler previously registered to this channel with <a href="#channelsubscribeonmessage"><code>channel.subscribe(onMessage)</code></a>.</p> <p class="module-type">MJS modules</p>
<pre data-language="js">import diagnostics_channel from 'node:diagnostics_channel';

const channel = diagnostics_channel.channel('my-channel');

function onMessage(message, name) {
  // Received data
}

channel.subscribe(onMessage);

channel.unsubscribe(onMessage);</pre>
<p class="module-type">CJS modules</p>
<pre data-language="js">const diagnostics_channel = require('node:diagnostics_channel');

const channel = diagnostics_channel.channel('my-channel');

function onMessage(message, name) {
  // Received data
}

channel.subscribe(onMessage);

channel.unsubscribe(onMessage);</pre> <h4 id="built-in-channels">Built-in Channels
</h4> <h5 id="http">HTTP
</h5> <p><code>http.client.request.start</code></p> <ul> <li>
<code>request</code> <a href="http#class-httpclientrequest" class="type">&lt;http.ClientRequest&gt;</a>
</li> </ul> <p>Emitted when client starts a request.</p> <p><code>http.client.response.finish</code></p> <ul> <li>
<code>request</code> <a href="http#class-httpclientrequest" class="type">&lt;http.ClientRequest&gt;</a>
</li> <li>
<code>response</code> <a href="http#class-httpincomingmessage" class="type">&lt;http.IncomingMessage&gt;</a>
</li> </ul> <p>Emitted when client receives a response.</p> <p><code>http.server.request.start</code></p> <ul> <li>
<code>request</code> <a href="http#class-httpincomingmessage" class="type">&lt;http.IncomingMessage&gt;</a>
</li> <li>
<code>response</code> <a href="http#class-httpserverresponse" class="type">&lt;http.ServerResponse&gt;</a>
</li> <li>
<code>socket</code> <a href="net#class-netsocket" class="type">&lt;net.Socket&gt;</a>
</li> <li>
<code>server</code> <a href="http#class-httpserver" class="type">&lt;http.Server&gt;</a>
</li> </ul> <p>Emitted when server receives a request.</p> <p><code>http.server.response.finish</code></p> <ul> <li>
<code>request</code> <a href="http#class-httpincomingmessage" class="type">&lt;http.IncomingMessage&gt;</a>
</li> <li>
<code>response</code> <a href="http#class-httpserverresponse" class="type">&lt;http.ServerResponse&gt;</a>
</li> <li>
<code>socket</code> <a href="net#class-netsocket" class="type">&lt;net.Socket&gt;</a>
</li> <li>
<code>server</code> <a href="http#class-httpserver" class="type">&lt;http.Server&gt;</a>
</li> </ul> <p>Emitted when server sends a response.</p></section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://nodejs.org/api/diagnostics_channel.html" class="_attribution-link" target="_blank">https://nodejs.org/api/diagnostics_channel.html</a>
  </p>
</div>
