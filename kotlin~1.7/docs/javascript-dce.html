<h1 data-toc="javascript-dce" id="javascript-dce.md">Kotlin/JS dead code elimination</h1>
<p id="ec30b292">The Kotlin/JS Gradle plugin includes a <em id="27ee6ea2" class=""><a href="https://wikipedia.org/wiki/Dead_code_elimination" id="c80cfd1c" data-external="true" rel="noopener noreferrer">dead code elimination</a></em> (<em id="7657287c" class="">DCE</em>) tool. Dead code elimination is often also called <em id="fd84403b" class="">tree shaking</em>. It reduces the size or the resulting JavaScript code by removing unused properties, functions, and classes.</p>
<p id="8fe71f25">Unused declarations can appear in cases like:</p>
<ul class="list _ul" id="ed86a541">
<li class="list__item" id="7e528006"><p>A function is inlined and never gets called directly (which happens always except for a few situations).</p></li>
<li class="list__item" id="937dfdb0"><p>A module uses a shared library. Without DCE, parts of the library that you don't use are still included in the resulting bundle. For example, the Kotlin standard library contains functions for manipulating lists, arrays, char sequences, adapters for DOM, and so on. All of this functionality would require about 1.3 MB as a JavaScript file. A simple "Hello, world" application only requires console routines, which is only few kilobytes for the entire file.</p></li>
</ul>
<p id="6fac3c3f">The Kotlin/JS Gradle plugin handles DCE automatically when you build a <b id="a10825fe" class="">production bundle</b>, for example by using the <code class="code ">browserProductionWebpack</code> task. <b id="b1474d79" class="">Development bundling</b> tasks (like <code class="code ">browserDevelopmentWebpack</code>) don't include DCE.</p>
<section class="chapter"><h2 id="exclude-declarations-from-dce" data-toc="javascript-dce#exclude-declarations-from-dce">Exclude declarations from DCE</h2>
<p id="5043a4f9">Sometimes you may need to keep a function or a class in the resulting JavaScript code even if you don't use it in your module, for example, if you're going to use it in the client JavaScript code.</p>
<p id="9dbede42">To keep certain declarations from elimination, add the <code class="code ">dceTask</code> block to your Gradle build script and list the declarations as arguments of the <code class="code ">keep</code> function. An argument must be the declaration's fully qualified name with the module name as a prefix: <code class="code ">moduleName.dot.separated.package.name.declarationName</code></p>
<aside data-type="note" class="prompt" data-title="" id="e3ac71d"><p id="13f817d">Unless specified otherwise, the names of functions and modules can be <a href="js-to-kotlin-interop#jsname-annotation" id="10400bf2">mangled</a> in the generated JavaScript code. To keep such functions from elimination, use the mangled names in the <code class="code ">keep</code> arguments as they appear in the generated JavaScript code.</p></aside><pre class="code" data-language="groovy">kotlin {
    js {
        browser {
            dceTask {
                keep("myKotlinJSModule.org.example.getName", "myKotlinJSModule.org.example.User" )
            }
            binaries.executable()
        }
    }
}
</pre>
<p id="1c9010ae">If you want to keep a whole package or module from elimination, you can use its fully qualified name as it appears in the generated JavaScript code.</p>
<aside data-type="note" class="prompt" data-title="" id="189ba08f"><p id="83f71fb4">Keeping whole packages or modules from elimination can prevent DCE from removing many unused declarations. Because of this, it is preferable to select individual declarations which should be excluded from DCE one by one.</p></aside></section><section class="chapter"><h2 id="disable-dce" data-toc="javascript-dce#disable-dce">Disable DCE</h2>
<p id="160096e1">To turn off DCE completely, use the <code class="code ">devMode</code> option in the <code class="code ">dceTask</code>:</p>
<pre class="code" data-language="groovy">kotlin {
    js {
        browser {
            dceTask {
                dceOptions.devMode = true
            }
        }
        binaries.executable()
    }
}
</pre></section><div class="last-modified"> Last modified: 08 August 2022</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="js-running-tests">Run tests in Kotlin/JS</a> <a class="navigation-links__next" href="js-ir-compiler">Kotlin/JS IR compiler</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/javascript-dce.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/javascript-dce.html</a>
  </p>
</div>
