<h1 data-toc="whatsnew-eap" id="whatsnew-eap.md">What's new in Kotlin 1.7.20-Beta</h1>
<p id="ea417b60"><em id="ea67db5e" class=""><a href="eap#build-details" id="2c32256d">Release date: 1 August 2022</a></em></p>
<aside data-type="note" class="prompt" data-title="" id="86f8ba15"><p id="c39d62fc">This document doesn't cover all of the features of the Early Access Preview (EAP) release, but highlights the new ones and some major improvements. See the full list of changes in the <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.7.20-Beta" id="7c2019c9" data-external="true" rel="noopener noreferrer">GitHub changelog</a>.</p></aside><p id="1782ca1e">The Kotlin 1.7.20-Beta release is out! Here are some highlights from this preview version of Kotlin:</p>
<ul class="list _ul" id="10491e00">
<li class="list__item" id="9d189a90"><p><a href="#support-for-kotlin-k2-compiler-plugins" id="64e2b845">The new Kotlin K2 compiler supports <code class="code ">all-open</code>, <code class="code ">no-arg</code>, Parcelize, and other compiler plugins</a></p></li>
<li class="list__item" id="471724ca"><p><a href="#preview-of-the-operator-for-creating-open-ended-ranges" id="6e19194c">We introduced the preview of the <code class="code ">..&lt;</code> operator for creating open-ended ranges</a></p></li>
<li class="list__item" id="954739cc"><p><a href="#the-new-kotlin-native-memory-manager-is-enabled-by-default" id="e9eccfe0">The new Kotlin/Native memory manager enabled by default</a></p></li>
<li class="list__item" id="4571bd1e"><p><a href="#generic-inline-classes" id="40c3dc35">We introduced a new experimental feature for JVM: inline classes with a generic underlying type</a></p></li>
</ul>
<section class="chapter"><h2 id="support-for-kotlin-k2-compiler-plugins" data-toc="whatsnew-eap#support-for-kotlin-k2-compiler-plugins">Support for Kotlin K2 compiler plugins</h2>
<p id="f0a90bb1">The Kotlin team continues to stabilize the K2 compiler. K2 is still in Alpha (as <a href="whatsnew17#new-kotlin-k2-compiler-for-the-jvm-in-alpha" id="9906b63c">announced in the Kotlin 1.7.0 release</a>), but now it supports several compiler plugins. You can follow <a href="https://youtrack.jetbrains.com/issue/KT-52604" id="9d033edf" data-external="true" rel="noopener noreferrer">this YouTrack issue</a> to get updates from the Kotlin team on the new compiler.</p>
<p id="f2170fca">Starting with this preview version, the Kotlin K2 compiler supports the following plugins:</p>
<ul class="list _ul" id="5de6ef02">
<li class="list__item" id="b9e694f6"><p><a href="all-open-plugin" id="50027b47"><code class="code ">all-open</code></a></p></li>
<li class="list__item" id="b885dd4c"><p><a href="no-arg-plugin" id="c1d9ed39"><code class="code ">no-arg</code></a></p></li>
<li class="list__item" id="eb7a05c7"><p>Parcelize</p></li>
<li class="list__item" id="56909a63"><p>AtomicFU</p></li>
<li class="list__item" id="48a486b2"><p><code class="code ">jvm-abi-gen</code></p></li>
</ul>
<p id="de1555e4">The Alpha version of the new K2 compiler only works with JVM projects. It doesn't support Kotlin/JS, Kotlin/Native, or other multi-platform projects.</p>
<p id="ed72918a">To enable the Kotlin K2 compiler and test it, use the following compiler option:</p>
<pre class="code" data-language="bash">-Xuse-k2
</pre>
<p id="bfe851c2">Learn more about the new compiler and its benefits in the following videos:</p>
<ul class="list _ul" id="8357fbef">
<li class="list__item" id="6c57515"><p><a href="https://www.youtube.com/watch?v=iTdJJq_LyoY" id="6c36d10e" data-external="true" rel="noopener noreferrer">The Road to the New Kotlin Compiler</a></p></li>
<li class="list__item" id="ff792032"><p><a href="https://www.youtube.com/watch?v=db19VFLZqJM" id="a38b2fdb" data-external="true" rel="noopener noreferrer">K2 Compiler: a Top-Down View</a></p></li>
</ul>
<section class="chapter"><h3 id="leave-your-feedback-on-the-new-k2-compiler" data-toc="whatsnew-eap#leave-your-feedback-on-the-new-k2-compiler">Leave your feedback on the new K2 compiler</h3>
<p id="a9fb5ba1">We really appreciate your feedback in any form:</p>
<ul class="list _ul" id="b66b341">
<li class="list__item" id="9cb80a3e"><p>Provide your feedback directly to K2 developers in Kotlin Slack: <a href="https://surveys.jetbrains.com/s3/kotlin-slack-sign-up?_gl=1*ju6cbn*_ga*MTA3MTk5NDkzMC4xNjQ2MDY3MDU4*_ga_9J976DJZ68*MTY1ODMzNzA3OS4xMDAuMS4xNjU4MzQwODEwLjYw" id="113e2028" data-external="true" rel="noopener noreferrer">get an invite</a> and join the <a href="https://kotlinlang.slack.com/archives/C03PK0PE257" id="478d7be5" data-external="true" rel="noopener noreferrer">#k2-early-adopters</a> channel</p></li>
<li class="list__item" id="ce3f4682"><p>Report any problems you faced with the new K2 compiler to <a href="https://youtrack.jetbrains.com/newIssue?project=KT&amp;c=Type%20Performance%20Problem&amp;c=Subsystems%20Frontend.%20IR" id="121a4347" data-external="true" rel="noopener noreferrer">our issue tracker</a></p></li>
</ul></section></section><section class="chapter"><h2 id="preview-of-the-operator-for-creating-open-ended-ranges" data-toc="whatsnew-eap#preview-of-the-operator-for-creating-open-ended-ranges">Preview of the ..&lt; operator for creating open-ended ranges</h2>
<aside data-type="warning" class="prompt" data-title="" id="34915e08"><p id="d2055482">The new operator is <a href="components-stability#stability-levels-explained" id="c1501e56">Experimental</a>, and it has limited support in the IDE.</p></aside><p id="9c34f055">This beta release introduces the new <code class="code ">..&lt;</code> operator. Kotlin has the <code class="code ">..</code> operator to express a range of values. The new <code class="code ">..&lt;</code> operator acts like the <code class="code ">until</code> function, and helps you define the open-ended range.</p>
<p id="206694a8">Our research shows that this new operator does a better job at expressing open-ended ranges and making it clear that the upper bound is not included.</p>
<p id="d25e827c">Here is an example of using the <code class="code ">..&lt;</code> operator in a <code class="code ">when</code> expression:</p>
<pre class="code" data-language="kotlin">when (value) {
    in 0.0..&lt;0.25 -&gt; // first quarter
    in 0.25..&lt;0.5 -&gt; // second quarter
    in 0.5..&lt;0.75 -&gt; // third quarter
    in 0.75..1.0 -&gt;  // last quarter  &lt;- note closed range here
}
</pre>
<section class="chapter"><h3 id="standard-library-api-changes" data-toc="whatsnew-eap#standard-library-api-changes">Standard library API changes</h3>
<p id="cab174f8">The following new types and operations will be introduced in the <code class="code ">kotlin.ranges</code> packages in the common Kotlin standard library:</p>
<section class="chapter"><h4 id="new-openendrange-interface" data-toc="whatsnew-eap#new-openendrange-interface">New OpenEndRange interface</h4>
<p id="4df511a">The new interface to represent open-ended ranges is very similar to the existing <code class="code ">ClosedRange&lt;T&gt;</code> interface:</p>
<pre class="code" data-language="kotlin">interface OpenEndRange&lt;T : Comparable&lt;T&gt;&gt; {
    // lower bound
    val start: T
    // upper bound, not included in the range
    val endExclusive: T
    operator fun contains(value: T): Boolean = value &gt;= start &amp;&amp; value &lt; endExclusive
    fun isEmpty(): Boolean = start &gt;= endExclusive
}
</pre></section><section class="chapter"><h4 id="implementing-openendrange-in-the-existing-iterable-ranges" data-toc="whatsnew-eap#implementing-openendrange-in-the-existing-iterable-ranges">Implementing OpenEndRange in the existing iterable ranges</h4>
<p id="aaa95818">Currently, in a situation when a user needs to get a range with excluded upper bound, they use <code class="code ">until</code> function producing a closed iterable range effectively with the same values. In order to make these ranges acceptable in the new API that takes <code class="code ">OpenEndRange&lt;T&gt;</code>, we want to implement that interface in the existing iterable ranges: <code class="code ">IntRange</code>,<code class="code ">LongRange</code>, <code class="code ">CharRange</code>, <code class="code ">UIntRange</code>, <code class="code ">ULongRange</code>. So they will be implementing both <code class="code ">ClosedRange&lt;T&gt;</code> and <code class="code ">OpenEndRange&lt;T&gt;</code> interfaces simultaneously.</p>
<pre class="code" data-language="kotlin">class IntRange : IntProgression(...), ClosedRange&lt;Int&gt;, OpenEndRange&lt;Int&gt; {
    override val start: Int
    override val endInclusive: Int
    override val endExclusive: Int
}
</pre></section><section class="chapter"><h4 id="rangeuntil-operators-for-the-standard-types" data-toc="whatsnew-eap#rangeuntil-operators-for-the-standard-types">rangeUntil operators for the standard types</h4>
<p id="22fb45ec"><code class="code ">rangeUntil</code> operators will be provided for the same types and their combinations that currently have <code class="code ">rangeTo</code> operator defined. For the purposes of prototype, we provide them as extension functions, but for consistency we plan to make them members later, before stabilizing the open-ended ranges API.</p></section></section><section class="chapter"><h3 id="how-to-enable-the-lt-operator" data-toc="whatsnew-eap#how-to-enable-the-lt-operator">How to enable the ..&lt; operator</h3>
<p id="afb22f30">In order to use the <code class="code ">..&lt;</code> operator or to implement that operator convention for your own types, you should enable the <code class="code ">-XXLanguage:+RangeUntilOperator</code>compiler option.</p>
<p id="849d5a71">The new API elements introduced to support the open-ended ranges of the standard types require an opt-in, as usual for an experimental stdlib API: <code class="code ">@OptIn(ExperimentalStdlibApi::class)</code>. Alternatively, you could use a compiler option: <code class="code ">-opt-in=kotlin.ExperimentalStdlibApi</code>.</p>
<p id="331bd20"><a href="https://github.com/kotlin/KEEP/blob/open-ended-ranges/proposals/open-ended-ranges.md" id="169e2c9f" data-external="true" rel="noopener noreferrer">Read more about the new operator in this KEEP document</a>.</p></section></section><section class="chapter"><h2 id="the-new-kotlin-native-memory-manager-is-enabled-by-default" data-toc="whatsnew-eap#the-new-kotlin-native-memory-manager-is-enabled-by-default">The new Kotlin/Native memory manager is enabled by default</h2>
<p id="27a1199c">Kotlin 1.7.20 comes with the new Kotlin/Native memory manager enabled by default. This release brings further stability and performance improvements, allowing us to promote the new memory manager to <a href="components-stability#stability-levels-explained" id="f0d0fd1f">Beta</a>.</p>
<p id="58fcfb5f">The previous memory manager made writing concurrent and asynchronous code complicated, including issues with implementing the <code class="code ">kotlinx.coroutines</code> library. This blocked the adoption of Kotlin Multiplatform Mobile because concurrency limitations created problems with sharing Kotlin code between iOS and Android platforms. The new memory manager finally paves the way to <a href="https://blog.jetbrains.com/kotlin/2022/05/kotlin-multiplatform-mobile-beta-roadmap-update/" id="1ac11e61" data-external="true" rel="noopener noreferrer">promote Kotlin Multiplatform Mobile to Beta</a>.</p>
<p id="45b7b3c1">The new memory manager also supports the compiler cache that makes compilation times comparable to previous releases. For more on the benefits of the new memory manager, see our original <a href="https://blog.jetbrains.com/kotlin/2021/08/try-the-new-kotlin-native-memory-manager-development-preview/" id="d3d19740" data-external="true" rel="noopener noreferrer">blog post</a> for the preview version. You can find more technical details in the <a href="https://github.com/JetBrains/kotlin/blob/master/kotlin-native/NEW_MM.md" id="2c79f045" data-external="true" rel="noopener noreferrer">migration instructions on GitHub</a>.</p>
<section class="chapter"><h3 id="configuration-and-setup" data-toc="whatsnew-eap#configuration-and-setup">Configuration and setup</h3>
<p id="277c9758">Starting with Kotlin 1.7.20, the new memory manager is the default. Not much additional setup is required.</p>
<p id="4163edc7">If you've already turned it on manually, you can remove the <code class="code ">kotlin.native.binary.memoryModel=experimental</code> option from your <code class="code ">gradle.properties</code> or <code class="code ">binaryOptions["memoryModel"] = "experimental"</code> from the <code class="code ">build.gradle(.kts)</code> file.</p>
<p id="21c16c1d">If it's necessary, you can switch back to the legacy memory manager with the <code class="code ">kotlin.native.binary.memoryModel=strict</code> option in your <code class="code ">gradle.properties</code>. However, compiler cache support is not available for the legacy memory manager anymore, so compilation times might become worse.</p>
<section class="chapter"><h4 id="freezing" data-toc="whatsnew-eap#freezing">Freezing</h4>
<p id="2f965474">In the new memory manager, freezing is deprecated. Don't use it unless you need your code to work with the legacy manager (where freezing is still required). This may be helpful for library authors that need to maintain support for the legacy memory manager or developers who want to have a fallback if they encounter issues with the new memory manager.</p>
<p id="78b84e5d">In such cases, you can temporarily support code for both new and legacy memory managers. To ignore deprecation warnings, do one of the following:</p>
<ul class="list _ul" id="e74e425f">
<li class="list__item" id="1b7b7776"><p>Annotate usages of the deprecated API with <code class="code ">@OptIn(FreezingIsDeprecated::class)</code>.</p></li>
<li class="list__item" id="e47088e3"><p>Apply <code class="code ">languageSettings.optIn("kotlin.native.FreezingIsDeprecated")</code> to all the Kotlin source sets in Gradle.</p></li>
<li class="list__item" id="7923c81e"><p>Pass the compiler flag <code class="code ">-opt-in=kotlin.native.FreezingIsDeprecated</code>.</p></li>
</ul></section><section class="chapter"><h4 id="calling-kotlin-suspending-functions-from-swift-objective-c" data-toc="whatsnew-eap#calling-kotlin-suspending-functions-from-swift-objective-c">Calling Kotlin suspending functions from Swift/Objective-C</h4>
<p id="393d5e88">The new memory manager still has a restriction on calling Kotlin <code class="code ">suspend</code> functions from Swift and Objective-C from threads other than the main one, but you can lift it with a new Gradle option.</p>
<p id="64be8509">This restriction was originally introduced in the legacy memory manager due to cases where the code dispatched a continuation to be resumed on the original thread. If this thread didn't have a supported event loop, the task would never run, and the coroutine would never be resumed.</p>
<p id="58012f56">In certain cases, this restriction is no longer required, but a check of all the necessary conditions can't be easily implemented. Because of this, we decided to keep it in the new memory manager, while introducing an option for you to disable it. For this, add the following option to your <code class="code ">gradle.properties</code>:</p>
<pre class="code" data-language="none">kotlin.native.binary.objcExportSuspendFunctionLaunchThreadRestriction=none
</pre>
<aside data-type="warning" class="prompt" data-title="" id="8d73d2e7"><p id="bb94da8d">Do not add this option if you use the <code class="code ">native-mt</code> version of <code class="code ">kotlinx.coroutines</code> or other libraries that have the same "dispatch to the original thread" approach.</p></aside><p id="3e614fb3">The Kotlin team is very grateful to <a href="https://github.com/ahmedre" id="48e5f35d" data-external="true" rel="noopener noreferrer">Ahmed El-Helw</a> for implementing this option.</p></section></section><section class="chapter"><h3 id="leave-your-feedback" data-toc="whatsnew-eap#leave-your-feedback">Leave your feedback</h3>
<p id="6a2b62b9">This is a significant change to our ecosystem. We would appreciate your feedback to help make it even better.</p>
<p id="7bc44e7">Try the new memory manager on your projects and <a href="https://youtrack.jetbrains.com/issue/KT-48525" id="2f28b15f" data-external="true" rel="noopener noreferrer">share feedback in our issue tracker, YouTrack</a>.</p></section></section><section class="chapter"><h2 id="generic-inline-classes" data-toc="whatsnew-eap#generic-inline-classes">Generic inline classes</h2>
<aside data-type="warning" class="prompt" data-title="" id="e6cdd319"><p id="36676e26">Generic inline classes is an <a href="components-stability#stability-levels-explained" id="d06b297">Experimental</a> feature. It may be dropped or changed at any time. Opt-in is required (see details below), and you should use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://youtrack.jetbrains.com/issue/KT-52994" id="8b87bc0e" data-external="true" rel="noopener noreferrer">YouTrack</a>.</p></aside><p id="7f0adb59">Kotlin 1.7.20-Beta allows the underlying type of JVM inline classes to be a type parameter. The compiler maps it to <code class="code ">Any?</code> or, generally, to the upper bound of the type parameter.</p>
<p id="4b7b9457">Consider the following example:</p>
<pre class="code" data-language="kotlin">@JvmInline
value class IC&lt;T&gt;(val a: T)

fun foo(s: IC&lt;String&gt;) {} // compiler generates fun foo-&lt;hash&gt;(s: Any?)
</pre>
<p id="90142df5">The function accepts the inline class as a parameter. The parameter is mapped to the upper bound and not to the type argument.</p>
<p id="c0d033a0">To enable this feature, use the <code class="code ">-language-version 1.8</code> compiler option.</p></section><section class="chapter"><h2 id="how-to-update-to-the-kotlin-1-7-20-beta" data-toc="whatsnew-eap#how-to-update-to-the-kotlin-1-7-20-beta">How to update to the Kotlin 1.7.20-Beta</h2>
<p id="58c159b4">Install Kotlin 1.7.20-Beta in any of the following ways:</p>
<ul class="list _ul" id="23c04268">
<li class="list__item" id="3ff27e17"><p>If you use the <em id="6f5f6995" class="">Early Access Preview</em> update channel, the IDE will suggest automatically updating to 1.7.20-Beta as soon as it becomes available.</p></li>
<li class="list__item" id="6ea3ba64"><p>If you use the <em id="62c79d1a" class="">Stable</em> update channel, you can change the channel to <em id="3bee436d" class="">Early Access Preview</em> at any time by selecting <b id="2fe5eee6" class="">Tools</b> | <b id="cdc0c89d" class="">Kotlin</b> | <b id="c8086c35" class="">Configure Kotlin Plugin Updates</b> in your IDE. You'll then be able to install the latest preview release. Check out <a href="install-eap-plugin" id="ac4d66fb">these instructions</a> for details.</p></li>
</ul>
<p id="82372f4">Once you've installed 1.7.20-Beta, don't forget to <a href="configure-build-for-eap" id="acda160d">change the Kotlin version</a> to 1.7.20-Beta in your build scripts.</p></section><div class="last-modified"> Last modified: 08 August 2022</div>

<div class="navigation-links _bottom"> <a class="navigation-links__prev" href="whatsnew11">What's new in Kotlin 1.1</a> <a class="navigation-links__next" href="eap">Participate in the Kotlin Early Access Preview</a> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://kotlinlang.org/docs/whatsnew-eap.html" class="_attribution-link" target="_blank">https://kotlinlang.org/docs/whatsnew-eap.html</a>
  </p>
</div>
