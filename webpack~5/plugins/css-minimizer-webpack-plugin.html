<h1>CssMinimizerWebpackPlugin</h1>
<div> <p>This plugin uses <a href="https://cssnano.co/">cssnano</a> to optimize and minify your CSS.</p> <p>Just like <a href="https://github.com/NMFR/optimize-css-assets-webpack-plugin">optimize-css-assets-webpack-plugin</a> but more accurate with source maps and assets using query string, allows to cache and works in parallel mode.</p> <h2 id="getting-started">Getting Started
</h2> <p>To begin, you'll need to install <code>css-minimizer-webpack-plugin</code>:</p> <pre data-language="console">$ npm install css-minimizer-webpack-plugin --save-dev
</pre> <p>Then add the plugin to your <code>webpack</code> configuration. For example:</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">const MiniCssExtractPlugin = require("mini-css-extract-plugin");
const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");

module.exports = {
  module: {
    rules: [
      {
        test: /.s?css$/,
        use: [MiniCssExtractPlugin.loader, "css-loader", "sass-loader"],
      },
    ],
  },
  optimization: {
    minimizer: [
      // For webpack@5 you can use the `...` syntax to extend existing minimizers (i.e. `terser-webpack-plugin`), uncomment the next line
      // `...`,
      new CssMinimizerPlugin(),
    ],
  },
};</pre> <p>This will enable CSS optimization only in production mode.</p> <p>If you want to run it also in development set the <code>optimization.minimize</code> option to <code>true</code>:</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">// [...]
module.exports = {
  optimization: {
    // [...]
    minimize: true,
  },
};</pre> <p>And run <code>webpack</code> via your preferred method.</p> <h2 id="note-about-source-maps">Note about source maps
</h2> <p><strong>Works only with <code>source-map</code>, <code>inline-source-map</code>, <code>hidden-source-map</code> and <code>nosources-source-map</code> values for the <a href="../configuration/devtool"><code>devtool</code></a> option.</strong></p> <p>Why? Because CSS support only these source map types.</p> <p>The plugin respect the <a href="../configuration/devtool"><code>devtool</code></a> and using the <code>SourceMapDevToolPlugin</code> plugin. Using supported <code>devtool</code> values enable source map generation. Using <code>SourceMapDevToolPlugin</code> with enabled the <code>columns</code> option enables source map generation.</p> <p>Use source maps to map error message locations to modules (this slows down the compilation). If you use your own <code>minify</code> function please read the <code>minify</code> section for handling source maps correctly.</p> <h2 id="options">Options
</h2> <h3 id="test">
<code>test</code>
</h3> <p>Type: <code>String|RegExp|Array&lt;String|RegExp&gt;</code> - default: <code>/\.css(\?.*)?$/i</code></p> <p>Test to match files against.</p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        test: /\.foo\.css$/i,
      }),
    ],
  },
};</pre> <h3 id="include">
<code>include</code>
</h3> <p>Type: <code>String|RegExp|Array&lt;String|RegExp&gt;</code> Default: <code>undefined</code></p> <p>Files to include.</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        include: /\/includes/,
      }),
    ],
  },
};</pre> <h3 id="exclude">
<code>exclude</code>
</h3> <p>Type: <code>String|RegExp|Array&lt;String|RegExp&gt;</code> Default: <code>undefined</code></p> <p>Files to exclude.</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        exclude: /\/excludes/,
      }),
    ],
  },
};</pre> <h3 id="parallel">
<code>parallel</code>
</h3> <p>Type: <code>Boolean|Number</code> Default: <code>true</code></p> <p>Use multi-process parallel running to improve the build speed. Default number of concurrent runs: <code>os.cpus().length - 1</code>.</p> <blockquote> <p>ℹ️ Parallelization can speedup your build significantly and is therefore <strong>highly recommended</strong>. If a parallelization is enabled, the packages in <code>minimizerOptions</code> must be required via strings (<code>packageName</code> or <code>require.resolve(packageName)</code>). Read more in <a href="#minimizeroptions"><code>minimizerOptions</code></a></p> </blockquote> <h4 id="boolean">
<code>Boolean</code>
</h4> <p>Enable/disable multi-process parallel running.</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        parallel: true,
      }),
    ],
  },
};</pre> <h4 id="number">
<code>Number</code>
</h4> <p>Enable multi-process parallel running and set number of concurrent runs.</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        parallel: 4,
      }),
    ],
  },
};</pre> <h3 id="minify">
<code>minify</code>
</h3> <p>Type: <code>Function|Array&lt;Function&gt;</code> Default: <code>CssMinimizerPlugin.cssnanoMinify</code></p> <p>Allows to override default minify function. By default plugin uses <a href="https://github.com/cssnano/cssnano">cssnano</a> package. Useful for using and testing unpublished versions or forks.</p> <p>Possible options:</p> <ul> <li>CssMinimizerPlugin.cssnanoMinify</li> <li>CssMinimizerPlugin.cssoMinify</li> <li>CssMinimizerPlugin.cleanCssMinify</li> <li>async (data, inputMap, minimizerOptions) =&gt; {return {code: <code>a{color: red}</code>, map: <code>...</code>, warnings: []}}</li> </ul> <blockquote> <p>⚠️ <strong>Always use <code>require</code> inside <code>minify</code> function when <code>parallel</code> option enabled</strong>.</p> </blockquote> <h4 id="function">
<code>Function</code>
</h4> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minimizerOptions: {
          level: {
            1: {
              roundingPrecision: "all=3,px=5",
            },
          },
        },
        minify: CssMinimizerPlugin.cleanCssMinify,
      }),
    ],
  },
};</pre> <h4 id="array">
<code>Array</code>
</h4> <p>If an array of functions is passed to the <code>minify</code> option, the <code>minimizerOptions</code> must also be an array. The function index in the <code>minify</code> array corresponds to the options object with the same index in the <code>minimizerOptions</code> array.</p> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minimizerOptions: [
          {}, // Options for the first function (CssMinimizerPlugin.cssnanoMinify)
          {}, // Options for the second function (CssMinimizerPlugin.cleanCssMinify)
          {}, // Options for the third function
        ],
        minify: [
          CssMinimizerPlugin.cssnanoMinify,
          CssMinimizerPlugin.cleanCssMinify,
          async (data, inputMap, minimizerOptions) =&gt; {
            // To do something
            return {
              code: `a{color: red}`,
              map: `{"version": "3", ...}`,
              warnings: [],
            };
          },
        ],
      }),
    ],
  },
};</pre> <h3 id="minimizeroptions">
<code>minimizerOptions</code>
</h3> <p>Type: <code>Object|Array&lt;Object&gt;</code> Default: <code>{ preset: 'default' }</code></p> <p>Cssnano optimisations <a href="https://cssnano.co/docs/optimisations">options</a>.</p> <h4 id="object">
<code>Object</code>
</h4> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minimizerOptions: {
          preset: [
            "default",
            {
              discardComments: { removeAll: true },
            },
          ],
        },
      }),
    ],
  },
};</pre> <h4 id="array-1">
<code>Array</code>
</h4> <p>The function index in the <code>minify</code> array corresponds to the options object with the same index in the <code>minimizerOptions</code> array. If you use <code>minimizerOptions</code> like object, all <code>minify</code> function accept it.</p> <blockquote> <p>If a parallelization is enabled, the packages in <code>minimizerOptions</code> must be required via strings (<code>packageName</code> or <code>require.resolve(packageName)</code>). In this case, we shouldn't use <code>require</code>/<code>import</code>.</p> </blockquote> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minimizerOptions: {
          preset: require.resolve("cssnano-preset-simple"),
        },
      }),
    ],
  },
};</pre> <h4 id="processoroptions">
<code>processorOptions</code>
</h4> <p>Type: <code>Object</code> Default: <code>{ to: assetName, from: assetName }</code></p> <p>Allows to specify options <a href="https://postcss.org/api/#processoptions"><code>processoptions</code></a> for the cssnano. The <code>parser</code>,<code> stringifier</code> and <code>syntax</code> can be either a function or a string indicating the module that will be imported.</p> <blockquote> <p>⚠️ <strong>If a function is passed, the <code>parallel</code> option must be disabled.</strong>.</p> </blockquote> <pre data-language="js">import sugarss from "sugarss";

module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        parallel: false,
        minimizerOptions: {
          processorOptions: {
            parser: sugarss,
          },
        },
      }),
    ],
  },
};</pre> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minimizerOptions: {
          processorOptions: {
            parser: "sugarss",
          },
        },
      }),
    ],
  },
};</pre> <h3 id="warningsfilter">
<code>warningsFilter</code>
</h3> <p>Type: <code>Function&lt;(warning, file, source) -&gt; Boolean&gt;</code> Default: <code>() =&gt; true</code></p> <p>Allow to filter css-minimizer warnings (By default <a href="https://github.com/cssnano/cssnano">cssnano</a>). Return <code>true</code> to keep the warning, a falsy value (<code>false</code>/<code>null</code>/<code>undefined</code>) otherwise.</p> <blockquote> <p>⚠️ The <code>source</code> argument will contain <code>undefined</code> if you don't use source maps.</p> </blockquote> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        warningsFilter: (warning, file, source) =&gt; {
          if (/Dropping unreachable code/i.test(warning)) {
            return true;
          }

          if (/file\.css/i.test(file)) {
            return true;
          }

          if (/source\.css/i.test(source)) {
            return true;
          }

          return false;
        },
      }),
    ],
  },
};</pre> <h2 id="examples">Examples
</h2> <h3 id="use-sourcemaps">Use sourcemaps
</h3> <p>Don't forget to enable <code>sourceMap</code> options for all loaders.</p> <pre data-language="js">const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");

module.exports = {
  devtool: "source-map",
  module: {
    loaders: [
      {
        test: /.s?css$/,
        use: [
          MiniCssExtractPlugin.loader,
          { loader: "css-loader", options: { sourceMap: true } },
          { loader: "sass-loader", options: { sourceMap: true } },
        ],
      },
    ],
  },
  optimization: {
    minimizer: [new CssMinimizerPlugin()],
  },
};</pre> <h3 id="remove-all-comments">Remove all comments
</h3> <p>Remove all comments (including comments starting with <code>/*!</code>).</p> <pre data-language="js">module.exports = {
  optimization: {
    minimizer: [
      new CssMinimizerPlugin({
        minimizerOptions: {
          preset: [
            "default",
            {
              discardComments: { removeAll: true },
            },
          ],
        },
      }),
    ],
  },
};</pre> <h3 id="using-custom-minifier-csso">Using custom minifier <a href="https://github.com/css/csso">csso</a>
</h3> <p>By default plugin uses <a href="https://github.com/cssnano/cssnano">cssnano</a> package. It is possible to use another minify function.</p> <blockquote> <p>⚠️ <strong>Always use <code>require</code> inside <code>minify</code> function when <code>parallel</code> option enabled</strong>.</p> </blockquote> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  devtool: "source-map",
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minify: async (data, inputMap) =&gt; {
          const csso = require("csso");
          const sourcemap = require("source-map");

          const [[filename, input]] = Object.entries(data);
          const minifiedCss = csso.minify(input, {
            filename: filename,
            sourceMap: true,
          });

          if (inputMap) {
            minifiedCss.map.applySourceMap(
              new sourcemap.SourceMapConsumer(inputMap),
              filename
            );
          }

          return {
            code: minifiedCss.css,
            map: minifiedCss.map.toJSON(),
          };
        },
      }),
    ],
  },
};</pre> <h3 id="using-custom-minifier-clean-css">Using custom minifier <a href="https://github.com/jakubpawlowicz/clean-css">clean-css</a>
</h3> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  devtool: "source-map",
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minify: CssMinimizerPlugin.cleanCssMinify,
        // Uncomment this line for options
        // minimizerOptions: { compatibility: 'ie11,-properties.merging' },
      }),
    ],
  },
};</pre> <h3 id="using-custom-minifier-csso-1">Using custom minifier <a href="https://github.com/css/csso">csso</a>
</h3> <p><strong>webpack.config.js</strong></p> <pre data-language="js">module.exports = {
  devtool: "source-map",
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minify: CssMinimizerPlugin.cssoMinify,
        // Uncomment this line for options
        // minimizerOptions: { restructure: false },
      }),
    ],
  },
};</pre> <h2 id="contributing">Contributing
</h2> <p>Please take a moment to read our contributing guidelines if you haven't yet done so.</p> <p><a href="https://github.com/webpack-contrib/css-minimizer-webpack-plugin/blob/master/.github/CONTRIBUTING.md">CONTRIBUTING</a></p> <h2 id="license">License
</h2> <p><a href="https://github.com/webpack-contrib/css-minimizer-webpack-plugin/blob/master/LICENSE">MIT</a></p> </div>
<div class="print:hidden mt-20">
<a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline" href="https://github.com/webpack-contrib/css-minimizer-webpack-plugin/edit/master/README.md">Edit this page</a><span class="mx-5 text-black font-bold dark:text-white">·</span><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline">Print this page</a><span class="mx-5 text-black font-bold dark:text-white">·</span><a class="text-gray-500 dark:text-gray-500 text-sm cursor-pointer font-sans hover:underline" href="https://github.com/webpack-contrib/css-minimizer-webpack-plugin">Jump to repository</a>
</div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://webpack.js.org/plugins/css-minimizer-webpack-plugin" class="_attribution-link" target="_blank">https://webpack.js.org/plugins/css-minimizer-webpack-plugin</a>
  </p>
</div>
