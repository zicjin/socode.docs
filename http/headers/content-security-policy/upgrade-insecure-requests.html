<h1>CSP: upgrade-insecure-requests</h1>
<h1>CSP: upgrade-insecure-requests</h1>
<p> The HTTP <a href="../content-security-policy"><code>Content-Security-Policy</code></a> (CSP) <code>upgrade-insecure-requests</code> directive instructs user agents to treat all of a site's insecure URLs (those served over HTTP) as though they have been replaced with secure URLs (those served over HTTPS). This directive is intended for web sites with large numbers of insecure legacy URLs that need to be rewritten. </p> <div class="notecard note"> <p> <strong>Note:</strong> The <code>upgrade-insecure-requests</code> directive is evaluated before <a href="block-all-mixed-content"><code>block-all-mixed-content</code></a> and if it is set, the latter is effectively a no-op. It is recommended to set either directive, but not both, unless you want to force HTTPS on older browsers that do not force it after a redirect to HTTP. </p> </div> <p> The <code>upgrade-insecure-requests</code> directive will not ensure that users visiting your site via links on third-party sites will be upgraded to HTTPS for the top-level navigation and thus does not replace the <a href="../strict-transport-security"><code>Strict-Transport-Security</code></a> (<a href="https://developer.mozilla.org/en-US/docs/Glossary/HSTS">HSTS</a>) header, which should still be set with an appropriate <code>max-age</code> to ensure that users are not subject to SSL stripping attacks. </p>
<h2 id="syntax">Syntax</h2>
<pre class="notranslate">Content-Security-Policy: upgrade-insecure-requests;
</pre>
<h2 id="examples">Examples</h2>
<h3 id="using_the_http_header">Using the HTTP header</h3>
<pre class="notranslate">Content-Security-Policy: upgrade-insecure-requests;
</pre>
<h3 id="using_the_html_meta_element">Using the HTML meta element</h3>
<div class="code-example"><pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Content-Security-Policy<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upgrade-insecure-requests<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</pre></div> <p> With the above header set on a domain example.com that wants to migrate from HTTP to HTTPS, non-navigational insecure resource requests are automatically upgraded (first-party as well as third-party requests). </p> <div class="code-example"><pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://example.com/image.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://not-example.com/image.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</pre></div> <p> These URLs will be rewritten before the request is made, meaning that no insecure requests will hit the network. Note that, if the requested resource is not actually available via HTTPS, the request will fail without any fallback to HTTP. </p> <div class="code-example"><pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://example.com/image.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://not-example.com/image.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</pre></div> <p> Navigational upgrades to third-party resources brings a significantly higher potential for breakage, these are not upgraded: </p> <div class="code-example"><pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://example.com/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://not-example.com/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</pre></div>
<h3 id="finding_insecure_requests">Finding insecure requests</h3>
<p> With the help of the <a href="../content-security-policy-report-only"><code>Content-Security-Policy-Report-Only</code></a> header and the <a href="report-uri"><code>report-uri</code></a> directive, you can set-up an enforced policy and a reported policy like this: </p> <pre class="notranslate">Content-Security-Policy: upgrade-insecure-requests; default-src https:
Content-Security-Policy-Report-Only: default-src https:; report-uri /endpoint
</pre> <p> That way, you still upgrade insecure requests on your secure site, but the only monitoring policy is violated and reports insecure resources to your endpoint. </p>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="standard-table">
<thead><tr><th scope="col">Specification</th></tr></thead>
<tbody><tr><td><a href="https://w3c.github.io/webappsec-upgrade-insecure-requests/#delivery">Upgrade Insecure Requests <br><small># delivery</small></a></td></tr></tbody>
</table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
<th>WebView Android</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody><tr>
<th><code>upgrade-insecure-requests</code></th>
<td class="bc-supports-yes"><div>43</div></td>
<td class="bc-supports-yes"><div>17</div></td>
<td class="bc-supports-yes"><div>42</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>30</div></td>
<td class="bc-supports-yes"><div>10.1</div></td>
<td class="bc-supports-yes"><div>43</div></td>
<td class="bc-supports-yes"><div>43</div></td>
<td class="bc-supports-yes"><div>42</div></td>
<td class="bc-supports-yes"><div>30</div></td>
<td class="bc-supports-yes"><div>10.3</div></td>
<td class="bc-supports-yes"><div>4.0</div></td>
</tr></tbody>
</table>
<h2 id="see_also">See also</h2>
<ul> <li><a href="../content-security-policy"><code>Content-Security-Policy</code></a></li> <li>
<a href="../upgrade-insecure-requests"><code>Upgrade-Insecure-Requests</code></a> header</li> <li>
<a href="../strict-transport-security"><code>Strict-Transport-Security</code></a> (<a href="https://developer.mozilla.org/en-US/docs/Glossary/HSTS">HSTS</a>) header</li> <li><a href="block-all-mixed-content"><code>block-all-mixed-content</code></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">Mixed content</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/upgrade-insecure-requests" class="_attribution-link" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/upgrade-insecure-requests</a>
  </p>
</div>
