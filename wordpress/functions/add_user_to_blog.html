<h1>add_user_to_blog( int $blog_id, int $user_id, string $role )</h1>  <section> <p>Adds a user to a blog, along with specifying the user’s role.</p> </section> <div class="content-toc">  <section> <h2 id="description">Description</h2> <p>Use the <a href="../hooks/add_user_to_blog">‘add_user_to_blog’</a> action to fire an event when users are added to a blog.</p> </section>  <section> <h2 id="parameters">Parameters</h2> <dl> <dt>$blog_id</dt> <dd> <p class="desc"> <span class="type">(<span class="int">int</span>)</span> <span class="required">(Required)</span> <span class="description">ID of the blog the user is being added to.</span> </p> </dd> <dt>$user_id</dt> <dd> <p class="desc"> <span class="type">(<span class="int">int</span>)</span> <span class="required">(Required)</span> <span class="description">ID of the user being added.</span> </p> </dd> <dt>$role</dt> <dd> <p class="desc"> <span class="type">(<span class="string">string</span>)</span> <span class="required">(Required)</span> <span class="description">The role you want the user to have.</span> </p> </dd> </dl> </section>  <section> <h2 id="return">Return</h2> <p><span class="return-type">(true|<a href="../classes/wp_error">WP_Error</a>)</span> True on success or a <a href="../classes/wp_error">WP_Error</a> object if the user doesn't exist or could not be added.</p> </section>  <section> <h2 id="more-information">More Information</h2> <ul> <li>It does not check if the user is already a member of the blog before setting their role. If you don’t want to overwrite the role of a user if they are already a member of the blog, use <a href="is_user_member_of_blog">is_user_member_of_blog()</a> to check that first.</li> <li>You <em>do not</em> need to call <a href="switch_to_blog">switch_to_blog()</a> to switch to the blog you want to add the user to before calling this function. The function will switch to the blog itself, and restore the current blog before returning as well.</li> </ul> </section>  <section> <h2 id="source">Source</h2> <p> File: <a href="https://developer.wordpress.org/reference/files/wp-includes/ms-functions.php/">wp-includes/ms-functions.php</a> </p> <pre data-language="php">function add_user_to_blog( $blog_id, $user_id, $role ) {
	switch_to_blog( $blog_id );

	$user = get_userdata( $user_id );

	if ( ! $user ) {
		restore_current_blog();
		return new WP_Error( 'user_does_not_exist', __( 'The requested user does not exist.' ) );
	}

	/**
	 * Filters whether a user should be added to a site.
	 *
	 * @since 4.9.0
	 *
	 * @param true|WP_Error $retval  True if the user should be added to the site, error
	 *                               object otherwise.
	 * @param int           $user_id User ID.
	 * @param string        $role    User role.
	 * @param int           $blog_id Site ID.
	 */
	$can_add_user = apply_filters( 'can_add_user_to_blog', true, $user_id, $role, $blog_id );

	if ( true !== $can_add_user ) {
		restore_current_blog();

		if ( is_wp_error( $can_add_user ) ) {
			return $can_add_user;
		}

		return new WP_Error( 'user_cannot_be_added', __( 'User cannot be added to this site.' ) );
	}

	if ( ! get_user_meta( $user_id, 'primary_blog', true ) ) {
		update_user_meta( $user_id, 'primary_blog', $blog_id );
		$site = get_site( $blog_id );
		update_user_meta( $user_id, 'source_domain', $site-&gt;domain );
	}

	$user-&gt;set_role( $role );

	/**
	 * Fires immediately after a user is added to a site.
	 *
	 * @since MU (3.0.0)
	 *
	 * @param int    $user_id User ID.
	 * @param string $role    User role.
	 * @param int    $blog_id Blog ID.
	 */
	do_action( 'add_user_to_blog', $user_id, $role, $blog_id );

	clean_user_cache( $user_id );
	wp_cache_delete( $blog_id . '_user_count', 'blog-details' );

	restore_current_blog();

	return true;
}</pre>  </section>  <section> <h2 id="related">Related</h2> <article class="uses"> <h3 id="uses">Uses</h3> <table id="uses-table">  <thead> <tr> <th>Uses</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td> <span>wp-includes/ms-functions.php:</span> <a href="../hooks/can_add_user_to_blog">can_add_user_to_blog</a> </td> <td class="related-desc"> <p>Filters whether a user should be added to a site.</p> </td> </tr> <tr> <td> <span>wp-includes/ms-site.php:</span> <a href="get_site">get_site()</a> </td> <td class="related-desc"> <p>Retrieves site data given a site ID or site object.</p> </td> </tr> <tr> <td> <span>wp-includes/cache.php:</span> <a href="wp_cache_delete">wp_cache_delete()</a> </td> <td class="related-desc"> <p>Removes the cache contents matching key and group.</p> </td> </tr> <tr> <td> <span>wp-includes/l10n.php:</span> <a href="__">__()</a> </td> <td class="related-desc"> <p>Retrieve the translation of $text.</p> </td> </tr> <tr> <td> <span>wp-includes/pluggable.php:</span> <a href="get_userdata">get_userdata()</a> </td> <td class="related-desc"> <p>Retrieve user info by user ID.</p> </td> </tr> <tr> <td> <span>wp-includes/plugin.php:</span> <a href="apply_filters">apply_filters()</a> </td> <td class="related-desc"> <p>Calls the callback functions that have been added to a filter hook.</p> </td> </tr> <tr> <td> <span>wp-includes/plugin.php:</span> <a href="do_action">do_action()</a> </td> <td class="related-desc"> <p>Calls the callback functions that have been added to an action hook.</p> </td> </tr> <tr> <td> <span>wp-includes/user.php:</span> <a href="clean_user_cache">clean_user_cache()</a> </td> <td class="related-desc"> <p>Cleans all user caches.</p> </td> </tr> <tr> <td> <span>wp-includes/user.php:</span> <a href="get_user_meta">get_user_meta()</a> </td> <td class="related-desc"> <p>Retrieves user meta field for a user.</p> </td> </tr> <tr> <td> <span>wp-includes/user.php:</span> <a href="update_user_meta">update_user_meta()</a> </td> <td class="related-desc"> <p>Updates user meta field based on user ID.</p> </td> </tr> <tr> <td> <span>wp-includes/ms-functions.php:</span> <a href="../hooks/add_user_to_blog">add_user_to_blog</a> </td> <td class="related-desc"> <p>Fires immediately after a user is added to a site.</p> </td> </tr> <tr> <td> <span>wp-includes/ms-blogs.php:</span> <a href="switch_to_blog">switch_to_blog()</a> </td> <td class="related-desc"> <p>Switch the current blog.</p> </td> </tr> <tr> <td> <span>wp-includes/ms-blogs.php:</span> <a href="restore_current_blog">restore_current_blog()</a> </td> <td class="related-desc"> <p>Restore the current blog, after calling <a href="switch_to_blog">switch_to_blog()</a>.</p> </td> </tr> <tr> <td> <span>wp-includes/load.php:</span> <a href="is_wp_error">is_wp_error()</a> </td> <td class="related-desc"> <p>Checks whether the given variable is a WordPress Error.</p> </td> </tr> <tr> <td> <span>wp-includes/class-wp-error.php:</span> <a href="../classes/wp_error/__construct">WP_Error::__construct()</a> </td> <td class="related-desc"> <p>Initializes the error.</p> </td> </tr> </tbody>

</table>   </article>  <article class="used-by"> <h3 id="used-by">Used By</h3> <table id="used-by-table">  <thead> <tr> <th>Used By</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td> <span>wp-includes/ms-site.php:</span> <a href="wp_initialize_site">wp_initialize_site()</a> </td> <td class="related-desc"> <p>Runs the initialization routine for a given site.</p> </td> </tr> <tr> <td> <span>wp-includes/rest-api/endpoints/class-wp-rest-users-controller.php:</span> <a href="../classes/wp_rest_users_controller/create_item">WP_REST_Users_Controller::create_item()</a> </td> <td class="related-desc"> <p>Creates a single user.</p> </td> </tr> <tr> <td> <span>wp-includes/ms-functions.php:</span> <a href="add_existing_user_to_blog">add_existing_user_to_blog()</a> </td> <td class="related-desc"> <p>Adds a user to a blog based on details from <a href="maybe_add_existing_user_to_blog">maybe_add_existing_user_to_blog()</a>.</p> </td> </tr> <tr> <td> <span>wp-includes/ms-functions.php:</span> <a href="add_new_user_to_blog">add_new_user_to_blog()</a> </td> <td class="related-desc"> <p>Adds a newly created user to the appropriate blog</p> </td> </tr> <tr> <td> <span>wp-includes/ms-functions.php:</span> <a href="get_active_blog_for_user">get_active_blog_for_user()</a> </td> <td class="related-desc"> <p>Gets one of a user’s active blogs.</p> </td> </tr> </tbody>

</table> </article> </section>  <section> <h2 id="changelog">Changelog</h2> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/mu.3.0.0/" alt="WordPress MU (3.0.0)">MU (3.0.0)</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section>    </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.wordpress.org/reference/functions/add_user_to_blog" class="_attribution-link" target="_blank">https://developer.wordpress.org/reference/functions/add_user_to_blog</a>
  </p>
</div>
