<h1>WP_Community_Events::get_events( string $location_search = '', string $timezone = '' )</h1>  <section> <p>Gets data about events near a particular location.</p> </section> <div class="content-toc">  <section> <h2 id="description">Description</h2> <p>Cached events will be immediately returned if the <code>user_location</code> property is set for the current user, and cached events exist for that location.</p> <p>Otherwise, this method sends a request to the w.org Events API with location data. The API will send back a recognized location based on the data, along with nearby events.</p> <p>The browser’s request for events is proxied with this method, rather than having the browser make the request directly to api.wordpress.org, because it allows results to be cached server-side and shared with other users and sites in the network. This makes the process more efficient, since increasing the number of visits that get cached data means users don’t have to wait as often; if the user’s browser made the request directly, it would also need to make a second request to WP in order to pass the data for caching. Having WP make the request also introduces the opportunity to anonymize the IP before sending it to w.org, which mitigates possible privacy concerns.</p> </section>  <section> <h2 id="parameters">Parameters</h2> <dl> <dt>$location_search</dt> <dd> <p class="desc"> <span class="type">(<span class="string">string</span>)</span> <span class="required">(Optional)</span> <span class="description"> City name to help determine the location. e.g., "Seattle". </span> </p> <p class="default">Default value: ''</p> </dd> <dt>$timezone</dt> <dd> <p class="desc"> <span class="type">(<span class="string">string</span>)</span> <span class="required">(Optional)</span> <span class="description"> Timezone to help determine the location. </span> </p> <p class="default">Default value: ''</p> </dd> </dl> </section>  <section> <h2 id="return">Return</h2> <p><span class="return-type">(array|<a href="../wp_error">WP_Error</a>)</span> A <a href="../wp_error">WP_Error</a> on failure; an array with location and events on success.</p> </section>  <section> <h2 id="source">Source</h2> <p> File: <a href="https://developer.wordpress.org/reference/files/wp-admin/includes/class-wp-community-events.php/">wp-admin/includes/class-wp-community-events.php</a> </p> <pre data-language="php">public function get_events( $location_search = '', $timezone = '' ) {
		$cached_events = $this-&gt;get_cached_events();

		if ( ! $location_search &amp;&amp; $cached_events ) {
			return $cached_events;
		}

		// Include an unmodified $wp_version.
		require ABSPATH . WPINC . '/version.php';

		$api_url                    = 'http://api.wordpress.org/events/1.0/';
		$request_args               = $this-&gt;get_request_args( $location_search, $timezone );
		$request_args['user-agent'] = 'WordPress/' . $wp_version . '; ' . home_url( '/' );

		if ( wp_http_supports( array( 'ssl' ) ) ) {
			$api_url = set_url_scheme( $api_url, 'https' );
		}

		$response       = wp_remote_get( $api_url, $request_args );
		$response_code  = wp_remote_retrieve_response_code( $response );
		$response_body  = json_decode( wp_remote_retrieve_body( $response ), true );
		$response_error = null;

		if ( is_wp_error( $response ) ) {
			$response_error = $response;
		} elseif ( 200 !== $response_code ) {
			$response_error = new WP_Error(
				'api-error',
				/* translators: %d: Numeric HTTP status code, e.g. 400, 403, 500, 504, etc. */
				sprintf( __( 'Invalid API response code (%d).' ), $response_code )
			);
		} elseif ( ! isset( $response_body['location'], $response_body['events'] ) ) {
			$response_error = new WP_Error(
				'api-invalid-response',
				isset( $response_body['error'] ) ? $response_body['error'] : __( 'Unknown API error.' )
			);
		}

		if ( is_wp_error( $response_error ) ) {
			return $response_error;
		} else {
			$expiration = false;

			if ( isset( $response_body['ttl'] ) ) {
				$expiration = $response_body['ttl'];
				unset( $response_body['ttl'] );
			}

			/*
			 * The IP in the response is usually the same as the one that was sent
			 * in the request, but in some cases it is different. In those cases,
			 * it's important to reset it back to the IP from the request.
			 *
			 * For example, if the IP sent in the request is private (e.g., 192.168.1.100),
			 * then the API will ignore that and use the corresponding public IP instead,
			 * and the public IP will get returned. If the public IP were saved, though,
			 * then get_cached_events() would always return `false`, because the transient
			 * would be generated based on the public IP when saving the cache, but generated
			 * based on the private IP when retrieving the cache.
			 */
			if ( ! empty( $response_body['location']['ip'] ) ) {
				$response_body['location']['ip'] = $request_args['body']['ip'];
			}

			/*
			 * The API doesn't return a description for latitude/longitude requests,
			 * but the description is already saved in the user location, so that
			 * one can be used instead.
			 */
			if ( $this-&gt;coordinates_match( $request_args['body'], $response_body['location'] ) &amp;&amp; empty( $response_body['location']['description'] ) ) {
				$response_body['location']['description'] = $this-&gt;user_location['description'];
			}

			/*
			 * Store the raw response, because events will expire before the cache does.
			 * The response will need to be processed every page load.
			 */
			$this-&gt;cache_events( $response_body, $expiration );

			$response_body['events'] = $this-&gt;trim_events( $response_body['events'] );

			return $response_body;
		}
	}</pre>  </section>  <section> <h2 id="related">Related</h2> <article class="uses"> <h3 id="uses">Uses</h3> <table id="uses-table">  <thead> <tr> <th>Uses</th> <th class="related-desc">Description</th> </tr> </thead> <tbody> <tr> <td> <span>wp-admin/includes/class-wp-community-events.php:</span> <a href="trim_events">WP_Community_Events::trim_events()</a> </td> <td class="related-desc"> <p>Prepares the event list for presentation.</p> </td> </tr> <tr> <td> <span>wp-admin/includes/class-wp-community-events.php:</span> <a href="get_cached_events">WP_Community_Events::get_cached_events()</a> </td> <td class="related-desc"> <p>Gets cached events.</p> </td> </tr> <tr> <td> <span>wp-admin/includes/class-wp-community-events.php:</span> <a href="get_request_args">WP_Community_Events::get_request_args()</a> </td> <td class="related-desc"> <p>Builds an array of args to use in an HTTP request to the w.org Events API.</p> </td> </tr> <tr> <td> <span>wp-admin/includes/class-wp-community-events.php:</span> <a href="coordinates_match">WP_Community_Events::coordinates_match()</a> </td> <td class="related-desc"> <p>Test if two pairs of latitude/longitude coordinates match each other.</p> </td> </tr> <tr> <td> <span>wp-admin/includes/class-wp-community-events.php:</span> <a href="cache_events">WP_Community_Events::cache_events()</a> </td> <td class="related-desc"> <p>Caches an array of events data from the Events API.</p> </td> </tr> <tr> <td> <span>wp-includes/l10n.php:</span> <a href="../../functions/__">__()</a> </td> <td class="related-desc"> <p>Retrieve the translation of $text.</p> </td> </tr> <tr> <td> <span>wp-includes/link-template.php:</span> <a href="../../functions/set_url_scheme">set_url_scheme()</a> </td> <td class="related-desc"> <p>Sets the scheme for a URL.</p> </td> </tr> <tr> <td> <span>wp-includes/link-template.php:</span> <a href="../../functions/home_url">home_url()</a> </td> <td class="related-desc"> <p>Retrieves the URL for the current site where the front end is accessible.</p> </td> </tr> <tr> <td> <span>wp-includes/http.php:</span> <a href="../../functions/wp_http_supports">wp_http_supports()</a> </td> <td class="related-desc"> <p>Determines if there is an HTTP Transport that can process this request.</p> </td> </tr> <tr> <td> <span>wp-includes/http.php:</span> <a href="../../functions/wp_remote_get">wp_remote_get()</a> </td> <td class="related-desc"> <p>Performs an HTTP request using the GET method and returns its response.</p> </td> </tr> <tr> <td> <span>wp-includes/http.php:</span> <a href="../../functions/wp_remote_retrieve_response_code">wp_remote_retrieve_response_code()</a> </td> <td class="related-desc"> <p>Retrieve only the response code from the raw response.</p> </td> </tr> <tr> <td> <span>wp-includes/http.php:</span> <a href="../../functions/wp_remote_retrieve_body">wp_remote_retrieve_body()</a> </td> <td class="related-desc"> <p>Retrieve only the body from the raw response.</p> </td> </tr> <tr> <td> <span>wp-includes/load.php:</span> <a href="../../functions/is_wp_error">is_wp_error()</a> </td> <td class="related-desc"> <p>Checks whether the given variable is a WordPress Error.</p> </td> </tr> <tr> <td> <span>wp-includes/class-wp-error.php:</span> <a href="../wp_error/__construct">WP_Error::__construct()</a> </td> <td class="related-desc"> <p>Initializes the error.</p> </td> </tr> </tbody>

</table>   </article> </section>  <section> <h2 id="changelog">Changelog</h2> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/5.5.2/" alt="WordPress 5.5.2">5.5.2</a></td> <td><span class="since-description">Response no longer contains formatted date field. They're added in <code>wp.communityEvents.populateDynamicEventFields()</code> now.</span></td> </tr> <tr> <td><a href="https://developer.wordpress.org/reference/since/4.8.0/" alt="WordPress 4.8.0">4.8.0</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section>    </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.wordpress.org/reference/classes/wp_community_events/get_events" class="_attribution-link" target="_blank">https://developer.wordpress.org/reference/classes/wp_community_events/get_events</a>
  </p>
</div>
