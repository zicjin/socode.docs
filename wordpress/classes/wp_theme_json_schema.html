<h1>WP_Theme_JSON_Schema</h1>  <section> <p>Class that migrates a given theme.json structure to the latest schema.</p> </section> <div class="content-toc">  <section> <h2 id="description">Description</h2> <p>This class is for internal core usage and is not supposed to be used by extenders (plugins and/or themes). This is a low-level API that may need to do breaking changes. Please, use get_global_settings, get_global_styles, and get_global_stylesheet instead.</p> </section>  <section> <h2 id="source">Source</h2> <p> File: <a href="https://developer.wordpress.org/reference/files/wp-includes/class-wp-theme-json-schema.php/">wp-includes/class-wp-theme-json-schema.php</a> </p> <pre data-language="php">class WP_Theme_JSON_Schema {

	/**
	 * Maps old properties to their new location within the schema's settings.
	 * This will be applied at both the defaults and individual block levels.
	 */
	const V1_TO_V2_RENAMED_PATHS = array(
		'border.customRadius'         =&gt; 'border.radius',
		'spacing.customMargin'        =&gt; 'spacing.margin',
		'spacing.customPadding'       =&gt; 'spacing.padding',
		'typography.customLineHeight' =&gt; 'typography.lineHeight',
	);

	/**
	 * Function that migrates a given theme.json structure to the last version.
	 *
	 * @since 5.9.0
	 *
	 * @param array $theme_json The structure to migrate.
	 *
	 * @return array The structure in the last version.
	 */
	public static function migrate( $theme_json ) {
		if ( ! isset( $theme_json['version'] ) ) {
			$theme_json = array(
				'version' =&gt; WP_Theme_JSON::LATEST_SCHEMA,
			);
		}

		if ( 1 === $theme_json['version'] ) {
			$theme_json = self::migrate_v1_to_v2( $theme_json );
		}

		return $theme_json;
	}

	/**
	 * Removes the custom prefixes for a few properties
	 * that were part of v1:
	 *
	 * 'border.customRadius'         =&gt; 'border.radius',
	 * 'spacing.customMargin'        =&gt; 'spacing.margin',
	 * 'spacing.customPadding'       =&gt; 'spacing.padding',
	 * 'typography.customLineHeight' =&gt; 'typography.lineHeight',
	 *
	 * @since 5.9.0
	 *
	 * @param array $old Data to migrate.
	 *
	 * @return array Data without the custom prefixes.
	 */
	private static function migrate_v1_to_v2( $old ) {
		// Copy everything.
		$new = $old;

		// Overwrite the things that changed.
		if ( isset( $old['settings'] ) ) {
			$new['settings'] = self::rename_paths( $old['settings'], self::V1_TO_V2_RENAMED_PATHS );
		}

		// Set the new version.
		$new['version'] = 2;

		return $new;
	}

	/**
	 * Processes the settings subtree.
	 *
	 * @since 5.9.0
	 *
	 * @param array $settings        Array to process.
	 * @param array $paths_to_rename Paths to rename.
	 *
	 * @return array The settings in the new format.
	 */
	private static function rename_paths( $settings, $paths_to_rename ) {
		$new_settings = $settings;

		// Process any renamed/moved paths within default settings.
		self::rename_settings( $new_settings, $paths_to_rename );

		// Process individual block settings.
		if ( isset( $new_settings['blocks'] ) &amp;&amp; is_array( $new_settings['blocks'] ) ) {
			foreach ( $new_settings['blocks'] as &amp;$block_settings ) {
				self::rename_settings( $block_settings, $paths_to_rename );
			}
		}

		return $new_settings;
	}

	/**
	 * Processes a settings array, renaming or moving properties.
	 *
	 * @since 5.9.0
	 *
	 * @param array $settings        Reference to settings either defaults or an individual block's.
	 * @param array $paths_to_rename Paths to rename.
	 */
	private static function rename_settings( &amp;$settings, $paths_to_rename ) {
		foreach ( $paths_to_rename as $original =&gt; $renamed ) {
			$original_path = explode( '.', $original );
			$renamed_path  = explode( '.', $renamed );
			$current_value = _wp_array_get( $settings, $original_path, null );

			if ( null !== $current_value ) {
				_wp_array_set( $settings, $renamed_path, $current_value );
				self::unset_setting_by_path( $settings, $original_path );
			}
		}
	}

	/**
	 * Removes a property from within the provided settings by its path.
	 *
	 * @since 5.9.0
	 *
	 * @param array $settings Reference to the current settings array.
	 * @param array $path Path to the property to be removed.
	 *
	 * @return void
	 */
	private static function unset_setting_by_path( &amp;$settings, $path ) {
		$tmp_settings = &amp;$settings; // phpcs:ignore VariableAnalysis.CodeAnalysis.VariableAnalysis.UnusedVariable
		$last_key     = array_pop( $path );
		foreach ( $path as $key ) {
			$tmp_settings = &amp;$tmp_settings[ $key ];
		}

		unset( $tmp_settings[ $last_key ] );
	}
}</pre>  </section>  <section> <h2 id="methods">Methods</h2> <ul> <li>
<a href="wp_theme_json_schema/migrate"> migrate</a> — Function that migrates a given theme.json structure to the last version. </li> <li>
<a href="wp_theme_json_schema/migrate_v1_to_v2"> migrate_v1_to_v2</a> — Removes the custom prefixes for a few properties that were part of v1: </li> <li>
<a href="wp_theme_json_schema/rename_paths"> rename_paths</a> — Processes the settings subtree. </li> <li>
<a href="wp_theme_json_schema/rename_settings"> rename_settings</a> — Processes a settings array, renaming or moving properties. </li> <li>
<a href="wp_theme_json_schema/unset_setting_by_path"> unset_setting_by_path</a> — Removes a property from within the provided settings by its path. </li> </ul> </section>  <section> <h2 id="changelog">Changelog</h2> <table>  <thead> <tr> <th class="changelog-version">Version</th> <th class="changelog-desc">Description</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.wordpress.org/reference/since/5.9.0/" alt="WordPress 5.9.0">5.9.0</a></td> <td>Introduced.</td> </tr> </tbody> </table> </section>    </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.wordpress.org/reference/classes/wp_theme_json_schema" class="_attribution-link" target="_blank">https://developer.wordpress.org/reference/classes/wp_theme_json_schema</a>
  </p>
</div>
