<h1 id="bottles-binary-packages">Bottles (binary packages)</h1> <p>Bottles are produced by installing a formula with <code class="highlighter-rouge">brew install --build-bottle &lt;formula&gt;</code> and then bottling it with <code class="highlighter-rouge">brew bottle &lt;formula&gt;</code>. This outputs the bottle DSL which should be inserted into the formula file.</p> <h2 id="usage">Usage</h2> <p>If a bottle is available and usable it will be downloaded and poured automatically when you <code class="highlighter-rouge">brew install &lt;formula&gt;</code>. If you wish to disable this you can do so by specifying <code class="highlighter-rouge">--build-from-source</code>.</p> <p>Bottles will not be used if the user requests it (see above), if the formula requests it (with <code class="highlighter-rouge">pour_bottle?</code>), if any options are specified during installation (bottles are all compiled with default options), if the bottle is not up to date (e.g. lacking a checksum) or if the bottle’s <code class="highlighter-rouge">cellar</code> is not <code class="highlighter-rouge">:any</code> nor equal to the current <code class="highlighter-rouge">HOMEBREW_CELLAR</code>.</p> <h2 id="creation">Creation</h2> <p>Bottles are created using the <a href="brew-test-bot">Brew Test Bot</a>. This happens mostly when people submit pull requests to Homebrew and the <code class="highlighter-rouge">bottle do</code> block is updated by maintainers when they <code class="highlighter-rouge">brew pull --bottle</code> the contents of a pull request. For the Homebrew organisations’ taps they are uploaded to and downloaded from <a href="https://bintray.com/homebrew">Bintray</a>.</p> <p>By default, bottles will be built for the oldest CPU supported by the OS/architecture you’re building for (Core 2 for 64-bit OSs). This ensures that bottles are compatible with all computers you might distribute them to. If you <em>really</em> want your bottles to be optimized for something else, you can pass the <code class="highlighter-rouge">--bottle-arch=</code> option to build for another architecture; for example, <code class="highlighter-rouge">brew install foo --build-bottle --bottle-arch=penryn</code>. Just remember that if you build for a newer architecture some of your users might get binaries they can’t run and that would be sad!</p> <h2 id="format">Format</h2> <p>Bottles are simple gzipped tarballs of compiled binaries. Any metadata is stored in a formula’s bottle DSL and in the bottle filename (i.e. macOS version, revision).</p> <h2 id="bottle-dsl-domain-specific-language">Bottle DSL (Domain Specific Language)</h2> <p>Bottles have a DSL to be used in formulae which is contained in the <code class="highlighter-rouge">bottle do ... end</code> block.</p> <p>A simple (and typical) example:</p> <pre data-language="ruby">bottle do
  sha256 "4921af80137af9cc3d38fd17c9120da882448a090b0a8a3a19af3199b415bfca" =&gt; :sierra
  sha256 "c71db15326ee9196cd98602e38d0b7fb2b818cdd48eede4ee8eb827d809e09ba" =&gt; :el_capitan
  sha256 "85cc828a96735bdafcf29eb6291ca91bac846579bcef7308536e0c875d6c81d7" =&gt; :yosemite
end</pre> <p>A full example:</p> <pre data-language="ruby">bottle do
  root_url "https://example.com"
  prefix "/opt/homebrew"
  cellar "/opt/homebrew/Cellar"
  rebuild 4
  sha256 "4921af80137af9cc3d38fd17c9120da882448a090b0a8a3a19af3199b415bfca" =&gt; :sierra
  sha256 "c71db15326ee9196cd98602e38d0b7fb2b818cdd48eede4ee8eb827d809e09ba" =&gt; :el_capitan
  sha256 "85cc828a96735bdafcf29eb6291ca91bac846579bcef7308536e0c875d6c81d7" =&gt; :yosemite
end</pre> <h3 id="root-url-root_url">Root URL (<code class="highlighter-rouge">root_url</code>)</h3> <p>Optionally contains the URL root used to calculate bottle URLs. By default this is omitted and the Homebrew default bottle URL root is used. This may be useful for taps which wish to provide bottles for their formulae or to cater for a non-default <code class="highlighter-rouge">HOMEBREW_CELLAR</code>.</p> <h3 id="cellar-cellar">Cellar (<code class="highlighter-rouge">cellar</code>)</h3> <p>Optionally contains the value of <code class="highlighter-rouge">HOMEBREW_CELLAR</code> in which the bottles were built. Most compiled software contains references to its compiled location so cannot be simply relocated anywhere on disk. If this value is <code class="highlighter-rouge">:any</code> or <code class="highlighter-rouge">:any_skip_relocation</code> this means that the bottle can be safely installed in any Cellar as it did not contain any references to its installation Cellar. This can be omitted if a bottle is compiled (as all default Homebrew ones are) for the default <code class="highlighter-rouge">HOMEBREW_CELLAR</code> of <code class="highlighter-rouge">/usr/local/Cellar</code>.</p> <h3 id="prefix-prefix">Prefix (<code class="highlighter-rouge">prefix</code>)</h3> <p>Optionally contains the value of <code class="highlighter-rouge">HOMEBREW_PREFIX</code> in which the bottles were built. See description of <code class="highlighter-rouge">cellar</code>. When <code class="highlighter-rouge">cellar</code> is <code class="highlighter-rouge">:any</code> or <code class="highlighter-rouge">:any_skip_relocation</code> the prefix should be omitted.</p> <h3 id="rebuild-version-rebuild">Rebuild version (<code class="highlighter-rouge">rebuild</code>)</h3> <p>Optionally contains the rebuild version of the bottle. Sometimes bottles may need be updated without bumping the version of the formula, e.g. a new patch was applied. In that case the rebuild will have a value of 1 or more.</p> <h3 id="checksum-sha256">Checksum (<code class="highlighter-rouge">sha256</code>)</h3> <p>Contains the SHA-256 hash of a bottle for a particular version of macOS.</p> <h2 id="formula-dsl">Formula DSL</h2> <p>An additional method is available in the formula DSL.</p> <h3 id="pour-bottle-pour_bottle">Pour bottle (<code class="highlighter-rouge">pour_bottle?</code>)</h3> <p>Optionally returns a boolean to decide whether a bottle should be used for this formula. For example a bottle may break if another formula has been compiled with non-default options, so this method could check for that case and return <code class="highlighter-rouge">false</code>.</p> <p>A full example:</p> <pre data-language="ruby">pour_bottle? do
  reason "The bottle needs the Xcode CLT to be installed."
  satisfy { MacOS::CLT.installed? }
end</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2009&ndash;present Homebrew contributors<br>Licensed under the BSD 2-Clause License.<br>
    <a href="https://docs.brew.sh/Bottles" class="_attribution-link">https://docs.brew.sh/Bottles</a>
  </p>
</div>
