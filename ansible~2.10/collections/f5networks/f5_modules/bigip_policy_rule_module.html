<h1 id="f5networks-f5-modules-bigip-policy-rule-manage-ltm-policy-rules-on-a-big-ip">f5networks.f5_modules.bigip_policy_rule – Manage LTM policy rules on a BIG-IP</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/f5networks/f5_modules">f5networks.f5_modules collection</a> (version 1.7.1).</p> <p>To install it use: <code>ansible-galaxy collection install f5networks.f5_modules</code>.</p> <p>To use it in a playbook, specify: <code>f5networks.f5_modules.bigip_policy_rule</code>.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 1.0.0: </span>of f5networks.f5_modules</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#examples" id="id5">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id6">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>This module will manage LTM policy rules on a BIG-IP.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>BIG-IP &gt;= v12.1.0</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="2">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="2">  <b>actions</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td> </td> <td> <div>The actions you want the policy rule to perform.</div> <div>The available attributes vary by the action, however, each action requires you specify a <code>type</code>.</div> <div>These conditions can be specified in any order. Despite the fact they are in a list, the order in the list does not matter to the BIG-IP.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>asm_policy</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>ASM policy to enable.</div> <div>This parameter is only valid with the <code>enable</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>cookie_expiry</b>  <div> <span>integer</span> </div> <div> added in 1.1.0 of f5networks.f5_modules </div> </td> <td> </td> <td> <div>Optional argument, specifying the time for which the session will be persisted.</div> <div>This parameter is only valid with the <code>persist</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>cookie_insert</b>  <div> <span>string</span> </div> <div> added in 1.1.0 of f5networks.f5_modules </div> </td> <td> </td> <td> <div>Cookie name on which you want to persist.</div> <div>This parameter is only valid with the <code>persist</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>event</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Events on which actions, such as reset, can be triggered.</div> <div>With the <code>set_variable</code> action, it is used for specifying an action event, such as request or response.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>expression</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>A tcl expression used with the <code>set_variable</code> action.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>location</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>The new URL for which a redirect response will be sent.</div> <div>A Tcl command substitution can be used for this field.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>node</b>  <div> <span>string</span> </div> <div> added in 1.2.0 of f5networks.f5_modules </div> </td> <td> </td> <td> <div>Node to which you want to forward traffic.</div> <div>This parameter is only valid with the <code>forward</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>pool</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Pool to which you want to forward traffic.</div> <div>This parameter is only valid with the <code>forward</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>type</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>forward</li> <li>enable</li> <li>ignore</li> <li>redirect</li> <li>reset</li> <li>persist</li> <li>set_variable</li> </ul> </td> <td> <div>The action type. This value controls which of the following options are required.</div> <div>When <code>type</code> is <code>forward</code>, the system associates a given <code>pool</code>, or <code>virtual</code>, or <code>node</code> with this rule.</div> <div>When <code>type</code> is <code>enable</code>, the system associates a given <code>asm_policy</code> with this rule.</div> <div>When <code>type</code> is <code>ignore</code>, the system removes all existing actions from this rule.</div> <div>When <code>type</code> is <code>redirect</code>, the system redirects an HTTP request to a different URL.</div> <div>When <code>type</code> is <code>reset</code>, the system resets the connection upon <code>event</code>.</div> <div>When <code>type</code> is <code>persist</code>, the system associates <code>cookie_insert</code> and <code>cookie_expiry</code> with this rule.</div> <div>When <code>type</code> is <code>set_variable</code>, the system sets a variable based on the evaluated Tcl <code>expression</code> based on <code>event</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>variable_name</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Variable name used with the <code>set_variable</code> action.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>virtual</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Virtual Server to which you want to forward traffic.</div> <div>This parameter is only valid with the <code>forward</code> type.</div> </td> </tr> <tr> <td colspan="2">  <b>conditions</b>  <div> <span>list</span> / <span>elements=dictionary</span> </div> </td> <td> </td> <td> <div>A list of attributes that describe the condition.</div> <div>See suboptions for details on how to construct each list entry.</div> <div>The ordering of this list is important, the module will ensure the order is kept when modifying the task.</div> <div>The suboption options listed below are not required for all condition types, read the description for more details.</div> <div>These conditions can be specified in any order. Despite the fact they are in a list, the order in the list does not matter to the BIG-IP.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>event</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Events on which conditions such as SSL Extension can be triggered.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>host_begins_with_any</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of strings of characters the HTTP Host should start with.</div> <div>This parameter is only valid with the <code>http_host</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>host_is_any</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of strings of characters the HTTP Host should match.</div> <div>This parameter is only valid with the <code>http_host</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>host_is_not_any</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of strings of characters the HTTP Host should not match.</div> <div>This parameter is only valid with the <code>http_host</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>path_begins_with_any</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of strings of characters the HTTP URI should start with.</div> <div>This parameter is only valid with the <code>http_uri</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>server_name_is_any</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> </td> <td> <div>A list of strings of characters the SSL Extension should match.</div> <div>This parameter is only valid with the <code>ssl_extension</code> type.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>type</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>http_uri</li> <li>all_traffic</li> <li>http_host</li> <li>ssl_extension</li> </ul> </td> <td> <div>The condition type. This value controls which of the following options are required.</div> <div>When <code>type</code> is <code>http_uri</code>, the system associates a given <code>path_begins_with_any</code> list of strings with which the HTTP URI should begin. Any item in the list will provide a match.</div> <div>When <code>type</code> is <code>all_traffic</code>, the system removes all existing conditions from this rule.</div> </td> </tr> <tr> <td colspan="2">  <b>description</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Description of the policy rule.</div> </td> </tr> <tr> <td colspan="2">  <b>name</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The name of the rule.</div> </td> </tr> <tr> <td colspan="2">  <b>partition</b>  <div> <span>string</span> </div> </td> <td> <b>Default:</b><br><div>"Common"</div> </td> <td> <div>Device partition to manage resources on.</div> </td> </tr> <tr> <td colspan="2">  <b>policy</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The name of the policy you want to associate this rule with.</div> </td> </tr> <tr> <td colspan="2">  <b>provider</b>  <div> <span>dictionary</span> </div> <div> added in 1.0.0 of f5networks.f5_modules </div> </td> <td> </td> <td> <div>A dict object containing connection details.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>auth_provider</b>  <div> <span>string</span> </div> </td> <td> </td> <td> <div>Configures the auth provider for to obtain authentication tokens from the remote device.</div> <div>This option is really used when working with BIG-IQ devices.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>no_f5_teem</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If <code>yes</code>, TEEM telemetry data is not sent to F5.</div> <div>You may omit this option by setting the environment variable <code>F5_TEEM</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>password</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The password for the user account used to connect to the BIG-IP.</div> <div>You may omit this option by setting the environment variable <code>F5_PASSWORD</code>.</div> <div>
<br>aliases: pass, pwd</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>server</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The BIG-IP host.</div> <div>You may omit this option by setting the environment variable <code>F5_SERVER</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>server_port</b>  <div> <span>integer</span> </div> </td> <td> <b>Default:</b><br><div>443</div> </td> <td> <div>The BIG-IP server port.</div> <div>You may omit this option by setting the environment variable <code>F5_SERVER_PORT</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>timeout</b>  <div> <span>integer</span> </div> </td> <td> </td> <td> <div>Specifies the timeout in seconds for communicating with the network device for either connecting or sending commands. If the timeout is exceeded before the operation is completed, the module will error.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>transport</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>rest</b> ←</div></li> </ul> </td> <td> <div>Configures the transport connection to use when connecting to the remote device.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>user</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> </td> <td> <div>The username to connect to the BIG-IP with. This user must have administrative privileges on the device.</div> <div>You may omit this option by setting the environment variable <code>F5_USER</code>.</div> </td> </tr> <tr> <td class="elbow-placeholder"></td> <td colspan="1">  <b>validate_certs</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div>
<b>yes</b> ←</div></li> </ul> </td> <td> <div>If <code>no</code>, SSL certificates are not validated. Use this only on personally controlled sites using self-signed certificates.</div> <div>You may omit this option by setting the environment variable <code>F5_VALIDATE_CERTS</code>.</div> </td> </tr> <tr> <td colspan="2">  <b>state</b>  <div> <span>string</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>present</b> ←</div></li> <li>absent</li> </ul> </td> <td> <div>When <code>present</code>, ensures the key is uploaded to the device. When <code>absent</code>, ensures the key is removed from the device. If the key is currently in use, the module will not be able to remove the key.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="admonition-title">Note</p> <ul class="simple"> <li>For more information on using Ansible to manage F5 Networks devices see <a class="reference external" href="https://www.ansible.com/integrations/networks/f5">https://www.ansible.com/integrations/networks/f5</a>.</li> <li>Requires BIG-IP software version &gt;= 12.</li> <li>The F5 modules only manipulate the running configuration of the F5 product. To ensure that BIG-IP specific configuration persists to disk, be sure to include at least one task that uses the <a class="reference internal" href="bigip_config_module#ansible-collections-f5networks-f5-modules-bigip-config-module"><span class="std std-ref">f5networks.f5_modules.bigip_config</span></a> module to save the running configuration. Refer to the module’s documentation for the correct usage of the module to save your running configuration.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja">- name: Create policies
  bigip_policy:
    name: Policy-Foo
    state: present
    provider:
      server: lb.mydomain.com
      user: admin
      password: secret
  delegate_to: localhost

- name: Add a rule to the new policy
  bigip_policy_rule:
    policy: Policy-Foo
    name: rule3
    conditions:
      - type: http_uri
        path_begins_with_any:
          - /ABC
    actions:
      - type: forward
        pool: pool-svrs
    provider:
      server: lb.mydomain.com
      user: admin
      password: secret
  delegate_to: localhost

- name: Add multiple rules to the new policy
  bigip_policy_rule:
    policy: Policy-Foo
    name: "{{ item.name }}"
    conditions: "{{ item.conditions }}"
    actions: "{{ item.actions }}"
    provider:
      server: lb.mydomain.com
      user: admin
      password: secret
  delegate_to: localhost
  loop:
    - name: rule1
      actions:
        - type: forward
          pool: pool-svrs
      conditions:
        - type: http_uri
          path_begins_with_any:
            - /euro
    - name: rule2
      actions:
        - type: forward
          pool: pool-svrs
      conditions:
        - type: http_uri
          path_begins_with_any:
            - /HomePage/
    - name: rule3
      actions:
        - type: set_variable
          variable_name: user-agent
          expression: tcl:[HTTP::header User-Agent]
          event: request
      conditions:
        - type: http_uri
          path_begins_with_any:
            - /HomePage/

- name: Remove all rules and confitions from the rule
  bigip_policy_rule:
    policy: Policy-Foo
    name: rule1
    conditions:
      - type: all_traffic
    actions:
      - type: ignore
    provider:
      server: lb.mydomain.com
      user: admin
      password: secret
  delegate_to: localhost
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="2">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="2">  <b>actions</b>  <div> <span>complex</span> </div> </td> <td>changed</td> <td> <div>The new list of actions applied to the rule.</div> <br> <div><b>Sample:</b></div> <div>hash/dictionary of values</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>pool</b>  <div> <span>string</span> </div> </td> <td>changed</td> <td> <div>Pool for forwarding to.</div> <br> <div><b>Sample:</b></div> <div>foo-pool</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>type</b>  <div> <span>string</span> </div> </td> <td>changed</td> <td> <div>The action type.</div> <br> <div><b>Sample:</b></div> <div>forward</div> </td> </tr> <tr> <td colspan="2">  <b>conditions</b>  <div> <span>complex</span> </div> </td> <td>changed</td> <td> <div>The new list of conditions applied to the rule.</div> <br> <div><b>Sample:</b></div> <div>hash/dictionary of values</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>path_begins_with_any</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td>changed</td> <td> <div>List of strings that the URI begins with.</div> <br> <div><b>Sample:</b></div> <div>['foo', 'bar']</div> </td> </tr> <tr> <td class="elbow-placeholder"> </td> <td colspan="1">  <b>type</b>  <div> <span>string</span> </div> </td> <td>changed</td> <td> <div>The condition type.</div> <br> <div><b>Sample:</b></div> <div>http_uri</div> </td> </tr> <tr> <td colspan="2">  <b>description</b>  <div> <span>string</span> </div> </td> <td>changed</td> <td> <div>The new description of the rule.</div> <br> <div><b>Sample:</b></div> <div>My rule</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Tim Rupp (@caphrim007)</li> <li>Wojciech Wypior (@wojtek0806)</li> <li>Greg Crosby (@crosbygw)</li> <li>Nitin Khanna (@nitinthewiz)</li> <li>Andrey Kashcheev (@andreykashcheev)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/2.10/collections/f5networks/f5_modules/bigip_policy_rule_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/2.10/collections/f5networks/f5_modules/bigip_policy_rule_module.html</a>
  </p>
</div>
