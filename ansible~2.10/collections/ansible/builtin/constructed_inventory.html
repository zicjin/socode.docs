<h1 id="ansible-builtin-constructed-uses-jinja2-to-construct-vars-and-groups-based-on-existing-inventory">ansible.builtin.constructed – Uses Jinja2 to construct vars and groups based on existing inventory.</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This module is part of <code>ansible-base</code> and included in all Ansible installations. In most cases, you can use the short module name constructed even without specifying the <code>collections:</code> keyword. Despite that, we recommend you use the FQCN for easy linking to the module documentation and to avoid conflicting with other collections that may have the same module name.</p> </div> <div class="versionadded"> <p><span class="versionmodified added">New in version 2.4: </span>of ansible.builtin</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id3">Examples</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Uses a YAML configuration file with a valid YAML or <code>.config</code> extension to define var expressions and group conditionals</li> <li>The Jinja2 conditionals that qualify a host for membership.</li> <li>The Jinja2 expressions are calculated and assigned to the variables</li> <li>Only variables already available from previous inventories or the fact cache can be used for templating.</li> <li>When <em>strict</em> is False, failed expressions will be ignored (assumes vars were missing).</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th>Configuration</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>compose</b>  <div> <span>dictionary</span> </div> </td> <td> <b>Default:</b><br><div>{}</div> </td> <td> </td> <td> <div>Create vars from jinja2 expressions.</div> </td> </tr> <tr> <td colspan="1">  <b>groups</b>  <div> <span>dictionary</span> </div> </td> <td> <b>Default:</b><br><div>{}</div> </td> <td> </td> <td> <div>Add hosts to group based on Jinja2 conditionals.</div> </td> </tr> <tr> <td colspan="1">  <b>keyed_groups</b>  <div> <span>list</span> / <span>elements=string</span> </div> </td> <td> <b>Default:</b><br><div>[]</div> </td> <td> </td> <td> <div>Add hosts to group based on the values of a variable.</div> </td> </tr> <tr> <td colspan="1">  <b>plugin</b>  <div> <span>string</span> / <span>required</span> </div> </td> <td> <ul>
<b>Choices:</b> <li>constructed</li> </ul> </td> <td> </td> <td> <div>token that ensures this is a source file for the 'constructed' plugin.</div> </td> </tr> <tr> <td colspan="1">  <b>strict</b>  <div> <span>boolean</span> </div> </td> <td> <ul>
<b>Choices:</b> <li><div>
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> </td> <td> <div>If <code>yes</code> make invalid entries a fatal error, otherwise skip and continue.</div> <div>Since it is possible to use facts in the expressions they might not always be available and we ignore those errors by default.</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml+jinja"># inventory.config file in YAML format
plugin: constructed
strict: False
compose:
    var_sum: var1 + var2

    # this variable will only be set if I have a persistent fact cache enabled (and have non expired facts)
    # `strict: False` will skip this instead of producing an error if it is missing facts.
    server_type: "ansible_hostname | regex_replace ('(.{6})(.{2}).*', '\\2')"
groups:
    # simple name matching
    webservers: inventory_hostname.startswith('web')

    # using ec2 'tags' (assumes aws inventory)
    development: "'devel' in (ec2_tags|list)"

    # using other host properties populated in inventory
    private_only: not (public_dns_name is defined or ip_address is defined)

    # complex group membership
    multi_group: (group_names | intersect(['alpha', 'beta', 'omega'])) | length &gt;= 2

keyed_groups:
    # this creates a group per distro (distro_CentOS, distro_Debian) and assigns the hosts that have matching values to it,
    # using the default separator "_"
    - prefix: distro
      key: ansible_distribution

    # the following examples assume the first inventory is from the `aws_ec2` plugin
    # this creates a group per ec2 architecture and assign hosts to the matching ones (arch_x86_64, arch_sparc, etc)
    - prefix: arch
      key: architecture

    # this creates a group per ec2 region like "us_west_1"
    - prefix: ""
      separator: ""
      key: placement.region

    # this creates a common parent group for all ec2 availability zones
    - key: placement.availability_zone
      parent_group: all_ec2_zones
</pre><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.ansible.com/ansible/2.10/collections/ansible/builtin/constructed_inventory.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/2.10/collections/ansible/builtin/constructed_inventory.html</a>
  </p>
</div>
