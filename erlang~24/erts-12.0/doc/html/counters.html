  <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-module-idm7309').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-idm7309').style.visibility = 'hidden';">Module</span></h2> <p class="REFBODY module-body">counters</p> </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-module-summary-idm7310').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-idm7310').style.visibility = 'hidden';">Module Summary</span></h2> <p class="REFBODY module-summary-body">Counter Functions</p> <h2><span onmouseover="document.getElementById('ghlink-since-idm7310').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-since-idm7310').style.visibility = 'hidden';">Since</span></h2> <p class="REFBODY module-since"> Module counters was introduced in OTP 21.2. </p> </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-description-idm7311').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-idm7311').style.visibility = 'hidden';">Description</span></h2> 
<p>This module provides a set of functions to do operations towards shared mutable counter variables. The implementation does not utilize any software level locking, which makes it very efficient for concurrent access. The counters are organized into arrays with the following semantics:</p> <ul> <li> <p>Counters are 64 bit signed integers.</p> </li> <li> <p>Counters wrap around at overflow and underflow operations.</p> </li> <li> <p>Counters are initialized to zero.</p> </li> <li> <p>Write operations guarantee atomicity. No intermediate results can be seen from a single write operation.</p> </li> <li> <p>Two types of counter arrays can be created with options <code class="code">atomics</code> or <code class="code">write_concurrency</code>. The <code class="code">atomics</code> counters have good allround performance with nice consistent semantics while <code class="code">write_concurrency</code> counters offers even better concurrent write performance at the expense of some potential read inconsistencies. See <code><a href="#new-2"><span class="code">new/2</span></a></code>.</p> </li> <li> <p>Indexes into counter arrays are one-based. A counter array of size N contains N counters with index from 1 to N.</p> </li> </ul>  </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-data-types-idm7332').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-idm7332').style.visibility = 'hidden';">Data Types</span></h2> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-counters_ref').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-counters_ref').style.visibility = 'hidden';">  <code id="type-counters_ref">counters_ref()</code><br> </div> <div class="data-type-desc">

<p>Identifies a counter array returned from <code><a href="#new-2"><span class="code">new/2</span></a></code>.</p> </div> </div> </div> <div class="innertube"><h2><span onmouseover="document.getElementById('ghlink-exports-idm7339').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-idm7339').style.visibility = 'hidden';">Exports</span></h2></div> <div class="exports-body"> <table class="func-table" id="new-2"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-new-2-idp11').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-new-2-idp11').style.visibility = 'hidden';"> new(Size, Opts) -&gt; <code><a href="#type-counters_ref">counters_ref()</a></code> </div></td> <td class="func-since-td"><span class="since">OTP 21.2</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>     <div class="exports-tube">

<p>Create a new counter array of <code class="code">Size</code> counters. All counters in the array are initially set to zero.</p> <p>Argument <code class="code">Opts</code> is a list of the following possible options:</p> <dl> <dt><strong><code class="code">atomics</code> (Default)</strong></dt> <dd> <p>Counters will be sequentially consistent. If write operation A is done sequentially before write operation B, then a concurrent reader may see the result of none of them, only A, or both A and B. It cannot see the result of only B.</p> </dd> <dt><strong><code class="code">write_concurrency</code></strong></dt> <dd> <p>This is an optimization to achieve very efficient concurrent <code><a href="#add-3"><span class="code">add</span></a></code> and <code><a href="#sub-3"><span class="code">sub</span></a></code> operations at the expense of potential read inconsistency and memory consumption per counter.</p> <p>Read operations may see sequentially inconsistent results with regard to concurrent write operations. Even if write operation A is done sequentially before write operation B, a concurrent reader may see any combination of A and B, including only B. A read operation is only guaranteed to see all writes done sequentially before the read. No writes are ever lost, but will eventually all be seen.</p> <p>The typical use case for <code class="code">write_concurrency</code> is when concurrent calls to <code><a href="#add-3"><span class="code">add</span></a></code> and <code><a href="#sub-3"><span class="code">sub</span></a></code> toward the same counters are very frequent, while calls to <code><a href="#get-2"><span class="code">get</span> </a></code> and <code><a href="#put-3"><span class="code">put</span></a></code> are much less frequent. The lack of absolute read consistency must also be acceptable.</p> </dd> </dl> <p>Counters are not tied to the current process and are automatically garbage collected when they are no longer referenced.</p> </div> <table class="func-table" id="get-2"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-get-2-idp12').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get-2-idp12').style.visibility = 'hidden';"> get(Ref, Ix) -&gt; integer()</div></td> <td class="func-since-td"><span class="since">OTP 21.2</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>    <div class="exports-tube">

<p>Read counter value.</p> </div> <table class="func-table" id="add-3"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-add-3-idp13').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-add-3-idp13').style.visibility = 'hidden';"> add(Ref, Ix, Incr) -&gt; ok</div></td> <td class="func-since-td"><span class="since">OTP 21.2</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>     <div class="exports-tube">

<p>Add <code class="code">Incr</code> to counter at index <code class="code">Ix</code>.</p> </div> <table class="func-table" id="sub-3"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-sub-3-idp14').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-sub-3-idp14').style.visibility = 'hidden';"> sub(Ref, Ix, Decr) -&gt; ok</div></td> <td class="func-since-td"><span class="since">OTP 21.2</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>     <div class="exports-tube">

<p>Subtract <code class="code">Decr</code> from counter at index <code class="code">Ix</code>.</p> </div> <table class="func-table" id="put-3"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-put-3-idp15').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-put-3-idp15').style.visibility = 'hidden';"> put(Ref, Ix, Value) -&gt; ok</div></td> <td class="func-since-td"><span class="since">OTP 21.2</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>     <div class="exports-tube">

<p>Write <code class="code">Value</code> to counter at index <code class="code">Ix</code>.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>Despite its name, the <code class="code">write_concurrency</code> optimization does not improve <code class="code">put</code>. A call to <code class="code">put</code> is a relatively heavy operation compared to the very lightweight and scalable <code><a href="#add-3"><span class="code">add</span></a></code> and <code><a href="#sub-3"> <span class="code">sub</span></a></code>. The cost for a <code class="code">put</code> with <code class="code">write_concurrency</code> is like a <code><a href="#get-2"><span class="code">get</span> </a></code> plus a <code class="code">put</code> without <code class="code">write_concurrency</code>.</p> </div> </div> </div> <table class="func-table" id="info-1"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-info-1-idp16').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-info-1-idp16').style.visibility = 'hidden';"> info(Ref) -&gt; Info</div></td> <td class="func-since-td"><span class="since">OTP 21.2</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>      <div class="exports-tube">

<p>Return information about a counter array in a map. The map has the following keys (at least):</p> <dl> <dt><strong><code class="code">size</code></strong></dt> <dd><p>The number of counters in the array.</p></dd> <dt><strong><code class="code">memory</code></strong></dt> <dd><p>Approximate memory consumption for the array in bytes.</p></dd> </dl> </div> </div> <div class="footer"> <hr> <p>Copyright Â© 1997-2021 Ericsson AB. All Rights Reserved.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2021 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
