  <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-module-idm2592').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-idm2592').style.visibility = 'hidden';">Module</span></h2> <p class="REFBODY module-body">instrument</p> </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-module-summary-idm2593').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-idm2593').style.visibility = 'hidden';">Module Summary</span></h2> <p class="REFBODY module-summary-body">Analysis and Utility Functions for Instrumentation</p> </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-description-idm2594').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-idm2594').style.visibility = 'hidden';">Description</span></h2> 
<p>The module <code class="code">instrument</code> contains support for studying the resource usage in an Erlang runtime system. Currently, only the allocation of memory can be studied.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>Note that this whole module is experimental, and the representations used as well as the functionality is likely to change in the future.</p> </div> </div>  </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-data-types-idm2599').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-idm2599').style.visibility = 'hidden';">Data Types</span></h2> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-block_histogram').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-block_histogram').style.visibility = 'hidden';">  <code id="type-block_histogram">block_histogram() = tuple()</code><br> </div> <div class="data-type-desc">

<p>A histogram of block sizes where each interval's upper bound is twice as high as the one before it.</p> <p>The upper bound of the first interval is provided by the function that returned the histogram, and the last interval has no upper bound.</p> </div> </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-allocation_summary').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-allocation_summary').style.visibility = 'hidden';">  <code>allocation_summary() = <br id="type-allocation_summary">    {HistogramStart :: integer() &gt;= 0,<br>     UnscannedSize :: integer() &gt;= 0,<br>     Allocations ::<br>         #{Origin :: atom() =&gt;<br>               #{Type :: atom() =&gt; <span><a href="#type-block_histogram">block_histogram()</a></span>}}}</code><br> </div> <div class="data-type-desc">

<p>A summary of allocated block sizes (including their headers) grouped by their <code class="code">Origin</code> and <code class="code">Type</code>.</p> <p><code class="code">Origin</code> is generally which NIF or driver that allocated the blocks, or 'system' if it could not be determined.</p> <p><code class="code">Type</code> is the allocation category that the blocks belong to, e.g. <code class="code">db_term</code>, <code class="code">message</code> or <code class="code">binary</code>.</p> <p>If one or more carriers could not be scanned in full without harming the responsiveness of the system, <code class="code">UnscannedSize</code> is the number of bytes that had to be skipped.</p> </div> </div> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-carrier_info_list').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-carrier_info_list').style.visibility = 'hidden';">  <code>carrier_info_list() = <br id="type-carrier_info_list">    {HistogramStart :: integer() &gt;= 0,<br>     Carriers ::<br>         [{AllocatorType :: atom(),<br>           InPool :: boolean(),<br>           TotalSize :: integer() &gt;= 0,<br>           UnscannedSize :: integer() &gt;= 0,<br>           Allocations ::<br>               {Type :: atom(),<br>                Count :: integer() &gt;= 0,<br>                Size :: integer() &gt;= 0},<br>           FreeBlocks :: <span><a href="#type-block_histogram">block_histogram()</a></span>}]}</code><br> </div> <div class="data-type-desc">

<p><code class="code">AllocatorType</code> is the type of the allocator that employs this carrier.</p> <p><code class="code">InPool</code> is whether the carrier is in the migration pool.</p> <p><code class="code">TotalSize</code> is the total size of the carrier, including its header.</p> <p><code class="code">Allocations</code> is a summary of the allocated blocks in the carrier.</p> <p><code class="code">FreeBlocks</code> is a histogram of the free block sizes in the carrier.</p> <p>If the carrier could not be scanned in full without harming the responsiveness of the system, <code class="code">UnscannedSize</code> is the number of bytes that had to be skipped.</p> </div> </div> </div> <div class="innertube"><h2><span onmouseover="document.getElementById('ghlink-exports-idm2646').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-idm2646').style.visibility = 'hidden';">Exports</span></h2></div> <div class="exports-body"> <table class="func-table" id="allocations-0"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-allocations-0-idp106').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-allocations-0-idp106').style.visibility = 'hidden';"> allocations() -&gt; {ok, Result} | {error, Reason}</div></td> <td class="func-since-td"><span class="since">OTP 21.0</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>    <div class="exports-tube">

<p>Shorthand for <code><a href="#allocations-1"><span class="code">allocations(#{})</span>.</a></code></p> </div> <table class="func-table" id="allocations-1"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-allocations-1-idp107').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-allocations-1-idp107').style.visibility = 'hidden';"> allocations(Options) -&gt; {ok, Result} | {error, Reason}</div></td> <td class="func-since-td"><span class="since">OTP 21.0</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>     <div class="exports-tube">

<p>Returns a summary of all tagged allocations in the system, optionally filtered by allocator type and scheduler id.</p> <p>Only binaries and allocations made by NIFs and drivers are tagged by default, but this can be configured an a per-allocator basis with the <code><span class="code">+M&lt;S&gt;atags</span> </code> emulator option.</p> <p>If the specified allocator types are not enabled, the call will fail with <code class="code">{error, not_enabled}</code>.</p> <p>The following options can be used:</p> <dl> <dt><strong><code class="code">allocator_types</code></strong></dt> <dd> <p>The allocator types that will be searched. Note that blocks can move freely between allocator types, so restricting the search to certain allocators may return unexpected types (e.g. process heaps when searching binary_alloc), or hide blocks that were migrated out.</p> <p>Defaults to all <code class="code">alloc_util</code> allocators.</p> </dd> <dt><strong><code class="code">scheduler_ids</code></strong></dt> <dd> <p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p> </dd> <dt><strong><code class="code">histogram_start</code></strong></dt> <dd> <p>The upper bound of the first interval in the allocated block size histograms. Defaults to 128.</p> </dd> <dt><strong><code class="code">histogram_width</code></strong></dt> <dd> <p>The number of intervals in the allocated block size histograms. Defaults to 18.</p> </dd> </dl> <p><strong>Example:</strong></p> <pre data-language="erlang">&gt; instrument:allocations(#{ histogram_start =&gt; 128, histogram_width =&gt; 15 }).
{ok,{128,0,
     #{udp_inet =&gt;
           #{driver_event_state =&gt; {0,0,0,0,0,0,0,0,0,1,0,0,0,0,0}},
       system =&gt;
           #{heap =&gt; {0,0,0,0,20,4,2,2,2,3,0,1,0,0,1},
             db_term =&gt; {271,3,1,52,80,1,0,0,0,0,0,0,0,0,0},
             code =&gt; {0,0,0,5,3,6,11,22,19,20,10,2,1,0,0},
             binary =&gt; {18,0,0,0,7,0,0,1,0,0,0,0,0,0,0},
             message =&gt; {0,40,78,2,2,0,0,0,0,0,0,0,0,0,0},
             ... }
       spawn_forker =&gt;
           #{driver_select_data_state =&gt;
                 {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0}},
       ram_file_drv =&gt; #{drv_binary =&gt; {0,0,0,0,0,0,1,0,0,0,0,0,0,0,0}},
       prim_file =&gt;
           #{process_specific_data =&gt; {2,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
             nif_trap_export_entry =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
             monitor_extended =&gt; {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0},
             drv_binary =&gt; {0,0,0,0,0,0,1,0,3,5,0,0,0,1,0},
             binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}},
       prim_buffer =&gt;
           #{nif_internal =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
             binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}}}}}</pre> </div> <table class="func-table" id="carriers-0"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-carriers-0-idp108').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-carriers-0-idp108').style.visibility = 'hidden';"> carriers() -&gt; {ok, Result} | {error, Reason}</div></td> <td class="func-since-td"><span class="since">OTP 21.0</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>    <div class="exports-tube">

<p>Shorthand for <code><a href="#carriers-1"><span class="code">carriers(#{})</span>.</a></code></p> </div> <table class="func-table" id="carriers-1"><tr class="func-tr"> <td class="func-td"><div onmouseover="document.getElementById('ghlink-carriers-1-idp109').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-carriers-1-idp109').style.visibility = 'hidden';"> carriers(Options) -&gt; {ok, Result} | {error, Reason}</div></td> <td class="func-since-td"><span class="since">OTP 21.0</span></td> </tr></table>  <h2 class="func-types-title">Types</h2>     <div class="exports-tube">

<p>Returns a summary of all carriers in the system, optionally filtered by allocator type and scheduler id.</p> <p>If the specified allocator types are not enabled, the call will fail with <code class="code">{error, not_enabled}</code>.</p> <p>The following options can be used:</p> <dl> <dt><strong><code class="code">allocator_types</code></strong></dt> <dd> <p>The allocator types that will be searched. Defaults to all <code class="code">alloc_util</code> allocators.</p> </dd> <dt><strong><code class="code">scheduler_ids</code></strong></dt> <dd> <p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p> </dd> <dt><strong><code class="code">histogram_start</code></strong></dt> <dd> <p>The upper bound of the first interval in the free block size histograms. Defaults to 512.</p> </dd> <dt><strong><code class="code">histogram_width</code></strong></dt> <dd> <p>The number of intervals in the free block size histograms. Defaults to 14.</p> </dd> </dl> <p><strong>Example:</strong></p> <pre data-language="erlang">&gt; instrument:carriers(#{ histogram_start =&gt; 512, histogram_width =&gt; 8 }).
{ok,{512,
     [{ll_alloc,1048576,0,1048344,71,false,{0,0,0,0,0,0,0,0}},
      {binary_alloc,1048576,0,324640,13,false,{3,0,0,1,0,0,0,2}},
      {eheap_alloc,2097152,0,1037200,45,false,{2,1,1,3,4,3,2,2}},
      {fix_alloc,32768,0,29544,82,false,{22,0,0,0,0,0,0,0}},
      {...}|...]}}</pre> </div> </div> <div class="innertube"> <h2><span onmouseover="document.getElementById('ghlink-see-also-idm2723').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-see-also-idm2723').style.visibility = 'hidden';">See Also</span></h2>  <p><code>erts_alloc(3)</code>, <code>erl(1)</code></p>  </div> <div class="footer"> <hr> <p>Copyright © 1997-2021 Ericsson AB. All Rights Reserved.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2021 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
