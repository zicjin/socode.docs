<div class="innertube"> <h1>3 Engine Load</h1> <p id="engine_load">  This chapter describes the support for loading encryption engines in the crypto application. </p> <h2><span onmouseover="document.getElementById('ghlink-background-idm175').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-background-idm175').style.visibility = 'hidden';">3.1 Background</span></h2> <p> OpenSSL exposes an Engine API, which makes it possible to plug in alternative implementations for some or all of the cryptographic operations implemented by OpenSSL. When configured appropriately, OpenSSL calls the engine's implementation of these operations instead of its own. </p> <p> Typically, OpenSSL engines provide a hardware implementation of specific cryptographic operations. The hardware implementation usually offers improved performance over its software-based counterpart, which is known as cryptographic acceleration. </p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The file name requirement on the engine dynamic library can differ between SSL versions.</p> </div> </div> <h2><span onmouseover="document.getElementById('ghlink-use-cases-idm181').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-use-cases-idm181').style.visibility = 'hidden';">3.2 Use Cases</span></h2> <h4><span onmouseover="document.getElementById('ghlink-dynamically-load-an-engine-from-default-directory-idm183').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-dynamically-load-an-engine-from-default-directory-idm183').style.visibility = 'hidden';">Dynamically load an engine from default directory</span></h4> <p> If the engine is located in the OpenSSL/LibreSSL installation <code class="code">engines</code> directory. </p> <pre data-language="erlang">1&gt; {ok, Engine} = crypto:engine_load(&lt;&lt;"otp_test_engine"&gt;&gt;, [], []).
 {ok, #Ref}</pre> <h4><span onmouseover="document.getElementById('ghlink-load-an-engine-with-the-dynamic-engine-idm188').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-load-an-engine-with-the-dynamic-engine-idm188').style.visibility = 'hidden';">Load an engine with the dynamic engine</span></h4> <p> Load an engine with the help of the dynamic engine by giving the path to the library. </p> <pre data-language="erlang">2&gt; {ok, Engine} = crypto:engine_load(&lt;&lt;"dynamic"&gt;&gt;,
                                     [{&lt;&lt;"SO_PATH"&gt;&gt;,
                                       &lt;&lt;"/some/path/otp_test_engine.so"&gt;&gt;},
                                      {&lt;&lt;"ID"&gt;&gt;, &lt;&lt;"MD5"&gt;&gt;},
                                      &lt;&lt;"LOAD"&gt;&gt;],
                                     []).
{ok, #Ref}</pre> <h4><span onmouseover="document.getElementById('ghlink-load-an-engine-and-replace-some-methods-idm192').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-load-an-engine-and-replace-some-methods-idm192').style.visibility = 'hidden';">Load an engine and replace some methods</span></h4> <p> Load an engine with the help of the dynamic engine and just replace some engine methods. </p> <pre data-language="erlang"> 3&gt; Methods = crypto:engine_get_all_methods() -- [engine_method_dh,engine_method_rand,
engine_method_ciphers,engine_method_digests, engine_method_store,
engine_method_pkey_meths, engine_method_pkey_asn1_meths].
[engine_method_rsa,engine_method_dsa,
 engine_method_ecdh,engine_method_ecdsa]
 4&gt; {ok, Engine} = crypto:engine_load(&lt;&lt;"dynamic"&gt;&gt;,
                                      [{&lt;&lt;"SO_PATH"&gt;&gt;,
                                        &lt;&lt;"/some/path/otp_test_engine.so"&gt;&gt;},
                                       {&lt;&lt;"ID"&gt;&gt;, &lt;&lt;"MD5"&gt;&gt;},
                                       &lt;&lt;"LOAD"&gt;&gt;],
                                      [],
		                      Methods).
 {ok, #Ref}</pre> <h4><span onmouseover="document.getElementById('ghlink-load-with-the-ensure-loaded-function-idm196').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-load-with-the-ensure-loaded-function-idm196').style.visibility = 'hidden';">Load with the ensure loaded function</span></h4> <p> This function makes sure the engine is loaded just once and the ID is added to the internal engine list of OpenSSL. The following calls to the function will check if the ID is loaded and then just get a new reference to the engine. </p> <pre data-language="erlang">5&gt; {ok, Engine} = crypto:ensure_engine_loaded(&lt;&lt;"MD5"&gt;&gt;,
                                              &lt;&lt;"/some/path/otp_test_engine.so"&gt;&gt;).
{ok, #Ref}</pre> <p> To unload it use crypto:ensure_engine_unloaded/1 which removes the ID from the internal list before unloading the engine. </p> <pre data-language="erlang">6&gt; crypto:ensure_engine_unloaded(&lt;&lt;"MD5"&gt;&gt;).
ok</pre> <h4><span onmouseover="document.getElementById('ghlink-list-all-engines-currently-loaded-idm202').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-list-all-engines-currently-loaded-idm202').style.visibility = 'hidden';">List all engines currently loaded</span></h4> <pre data-language="erlang"> 5&gt; crypto:engine_list().
[&lt;&lt;"dynamic"&gt;&gt;, &lt;&lt;"MD5"&gt;&gt;]</pre> </div> <div class="footer"> <hr> <p>Copyright Â© 1999-2021 Ericsson AB. All Rights Reserved.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2021 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
