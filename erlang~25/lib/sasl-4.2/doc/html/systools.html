  <div class="innertube"> <h2 id="module" class="title-link" onmouseover="document.getElementById('ghlink-module-idm1513').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-idm1513').style.visibility = 'hidden';"> <div class="title-name">Module</div>  </h2> <p class="REFBODY module-body">systools</p> </div> <div class="innertube"> <h2 id="module-summary" class="title-link" onmouseover="document.getElementById('ghlink-module-summary-idm1514').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-idm1514').style.visibility = 'hidden';"> <div class="title-name">Module Summary</div>  </h2> <p class="REFBODY module-summary-body">A Set of Release Handling Tools</p> </div> <section class="description"><div class="innertube"> <h2 id="description" class="title-link" onmouseover="document.getElementById('ghlink-description-idm1515').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-idm1515').style.visibility = 'hidden';"> <div class="title-name">Description</div>  </h2> 
<p>This module contains functions to generate boot scripts (<code class="code">.boot</code>, <code class="code">.script</code>), a release upgrade file (<code class="code">relup</code>), and release packages.</p>  </div></section> <div class="innertube"><h2 id="export" class="title-link" onmouseover="document.getElementById('ghlink-export-idm1520').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-export-idm1520').style.visibility = 'hidden';"> <div class="title-name">Exports</div>  </h2></div> <div class="exports-body"> <article class="func"><div><h4 id="make_relup-3" class="title-link" onmouseover="document.getElementById('ghlink-make_relup-3-idm1522').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-make_relup-3-idm1522').style.visibility = 'hidden';">  <div class="title-name">make_relup(Name, UpFrom, DownTo) -&gt; Result</div> </h4></div> <div><h4 id="make_relup-4" class="title-link" onmouseover="document.getElementById('ghlink-make_relup-4-idm1523').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-make_relup-4-idm1523').style.visibility = 'hidden';">  <div class="title-name">make_relup(Name, UpFrom, DownTo, [Opt]) -&gt; Result</div> </h4></div> <div class="exports-tube">  <h2 id="types" class="func-types-title">Types</h2>            <p>Generates a release upgrade file <code class="code">relup</code> containing instructions for upgrading from or downgrading to one or more previous releases. The instructions are used by <code><a href="release_handler"><span class="code">release_handler</span></a></code> when installing a new version of a release in runtime.</p> <p>By default, <code class="code">relup</code> file is located in the current working directory. If option <code class="code">{outdir,Dir}</code> is specified, the <code class="code">relup</code> file is located in <code class="code">Dir</code> instead.</p> <p>The release resource file <code class="code">Name.rel</code> is compared with all release resource files <code class="code">Name2.rel</code>, specified in <code class="code">UpFrom</code> and <code class="code">DownTo</code>. For each such pair, the following is deducted:</p> <ul> <li> <p>Which applications to be deleted, that is, applications listed in <code class="code">Name.rel</code> but not in <code class="code">Name2.rel</code></p> </li> <li> <p>Which applications to be added, that is, applications listed in <code class="code">Name2.rel</code> but not in <code class="code">Name.rel</code></p> </li> <li> <p>Which applications to be upgraded/downgraded, that is, applications listed in both <code class="code">Name.rel</code> and <code class="code">Name2.rel</code> but with different versions</p> </li> <li> <p>If the emulator needs to be restarted after upgrading or downgrading, that is, if the ERTS version differs between <code class="code">Name.rel</code> and <code class="code">Name2.rel</code></p> </li> </ul> <p>Instructions for this are added to the <code class="code">relup</code> file in the above order. Instructions for upgrading or downgrading between application versions are fetched from the relevant application upgrade files <code class="code">App.appup</code>, sorted in the same order as when generating a boot script, see <code><a href="#make_script-1"><span class="code">make_script/1,2</span></a></code>. High-level instructions are translated into low-level instructions and the result is printed to the <code class="code">relup</code> file.</p> <p>The optional <code class="code">Descr</code> parameter is included "as is" in the <code class="code">relup</code> file, see <code><a href="relup"><span class="code">relup(4)</span></a></code>. Defaults to the empty list.</p> <p>All the files are searched for in the code path. It is assumed that the <code class="code">.app</code> and <code class="code">.appup</code> files for an application are located in the same directory.</p> <p>If option <code class="code">{path,[Dir]}</code> is specified, this path is appended to the current path. Wildcard <code class="code">*</code> is expanded to all matching directories, for example, <code class="code">lib/*/ebin</code>.</p> <p>If option <code class="code">restart_emulator</code> is specified, a low-level instruction to restart the emulator is appended to the <code class="code">relup</code> file. This ensures that a complete reboot of the system is done when the system is upgraded or downgraded.</p> <p>If an upgrade includes a change from an emulator earlier than OTP R15 to OTP R15 or later, the warning <code class="code">pre_R15_emulator_upgrade</code> is issued. For more information about this, see <code>Design Principles</code> in <strong>System Documentation</strong>.</p> <p>By default, errors and warnings are printed to tty and the function returns <code class="code">ok</code> or <code class="code">error</code>. If option <code class="code">silent</code> is specified, the function instead either returns <code class="code">{ok,Relup,Module,Warnings}</code>, where <code class="code">Relup</code> is the release upgrade file, or <code class="code">{error,Module,Error}</code>. Warnings and errors can be converted to strings by calling <code class="code">Module:format_warning(Warnings)</code> or <code class="code">Module:format_error(Error)</code>.</p> <p>If option <code class="code">noexec</code> is specified, the function returns the same values as for <code class="code">silent</code> but no <code class="code">relup</code> file is created.</p> <p>If option <code class="code">warnings_as_errors</code> is specified, warnings are treated as errors.</p>  </div></article><article class="func"><div><h4 id="make_script-1" class="title-link" onmouseover="document.getElementById('ghlink-make_script-1-idm1609').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-make_script-1-idm1609').style.visibility = 'hidden';">  <div class="title-name">make_script(Name) -&gt; Result</div> </h4></div> <div><h4 id="make_script-2" class="title-link" onmouseover="document.getElementById('ghlink-make_script-2-idm1610').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-make_script-2-idm1610').style.visibility = 'hidden';">  <div class="title-name">make_script(Name, [Opt]) -&gt; Result</div> </h4></div> <div class="exports-tube">  <h2 id="types" class="func-types-title">Types</h2>            <p>Generates a boot script <code class="code">Name.script</code> and its binary version, the boot file <code class="code">Name.boot</code>, unless the <code class="code">{script_name, ScriptName}</code> option is given, in which case the names are <code class="code">ScriptName.script</code> and <code class="code">ScriptName.boot</code> The boot file specifies which code to be loaded and which applications to be started when the Erlang runtime system is started. See <code><a href="script"><span class="code">script(4)</span></a></code>.</p> <p>The release resource file <code class="code">Name.rel</code> is read to determine which applications are included in the release. Then the relevant application resource files <code class="code">App.app</code> are read to determine which modules to be loaded, and if and how the applications are to be started. (Keys <code class="code">modules</code> and <code class="code">mod</code>, see <code><span class="code">app(4)</span></code>.</p> <p>By default, the boot script and boot file are located in the same directory as <code class="code">Name.rel</code>. That is, in the current working directory unless <code class="code">Name</code> contains a path. If option <code class="code">{outdir,Dir}</code> is specified, they are located in <code class="code">Dir</code> instead.</p> <p>The correctness of each application is checked as follows:</p> <ul> <li> <p>The version of an application specified in the <code class="code">.rel</code> file is to be the same as the version specified in the <code class="code">.app</code> file.</p> </li> <li> <p>There are to be no undefined applications, that is, dependencies to applications that are not included in the release. (Key <code class="code">applications</code> in the <code class="code">.app</code> file).</p> </li> <li> <p>There are to be no circular dependencies among the applications.</p> </li> <li> <p>There are to be no duplicated modules, that is, modules with the same name but belonging to different applications.</p> </li> <li> <p>If option <code class="code">src_tests</code> is specified, a warning is issued if the source code for a module is missing or is newer than the object code.</p> </li> </ul> <p>The applications are sorted according to the dependencies between the applications. Where there are no dependencies, the order in the <code class="code">.rel</code> file is kept.</p> <p>The function fails if the mandatory applications Kernel and STDLIB are not included in the <code class="code">.rel</code> file and have start type <code class="code">permanent</code> (which is default).</p> <p>If SASL is not included as an application in the <code class="code">.rel</code> file, a warning is issued because such a release cannot be used in an upgrade. To turn off this warning, add option <code class="code">no_warn_sasl</code>.</p> <p>All files are searched for in the current path. It is assumed that the <code class="code">.app</code> and <code class="code">.beam</code> files for an application are located in the same directory. The <code class="code">.erl</code> files are also assumed to be located in this directory, unless it is an <code class="code">ebin</code> directory in which case they can be located in the corresponding <code class="code">src</code> directory.</p> <p>If option <code class="code">{path,[Dir]}</code> is specified, this path is appended to the current path. A directory in the path can be specified with a wildcard <code class="code">*</code>, this is expanded to all matching directories. Example: <code class="code">"lib/*/ebin"</code>.</p> <p>In the generated boot script all application directories are structured as <code class="code">App-Vsn/ebin</code>. They are assumed to be located in <code class="code">$ROOT/lib</code>, where <code class="code">$ROOT</code> is the root directory of the installed release. If option <code class="code">local</code> is specified, the actual directories where the applications were found are used instead. This is a useful way to test a generated boot script locally.</p> <p>Option <code class="code">variables</code> can be used to specify an installation directory other than <code class="code">$ROOT/lib</code> for some of the applications. If a variable <code class="code">{VarName,Prefix}</code> is specified and an application is found in a directory <code class="code">Prefix/Rest/App[-Vsn]/ebin</code>, this application gets the path <code class="code">VarName/Rest/App-Vsn/ebin</code> in the boot script. If an application is found in a directory <code class="code">Prefix/Rest</code>, the path is <code class="code">VarName/Rest/App-Vsn/ebin</code>. When starting Erlang, all variables <code class="code">VarName</code> are given values using command-line flag <code class="code">boot_var</code>.</p> <p><strong>Example:</strong> If option <code class="code">{variables,[{"TEST","lib"}]}</code> is specified and <code class="code">myapp.app</code> is found in <code class="code">lib/myapp/ebin</code>, the path to this application in the boot script is <code class="code">"$TEST/myapp-1/ebin"</code>. If <code class="code">myapp.app</code> is found in <code class="code">lib/test</code>, the path is <code class="code">$TEST/test/myapp-1/ebin</code>.</p> <p>The checks performed before the boot script is generated can be extended with some cross reference checks by specifying option <code class="code">exref</code>. These checks are performed with the Xref tool. All applications, or the applications specified with <code class="code">{exref,[App]}</code>, are checked by Xref and warnings are issued for calls to undefined functions.</p> <p>By default, errors and warnings are printed to tty and the function returns <code class="code">ok</code> or <code class="code">error</code>. If option <code class="code">silent</code> is specified, the function instead returns <code class="code">{ok,Module,Warnings}</code> or <code class="code">{error,Module,Error}</code>. Warnings and errors can be converted to strings by calling <code class="code">Module:format_warning(Warnings)</code> or <code class="code">Module:format_error(Error)</code>.</p> <p>If option <code class="code">warnings_as_errors</code> is specified, warnings are treated as errors.</p> <p>If option <code class="code">no_dot_erlang</code> is specified, the instruction to load the <code class="code">.erlang</code> file during boot is <strong>not</strong> included.</p>  </div></article><article class="func"><h4 id="make_tar-1" onmouseover="document.getElementById('ghlink-make_tar-1-idp1').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-make_tar-1-idp1').style.visibility = 'hidden';">  <span class="title-name">make_tar(Name) -&gt; Result</span> </h4> <h4 id="make_tar-2" onmouseover="document.getElementById('ghlink-make_tar-2-idp2').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-make_tar-2-idp2').style.visibility = 'hidden';">  <span class="title-name">make_tar(Name, Opts) -&gt; Result</span> </h4>  <h2 id="types" class="func-types-title">Types</h2>               <div class="exports-tube"> <p>Creates a release package file <code class="code">Name.tar.gz</code>. This file must be uncompressed and unpacked on the target system using <code><a href="release_handler"><span class="code">release_handler</span></a></code> before the new release can be installed.</p> <p>The release resource file <code class="code">Name.rel</code> is read to determine which applications are included in the release. Then the relevant application resource files <code class="code">App.app</code> are read to determine the version and modules of each application (keys <code class="code">vsn</code> and <code class="code">modules</code>, see <code><span class="code">app(4)</span></code>).</p> <p>By default, the release package file is located in the same directory as <code class="code">Name.rel</code>. That is, in the current working directory unless <code class="code">Name</code> contains a path. If option <code class="code">{outdir,Dir}</code> is specified, it is located in <code class="code">Dir</code> instead.</p> <p>If SASL is not included as an application in the <code class="code">.rel</code> file, a warning is issued because such a release cannot be used in an upgrade. To turn off this warning, add option <code class="code">no_warn_sasl</code>.</p> <p>By default, the release package contains the directories <code class="code">lib/App-Vsn/ebin</code> and <code class="code">lib/App-Vsn/priv</code> for each included application. If more directories are to be included, option <code class="code">dirs</code> is specified, for example, <code class="code">{dirs,[src,examples]}</code>.</p> <p>All these files are searched for in the current path. If option <code class="code">{path,[Dir]}</code> is specified, this path is appended to the current path. Wildcard <code class="code">*</code> is expanded to all matching directories. Example: <code class="code">"lib/*/ebin"</code>.</p> <p>If the <code class="code">{extra_files, ExtraFiles}</code> option is given then the <code class="code">ExtraFiles</code> are added to the tarball after everything else to be included has been added. The <code class="code">ExtraFiles</code> list is a list of files or directories in the same format as the <code class="code">add_type()</code> tuple for <code>erl_tar:add/3,4</code></p> <p>Option <code class="code">variables</code> can be used to specify an installation directory other than <code class="code">lib</code> for some of the applications. If variable <code class="code">{VarName,Prefix}</code> is specified and an application is found in directory <code class="code">Prefix/Rest/App[-Vsn]/ebin</code>, this application is packed into a separate <code class="code">VarName.tar.gz</code> file as <code class="code">Rest/App-Vsn/ebin</code>.</p> <p><strong>Example:</strong> If option <code class="code">{variables,[{"TEST","lib"}]}</code> is specified and <code class="code">myapp.app</code> is located in <code class="code">lib/myapp-1/ebin</code>, application <code class="code">myapp</code> is included in <code class="code">TEST.tar.gz</code>:</p> <pre data-language="erlang">
% tar tf TEST.tar
myapp-1/ebin/myapp.app
...</pre> <p>Option <code class="code">{var_tar,VarTar}</code> can be used to specify if and where a separate package is to be stored. In this option <code class="code">VarTar</code> is one of the following:</p> <dl> <dt><strong><code class="code">include</code></strong></dt> <dd><p>Each separate (variable) package is included in the main <code class="code">ReleaseName.tar.gz</code> file. This is the default.</p></dd> <dt><strong><code class="code">ownfile</code></strong></dt> <dd><p>Each separate (variable) package is generated as a separate file in the same directory as the <code class="code">ReleaseName.tar.gz</code> file.</p></dd> <dt><strong><code class="code">omit</code></strong></dt> <dd><p>No separate (variable) packages are generated. Applications that are found underneath a variable directory are ignored.</p></dd> </dl> <p>A directory <code class="code">releases</code> is also included in the release package, containing <code class="code">Name.rel</code> and a subdirectory <code class="code">RelVsn</code>. <code class="code">RelVsn</code> is the release version as specified in <code class="code">Name.rel</code>.</p> <p><code class="code">releases/RelVsn</code> contains the boot script <code class="code">Name.boot</code> renamed to <code class="code">start.boot</code> and, if found, the files <code class="code">relup</code> and <code class="code">sys.config</code> or <code class="code">sys.config.src</code>. These files are searched for in the same directory as <code class="code">Name.rel</code>, in the current working directory, and in any directories specified using option <code class="code">path</code>. In the case of <code class="code">sys.config</code> it is not included if <code class="code">sys.config.src</code> is found.</p> <p>If the release package is to contain a new Erlang runtime system, the <code class="code">erts-ErtsVsn/bin</code> directory of the specified runtime system <code class="code">{erts,Dir}</code> is copied to <code class="code">erts-ErtsVsn/bin</code>. Some erts executables are not copied by default, if you want to include all executables you can give the <code class="code">erts_all</code> option.</p> <p>All checks with function <code><a href="#make_script-1"><span class="code">make_script</span></a></code> are performed before the release package is created. Options <code class="code">src_tests</code> and <code class="code">exref</code> are also valid here.</p> <p>The return value and the handling of errors and warnings are the same as described for <code><a href="#make_script-1"><span class="code">make_script</span></a></code>.</p> </div></article><article class="func"><div><h4 id="script2boot-1" class="title-link" onmouseover="document.getElementById('ghlink-script2boot-1-idm1824').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-script2boot-1-idm1824').style.visibility = 'hidden';">  <div class="title-name">script2boot(File) -&gt; ok | error</div> </h4></div> <div class="exports-tube">  <h2 id="types" class="func-types-title">Types</h2>    <p>The Erlang runtime system requires that the contents of the script used to boot the system is a binary Erlang term. This function transforms the <code class="code">File.script</code> boot script to a binary term, which is stored in the <code class="code">File.boot</code> file.</p> <p>A boot script generated using <code><a href="#make_script-1"><span class="code">make_script</span></a></code> is already transformed to the binary form.</p>  </div></article> </div> <section class="innertube"><h2 id="see-also" class="title-link" onmouseover="document.getElementById('ghlink-see-also-idm1835').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-see-also-idm1835').style.visibility = 'hidden';"> <div class="title-name">See Also</div>  </h2>  <p><code><span class="code">app(4)</span></code>, <code><a href="appup"><span class="code">appup(4)</span></a></code>, <code><span class="code">erl(1)</span></code>, <code><a href="rel"><span class="code">rel(4)</span></a></code>, <code><a href="release_handler"><span class="code">release_handler(3)</span></a></code>, <code><a href="relup"><span class="code">relup(4)</span></a></code>, <code><a href="script"><span class="code">script(4)</span></a></code></p> </section> <div class="footer"> <hr> <p>Copyright © 1997-2022 Ericsson AB. All Rights Reserved.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2022 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
