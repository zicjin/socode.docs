  <div class="innertube"> <h2 id="module" class="title-link" onmouseover="document.getElementById('ghlink-module-idm3415').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-idm3415').style.visibility = 'hidden';"> <div class="title-name">Module</div>  </h2> <p class="REFBODY module-body">ssh_file</p> </div> <div class="innertube"> <h2 id="module-summary" class="title-link" onmouseover="document.getElementById('ghlink-module-summary-idm3416').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-idm3416').style.visibility = 'hidden';"> <div class="title-name">Module Summary</div>  </h2> <p class="REFBODY module-summary-body">Default callback module for the client's and server's database operations in the ssh application</p> <h2 id="since" class="title-link" onmouseover="document.getElementById('ghlink-since-idm3416').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-since-idm3416').style.visibility = 'hidden';"> <div class="title-name">Since</div>  </h2> <p class="REFBODY module-since"> Module ssh_file was introduced in OTP 21.2. </p> </div> <section class="description"><div class="innertube"> <h2 id="description" class="title-link" onmouseover="document.getElementById('ghlink-description-idm3417').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-idm3417').style.visibility = 'hidden';"> <div class="title-name">Description</div>  </h2> 
<p>This module is the default callback handler for the client's and the server's user and host "database" operations. All data, for instance key pairs, are stored in files in the normal file system. This page documents the files, where they are stored and configuration options for this callback module. </p> <p>The intention is to be compatible with the <code><a href="http://www.openssh.com">OpenSSH</a></code> storage in files. Therefore it mimics directories and filenames of <code><a href="http://www.openssh.com">OpenSSH</a></code>. </p> <p>Ssh_file implements the <code>ssh_server_key_api</code> and the <code>ssh_client_key_api</code>. This enables the user to make an own interface using for example a database handler. </p> <p>Such another callback module could be used by setting the option <code><span class="code">key_cb</span></code> when starting a client or a server (with for example <code>ssh:connect</code>, <code>ssh:daemon</code> of <code>ssh:shell</code> ). </p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The functions are <i>Callbacks</i> for the SSH app. They are not intended to be called from the user's code! </p> </div> </div>  </div></section> <section class="innertube"><h2 id="files,-directories-and-who-uses-them" class="title-link" onmouseover="document.getElementById('ghlink-files,-directories-and-who-uses-them-idm3434').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-files,-directories-and-who-uses-them-idm3434').style.visibility = 'hidden';"> <div class="title-name">Files, directories and who uses them</div>  </h2>  <section><h4 id="Daemons">Daemons</h4>  <p>Daemons uses all files stored in the <code><a href="#SYSDIR">SYSDIR</a></code> directory. </p> <p>Optionally, in case of <code class="code">publickey</code> authorization, one or more of the remote user's public keys in the <code><a href="#USERDIR">USERDIR</a></code> directory are used. See the files <code><a href="#FILE-authorized_keys"><span class="code">USERDIR/authorized_keys</span></a></code> and <code><a href="#FILE-authorized_keys2"><span class="code">USERDIR/authorized_keys2</span></a></code>. </p> </section> <section><h4 id="Clients">Clients</h4>  <p>Clients uses all files stored in the <code><a href="#USERDIR">USERDIR</a></code> directory. </p> </section> <section><h4 id="Directory contents">Directory contents</h4>  <dl> <dt><strong id="LOCALUSER">LOCALUSER</strong></dt> <dd> <p>The user name of the OS process running the Erlang virtual machine (emulator).</p> </dd> <dt><strong id="SYSDIR">SYSDIR</strong></dt> <dd> <p>This is the directory holding the server's files:</p> <ul> <li>  <code class="code" id="FILE-ssh_host_dsa_key">ssh_host_dsa_key</code> - private dss host key (optional)</li> <li> <code class="code" id="FILE-ssh_host_rsa_key">ssh_host_rsa_key</code> - private rsa host key (optional)</li> <li> <code class="code" id="FILE-ssh_host_ecdsa_key">ssh_host_ecdsa_key</code> - private ecdsa host key (optional)</li> <li> <code class="code" id="FILE-ssh_host_ed25519_key">ssh_host_ed25519_key</code> - private eddsa host key for curve 25519 (optional)</li> <li> <code class="code" id="FILE-ssh_host_ed448_key">ssh_host_ed448_key</code> - private eddsa host key for curve 448 (optional)</li> </ul> <p>The key files could be generated with OpenSSH's ssh-keygen command.</p> <p>At least one host key must be defined. The default value of SYSDIR is <code class="code" id="#/etc/ssh">/etc/ssh</code>. </p> <p>For security reasons, this directory is normally accessible only to the root user. </p> <p>To change the SYSDIR, see the <code><a href="#type-system_dir_daemon_option">system_dir</a></code> option. </p> </dd> <dt><strong id="USERDIR">USERDIR</strong></dt> <dd> <p>This is the directory holding the files:</p> <ul> <li> <code class="code" id="FILE-authorized_keys">authorized_keys</code> and, as second alternative <code class="code" id="FILE-authorized_keys2">authorized_keys2</code> - the user's public keys are stored concatenated in one of those files. <p>It is composed of lines as for <code><a href="https://man.openbsd.org/sshd#AUTHORIZED_KEYS_FILE_FORMAT">OpenSSH</a></code>:</p> <pre data-language="erlang">(options)? keytype base64-encoded-key comment</pre> <p>where</p> <pre data-language="erlang">options :: option(,option)*
option :: % All options are skipped
keytype :: 'ssh-dsa'
         | 'ssh-rsa'
         | 'ssh-ecdsa-nistp256'
	 | 'ssh-ecdsa-nistp384'
         | 'ssh-ecdsa-nistp521'
         | 'ssh-ed25519'
	 | 'ssh-ed448'
base64-encoded-key :: % The user's public key
comment :: % Comments are skipped</pre> </li> <li> <code class="code" id="FILE-known_hosts">known_hosts</code> - host keys from hosts visited concatenated. The file is created and used by the client. <p>It is composed of lines as for <code><a href="https://man.openbsd.org/sshd#SSH_KNOWN_HOSTS_FILE_FORMAT">OpenSSH</a></code>:</p> <pre data-language="erlang">(option)? pattern(,pattern)* keytype key (comment)?</pre> <p>where</p> <pre data-language="erlang">option :: '@revoked'
pattern :: host | '[' host ']:' port
host :: ip-address | hostname | '*'
port :: portnumber | '*'
keytype :: 'ssh-dsa'
         | 'ssh-rsa'
         | 'ssh-ecdsa-nistp256'
	 | 'ssh-ecdsa-nistp384'
         | 'ssh-ecdsa-nistp521'
         | 'ssh-ed25519'
	 | 'ssh-ed448'
key :: % encoded key from eg ssh_host_*.pub</pre> </li> <li>  <code class="code" id="FILE-id_dsa">id_dsa</code> - private dss user key (optional)</li> <li> <code class="code" id="FILE-id_rsa">id_rsa</code> - private rsa user key (optional)</li> <li> <code class="code" id="FILE-id_ecdsa">id_ecdsa</code> - private ecdsa user key (optional)</li> <li> <code class="code" id="FILE-id_ed25519">id_ed25519</code> - private eddsa user key for curve 25519 (optional)</li> <li> <code class="code" id="FILE-id_ed448">id_ed448</code> - private eddsa user key for curve 448 (optional)</li> </ul> <p>The key files could be generated with OpenSSH's ssh-keygen command.</p> <p>The default value of USERDIR is <code class="code">/home/</code><code><a href="#LOCALUSER"><span class="code">LOCALUSER</span></a></code><code class="code">/.ssh</code>. </p> <p>To change the USERDIR, see the <code><a href="#type-user_dir_common_option">user_dir</a></code> option </p> </dd> </dl> </section> </section> <div class="innertube"> <h2 id="data-types" class="title-link" onmouseover="document.getElementById('ghlink-data-types-idm3533').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-idm3533').style.visibility = 'hidden';"> <div class="title-name">Data Types</div>  </h2> <h4 id="Options for the default ssh_file callback module" class="title-link" onmouseover="document.getElementById('ghlink-Options for the default ssh_file callback module-idm3534').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-Options for the default ssh_file callback module-idm3534').style.visibility = 'hidden';"> <div class="title-name">Options for the default ssh_file callback module</div>  </h4> <article class="data-types-body"><h4 id="type-user_dir_common_option" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-user_dir_common_option').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-user_dir_common_option').style.visibility = 'hidden';">  <div class="title-name"> <code>user_dir_common_option() = {user_dir, <span id="type-user_dir_common_option">string()</span>}</code><br> </div> </h4> <div class="data-type-desc"> <p>Sets the <code><a href="#USERDIR">user directory</a></code>.</p> </div></article> <article class="data-types-body"><h4 id="type-user_dir_fun_common_option" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-user_dir_fun_common_option').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-user_dir_fun_common_option').style.visibility = 'hidden';">  <div class="title-name"> <code>user_dir_fun_common_option() = {user_dir_fun, <span id="type-user_dir_fun_common_option"><a href="#type-user2dir">user2dir()</a></span>}</code><br> <code>user2dir() = <br id="type-user2dir">    fun((RemoteUserName :: <span>string()</span>) -&gt; UserDir :: <span>string()</span>)</code><br> </div> </h4> <div class="data-type-desc"> <p>Sets the <code><a href="#USERDIR">user directory</a></code> dynamically by evaluating the <code class="code">user2dir</code> function. </p> </div></article> <article class="data-types-body"><h4 id="type-system_dir_daemon_option" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-system_dir_daemon_option').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-system_dir_daemon_option').style.visibility = 'hidden';">  <div class="title-name"> <code>system_dir_daemon_option() = {system_dir, <span id="type-system_dir_daemon_option">string()</span>}</code><br> </div> </h4> <div class="data-type-desc"> <p>Sets the <code><a href="#SYSDIR">system directory</a></code>.</p> </div></article> <article class="data-types-body"><h4 id="type-pubkey_passphrase_client_options" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-pubkey_passphrase_client_options').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-pubkey_passphrase_client_options').style.visibility = 'hidden';">  <div class="title-name"> <code>pubkey_passphrase_client_options() = <br id="type-pubkey_passphrase_client_options">    {dsa_pass_phrase, <span>string()</span>} |<br>    {rsa_pass_phrase, <span>string()</span>} |<br>    {ecdsa_pass_phrase, <span>string()</span>}</code><br> </div> </h4> <div class="data-type-desc"> <p>If the user's DSA, RSA or ECDSA key is protected by a passphrase, it can be supplied with thoose options. </p> <p>Note that EdDSA passhrases (Curves 25519 and 448) are not implemented.</p> </div></article> <article class="data-types-body"><h4 id="type-optimize_key_lookup" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-optimize_key_lookup').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-optimize_key_lookup').style.visibility = 'hidden';">  <div class="title-name"> <code id="type-optimize_key_lookup">optimize_key_lookup() = {optimize, time | space}</code><br> </div> </h4> <div class="data-type-desc"> <p>Make the handling of large files fast by setting <code class="code">time</code>, but this will use more memory. The <code class="code">space</code> variant shrinks the memory requirements, but with a higher time consumption. </p> <p>To set it, set the option <code class="code">{key_cb, {ssh_file, [{optimize,TimeOrSpace}]}</code> in the call of <code><a href="ssh#connect-3">"ssh:connect/3</a></code>, <code><a href="ssh#daemon-2">ssh:daemon/2</a></code> or similar function call that initiates an ssh connection. </p> </div></article> <article class="data-types-body"><h4 id="type-key" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-key').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-key').style.visibility = 'hidden';">  <div class="title-name"> <code>key() = <span id="type-key">public_key:public_key()</span> | <span>public_key:private_key()</span></code><br> </div> </h4> <div class="data-type-desc"> <p>The key representation</p> </div></article> <article class="data-types-body"><h4 id="type-experimental_openssh_key_v1" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-experimental_openssh_key_v1').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-experimental_openssh_key_v1').style.visibility = 'hidden';">  <div class="title-name"> <code>experimental_openssh_key_v1() = <br id="type-experimental_openssh_key_v1">    [{<span><a href="#type-key">key()</a></span>, <span><a href="#type-openssh_key_v1_attributes">openssh_key_v1_attributes()</a></span>}]</code><br> <code>openssh_key_v1_attributes() = [{<span id="type-openssh_key_v1_attributes">atom()</span>, <span>term()</span>}]</code><br> </div> </h4> <div class="data-type-desc"> <p>Types for the experimental implementaition of the <code class="code">openssh_key_v1</code> format. </p> </div></article> </div> <div class="innertube"><h2 id="export" class="title-link" onmouseover="document.getElementById('ghlink-export-idm3577').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-export-idm3577').style.visibility = 'hidden';"> <div class="title-name">Exports</div>  </h2></div> <div class="exports-body"> <article class="func"><h4 id="host_key-2" onmouseover="document.getElementById('ghlink-host_key-2-idp35').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-host_key-2-idp35').style.visibility = 'hidden';">  <span class="title-name">host_key(Algorithm, Options) -&gt; Result</span><div class="title-since"><span class="since">OTP 21.2</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>     <div class="exports-tube"> <p><strong>Types and description</strong></p> <p>See the api description in <code>ssh_server_key_api, Module:host_key/2</code>. </p> <p><strong>Options</strong></p> <ul> <li><code><a href="#type-system_dir_daemon_option">system_dir</a></code></li> </ul> <p><strong>Files</strong></p> <ul> <li><code><a href="#FILE-ssh_host_rsa_key"><span class="code">SYSDIR/ssh_host_rsa_key</span></a></code></li> <li><code><a href="#FILE-ssh_host_dsa_key"><span class="code">SYSDIR/ssh_host_dsa_key</span></a></code></li> <li><code><a href="#FILE-ssh_host_ecdsa_key"><span class="code">SYSDIR/ssh_host_ecdsa_key</span></a></code></li> <li><code><a href="#FILE-ssh_host_ed25519_key"><span class="code">SYSDIR/ssh_host_ed25519_key</span></a></code></li> <li><code><a href="#FILE-ssh_host_ed448_key"><span class="code">SYSDIR/ssh_host_ed448_key</span>c&gt;</a></code></li> </ul> </div></article><article class="func"><h4 id="is_auth_key-3" onmouseover="document.getElementById('ghlink-is_auth_key-3-idp36').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-is_auth_key-3-idp36').style.visibility = 'hidden';">  <span class="title-name">is_auth_key(Key, User, Options) -&gt; <code>boolean()</code></span><div class="title-since"><span class="since">OTP 21.2</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>     <div class="exports-tube"> <p><strong>Types and description</strong></p> <p>See the api description in <code>ssh_server_key_api: Module:is_auth_key/3</code>. </p> <p><strong>Options</strong></p> <ul> <li><code><a href="#type-user_dir_fun_common_option">user_dir_fun</a></code></li> <li><code><a href="#type-user_dir_common_option">user_dir</a></code></li> </ul> <p><strong>Files</strong></p> <ul> <li><code><a href="#FILE-authorized_keys"><span class="code">USERDIR/authorized_keys</span></a></code></li> <li><code><a href="#FILE-authorized_keys2"><span class="code">USERDIR/authorized_keys2</span></a></code></li> </ul> <p>This functions discards all options in the beginning of the lines of thoose files when reading them. </p> </div></article><article class="func"><h4 id="add_host_key-4" onmouseover="document.getElementById('ghlink-add_host_key-4-idp37').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-add_host_key-4-idp37').style.visibility = 'hidden';">  <span class="title-name">add_host_key(Host, Port, Key, Options) -&gt; Result</span><div class="title-since"><span class="since">OTP 23.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>       <div class="exports-tube"> <p><strong>Types and description</strong></p> <p>See the api description in <code>ssh_client_key_api, Module:add_host_key/4</code>. </p>  <p id="add_host_key-3">Note that the alternative, the old <code>Module:add_host_key/3</code> is no longer supported by <code class="code">ssh_file</code>. </p> <p><strong>Option</strong></p> <ul> <li><code><a href="#type-user_dir_common_option">user_dir</a></code></li> </ul> <p><strong>File</strong></p> <ul> <li><code><a href="#FILE-known_hosts"><span class="code">USERDIR/known_hosts</span></a></code></li> </ul> </div></article><article class="func"><h4 id="is_host_key-5" onmouseover="document.getElementById('ghlink-is_host_key-5-idp38').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-is_host_key-5-idp38').style.visibility = 'hidden';">  <span class="title-name">is_host_key(Key, Host, Port, Algorithm, Options) -&gt; Result</span><div class="title-since"><span class="since">OTP 23.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>        <div class="exports-tube"> <p><strong>Types and description</strong></p> <p>See the api description in <code>ssh_client_key_api, Module:is_host_key/5</code>. </p>  <p id="is_host_key-4">Note that the alternative, the old <code>Module:is_host_key/4</code> is no longer supported by <code class="code">ssh_file</code>. </p> <p><strong>Option</strong></p> <ul> <li><code><a href="#type-user_dir_common_option">user_dir</a></code></li> </ul> <p><strong>File</strong></p> <ul> <li><code><a href="#FILE-known_hosts"><span class="code">USERDIR/known_hosts</span></a></code></li> </ul> </div></article><article class="func"><h4 id="user_key-2" onmouseover="document.getElementById('ghlink-user_key-2-idp39').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-user_key-2-idp39').style.visibility = 'hidden';">  <span class="title-name">user_key(Algorithm, Options) -&gt; Result</span><div class="title-since"><span class="since">OTP 21.2</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>     <div class="exports-tube"> <p><strong>Types and description</strong></p> <p>See the api description in <code>ssh_client_key_api, Module:user_key/2</code>. </p> <p><strong>Options</strong></p> <ul> <li><code><a href="#type-user_dir_common_option">user_dir</a></code></li> <li><code><a href="#type-pubkey_passphrase_client_options">dsa_pass_phrase</a></code></li> <li><code><a href="#type-pubkey_passphrase_client_options">rsa_pass_phrase</a></code></li> <li><code><a href="#type-pubkey_passphrase_client_options">ecdsa_pass_phrase</a></code></li> </ul> <p>Note that EdDSA passhrases (Curves 25519 and 448) are not implemented.</p> <p><strong>Files</strong> </p> <ul> <li><code><a href="#FILE-id_dsa"><span class="code">USERDIR/id_dsa</span></a></code></li> <li><code><a href="#FILE-id_rsa"><span class="code">USERDIR/id_rsa</span></a></code></li> <li><code><a href="#FILE-id_ecdsa"><span class="code">USERDIR/id_ecdsa</span></a></code></li> <li><code><a href="#FILE-id_ed25519"><span class="code">USERDIR/id_ed25519</span></a></code></li> <li><code><a href="#FILE-id_ed448"><span class="code">USERDIR/id_ed448</span></a></code></li> </ul> </div></article><article class="func"><h4 id="decode-2" onmouseover="document.getElementById('ghlink-decode-2-idp40').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-decode-2-idp40').style.visibility = 'hidden';">  <span class="title-name">decode(SshBin, Type) -&gt; Decoded | {error, <code>term()</code>}</span><div class="title-since"><span class="since">OTP 24.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>             <div class="exports-tube"> <p>Decodes an SSH file-binary.</p> <p>If <code class="code">Type</code> is <code class="code">public_key</code> the binary can be either an RFC4716 public key or an OpenSSH public key.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The following key types have been renamed from the deprecated <code class="code">public_key:ssh_decode/2</code>:</p> <ul> <li>rfc4716_public_key -&gt; rfc4716_key</li> <li>openssh_public_key -&gt; openssh_key</li> </ul> </div> </div> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The implementation of the <code class="code">openssh_key_v1</code> format is still experimental.</p>
</div> </div> </div></article><article class="func"><h4 id="encode-2" onmouseover="document.getElementById('ghlink-encode-2-idp41').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-encode-2-idp41').style.visibility = 'hidden';">  <span class="title-name">encode(InData, Type) -&gt; <code>binary()</code> | {error, <code>term()</code>}</span><div class="title-since"><span class="since">OTP 24.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>           <div class="exports-tube"> <p>Encodes a list of SSH file entries (public keys and attributes) to a binary.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The following key types have been renamed from the removed <code class="code">public_key:ssh_encode/2</code>:</p> <ul> <li>rfc4716_public_key -&gt; rfc4716_key</li> <li>openssh_public_key -&gt; openssh_key</li> </ul> </div> </div> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The implementation of the <code class="code">openssh_key_v1</code> format is still experimental.</p>
</div> </div> </div></article><article class="func"><h4 id="extract_public_key-1" onmouseover="document.getElementById('ghlink-extract_public_key-1-idp42').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-extract_public_key-1-idp42').style.visibility = 'hidden';">  <span class="title-name">extract_public_key(PrivKey) -&gt; PubKey</span><div class="title-since"><span class="since">OTP 25.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>    <div class="exports-tube"> <p>Fetches the public key from a private key.</p> </div></article> </div> <div class="footer"> <hr> <p>Copyright © 2005-2022 Ericsson AB. All Rights Reserved.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2022 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
