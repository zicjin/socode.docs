  <div class="innertube"> <h2 id="module" class="title-link" onmouseover="document.getElementById('ghlink-module-idm2588').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-idm2588').style.visibility = 'hidden';"> <div class="title-name">Module</div>  </h2> <p class="REFBODY module-body">instrument</p> </div> <div class="innertube"> <h2 id="module-summary" class="title-link" onmouseover="document.getElementById('ghlink-module-summary-idm2589').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-idm2589').style.visibility = 'hidden';"> <div class="title-name">Module Summary</div>  </h2> <p class="REFBODY module-summary-body">Analysis and Utility Functions for Instrumentation</p> </div> <section class="description"><div class="innertube"> <h2 id="description" class="title-link" onmouseover="document.getElementById('ghlink-description-idm2590').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-idm2590').style.visibility = 'hidden';"> <div class="title-name">Description</div>  </h2> 
<p>The module <code class="code">instrument</code> contains support for studying the resource usage in an Erlang runtime system. Currently, only the allocation of memory can be studied.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>Since this module inspects internal details of the runtime system it may differ greatly from one version to another. We make no compatibility guarantees in this module.</p> </div> </div>  </div></section> <div class="innertube"> <h2 id="data-types" class="title-link" onmouseover="document.getElementById('ghlink-data-types-idm2595').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-idm2595').style.visibility = 'hidden';"> <div class="title-name">Data Types</div>  </h2> <article class="data-types-body"><h4 id="type-block_histogram" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-block_histogram').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-block_histogram').style.visibility = 'hidden';">  <div class="title-name"> <code>block_histogram() = <span id="type-block_histogram">tuple()</span></code><br> </div> </h4> <div class="data-type-desc"> <p>A histogram of block sizes where each interval's upper bound is twice as high as the one before it.</p> <p>The upper bound of the first interval is provided by the function that returned the histogram, and the last interval has no upper bound.</p> <p>For example, the histogram below has 40 (<code class="code">message</code>) blocks between 256-512 bytes in size, 78 blocks between 512-1024 bytes,2 blocks between 1-2KB, and 2 blocks between 2-4KB.</p> <pre data-language="erlang">&gt; instrument:allocations(#{ histogram_start =&gt; 128, histogram_width =&gt; 15 }).
{ok, {128, 0, #{ message =&gt; {0,40,78,2,2,0,0,0,0,0,0,0,0,0,0}, ... } }}</pre> </div></article> <article class="data-types-body"><h4 id="type-allocation_summary" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-allocation_summary').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-allocation_summary').style.visibility = 'hidden';">  <div class="title-name"> <code>allocation_summary() = <br id="type-allocation_summary">    {HistogramStart :: <span>integer() &gt;= 0</span>,<br>     UnscannedSize :: <span>integer() &gt;= 0</span>,<br>     Allocations ::<br>         #{Origin :: <span>atom()</span> =&gt;<br>               #{Type :: <span>atom()</span> =&gt; <span><a href="#type-block_histogram">block_histogram()</a></span>}}}</code><br> </div> </h4> <div class="data-type-desc"> <p>A summary of allocated block sizes (including their headers) grouped by their <code class="code">Origin</code> and <code class="code">Type</code>.</p> <p><code class="code">Origin</code> is generally which NIF or driver that allocated the blocks, or 'system' if it could not be determined.</p> <p><code class="code">Type</code> is the allocation category that the blocks belong to, e.g. <code class="code">db_term</code>, <code class="code">message</code> or <code class="code">binary</code>. The categories correspond to those in <code><a href="https://github.com/erlang/otp/blob/master/erts/emulator/beam/erl_alloc.types"> erl_alloc.types</a></code>.</p> <p>If one or more carriers could not be scanned in full without harming the responsiveness of the system, <code class="code">UnscannedSize</code> is the number of bytes that had to be skipped.</p> </div></article> <article class="data-types-body"><h4 id="type-carrier_info_list" class="title-link data-type-name" onmouseover="document.getElementById('ghlink-type-carrier_info_list').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-carrier_info_list').style.visibility = 'hidden';">  <div class="title-name"> <code>carrier_info_list() = <br id="type-carrier_info_list">    {HistogramStart :: <span>integer() &gt;= 0</span>,<br>     Carriers ::<br>         [{AllocatorType :: <span>atom()</span>,<br>           InPool :: <span>boolean()</span>,<br>           TotalSize :: <span>integer() &gt;= 0</span>,<br>           UnscannedSize :: <span>integer() &gt;= 0</span>,<br>           Allocations ::<br>               {Type :: <span>atom()</span>,<br>                Count :: <span>integer() &gt;= 0</span>,<br>                Size :: <span>integer() &gt;= 0</span>},<br>           FreeBlocks :: <span><a href="#type-block_histogram">block_histogram()</a></span>}]}</code><br> </div> </h4> <div class="data-type-desc"> <p><code class="code">AllocatorType</code> is the type of the allocator that employs this carrier.</p> <p><code class="code">InPool</code> is whether the carrier is in the migration pool.</p> <p><code class="code">TotalSize</code> is the total size of the carrier, including its header.</p> <p><code class="code">Allocations</code> is a summary of the allocated blocks in the carrier. Note that carriers may contain multiple different block types when carrier pools are shared between different allocator types (see the <code><span class="code">erts_alloc</span> </code> documentation for more details).</p> <p><code class="code">FreeBlocks</code> is a histogram of the free block sizes in the carrier.</p> <p>If the carrier could not be scanned in full without harming the responsiveness of the system, <code class="code">UnscannedSize</code> is the number of bytes that had to be skipped.</p> </div></article> </div> <div class="innertube"><h2 id="export" class="title-link" onmouseover="document.getElementById('ghlink-export-idm2648').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-export-idm2648').style.visibility = 'hidden';"> <div class="title-name">Exports</div>  </h2></div> <div class="exports-body"> <article class="func"><h4 id="allocations-0" onmouseover="document.getElementById('ghlink-allocations-0-idp106').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-allocations-0-idp106').style.visibility = 'hidden';">  <span class="title-name">allocations() -&gt; {ok, Result} | {error, Reason}</span><div class="title-since"><span class="since">OTP 21.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>    <div class="exports-tube"> <p>Shorthand for <code><a href="#allocations-1"><span class="code">allocations(#{})</span>.</a></code></p> </div></article><article class="func"><h4 id="allocations-1" onmouseover="document.getElementById('ghlink-allocations-1-idp107').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-allocations-1-idp107').style.visibility = 'hidden';">  <span class="title-name">allocations(Options) -&gt; {ok, Result} | {error, Reason}</span><div class="title-since"><span class="since">OTP 21.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>     <div class="exports-tube"> <p>Returns a summary of all tagged allocations in the system, optionally filtered by allocator type and scheduler id.</p> <p>Only binaries and allocations made by NIFs and drivers are tagged by default, but this can be configured an a per-allocator basis with the <code><span class="code">+M&lt;S&gt;atags</span> </code> emulator option.</p> <p>If the specified allocator types are not enabled, the call will fail with <code class="code">{error, not_enabled}</code>.</p> <p>The following options can be used:</p> <dl> <dt><strong><code class="code">allocator_types</code></strong></dt> <dd> <p>The allocator types that will be searched.</p> <p>Specifying a specific allocator type may lead to strange results when carrier migration between different allocator types has been enabled: you may see unexpected types (e.g. process heaps when searching binary_alloc), or fewer blocks than expected if the carriers the blocks are on have been migrated out to an allocator of a different type.</p> <p>Defaults to all <code class="code">alloc_util</code> allocators.</p> </dd> <dt><strong><code class="code">scheduler_ids</code></strong></dt> <dd> <p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p> </dd> <dt><strong><code class="code">histogram_start</code></strong></dt> <dd> <p>The upper bound of the first interval in the allocated block size histograms. Defaults to 128.</p> </dd> <dt><strong><code class="code">histogram_width</code></strong></dt> <dd> <p>The number of intervals in the allocated block size histograms. Defaults to 18.</p> </dd> </dl> <p><strong>Example:</strong></p> <pre data-language="erlang">&gt; instrument:allocations(#{ histogram_start =&gt; 128, histogram_width =&gt; 15 }).
{ok,{128,0,
     #{udp_inet =&gt;
           #{driver_event_state =&gt; {0,0,0,0,0,0,0,0,0,1,0,0,0,0,0}},
       system =&gt;
           #{heap =&gt; {0,0,0,0,20,4,2,2,2,3,0,1,0,0,1},
             db_term =&gt; {271,3,1,52,80,1,0,0,0,0,0,0,0,0,0},
             code =&gt; {0,0,0,5,3,6,11,22,19,20,10,2,1,0,0},
             binary =&gt; {18,0,0,0,7,0,0,1,0,0,0,0,0,0,0},
             message =&gt; {0,40,78,2,2,0,0,0,0,0,0,0,0,0,0},
             ... }
       spawn_forker =&gt;
           #{driver_select_data_state =&gt;
                 {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0}},
       ram_file_drv =&gt; #{drv_binary =&gt; {0,0,0,0,0,0,1,0,0,0,0,0,0,0,0}},
       prim_file =&gt;
           #{process_specific_data =&gt; {2,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
             nif_trap_export_entry =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
             monitor_extended =&gt; {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0},
             drv_binary =&gt; {0,0,0,0,0,0,1,0,3,5,0,0,0,1,0},
             binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}},
       prim_buffer =&gt;
           #{nif_internal =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0},
             binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}}}}}</pre> </div></article><article class="func"><h4 id="carriers-0" onmouseover="document.getElementById('ghlink-carriers-0-idp108').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-carriers-0-idp108').style.visibility = 'hidden';">  <span class="title-name">carriers() -&gt; {ok, Result} | {error, Reason}</span><div class="title-since"><span class="since">OTP 21.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>    <div class="exports-tube"> <p>Shorthand for <code><a href="#carriers-1"><span class="code">carriers(#{})</span>.</a></code></p> </div></article><article class="func"><h4 id="carriers-1" onmouseover="document.getElementById('ghlink-carriers-1-idp109').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-carriers-1-idp109').style.visibility = 'hidden';">  <span class="title-name">carriers(Options) -&gt; {ok, Result} | {error, Reason}</span><div class="title-since"><span class="since">OTP 21.0</span></div> </h4>  <h2 id="types" class="func-types-title">Types</h2>     <div class="exports-tube"> <p>Returns a summary of all carriers in the system, optionally filtered by allocator type and scheduler id.</p> <p>If the specified allocator types are not enabled, the call will fail with <code class="code">{error, not_enabled}</code>.</p> <p>The following options can be used:</p> <dl> <dt><strong><code class="code">allocator_types</code></strong></dt> <dd> <p>The allocator types that will be searched. Defaults to all <code class="code">alloc_util</code> allocators.</p> </dd> <dt><strong><code class="code">scheduler_ids</code></strong></dt> <dd> <p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p> </dd> <dt><strong><code class="code">histogram_start</code></strong></dt> <dd> <p>The upper bound of the first interval in the free block size histograms. Defaults to 512.</p> </dd> <dt><strong><code class="code">histogram_width</code></strong></dt> <dd> <p>The number of intervals in the free block size histograms. Defaults to 14.</p> </dd> </dl> <p><strong>Example:</strong></p> <pre data-language="erlang">&gt; instrument:carriers(#{ histogram_start =&gt; 512, histogram_width =&gt; 8 }).
{ok,{512,
     [{driver_alloc,false,262144,0,
                    [{driver_alloc,1,32784}],
                    {0,0,0,0,0,0,0,1}},
      {binary_alloc,false,32768,0,
                    [{binary_alloc,15,4304}],
                    {3,0,0,0,1,0,0,0}},
      {...}|...]}}</pre> </div></article> </div> <section class="innertube"><h2 id="see-also" class="title-link" onmouseover="document.getElementById('ghlink-see-also-idm2726').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-see-also-idm2726').style.visibility = 'hidden';"> <div class="title-name">See Also</div>  </h2>  <p><code>erts_alloc(3)</code>, <code>erl(1)</code></p> </section> <div class="footer"> <hr> <p>Copyright © 1997-2022 Ericsson AB. All Rights Reserved.</p> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010&ndash;2022 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>
