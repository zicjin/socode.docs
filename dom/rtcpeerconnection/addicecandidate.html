<h1>RTCPeerConnection.addIceCandidate()</h1> <p>When a web site or app using <a href="../rtcpeerconnection"><code>RTCPeerConnection</code></a> receives a new ICE candidate from the remote peer over its signaling channel, it delivers the newly-received candidate to the browser's <a href="https://developer.mozilla.org/en-US/docs/Glossary/ICE">ICE</a> agent by calling <code><strong>RTCPeerConnection.addIceCandidate()</strong></code>. This adds this new remote candidate to the <code>RTCPeerConnection</code>'s remote description, which describes the state of the remote end of the connection.</p> <p>If the <code>candidate</code> parameter is missing or a value of <code>null</code> is given when calling <code>addIceCandidate()</code>, the added ICE candidate is an "end-of-candidates" indicator. The same is the case if the value of the specified object's <a href="../rtcicecandidate/candidate"><code>candidate</code></a> is either missing or an empty string (<code>""</code>), it signals that all remote candidates have been delivered.</p> <p>The end-of-candidates notification is transmitted to the remote peer using a candidate with an a-line value of <code>end-of-candidates</code>.</p> <p>During negotiation, your app will likely receive many candidates which you'll deliver to the ICE agent in this way, allowing it to build up a list of potential connection methods. This is covered in more detail in the articles <a href="../webrtc_api/connectivity">WebRTC connectivity</a> and <a href="../webrtc_api/signaling_and_video_calling">Signaling and video calling</a>.</p>
<h2 id="syntax">Syntax</h2>
<div class="code-example"><pre data-language="js"><span class="token function">addIceCandidate</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span>
<span class="token function">addIceCandidate</span><span class="token punctuation">(</span>candidate<span class="token punctuation">,</span> successCallback<span class="token punctuation">,</span> failureCallback<span class="token punctuation">)</span> <span class="token comment">// deprecated</span>
</pre></div>
<h3 id="parameters">Parameters</h3>
<dl> <dt>
<code>candidate</code> <span class="badge inline optional">Optional</span>
</dt> <dd> <p>An <a href="../rtcicecandidate"><code>RTCIceCandidate</code></a> object, or an object that has the following properties:</p>  <dl> <dt>
<code>candidate</code> <span class="badge inline optional">Optional</span>
</dt> <dd>
<p>A <a href="../domstring"><code>DOMString</code></a> describing the properties of the candidate, taken directly from the <a href="../webrtc_api/protocols#sdp">SDP</a> attribute <code>"candidate"</code>. The candidate string specifies the network connectivity information for the candidate. If the <code>candidate</code> is an empty string (<code>""</code>), the end of the candidate list has been reached; this candidate is known as the "end-of-candidates" marker.</p> <p>The syntax of the candidate string is described in <a href="https://tools.ietf.org/html/rfc5245#section-15.1" rel=" noopener">RFC 5245, section 15.1</a>. For an a-line (attribute line) that looks like this:</p> <pre class="notranslate">a=candidate:4234997325 1 udp 2043278322 192.168.0.56 44323 typ host</pre> <p>the corresponding <code>candidate</code> string's value will be <code>"candidate:4234997325 1 udp 2043278322 192.168.0.56 44323 typ host"</code>.</p> <p>The <a href="https://developer.mozilla.org/en-US/docs/Glossary/User_agent">user agent</a> always prefers candidates with the highest <a href="../rtcicecandidate/priority"><code>priority</code></a>, all else being equal. In the example above, the priority is <code>2043278322</code>. The attributes are all separated by a single space character, and are in a specific order. The complete list of attributes for this example candidate is:</p> <ul> <li>
<a href="../rtcicecandidate/foundation"><code>foundation</code></a> = 4234997325</li> <li>
<a href="../rtcicecandidate/component"><code>component</code></a> = <code>"rtp"</code> (the number 1 is encoded to this string; 2 becomes <code>"rtcp"</code>)</li> <li>
<a href="../rtcicecandidate/protocol"><code>protocol</code></a> = <code>"udp"</code>
</li> <li>
<a href="../rtcicecandidate/priority"><code>priority</code></a> = 2043278322</li> <li>
<a href="../rtcicecandidate/address"><code>ip</code></a> = <code>"192.168.0.56"</code>
</li> <li>
<a href="../rtcicecandidate/port"><code>port</code></a> = 44323</li> <li>
<a href="../rtcicecandidate/type"><code>type</code></a> = <code>"host"</code>
</li> </ul> <p>Additional information can be found in <a href="../rtcicecandidate/candidate"><code>RTCIceCandidate.candidate</code></a>.</p> <div class="notecard note"> <p>For backward compatibility with older versions of the WebRTC specification, the constructor also accepts this string directly as an argument.</p> </div> </dd> <dt>
<code>sdpMid</code> <span class="badge inline optional">Optional</span> </dt> <dd>A <a href="../domstring"><code>DOMString</code></a> containing the identification tag of the media stream with which the candidate is associated, or <code>null</code> if there is no associated media stream. The default is <code>null</code>. <p>Additional information can be found in <a href="../rtcicecandidate/sdpmid"><code>RTCIceCandidate.sdpMid</code></a>.</p>
</dd> <dt>
<code>sdpMLineIndex</code> <span class="badge inline optional">Optional</span>
</dt> <dd>A number property containing the zero-based index of the m-line with which the candidate is associated, within the <a href="../webrtc_api/protocols#sdp">SDP</a> of the media description, or <code>null</code> if no such associated exists. The default is <code>null</code>. <p>Additional information can be found in <a href="../rtcicecandidate/sdpmlineindex"><code>RTCIceCandidate.sdpMLineIndex</code></a>.</p> </dd> <dt>
<code>usernameFragment</code> <span class="badge inline optional">Optional</span>
</dt> <dd>A <a href="../domstring"><code>DOMString</code></a> containing the username fragment (usually referred to in shorthand as "ufrag" or "ice-ufrag"). This fragment, along with the ICE password ("ice-pwd"), uniquely identifies a single ongoing ICE interaction (including for any communication with the <a href="https://developer.mozilla.org/en-US/docs/Glossary/STUN">STUN</a> server). <p>The string is generated by WebRTC at the beginning of the session. It may be up to 256 characters long, and at least 24 bits must contain random data. It has no default value and is not present unless set explicitly.</p> <p>Additional information can be found in <a href="../rtcicecandidate/usernamefragment"><code>RTCIceCandidate.usernameFragment</code></a>.</p> </dd> </dl> <p>The method will throw a <code>TypeError</code> exception if both <code>sdpMid</code> and <code>sdpMLineIndex</code> are <code>null</code>.</p> <p>The contents of the object should be constructed from a message received over the signaling channel, describing a newly received ICE candidate that's ready to be delivered to the local ICE agent.</p> <p>If no <code>candidate</code> object is specified, or its value is <code>null</code>, an end-of-candidates signal is sent to the remote peer using the <code>end-of-candidates</code> a-line, formatted like this:</p> <pre class="notranslate">a=end-of-candidates</pre> </dd> </dl>
<h3 id="deprecated_parameters">Deprecated parameters</h3>
<p>In older code and documentation, you may see a callback-based version of this function. This has been deprecated and its use is <strong>strongly</strong> discouraged. You should update any existing code to use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a>-based version of <code>addIceCandidate()</code> instead. The parameters for this form of <code>addIceCandidate()</code> are described below, to aid in updating existing code.</p> <dl> <dt>
<code>successCallback</code> 
</dt> <dd>A function to be called when the ICE candidate has been successfully added. This function receives no input parameters and doesn't return a value.</dd> <dt>
<code>failureCallback</code> 
</dt> <dd>A function to be called if attempting to add the ICE candidate fails. Receives as input a <a href="../domexception"><code>DOMException</code></a> object describing why failure occurred.</dd> </dl>
<h3 id="return_value">Return value</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> which is fulfilled when the candidate has been successfully added to the remote peer's description by the ICE agent. The promise does not receive any input parameters.</p>
<h3 id="exceptions">Exceptions</h3>
<p>When an error occurs while attempting to add the ICE candidate, the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> returned by this method is rejected, returning one of the errors below as the <a href="../domexception/name"><code>name</code></a> attribute in the specified <a href="../domexception"><code>DOMException</code></a> object passed to the rejection handler.</p> <dl> <dt><code>TypeError</code></dt> <dd>The specified candidate's <a href="../rtcicecandidate/sdpmid"><code>sdpMid</code></a> and <a href="../rtcicecandidate/sdpmlineindex"><code>sdpMLineIndex</code></a> are both <code>null</code>.</dd> <dt><code>InvalidStateError</code></dt> <dd>The <code>RTCPeerConnection</code> currently has no remote peer established (<a href="remotedescription"><code>remoteDescription</code></a> is <code>null</code>).</dd> <dt><code>OperationError</code></dt> <dd>This can happen for a number of reasons: <ul> <li>The value specified for <a href="../rtcicecandidate/sdpmid"><code>sdpMid</code></a> is non-<code>null</code> and doesn't match the media description ID of any media description included within the <a href="remotedescription"><code>remoteDescription</code></a>. </li> <li>The specified value of <a href="../rtcicecandidate/sdpmlineindex"><code>sdpMLineIndex</code></a> is greater than or equal to the number of media descriptions included in the remote description.</li> <li>The specified <a href="../rtcicecandidate/usernamefragment"><code>ufrag</code></a> doesn't match the <code>ufrag</code> field in any of the remote descriptions being considered.</li> <li>One or more of the values in the <a href="../rtcicecandidate"><code>candidate</code></a> string are invalid or could not be parsed.</li> <li>Attempting to add the candidate fails for any reason.</li> </ul> </dd> </dl>
<h2 id="examples">Examples</h2>
<p>This code snippet shows how to signal ICE candidates across an arbitrary signaling channel.</p> <div class="code-example"><pre data-language="js"><span class="token comment">// This example assumes that the other peer is using a signaling channel as follows:</span>
<span class="token comment">//</span>
<span class="token comment">// pc.onicecandidate = event =&gt; {</span>
<span class="token comment">//   if (event.candidate) {</span>
<span class="token comment">//     signalingChannel.send(JSON.stringify({ice: event.candidate})); // "ice" is arbitrary</span>
<span class="token comment">//   } else {</span>
<span class="token comment">//     // All ICE candidates have been sent</span>
<span class="token comment">//   }</span>
<span class="token comment">// }</span>

signalingChannel<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">receivedString</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>receivedString<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>ice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// A typical value of ice here might look something like this:</span>
    <span class="token comment">//</span>
    <span class="token comment">// {candidate: "candidate:0 1 UDP 2122154243 192.168.1.9 53421 typ host", sdpMid: "0", ...}</span>
    <span class="token comment">//</span>
    <span class="token comment">// Pass the whole thing to addIceCandidate:</span>

    pc<span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>ice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Failure during addIceCandidate(): "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// handle other things you might be signaling, like sdp</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div> <p>The last candidate to be signaled this way by the remote peer will be a special candidate denoting end-of-candidates. Out of interest, end-of-candidates may be manually indicated as follows:</p> <div class="code-example"><pre data-language="js">pc<span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>candidate<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div> <p>However, in most cases you won't need to look for this explicitly, since the events driving the <a href="../rtcpeerconnection"><code>RTCPeerConnection</code></a> will deal with it for you, sending the appropriate events.</p>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="standard-table">
<thead><tr><th scope="col">Specification</th></tr></thead>
<tbody><tr><td><a href="https://w3c.github.io/webrtc-pc/#dom-peerconnection-addicecandidate">WebRTC 1.0: Real-Time Communication Between Browsers (WebRTC 1.0)<br><small># dom-peerconnection-addicecandidate</small></a></td></tr></tbody>
</table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
<th>WebView Android</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody><tr>
<th><code>addIceCandidate</code></th>
<td class="bc-supports-yes">
<div>51</div>
<div>Promise-based version.</div>
<div>24</div>
</td>
<td class="bc-supports-yes"><div>15</div></td>
<td class="bc-supports-yes">
<div>22</div>
<div>Starting in Firefox 68, the <code>candidate</code> parameter is optional when calling <code>addIceCandidate()</code>. A <code>null</code> value for <code>candidate</code> indicates no more candidates will be sent, while an empty <code>candidate</code> string indicates that no more candidates will be sent for the current generation of candidates.</div>
</td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes">
<div>43</div>
<div>Promise-based version.</div>
<div>37-43</div>
</td>
<td class="bc-supports-yes"><div>11</div></td>
<td class="bc-supports-yes">
<div>51</div>
<div>Promise-based version.</div>
<div>Yes</div>
</td>
<td class="bc-supports-yes">
<div>51</div>
<div>Promise-based version.</div>
<div>Yes</div>
</td>
<td class="bc-supports-yes">
<div>44</div>
<div>Starting in Firefox 68, the <code>candidate</code> parameter is optional when calling <code>addIceCandidate()</code>. A <code>null</code> value for <code>candidate</code> indicates no more candidates will be sent, while an empty <code>candidate</code> string indicates that no more candidates will be sent for the current generation of candidates.</div>
</td>
<td class="bc-supports-yes">
<div>43</div>
<div>Promise-based version.</div>
<div>37-43</div>
</td>
<td class="bc-supports-yes"><div>11</div></td>
<td class="bc-supports-yes">
<div>6.0</div>
<div>Promise-based version and unprefixed.</div>
<div>5.0-6.0</div>
<div>Promise-based version.</div>
</td>
</tr></tbody>
</table>


<h2 id="see_also">See also</h2>
<ul> <li><a href="../webrtc_api">WebRTC API</a></li> <li><a href="../webrtc_api/signaling_and_video_calling">Signaling and video calling</a></li> <li><a href="../webrtc_api/protocols">Introduction to WebRTC protocols</a></li> <li><a href="../webrtc_api/connectivity">WebRTC connectivity</a></li> <li><a href="../webrtc_api/session_lifetime">Lifetime of a WebRTC session</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate" class="_attribution-link" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addIceCandidate</a>
  </p>
</div>
