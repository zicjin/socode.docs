<h1>XRSession.requestAnimationFrame()</h1>
<div class="section-content">
<p> The <a href="../xrsession"><code>XRSession</code></a> method <code>requestAnimationFrame()</code>, much like the <a href="../window"><code>Window</code></a> method of the same name, schedules a callback to be executed the next time the browser is ready to paint the session's virtual environment to the XR display. The specified callback is executed once before the next repaint; if you wish for it to be executed for the following repaint, you must call <code>requestAnimationFrame()</code> again. This can be done from within the callback itself. </p> <p> The callback takes two parameters as inputs: an <a href="../xrframe"><code>XRFrame</code></a> describing the state of all tracked objects for the session, and a time stamp you can use to compute any animation updates needed. </p> <p> You can cancel a previously scheduled animation by calling <a href="cancelanimationframe"><code>cancelAnimationFrame()</code></a>. </p> <div class="notecard note" id="sect1"> <p> <strong>Note:</strong> Despite the obvious similarities between these methods and the global <a href="../window/requestanimationframe"><code>requestAnimationFrame()</code></a> function provided by the <code>Window</code> interface, you <em>must not</em> treat these as interchangeable. There is <em>no</em> guarantee that the latter will work at all while an immersive XR session is underway. </p> </div>
</div>
<h2 id="syntax">Syntax</h2>
<div class="section-content"><div class="code-example"><pre data-language="js"><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animationFrameCallback<span class="token punctuation">)</span>
</pre></div></div>
<h3 id="parameters">Parameters</h3>
<div class="section-content"><dl> <dt id="animationframecallback"><code>animationFrameCallback</code></dt> <dd> <p> A function which is called before the next repaint in order to allow you to update and render the XR scene based on elapsed time, animation, user input changes, and so forth. The callback receives as input two parameters: </p> <dl> <dt id="time"><code>time</code></dt> <dd> <p> A <a href="../domhighrestimestamp"><code>DOMHighResTimeStamp</code></a> indicating the time offset at which the updated viewer state was received from the WebXR device. </p> </dd> <dt id="xrframe"><code>xrFrame</code></dt> <dd> <p> An <a href="../xrframe"><code>XRFrame</code></a> object describing the state of the objects being tracked by the session. This can be used to obtain the poses of the viewer and the scene itself, as well as other information needed to render a frame of an AR or VR scene. </p> </dd> </dl> </dd> </dl></div>
<h3 id="return_value">Return value</h3>
<div class="section-content"><p> An integer value which serves as a unique, non-zero ID or handle you may pass to <a href="cancelanimationframe"><code>cancelAnimationFrame()</code></a> if you need to remove the pending animation frame request. </p></div>
<h2 id="examples">Examples</h2>
<div class="section-content">
<p> The following example requests <code>XRSession</code> with "inline" mode so that it can be displayed in an HTML element (without the need for a separate AR or VR device). </p> <div class="notecard note" id="sect2"> <p> <strong>Note:</strong> A real application should check that the device and the User Agent support WebXR API at all and then that they both support the desired session type via <a href="../xrsystem/issessionsupported"><code>XRSystem.isSessionSupported()</code></a>. </p> </div> <div class="code-example"><pre data-language="js"><span class="token comment">// Obtain XR object</span>
<span class="token keyword">const</span> <span class="token constant">XR</span> <span class="token operator">=</span> navigator<span class="token punctuation">.</span>xr

<span class="token comment">// Request a new XRSession</span>
<span class="token constant">XR</span><span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">"inline"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">xrSession</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  xrSession<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> xrFrame</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> viewer <span class="token operator">=</span> xrFrame<span class="token punctuation">.</span><span class="token function">getViewerPose</span><span class="token punctuation">(</span>xrReferenceSpace<span class="token punctuation">)</span>

    gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>xrWebGLLayer<span class="token punctuation">.</span>framebuffer<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>xrView <span class="token keyword">of</span> viewer<span class="token punctuation">.</span>views<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> xrViewport <span class="token operator">=</span> xrWebGLLayer<span class="token punctuation">.</span><span class="token function">getViewport</span><span class="token punctuation">(</span>xrView<span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span>xrViewport<span class="token punctuation">.</span>x<span class="token punctuation">,</span> xrViewport<span class="token punctuation">.</span>y<span class="token punctuation">,</span> xrViewport<span class="token punctuation">.</span>width<span class="token punctuation">,</span> xrViewport<span class="token punctuation">.</span>height<span class="token punctuation">)</span>

    <span class="token comment">// WebGL draw calls will now be rendered into the appropriate viewport.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</pre></div> <p> The following example was taken directly from the spec draft. This example demonstrates a design pattern that ensures seamless transition between non-immersive animations created via <a href="../window/requestanimationframe"><code>Window.requestAnimationFrame</code></a> and immersive XR animations. </p> <div class="code-example"><pre data-language="js"><span class="token keyword">let</span> xrSession <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token keyword">function</span> <span class="token function">onWindowAnimationFrame</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onWindowAnimationFrame<span class="token punctuation">)</span>

  <span class="token comment">// This may be called while an immersive session is running on some devices,</span>
  <span class="token comment">// such as a desktop with a tethered headset. To prevent two loops from</span>
  <span class="token comment">// rendering in parallel, skip drawing in this one until the session ends.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>xrSession<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">renderFrame</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// The window animation loop can be started immediately upon the page loading.</span>
window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onWindowAnimationFrame<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">onXRAnimationFrame</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> xrFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xrSession<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onXRAnimationFrame<span class="token punctuation">)</span>
  <span class="token function">renderFrame</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> xrFrame<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderFrame</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> xrFrame</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Shared rendering logic.</span>
<span class="token punctuation">}</span>

<span class="token comment">// Assumed to be called by a user gesture event elsewhere in code.</span>
<span class="token keyword">function</span> <span class="token function">startXRSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>xr<span class="token punctuation">.</span><span class="token function">requestSession</span><span class="token punctuation">(</span><span class="token string">'immersive-vr'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">session</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    xrSession <span class="token operator">=</span> session
    xrSession<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> onXRSessionEnded<span class="token punctuation">)</span>
    <span class="token comment">// Do necessary session setup here.</span>
    <span class="token comment">// Begin the session's animation loop.</span>
    xrSession<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>onXRAnimationFrame<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onXRSessionEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xrSession <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</pre></div>
</div>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="standard-table">
<thead><tr><th scope="col">Specification</th></tr></thead>
<tbody><tr><td><a href="https://immersive-web.github.io/webxr/#dom-xrsession-requestanimationframe">WebXR Device API <br><small># dom-xrsession-requestanimationframe</small></a></td></tr></tbody>
</table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
<th>WebView Android</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody><tr>
<th><code>requestAnimationFrame</code></th>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>11.2</div></td>
</tr></tbody>
</table>
<h2 id="see_also">See also</h2>
<div class="section-content"><ul> <li><a href="../window/requestanimationframe"><code>Window.requestAnimationFrame()</code></a></li> <li><a href="cancelanimationframe"><code>XRSession.cancelAnimationFrame()</code></a></li> </ul></div>
<aside class="metadata"><div class="metadata-content-container">
<div id="on-github" class="on-github">
<h3>Found a problem with this page?</h3>
<ul>
<li><a href="https://github.com/mdn/content/edit/main/files/en-us/web/api/xrsession/requestanimationframe/index.md" target="_blank" rel="noopener noreferrer">Edit on <b>GitHub</b></a></li>
<li><a href="https://github.com/mdn/content/blob/main/files/en-us/web/api/xrsession/requestanimationframe/index.md?plain=1" target="_blank" rel="noopener noreferrer">Source on <b>GitHub</b></a></li>
<li><a href="https://github.com/mdn/content/issues/new?template=page-report.yml&amp;mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FXRSession%2FrequestAnimationFrame&amp;metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A*+Folder%3A+%60en-us%2Fweb%2Fapi%2Fxrsession%2Frequestanimationframe%60%0A*+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FXRSession%2FrequestAnimationFrame%0A*+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fapi%2Fxrsession%2Frequestanimationframe%2Findex.md%0A*+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F71ace5e892c9b07e44a54383807259f64c023314%0A*+Document+last+modified%3A+2022-06-03T07%3A21%3A37.000Z%0A%0A%3C%2Fdetails%3E" target="_blank" rel="noopener noreferrer">Report a problem with this content on <b>GitHub</b></a></li>
<li>Want to fix the problem yourself? See <a href="https://github.com/mdn/content/blob/main/README.md" target="_blank" rel="noopener noreferrer">our Contribution guide</a>.</li>
</ul>
</div>
<p class="last-modified-date"><b>Last modified:</b> <time datetime="2022-06-03T07:21:37.000Z">Jun 3, 2022</time>, <a href="requestanimationframe/contributors.txt">by MDN contributors</a></p>
</div></aside><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/XRSession/requestAnimationFrame" class="_attribution-link" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/XRSession/requestAnimationFrame</a>
  </p>
</div>
