<h1>HTML Sanitizer API</h1>
<div class="notecard experimental"><p><strong>Experimental:</strong> <strong>This is an <a href="https://developer.mozilla.org/en-US/docs/MDN/Guidelines/Conventions_definitions#experimental">experimental technology</a></strong><br>Check the <a href="#browser_compatibility">Browser compatibility table</a> carefully before using this in production.</p></div>
<div class="notecard secure"><p><strong>Secure context:</strong> This feature is available only in <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">secure contexts</a> (HTTPS), in some or all <a href="#browser_compatibility">supporting browsers</a>.</p></div> <p>The <strong>HTML Sanitizer API</strong> allow developers to take untrusted strings of HTML and <a href="document"><code>Document</code></a> or <a href="documentfragment"><code>DocumentFragment</code></a> objects, and sanitize them for safe insertion into a documentâ€™s DOM.</p>
<h2 id="concepts_and_usage">Concepts and usage</h2>
<p> Web applications often need to work with untrusted HTML on the client side, for example, as part of a client-side templating solution or for rendering user generated content, or when including data in a frame from other another site. The Sanitizer API allows for rendering of this potentially untrusted HTML in a safe manner. </p> <p> To access the API you would use the <a href="sanitizer/sanitizer"><code>Sanitizer()</code></a> constructor to create and configure a <a href="sanitizer"><code>Sanitizer</code></a> instance. The configuration options parameter allows you to specify the allowed and dis-allowed elements and attributes, and to enable custom elements and comments. </p> <p> The most common use-case - preventing XSS - is handled by the default configuration. Creating a <a href="sanitizer/sanitizer"><code>Sanitizer.Sanitizer</code></a> with a custom configuration is necessary only to handle additional, application-specific use cases. </p> <p>The API has three main methods for sanitizing data:</p> <ol> <li>
<a href="element/sethtml"><code>Element.setHTML()</code></a> parses and sanitizes a string of HTML and immediately inserts it into the DOM as a child of the current element.</li> </ol> <p> This is essentially "safe" version of <a href="element/innerhtml"><code>Element.innerHTML</code></a>, and should be used instead of <code>innerHTML</code> when inserting untrusted data. 2. <a href="sanitizer/sanitizefor"><code>Sanitizer.sanitizeFor()</code></a> parses and sanitizes a string of HTML for later insertion into the DOM. This might be used when the target element for the string is not always ready/available for update. 3. <a href="sanitizer/sanitize"><code>Sanitizer.sanitize()</code></a> sanitizes data that is in a <a href="document"><code>Document</code></a> or <a href="documentfragment"><code>DocumentFragment</code></a>. It might be used, for example, to sanitize a <a href="document"><code>Document</code></a> instance in a frame. </p>
<h3 id="parsing_and_sanitizing_strings">Parsing and sanitizing strings</h3>
<p>The result of parsing a string of HTML depends on the context/the element into which it is inserted.</p> <p> For example, an HTML string containing <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/td"><code>&lt;td&gt;</code></a> elements is valid if inserted under a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/table"><code>&lt;table&gt;</code></a> elements, but will be dropped if inserted in a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> element. Similarly, an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/em"><code>&lt;em&gt;</code></a> element is a valid node in a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div"><code>&lt;div&gt;</code></a> but the tag will be escaped if used in a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/textarea"><code>&lt;textarea&gt;</code></a>: </p> <div class="code-example"><pre data-language="html"><span class="token comment">&lt;!-- "&lt;em&gt;bla&lt;/em&gt;" inserted into &lt;div&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>bla<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- "&lt;em&gt;bla&lt;/em&gt;" inserted into &lt;textarea&gt; --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity">&amp;lt;</span>em<span class="token entity named-entity">&amp;gt;</span>bla<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
</pre></div> <p>The target element must therefore be known when the parser is run and the resulting subtree must be inserted into that same type of element in the DOM, or the result will be incorrect.</p> <p> For this reason when using <a href="sanitizer/sanitizefor"><code>Sanitizer.sanitizeFor()</code></a> developers must specify the tag of the eventual target element as a parameter, and the method returns a matching HTML element with the parsed string as a child (for example, the target tag <code>"div"</code> results in a returned object that is an instance of <a href="htmldivelement"><code>HTMLDivElement</code></a>). The return type ensures that a user always has the context in which the object must be inserted into the DOM. </p> <p>This consideration does not matter for <a href="element/sethtml"><code>Element.setHTML()</code></a> as it is called on a particular element and the context is therefore implicit.</p> <p> The parser may also perform normalization operations on the input string. As a result, even if the HTML is valid and the sanitizer method does nothing, the sanitized output may not precisely match the unsanitized input. This applies to both methods. </p>
<h2 id="interfaces">Interfaces</h2>
<dl> <dt><a href="sanitizer"><code>Sanitizer</code></a></dt> <dd> <p>Provides the functionality to define a sanitizer configuration, to sanitize untrusted strings of HTML for later insertion into the DOM, and to sanitize <a href="document"><code>Document</code></a> and <a href="documentfragment"><code>DocumentFragment</code></a> objects.</p> </dd> <dt><a href="element/sethtml"><code>Element.setHTML()</code></a></dt> <dd> <p>Parses a string of HTML into a subtree of nodes, sanitizes it using a <code>Sanitizer</code> object, then sets it as a child of the current element.</p> </dd> </dl>
<h2 id="examples">Examples</h2>
<p>The following examples show how to use the sanitizer API using the <em>default</em> sanitizer (at time of writing configuration operations are not yet supported).</p>
<h3 id="sanitize_a_string_immediately">Sanitize a string immediately</h3>
<p>The code below demonstrates how <a href="element/sethtml"><code>Element.setHTML()</code></a> is used to sanitize a string of HTML and insert it into the <code>Element</code> with an id of <code>target</code>.</p> <p>The <code>script</code> element is disallowed by the default sanitizer so the alert is removed.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> unsanitized_string <span class="token operator">=</span> <span class="token string">"abc &lt;script&gt;alert(1)&lt;/script&gt; def"</span><span class="token punctuation">;</span>  <span class="token comment">// Unsanitized string of HTML</span>

<span class="token keyword">const</span> sanitizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sanitizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Default sanitizer;</span>

<span class="token comment">// Get the Element with id "target" and set it with the sanitized string.</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"target"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
target<span class="token punctuation">.</span><span class="token function">setHTML</span><span class="token punctuation">(</span>unsanitized_string<span class="token punctuation">,</span> sanitizer<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// "abc  def"</span>
</pre></div>
<h3 id="sanitize_a_string_for_deferred_use">Sanitize a string for deferred use</h3>
<p>The example below shows the same sanitization operation using the <a href="sanitizer/sanitizefor"><code>Sanitizer.sanitizeFor()</code></a> method, with the intent of later inserting the returned element into a <code>&lt;div&gt;</code> element:</p> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> unsanitized_string <span class="token operator">=</span> <span class="token string">"abc &lt;script&gt;alert(1)&lt;/script&gt; def"</span><span class="token punctuation">;</span>  <span class="token comment">// Unsanitized string of HTML</span>
<span class="token keyword">const</span> sanitizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sanitizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Default sanitizer;</span>

<span class="token comment">// Sanitize the string</span>
<span class="token keyword">let</span> sanitizedDiv <span class="token operator">=</span> sanitizer<span class="token punctuation">.</span><span class="token function">sanitizeFor</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> unsanitized_string<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//We can verify the returned element type, and view sanitized HTML in string form:</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>sanitizedDiv <span class="token keyword">instanceof</span> <span class="token class-name">HTMLDivElement</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sanitizedDiv<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token comment">// "abc  def"</span>

<span class="token comment">// At some point later ...</span>

<span class="token comment">// Get the element to update. This must be a div to match our sanitizeFor() context.</span>
<span class="token comment">// Set its content to be the children of our sanitized element.</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"div#target"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceChildren</span><span class="token punctuation">(</span>sanitizedDiv<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div> <div class="notecard note"> <p> <strong>Note:</strong> If you really must perform a string-to-string operation you can extract the string using <code>innerHTML</code>, but you must remember to use the correct context when the string is applied: </p> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> unsanitized_string <span class="token operator">=</span> <span class="token string">"abc &lt;script&gt;alert(1)&lt;/script&gt; def"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sanitizedString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sanitizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sanitizeFor</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> unsanitized_string<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
</pre></div> </div>
<h3 id="sanitize_a_frame">Sanitize a frame</h3>
<p>To sanitize data from an <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe"><code>&lt;iframe&gt;</code></a> with id <code>userFrame</code>:</p> <div class="code-example"><pre data-language="js"><span class="token keyword">const</span> sanitizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sanitizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Default sanitizer;</span>

<span class="token comment">// Get the frame and its Document object</span>
<span class="token keyword">const</span> frame_element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"userFrame"</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> unsantitized_frame_tree <span class="token operator">=</span> frame_element<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">;</span>

<span class="token comment">// Sanitize the document tree and update the frame.</span>
<span class="token keyword">const</span> sanitized_frame_tree <span class="token operator">=</span> sanitizer<span class="token punctuation">.</span><span class="token function">sanitize</span><span class="token punctuation">(</span>unsanititized_frame_tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
frame_element<span class="token punctuation">.</span><span class="token function">replaceChildren</span><span class="token punctuation">(</span>sanitized_frame_tree<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="no-markdown"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a href="https://wicg.github.io/sanitizer-api/#sanitizer-api" hreflang="en" rel=" noopener">HTML Sanitizer API</a></td> <td><span class="spec-wd">Working Draft</span></td> <td>Initial definition.</td> </tr> </tbody> </table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
<th>WebView Android</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody>
<tr>
<th><code>HTML_Sanitizer_API</code></th>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>83</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
</tr>
<tr>
<th><code>Sanitizer</code></th>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>83</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
</tr>
<tr>
<th><code>sanitize</code></th>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>83</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
</tr>
<tr>
<th><code>sanitizeFor</code></th>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>93</div></td>
<td class="bc-supports-yes"><div>94</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-no"><div>No</div></td>
</tr>
</tbody>
</table><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Sanitizer_API" class="_attribution-link" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/HTML_Sanitizer_API</a>
  </p>
</div>
