<h1 id="module-Bundler" class="module"> module Bundler </h1> <section class="description"> <p><a href="bundler"><code>Bundler</code></a> provides a consistent environment for Ruby projects by tracking and installing the exact gems and versions that are needed.</p> <p>Since Ruby 2.6, <a href="bundler"><code>Bundler</code></a> is a part of Ruby's standard library.</p> <p>Bunder is used by creating <em>gemfiles</em> listing all the project dependencies and (optionally) their versions and then using</p> <pre class="ruby" data-language="ruby">require 'bundler/setup'
</pre> <p>or <a href="bundler#method-c-setup"><code>Bundler.setup</code></a> to setup environment where only specified gems and their specified versions could be used.</p> <p>See <a href="https://bundler.io/docs.html">Bundler website</a> for extensive documentation on gemfiles creation and <a href="bundler"><code>Bundler</code></a> usage.</p> <p>As a standard library inside project, <a href="bundler"><code>Bundler</code></a> could be used for introspection of loaded and required modules.</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="ORIGINAL_ENV">ORIGINAL_ENV </dt>

<dt id="SUDO_MUTEX">SUDO_MUTEX </dt>

</dl> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-app_cache"> <span class="method-name">app_cache</span><span class="method-args">(custom_path = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="app_cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 306
def app_cache(custom_path = nil)
  path = custom_path || root
  Pathname.new(path).join(settings.app_cache_path)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-app_config_path"> <span class="method-name">app_config_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="app_config_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 292
def app_config_path
  if app_config = ENV["BUNDLE_APP_CONFIG"]
    app_config_pathname = Pathname.new(app_config)

    if app_config_pathname.absolute?
      app_config_pathname
    else
      app_config_pathname.expand_path(root)
    end
  else
    root.join(".bundle")
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-bin_path"> <span class="method-name">bin_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="bin_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 103
def bin_path
  @bin_path ||= begin
    path = settings[:bin] || "bin"
    path = Pathname.new(path).expand_path(root).expand_path
    SharedHelpers.filesystem_access(path) {|p| FileUtils.mkdir_p(p) }
    path
  end
end</pre> </div> <p>Returns absolute location of where binstubs are installed to.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-bundle_path"> <span class="method-name">bundle_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="bundle_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 94
def bundle_path
  @bundle_path ||= Pathname.new(configured_bundle_path.path).expand_path(root)
end</pre> </div> <p>Returns absolute path of where gems are installed on the filesystem.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-clean_env"> <span class="method-name">clean_env</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clean_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 340
def clean_env
  Bundler::SharedHelpers.major_deprecation(
    2,
    "`Bundler.clean_env` has been deprecated in favor of `Bundler.unbundled_env`. " \
    "If you instead want the environment before bundler was originally loaded, use `Bundler.original_env`",
    :print_caller_location =&gt; true
  )

  unbundled_env
end</pre> </div> <p>@deprecated Use `unbundled_env` instead</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-clean_exec"> <span class="method-name">clean_exec</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clean_exec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 427
def clean_exec(*args)
  Bundler::SharedHelpers.major_deprecation(
    2,
    "`Bundler.clean_exec` has been deprecated in favor of `Bundler.unbundled_exec`. " \
    "If you instead want to exec to a command in the environment before bundler was originally loaded, use `Bundler.original_exec`",
    :print_caller_location =&gt; true
  )

  with_env(unbundled_env) { Kernel.exec(*args) }
end</pre> </div> <p>@deprecated Use `unbundled_exec` instead</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-clean_system"> <span class="method-name">clean_system</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clean_system-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 405
def clean_system(*args)
  Bundler::SharedHelpers.major_deprecation(
    2,
    "`Bundler.clean_system` has been deprecated in favor of `Bundler.unbundled_system`. " \
    "If you instead want to run the command in the environment before bundler was originally loaded, use `Bundler.original_system`",
    :print_caller_location =&gt; true
  )

  with_env(unbundled_env) { Kernel.system(*args) }
end</pre> </div> <p>@deprecated Use `unbundled_system` instead</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-clear_gemspec_cache"> <span class="method-name">clear_gemspec_cache</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clear_gemspec_cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 592
def clear_gemspec_cache
  @gemspec_cache = {}
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-configure"> <span class="method-name">configure</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="configure-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 80
def configure
  @configured ||= configure_gem_home_and_path
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-configured_bundle_path"> <span class="method-name">configured_bundle_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="configured_bundle_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 98
def configured_bundle_path
  @configured_bundle_path ||= settings.path.tap(&amp;:validate!)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-default_bundle_dir"> <span class="method-name">default_bundle_dir</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="default_bundle_dir-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 456
def default_bundle_dir
  SharedHelpers.default_bundle_dir
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-default_gemfile"> <span class="method-name">default_gemfile</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="default_gemfile-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 448
def default_gemfile
  SharedHelpers.default_gemfile
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-default_lockfile"> <span class="method-name">default_lockfile</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="default_lockfile-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 452
def default_lockfile
  SharedHelpers.default_lockfile
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-definition"> <span class="method-name">definition</span><span class="method-args">(unlock = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="definition-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 191
def definition(unlock = nil)
  @definition = nil if unlock
  @definition ||= begin
    configure
    Definition.build(default_gemfile, default_lockfile, unlock)
  end
end</pre> </div> <p>Returns an instance of Bundler::Definition for given Gemfile and lockfile</p> <p>@param unlock [Hash, Boolean, nil] Gems that have been requested</p> <pre class="ruby" data-language="ruby">to be updated or true if all gems should be updated
</pre> <p>@return [Bundler::Definition]</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-environment"> <span class="method-name">environment</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="environment-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 181
def environment
  SharedHelpers.major_deprecation 2, "Bundler.environment has been removed in favor of Bundler.load", :print_caller_location =&gt; true
  load
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-feature_flag"> <span class="method-name">feature_flag</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="feature_flag-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 601
def feature_flag
  @feature_flag ||= FeatureFlag.new(VERSION)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-frozen_bundle-3F"> <span class="method-name">frozen_bundle?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="frozen_bundle-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 199
def frozen_bundle?
  frozen = settings[:deployment]
  frozen ||= settings[:frozen] unless feature_flag.deployment_means_frozen?
  frozen
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-git_present-3F"> <span class="method-name">git_present?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="git_present-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 596
def git_present?
  return @git_present if defined?(@git_present)
  @git_present = Bundler.which("git") || Bundler.which("git.exe")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-home"> <span class="method-name">home</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="home-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 270
def home
  bundle_path.join("bundler")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-install_path"> <span class="method-name">install_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 274
def install_path
  home.join("gems")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-load"> <span class="method-name">load</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="load-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 177
def load
  @load ||= Runtime.new(root, definition)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-load_gemspec"> <span class="method-name">load_gemspec</span><span class="method-args">(file, validate = false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="load_gemspec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 565
def load_gemspec(file, validate = false)
  @gemspec_cache ||= {}
  key = File.expand_path(file)
  @gemspec_cache[key] ||= load_gemspec_uncached(file, validate)
  # Protect against caching side-effected gemspecs by returning a
  # new instance each time.
  @gemspec_cache[key].dup if @gemspec_cache[key]
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-load_gemspec_uncached"> <span class="method-name">load_gemspec_uncached</span><span class="method-args">(file, validate = false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="load_gemspec_uncached-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 574
def load_gemspec_uncached(file, validate = false)
  path = Pathname.new(file)
  contents = read_file(file)
  spec = if contents.start_with?("---") # YAML header
    eval_yaml_gemspec(path, contents)
  else
    # Eval the gemspec from its parent directory, because some gemspecs
    # depend on "./" relative paths.
    SharedHelpers.chdir(path.dirname.to_s) do
      eval_gemspec(path, contents)
    end
  end
  return unless spec
  spec.loaded_from = path.expand_path.to_s
  Bundler.rubygems.validate(spec) if validate
  spec
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-load_marshal"> <span class="method-name">load_marshal</span><span class="method-args">(data)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="load_marshal-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 559
def load_marshal(data)
  Marshal.load(data)
rescue StandardError =&gt; e
  raise MarshalError, "#{e.class}: #{e.message}"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-local_platform"> <span class="method-name">local_platform</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="local_platform-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 443
def local_platform
  return Gem::Platform::RUBY if settings[:force_ruby_platform]
  Gem::Platform.local
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-locked_gems"> <span class="method-name">locked_gems</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="locked_gems-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 205
def locked_gems
  @locked_gems ||=
    if defined?(@definition) &amp;&amp; @definition
      definition.locked_gems
    elsif Bundler.default_lockfile.file?
      lock = Bundler.read_file(Bundler.default_lockfile)
      LockfileParser.new(lock)
    end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-mkdir_p"> <span class="method-name">mkdir_p</span><span class="method-args">(path, options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="mkdir_p-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 505
def mkdir_p(path, options = {})
  if requires_sudo? &amp;&amp; !options[:no_sudo]
    sudo "mkdir -p '#{path}'" unless File.exist?(path)
  else
    SharedHelpers.filesystem_access(path, :write) do |p|
      FileUtils.mkdir_p(p)
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-most_specific_locked_platform-3F"> <span class="method-name">most_specific_locked_platform?</span><span class="method-args">(platform)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="most_specific_locked_platform-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 215
def most_specific_locked_platform?(platform)
  return false unless defined?(@definition) &amp;&amp; @definition

  definition.most_specific_locked_platform == platform
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-original_env"> <span class="method-name">original_env</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="original_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 335
def original_env
  ORIGINAL_ENV.clone
end</pre> </div> <p>@return [Hash] Environment present before <a href="bundler"><code>Bundler</code></a> was activated</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-original_exec"> <span class="method-name">original_exec</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="original_exec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 422
def original_exec(*args)
  with_original_env { Kernel.exec(*args) }
end</pre> </div> <p>Run a `Kernel.exec` to a subcommand with the environment present before <a href="bundler"><code>Bundler</code></a> was activated</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-original_system"> <span class="method-name">original_system</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="original_system-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 400
def original_system(*args)
  with_original_env { Kernel.system(*args) }
end</pre> </div> <p>Run subcommand with the environment present before <a href="bundler"><code>Bundler</code></a> was activated</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-preferred_gemfile_name"> <span class="method-name">preferred_gemfile_name</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="preferred_gemfile_name-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 469
def preferred_gemfile_name
  Bundler.settings[:init_gems_rb] ? "gems.rb" : "Gemfile"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-read_file"> <span class="method-name">read_file</span><span class="method-args">(file)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="read_file-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 553
def read_file(file)
  SharedHelpers.filesystem_access(file, :read) do
    File.open(file, "r:UTF-8", &amp;:read)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-require"> <span class="method-name">require</span><span class="method-args">(*groups)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="require-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 173
def require(*groups)
  setup(*groups).require(*groups)
end</pre> </div> <p>Setups <a href="bundler"><code>Bundler</code></a> environment (see <a href="bundler#method-c-setup"><code>Bundler.setup</code></a>) if it is not already set, and loads all gems from groups specified. Unlike <a href="bundler#method-c-setup"><code>::setup</code></a>, can be called multiple times with different groups (if they were allowed by setup).</p> <p>Assuming Gemfile</p> <pre class="ruby" data-language="ruby">gem 'first_gem', '= 1.0'
group :test do
  gem 'second_gem', '= 1.0'
end
</pre> <p>The code will work as follows:</p> <pre class="ruby" data-language="ruby">Bundler.setup # allow all groups
Bundler.require(:default) # requires only first_gem
# ...later
Bundler.require(:test)   # requires second_gem
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-requires_sudo-3F"> <span class="method-name">requires_sudo?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="requires_sudo-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 477
def requires_sudo?
  return @requires_sudo if defined?(@requires_sudo_ran)

  sudo_present = which "sudo" if settings.allow_sudo?

  if sudo_present
    # the bundle path and subdirectories need to be writable for RubyGems
    # to be able to unpack and install gems without exploding
    path = bundle_path
    path = path.parent until path.exist?

    # bins are written to a different location on OS X
    bin_dir = Pathname.new(Bundler.system_bindir)
    bin_dir = bin_dir.parent until bin_dir.exist?

    # if any directory is not writable, we need sudo
    files = [path, bin_dir] | Dir[bundle_path.join("build_info/*").to_s] | Dir[bundle_path.join("*").to_s]
    unwritable_files = files.reject {|f| File.writable?(f) }
    sudo_needed = !unwritable_files.empty?
    if sudo_needed
      Bundler.ui.warn "Following files may not be writable, so sudo is needed:\n  #{unwritable_files.map(&amp;:to_s).sort.join("\n  ")}"
    end
  end

  @requires_sudo_ran = true
  @requires_sudo = settings.allow_sudo? &amp;&amp; sudo_present &amp;&amp; sudo_needed
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-reset-21"> <span class="method-name">reset!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="reset-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 605
def reset!
  reset_paths!
  Plugin.reset!
  reset_rubygems!
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-reset_paths-21"> <span class="method-name">reset_paths!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="reset_paths-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 616
def reset_paths!
  @bin_path = nil
  @bundler_major_version = nil
  @bundle_path = nil
  @configured = nil
  @configured_bundle_path = nil
  @definition = nil
  @load = nil
  @locked_gems = nil
  @root = nil
  @settings = nil
  @setup = nil
  @user_home = nil
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-reset_rubygems-21"> <span class="method-name">reset_rubygems!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="reset_rubygems-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 631
def reset_rubygems!
  return unless defined?(@rubygems) &amp;&amp; @rubygems
  rubygems.undo_replacements
  rubygems.reset
  @rubygems = nil
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-reset_settings_and_root-21"> <span class="method-name">reset_settings_and_root!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="reset_settings_and_root-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 611
def reset_settings_and_root!
  @settings = nil
  @root = nil
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-rm_rf"> <span class="method-name">rm_rf</span><span class="method-args">(path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="rm_rf-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 316
    def rm_rf(path)
      FileUtils.remove_entry_secure(path) if path &amp;&amp; File.exist?(path)
    rescue ArgumentError
      message = &lt;&lt;EOF
It is a security vulnerability to allow your home directory to be world-writable, and bundler can not continue.
You should probably consider fixing this issue by running `chmod o-w ~` on *nix.
Please refer to https://ruby-doc.org/stdlib-2.1.2/libdoc/fileutils/rdoc/FileUtils.html#method-c-remove_entry_secure for details.
EOF
      File.world_writable?(path) ? Bundler.ui.warn(message) : raise
      raise PathError, "Please fix the world-writable issue with your #{path} directory"
    end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-root"> <span class="method-name">root</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="root-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 282
def root
  @root ||= begin
              SharedHelpers.root
            rescue GemfileNotFound
              bundle_dir = default_bundle_dir
              raise GemfileNotFound, "Could not locate Gemfile or .bundle/ directory" unless bundle_dir
              Pathname.new(File.expand_path("..", bundle_dir))
            end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-ruby_scope"> <span class="method-name">ruby_scope</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="ruby_scope-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 221
def ruby_scope
  "#{Bundler.rubygems.ruby_engine}/#{RbConfig::CONFIG["ruby_version"]}"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-settings"> <span class="method-name">settings</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="settings-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 328
def settings
  @settings ||= Settings.new(app_config_path)
rescue GemfileNotFound
  @settings = Settings.new(Pathname.new(".bundle").expand_path)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-setup"> <span class="method-name">setup</span><span class="method-args">(*groups)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="setup-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 139
def setup(*groups)
  # Return if all groups are already loaded
  return @setup if defined?(@setup) &amp;&amp; @setup

  definition.validate_runtime!

  SharedHelpers.print_major_deprecations!

  if groups.empty?
    # Load all groups, but only once
    @setup = load.setup
  else
    load.setup(*groups)
  end
end</pre> </div> <p>Turns on the <a href="bundler"><code>Bundler</code></a> runtime. After <code>Bundler.setup</code> call, all <code>load</code> or <code>require</code> of the gems would be allowed only if they are part of the Gemfile or Ruby's standard library. If the versions specified in Gemfile, only those versions would be loaded.</p> <p>Assuming Gemfile</p> <pre class="ruby" data-language="ruby">gem 'first_gem', '= 1.0'
group :test do
  gem 'second_gem', '= 1.0'
end
</pre> <p>The code using <a href="bundler#method-c-setup"><code>Bundler.setup</code></a> works as follows:</p> <pre class="ruby" data-language="ruby">require 'third_gem' # allowed, required from global gems
require 'first_gem' # allowed, loads the last installed version
Bundler.setup
require 'fourth_gem' # fails with LoadError
require 'second_gem' # loads exactly version 1.0
</pre> <p><code>Bundler.setup</code> can be called only once, all subsequent calls are no-op.</p> <p>If <em>groups</em> list is provided, only gems from specified groups would be allowed (gems specified outside groups belong to special <code>:default</code> group).</p> <p>To require all gems from Gemfile (or only some groups), see <a href="bundler#method-c-require"><code>Bundler.require</code></a>.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-specs_path"> <span class="method-name">specs_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="specs_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 278
def specs_path
  bundle_path.join("specifications")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-sudo"> <span class="method-name">sudo</span><span class="method-args">(str)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sudo-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 528
    def sudo(str)
      SUDO_MUTEX.synchronize do
        prompt = "\n\n" + &lt;&lt;-PROMPT.gsub(/^ {6}/, "").strip + " "
        Your user account isn't allowed to install to the system RubyGems.
        You can cancel this installation and run:

            bundle config set --local path 'vendor/bundle'
            bundle install

        to install the gems into ./vendor/bundle/, or you can enter your password
        and install the bundled gems to RubyGems using sudo.

        Password:
        PROMPT

        unless @prompted_for_sudo ||= system(%(sudo -k -p "#{prompt}" true))
          raise SudoNotPermittedError,
            "Bundler requires sudo access to install at the moment. " \
            "Try installing again, granting Bundler sudo access when prompted, or installing into a different path."
        end

        `sudo -p "#{prompt}" #{str}`
      end
    end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-system_bindir"> <span class="method-name">system_bindir</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="system_bindir-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 460
def system_bindir
  # Gem.bindir doesn't always return the location that RubyGems will install
  # system binaries. If you put '-n foo' in your .gemrc, RubyGems will
  # install binstubs there instead. Unfortunately, RubyGems doesn't expose
  # that directory at all, so rather than parse .gemrc ourselves, we allow
  # the directory to be set as well, via `bundle config set --local bindir foo`.
  Bundler.settings[:system_bindir] || Bundler.rubygems.gem_bindir
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-tmp"> <span class="method-name">tmp</span><span class="method-args">(name = Process.pid.to_s)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="tmp-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 311
def tmp(name = Process.pid.to_s)
  Kernel.send(:require, "tmpdir")
  Pathname.new(Dir.mktmpdir(["bundler", name]))
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-ui"> <span class="method-name">ui</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="ui-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 84
def ui
  (defined?(@ui) &amp;&amp; @ui) || (self.ui = UI::Shell.new)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-ui-3D"> <span class="method-name">ui=</span><span class="method-args">(ui)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="ui-3D-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 88
def ui=(ui)
  Bundler.rubygems.ui = UI::RGProxy.new(ui)
  @ui = ui
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-unbundled_env"> <span class="method-name">unbundled_env</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="unbundled_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 352
def unbundled_env
  env = original_env

  if env.key?("BUNDLER_ORIG_MANPATH")
    env["MANPATH"] = env["BUNDLER_ORIG_MANPATH"]
  end

  env.delete_if {|k, _| k[0, 7] == "BUNDLE_" }

  if env.key?("RUBYOPT")
    rubyopt = env["RUBYOPT"].split(" ")
    rubyopt.delete("-r#{File.expand_path("bundler/setup", __dir__)}")
    rubyopt.delete("-rbundler/setup")
    env["RUBYOPT"] = rubyopt.join(" ")
  end

  if env.key?("RUBYLIB")
    rubylib = env["RUBYLIB"].split(File::PATH_SEPARATOR)
    rubylib.delete(File.expand_path("..", __FILE__))
    env["RUBYLIB"] = rubylib.join(File::PATH_SEPARATOR)
  end

  env
end</pre> </div> <p>@return [Hash] Environment with all bundler-related variables removed</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-unbundled_exec"> <span class="method-name">unbundled_exec</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="unbundled_exec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 439
def unbundled_exec(*args)
  with_env(unbundled_env) { Kernel.exec(*args) }
end</pre> </div> <p>Run a `Kernel.exec` to a subcommand in an environment with all bundler related variables removed</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-unbundled_system"> <span class="method-name">unbundled_system</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="unbundled_system-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 417
def unbundled_system(*args)
  with_unbundled_env { Kernel.system(*args) }
end</pre> </div> <p>Run subcommand in an environment with all bundler related variables removed</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-use_system_gems-3F"> <span class="method-name">use_system_gems?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="use_system_gems-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 473
def use_system_gems?
  configured_bundle_path.use_system_gems?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-user_bundle_path"> <span class="method-name">user_bundle_path</span><span class="method-args">(dir = "home")</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="user_bundle_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 248
def user_bundle_path(dir = "home")
  env_var, fallback = case dir
                      when "home"
                        ["BUNDLE_USER_HOME", proc { Pathname.new(user_home).join(".bundle") }]
                      when "cache"
                        ["BUNDLE_USER_CACHE", proc { user_bundle_path.join("cache") }]
                      when "config"
                        ["BUNDLE_USER_CONFIG", proc { user_bundle_path.join("config") }]
                      when "plugin"
                        ["BUNDLE_USER_PLUGIN", proc { user_bundle_path.join("plugin") }]
                      else
                        raise BundlerError, "Unknown user path requested: #{dir}"
  end
  # `fallback` will already be a Pathname, but Pathname.new() is
  # idempotent so it's OK
  Pathname.new(ENV.fetch(env_var, &amp;fallback))
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-user_cache"> <span class="method-name">user_cache</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="user_cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 266
def user_cache
  user_bundle_path("cache")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-user_home"> <span class="method-name">user_home</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="user_home-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 225
def user_home
  @user_home ||= begin
    home = Bundler.rubygems.user_home
    bundle_home = home ? File.join(home, ".bundle") : nil

    warning = if home.nil?
      "Your home directory is not set."
    elsif !File.directory?(home)
      "`#{home}` is not a directory."
    elsif !File.writable?(home) &amp;&amp; (!File.directory?(bundle_home) || !File.writable?(bundle_home))
      "`#{home}` is not writable."
    end

    if warning
      user_home = tmp_home_path(warning)
      Bundler.ui.warn "#{warning}\nBundler will use `#{user_home}' as your home directory temporarily.\n"
      user_home
    else
      Pathname.new(home)
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-which"> <span class="method-name">which</span><span class="method-args">(executable)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="which-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 515
def which(executable)
  if File.file?(executable) &amp;&amp; File.executable?(executable)
    executable
  elsif paths = ENV["PATH"]
    quote = '"'.freeze
    paths.split(File::PATH_SEPARATOR).find do |path|
      path = path[1..-2] if path.start_with?(quote) &amp;&amp; path.end_with?(quote)
      executable_path = File.expand_path(executable, path)
      return executable_path if File.file?(executable_path) &amp;&amp; File.executable?(executable_path)
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-with_clean_env"> <span class="method-name">with_clean_env</span><span class="method-args">() { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="with_clean_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 383
def with_clean_env
  Bundler::SharedHelpers.major_deprecation(
    2,
    "`Bundler.with_clean_env` has been deprecated in favor of `Bundler.with_unbundled_env`. " \
    "If you instead want the environment before bundler was originally loaded, use `Bundler.with_original_env`",
    :print_caller_location =&gt; true
  )

  with_env(unbundled_env) { yield }
end</pre> </div> <p>@deprecated Use `with_unbundled_env` instead</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-with_original_env"> <span class="method-name">with_original_env</span><span class="method-args">() { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="with_original_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 378
def with_original_env
  with_env(original_env) { yield }
end</pre> </div> <p>Run block with environment present before <a href="bundler"><code>Bundler</code></a> was activated</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-with_unbundled_env"> <span class="method-name">with_unbundled_env</span><span class="method-args">() { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="with_unbundled_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 395
def with_unbundled_env
  with_env(unbundled_env) { yield }
end</pre> </div> <p>Run block with all bundler-related variables removed</p>  </div> </div> </section> <section id="private-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-configure_gem_home"> <span class="method-name">configure_gem_home</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="configure_gem_home-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 682
def configure_gem_home
  Bundler::SharedHelpers.set_env "GEM_HOME", File.expand_path(bundle_path, root)
  Bundler.rubygems.clear_paths
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-configure_gem_home_and_path"> <span class="method-name">configure_gem_home_and_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="configure_gem_home_and_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 662
def configure_gem_home_and_path
  configure_gem_path
  configure_gem_home
  bundle_path
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-configure_gem_path"> <span class="method-name">configure_gem_path</span><span class="method-args">(env = ENV)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="configure_gem_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 668
def configure_gem_path(env = ENV)
  blank_home = env["GEM_HOME"].nil? || env["GEM_HOME"].empty?
  if !use_system_gems?
    # this needs to be empty string to cause
    # PathSupport.split_gem_path to only load up the
    # Bundler --path setting as the GEM_PATH.
    env["GEM_PATH"] = ""
  elsif blank_home
    possibles = [Bundler.rubygems.gem_dir, Bundler.rubygems.gem_path]
    paths = possibles.flatten.compact.uniq.reject(&amp;:empty?)
    env["GEM_PATH"] = paths.join(File::PATH_SEPARATOR)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-eval_gemspec"> <span class="method-name">eval_gemspec</span><span class="method-args">(path, contents)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="eval_gemspec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 650
def eval_gemspec(path, contents)
  eval(contents, TOPLEVEL_BINDING.dup, path.expand_path.to_s)
rescue ScriptError, StandardError =&gt; e
  msg = "There was an error while loading `#{path.basename}`: #{e.message}"

  if e.is_a?(LoadError)
    msg += "\nDoes it try to require a relative path? That's been removed in Ruby 1.9"
  end

  raise GemspecError, Dsl::DSLError.new(msg, path, e.backtrace, contents)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-eval_yaml_gemspec"> <span class="method-name">eval_yaml_gemspec</span><span class="method-args">(path, contents)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="eval_yaml_gemspec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 640
def eval_yaml_gemspec(path, contents)
  require_relative "bundler/psyched_yaml"

  # If the YAML is invalid, Syck raises an ArgumentError, and Psych
  # raises a Psych::SyntaxError. See psyched_yaml.rb for more info.
  Gem::Specification.from_yaml(contents)
rescue YamlLibrarySyntaxError, ArgumentError, Gem::EndOfYAMLException, Gem::Exception
  eval_gemspec(path, contents)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-tmp_home_path"> <span class="method-name">tmp_home_path</span><span class="method-args">(warning)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="tmp_home_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 687
def tmp_home_path(warning)
  Kernel.send(:require, "tmpdir")
  SharedHelpers.filesystem_access(Dir.tmpdir) do
    path = Bundler.tmp
    at_exit { Bundler.rm_rf(path) }
    path
  end
rescue RuntimeError =&gt; e
  raise e.exception("#{warning}\nBundler also failed to create a temporary home directory':\n#{e}")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-with_env"> <span class="method-name">with_env</span><span class="method-args">(env) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="with_env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler.rb, line 699
def with_env(env)
  backup = ENV.to_hash
  ENV.replace(env)
  yield
ensure
  ENV.replace(backup)
end</pre> </div> <p>@param env [Hash]</p>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core &copy; 1993&ndash;2020 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library &copy; contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>
