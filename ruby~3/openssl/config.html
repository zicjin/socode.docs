<h1 id="class-OpenSSL::Config" class="class"> class OpenSSL::Config </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="../enumerable">Enumerable</a></dd>
</dl> <section class="description"> <h1 id="class-OpenSSL::Config-label-OpenSSL-3A-3AConfig"><a href="config"><code>OpenSSL::Config</code></a></h1> <p>Configuration for the openssl library.</p> <p>Many system's installation of openssl library will depend on your system configuration. See the value of <a href="config#DEFAULT_CONFIG_FILE"><code>OpenSSL::Config::DEFAULT_CONFIG_FILE</code></a> for the location of the file for your host.</p> <p>See also <a href="http://www.openssl.org/docs/apps/config.html">www.openssl.org/docs/apps/config.html</a></p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="DEFAULT_CONFIG_FILE">DEFAULT_CONFIG_FILE </dt>
<dd>
<p>The default system configuration file for openssl</p> </dd>
<dt id="ESCAPE_MAP">ESCAPE_MAP </dt>
<dd>
<p>escaped char map</p> </dd>
<dt id="QUOTE_REGEXP_DQ">QUOTE_REGEXP_DQ </dt>
<dd>
<p>escape with backslash and doubled dq</p> </dd>
<dt id="QUOTE_REGEXP_SQ">QUOTE_REGEXP_SQ </dt>
<dd>
<p>escape with backslash</p> </dd>
</dl> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(filename = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 264
def initialize(filename = nil)
  @data = {}
  if filename
    File.open(filename.to_s) do |file|
      Config.parse_config(file).each do |section, hash|
        set_section(section, hash)
      end
    end
  end
end</pre> </div> <p>Creates an instance of OpenSSL's configuration class.</p> <p>This can be used in contexts like <a href="x509/extensionfactory#attribute-i-config"><code>OpenSSL::X509::ExtensionFactory.config=</code></a></p> <p>If the optional <em>filename</em> parameter is provided, then it is read in and parsed via parse_config.</p> <p>This can raise <a href="../io"><code>IO</code></a> exceptions based on the access, or availability of the file. A <a href="configerror"><code>ConfigError</code></a> exception may be raised depending on the validity of the data being configured.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-parse"> <span class="method-name">parse</span><span class="method-args">(string)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="parse-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 37
def parse(string)
  c = new()
  parse_config(StringIO.new(string)).each do |section, hash|
    c.set_section(section, hash)
  end
  c
end</pre> </div> <p>Parses a given <em>string</em> as a blob that contains configuration for <a href="../openssl"><code>OpenSSL</code></a>.</p> <p>If the source of the <a href="../io"><code>IO</code></a> is a file, then consider using parse_config.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-parse_config"> <span class="method-name">parse_config</span><span class="method-args">(io)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="parse_config-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 53
def parse_config(io)
  begin
    parse_config_lines(io)
  rescue =&gt; error
    raise ConfigError, "error in line #{io.lineno}: " + error.message
  end
end</pre> </div> <p>Parses the configuration data read from <em>io</em>, see also parse.</p> <p>Raises a <a href="configerror"><code>ConfigError</code></a> on invalid configuration data.</p>  </div> </div> </section> <section id="private-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-clear_comments"> <span class="method-name">clear_comments</span><span class="method-args">(line)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clear_comments-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 192
def clear_comments(line)
  # FCOMMENT
  if m = line.match(/\A([\t\n\f ]*);.*\z/)
    return m[1]
  end
  # COMMENT
  scanned = []
  while m = line.match(/[#'"\\]/)
    scanned &lt;&lt; m.pre_match
    c = m[0]
    line = m.post_match
    case c
    when '#'
      line = nil
      break
    when "'", '"'
      regexp = (c == "'") ? QUOTE_REGEXP_SQ : QUOTE_REGEXP_DQ
      scanned &lt;&lt; c
      if m = line.match(regexp)
        scanned &lt;&lt; m[0]
        line = m.post_match
      else
        scanned &lt;&lt; line
        line = nil
        break
      end
    when "\\"
      scanned &lt;&lt; c
      scanned &lt;&lt; line.slice!(0, 1)
    else
      raise 'must not reaced'
    end
  end
  scanned &lt;&lt; line
  scanned.join
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-extract_reference"> <span class="method-name">extract_reference</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="extract_reference-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 177
def extract_reference(value)
  rest = ''
  if m = value.match(/\(([^)]*)\)|\{([^}]*)\}/)
    value = m[1] || m[2]
    rest = m.post_match
  elsif [?(, ?{].include?(value[0])
    raise ConfigError, "no close brace"
  end
  if m = value.match(/[a-zA-Z0-9_]*(?:::[a-zA-Z0-9_]*)?/)
    return m[0], m.post_match + rest
  else
    raise
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-get_definition"> <span class="method-name">get_definition</span><span class="method-args">(io_stack)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="get_definition-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 229
def get_definition(io_stack)
  if line = get_line(io_stack)
    while /[^\\]\\\z/ =~ line
      if extra = get_line(io_stack)
        line += extra
      else
        break
      end
    end
    return line.strip
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-get_line"> <span class="method-name">get_line</span><span class="method-args">(io_stack)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="get_line-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 242
def get_line(io_stack)
  while io = io_stack.last
    if line = io.gets
      return line.gsub(/[\r\n]*/, '')
    end
    io_stack.pop
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-parse_config_lines"> <span class="method-name">parse_config_lines</span><span class="method-args">(io)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="parse_config_lines-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 76
def parse_config_lines(io)
  section = 'default'
  data = {section =&gt; {}}
  io_stack = [io]
  while definition = get_definition(io_stack)
    definition = clear_comments(definition)
    next if definition.empty?
    case definition
    when /\A\[/
      if /\[([^\]]*)\]/ =~ definition
        section = $1.strip
        data[section] ||= {}
      else
        raise ConfigError, "missing close square bracket"
      end
    when /\A\.include (\s*=\s*)?(.+)\z/
      path = $2
      if File.directory?(path)
        files = Dir.glob(File.join(path, "*.{cnf,conf}"), File::FNM_EXTGLOB)
      else
        files = [path]
      end

      files.each do |filename|
        begin
          io_stack &lt;&lt; StringIO.new(File.read(filename))
        rescue
          raise ConfigError, "could not include file '%s'" % filename
        end
      end
    when /\A([^:\s]*)(?:::([^:\s]*))?\s*=(.*)\z/
      if $2
        section = $1
        key = $2
      else
        key = $1
      end
      value = unescape_value(data, section, $3)
      (data[section] ||= {})[key] = value.strip
    else
      raise ConfigError, "missing equal sign"
    end
  end
  data
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-unescape_value"> <span class="method-name">unescape_value</span><span class="method-args">(data, section, value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="unescape_value-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 134
def unescape_value(data, section, value)
  scanned = []
  while m = value.match(/['"\\$]/)
    scanned &lt;&lt; m.pre_match
    c = m[0]
    value = m.post_match
    case c
    when "'"
      if m = value.match(QUOTE_REGEXP_SQ)
        scanned &lt;&lt; m[1].gsub(/\\(.)/, '\\1')
        value = m.post_match
      else
        break
      end
    when '"'
      if m = value.match(QUOTE_REGEXP_DQ)
        scanned &lt;&lt; m[1].gsub(/""/, '').gsub(/\\(.)/, '\\1')
        value = m.post_match
      else
        break
      end
    when "\\"
      c = value.slice!(0, 1)
      scanned &lt;&lt; (ESCAPE_MAP[c] || c)
    when "$"
      ref, value = extract_reference(value)
      refsec = section
      if ref.index('::')
        refsec, ref = ref.split('::', 2)
      end
      if v = get_key_string(data, refsec, ref)
        scanned &lt;&lt; v
      else
        raise ConfigError, "variable has no value"
      end
    else
      raise 'must not reaced'
    end
  end
  scanned &lt;&lt; value
  scanned.join
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D"> <span class="method-name">[]</span><span class="method-args">(section)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 360
def [](section)
  @data[section] || {}
end</pre> </div> <p>Get a specific <em>section</em> from the current configuration</p> <p>Given the following configurating file being loaded:</p> <pre class="ruby" data-language="ruby">config = OpenSSL::Config.load('foo.cnf')
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
</pre> <p>You can get a hash of the specific section like so:</p> <pre class="ruby" data-language="ruby">config['default']
  #=&gt; {"foo"=&gt;"bar"}
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D-3D"> <span class="method-name">[]=</span><span class="method-args">(section, pairs)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-3D-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 399
def []=(section, pairs)
  check_modify
  set_section(section, pairs)
end</pre> </div> <p>*Deprecated in v2.2.0*. This method will be removed in a future release.</p> <p>Sets a specific <em>section</em> name with a <a href="../hash"><code>Hash</code></a> <em>pairs</em>.</p> <p>Given the following configuration being created:</p> <pre class="ruby" data-language="ruby">config = OpenSSL::Config.new
  #=&gt; #&lt;OpenSSL::Config sections=[]&gt;
config['default'] = {"foo"=&gt;"bar","baz"=&gt;"buz"}
  #=&gt; {"foo"=&gt;"bar", "baz"=&gt;"buz"}
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
  #   baz=buz
</pre> <p>It's important to note that this will essentially merge any of the keys in <em>pairs</em> with the existing <em>section</em>. For example:</p> <pre class="ruby" data-language="ruby">config['default']
  #=&gt; {"foo"=&gt;"bar", "baz"=&gt;"buz"}
config['default'] = {"foo" =&gt; "changed"}
  #=&gt; {"foo"=&gt;"changed"}
config['default']
  #=&gt; {"foo"=&gt;"changed", "baz"=&gt;"buz"}
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-add_value"> <span class="method-name">add_value</span><span class="method-args">(section, key, value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="add_value-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 339
def add_value(section, key, value)
  check_modify
  (@data[section] ||= {})[key] = value
end</pre> </div> <p>*Deprecated in v2.2.0*. This method will be removed in a future release.</p> <p><a href="../set"><code>Set</code></a> the target <em>key</em> with a given <em>value</em> under a specific <em>section</em>.</p> <p>Given the following configurating file being loaded:</p> <pre class="ruby" data-language="ruby">config = OpenSSL::Config.load('foo.cnf')
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
</pre> <p>You can set the value of <em>foo</em> under the <em>default</em> section to a new value:</p> <pre class="ruby" data-language="ruby">config.add_value('default', 'foo', 'buzz')
  #=&gt; "buzz"
puts config.to_s
  #=&gt; [ default ]
  #   foo=buzz
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-each"> <span class="method-name">each</span><span class="method-args">() { |section, key, value| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="each-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 464
def each
  @data.each do |section, hash|
    hash.each do |key, value|
      yield [section, key, value]
    end
  end
end</pre> </div> <p>For a block.</p> <p>Receive the section and its pairs for the current configuration.</p> <pre class="ruby" data-language="ruby">config.each do |section, key, value|
  # ...
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-get_value"> <span class="method-name">get_value</span><span class="method-args">(section, key)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="get_value-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 292
def get_value(section, key)
  if section.nil?
    raise TypeError.new('nil not allowed')
  end
  section = 'default' if section.empty?
  get_key_string(section, key)
end</pre> </div> <p>Gets the value of <em>key</em> from the given <em>section</em></p> <p>Given the following configurating file being loaded:</p> <pre class="ruby" data-language="ruby">config = OpenSSL::Config.load('foo.cnf')
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
</pre> <p>You can get a specific value from the config if you know the <em>section</em> and <em>key</em> like so:</p> <pre class="ruby" data-language="ruby">config.get_value('default','foo')
  #=&gt; "bar"
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-inspect"> <span class="method-name">inspect</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="inspect-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 475
def inspect
  "#&lt;#{self.class.name} sections=#{sections.inspect}&gt;"
end</pre> </div> <p><a href="../string"><code>String</code></a> representation of this configuration object, including the class name and its sections.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sections"> <span class="method-name">sections</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sections-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 413
def sections
  @data.keys
end</pre> </div> <p>Get the names of all sections in the current configuration</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_s"> <span class="method-name">to_s</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="to_s-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 443
def to_s
  ary = []
  @data.keys.sort.each do |section|
    ary &lt;&lt; "[ #{section} ]\n"
    @data[section].keys.each do |key|
      ary &lt;&lt; "#{key}=#{@data[section][key]}\n"
    end
    ary &lt;&lt; "\n"
  end
  ary.join
end</pre> </div> <p>Get the parsable form of the current configuration</p> <p>Given the following configuration being created:</p> <pre class="ruby" data-language="ruby">config = OpenSSL::Config.new
  #=&gt; #&lt;OpenSSL::Config sections=[]&gt;
config['default'] = {"foo"=&gt;"bar","baz"=&gt;"buz"}
  #=&gt; {"foo"=&gt;"bar", "baz"=&gt;"buz"}
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
  #   baz=buz
</pre> <p>You can parse get the serialized configuration using <a href="config#method-i-to_s"><code>to_s</code></a> and then parse it later:</p> <pre class="ruby" data-language="ruby">serialized_config = config.to_s
# much later...
new_config = OpenSSL::Config.parse(serialized_config)
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts new_config
  #=&gt; [ default ]
      foo=bar
      baz=buz
</pre>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-check_modify"> <span class="method-name">check_modify</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="check_modify-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 491
def check_modify
  warn "#{caller(2, 1)[0]}: warning: do not modify OpenSSL::Config; this " \
    "method is deprecated and will be removed in a future release."
  raise TypeError.new("Insecure: can't modify OpenSSL config") if frozen?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-get_key_string"> <span class="method-name">get_key_string</span><span class="method-args">(section, key)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="get_key_string-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 497
def get_key_string(section, key)
  Config.get_key_string(@data, section, key)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-initialize_copy"> <span class="method-name">initialize_copy</span><span class="method-args">(other)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="initialize_copy-source"> <pre class="ruby" data-language="ruby"># File ext/openssl/lib/openssl/config.rb, line 487
def initialize_copy(other)
  @data = other.data.dup
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core &copy; 1993&ndash;2020 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library &copy; contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>
