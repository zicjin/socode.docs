<div id="page-doc"> <h1 id="overriding-the-express-api" data-level="4">Overriding the Express API</h1> <p>The Express API consists of various methods and properties on the request and response objects. These are inherited by prototype. There are two extension points for the Express API:</p> <ol> <li>The global protoypes at <code>express.request</code> and <code>express.response</code>.</li> <li>App-specific prototypes at <code>app.request</code> and <code>app.response</code>.</li> </ol> <p>Altering the global prototypes will affect all loaded Express apps in the same process. If desired, alterations can be made app-specific by only altering the app-specific prototypes after creating a new app.</p> <h2 id="methods">Methods</h2> <p>You can override the signature and behavior of existing methods with your own, by assigning a custom function.</p> <p>Following is an example of overriding the behavior of <a href="http://expressjs.com/index.html#res.sendStatus">res.sendStatus</a>.</p> <pre data-language="js">app.response.sendStatus = function (statusCode, type, message) {
  // code is intentionally kept simple for demonstration purpose
  return this.contentType(type)
    .status(statusCode)
    .send(message)
}
</pre> <p>The above implementation completely changes the original signature of <code>res.sendStatus</code>. It now accepts a status code, encoding type, and the message to be sent to the client.</p> <p>The overridden method may now be used this way:</p> <pre data-language="js">res.sendStatus(404, 'application/json', '{"error":"resource not found"}')
</pre> <h2 id="properties">Properties</h2> <p>Properties in the Express API are either:</p> <ol> <li>Assigned properties (ex: <code>req.baseUrl</code>, <code>req.originalUrl</code>)</li> <li>Defined as getters (ex: <code>req.secure</code>, <code>req.ip</code>)</li> </ol> <p>Since properties under category 1 are dynamically assigned on the <code>request</code> and <code>response</code> objects in the context of the current request-response cycle, their behavior cannot be overridden.</p> <p>Properties under category 2 can be overwritten using the Express API extensions API.</p> <p>The following code rewrites how the value of <code>req.ip</code> is to be derived. Now, it simply returns the value of the <code>Client-IP</code> request header.</p> <pre data-language="js">Object.defineProperty(app.request, 'ip', {
  configurable: true,
  enumerable: true,
  get: function () { return this.get('Client-IP') }
})
</pre> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="http://expressjs.com/en/guide/overriding-express-api.html" class="_attribution-link" target="_blank">http://expressjs.com/en/guide/overriding-express-api.html</a>
  </p>
</div>
