<h1 id="writing-middleware-for-use-in-express-apps" data-level="2">Writing middleware for use in Express apps</h1> <h2>Overview</h2> <p><em>Middleware</em> functions are functions that have access to the <a href="../index#req">request object</a> (<code>req</code>), the <a href="../index#res">response object</a> (<code>res</code>), and the <code>next</code> function in the application’s request-response cycle. The <code>next</code> function is a function in the Express router which, when invoked, executes the middleware succeeding the current middleware.</p> <p>Middleware functions can perform the following tasks:</p> <ul> <li>Execute any code.</li> <li>Make changes to the request and the response objects.</li> <li>End the request-response cycle.</li> <li>Call the next middleware in the stack.</li> </ul> <p>If the current middleware function does not end the request-response cycle, it must call <code>next()</code> to pass control to the next middleware function. Otherwise, the request will be left hanging.</p> <p>The following figure shows the elements of a middleware function call:</p> <table id="mw-fig"> <tr>
<td id="mw-fig-imgcell"> <img src="data:image/png;base64,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" id="mw-fig-img"> </td> <td class="mw-fig-callouts"> <div class="callout" id="callout1">HTTP method for which the middleware function applies.</div> <div class="callout" id="callout2">Path (route) for which the middleware function applies.</div> <div class="callout" id="callout3">The middleware function.</div> <div class="callout" id="callout4">Callback argument to the middleware function, called "next" by convention.</div> <div class="callout" id="callout5">HTTP <a href="../index#res">response</a> argument to the middleware function, called "res" by convention.</div> <div class="callout" id="callout6">HTTP <a href="../index#req">request</a> argument to the middleware function, called "req" by convention.</div> </td>
</tr> </table> <p>Starting with Express 5, middleware functions that return a Promise will call <code>next(value)</code> when they reject or throw an error. <code>next</code> will be called with either the rejected value or the thrown Error.</p> <h2>Example</h2> <p>Here is an example of a simple “Hello World” Express application. The remainder of this article will define and add three middleware functions to the application: one called <code>myLogger</code> that prints a simple log message, one called <code>requestTime</code> that displays the timestamp of the HTTP request, and one called <code>validateCookies</code> that validates incoming cookies.</p> <pre data-language="js">const express = require('express')
const app = express()

app.get('/', (req, res) =&gt; {
  res.send('Hello World!')
})

app.listen(3000)
</pre> <h3>Middleware function myLogger</h3> <p>Here is a simple example of a middleware function called “myLogger”. This function just prints “LOGGED” when a request to the app passes through it. The middleware function is assigned to a variable named <code>myLogger</code>.</p> <pre data-language="js">const myLogger = function (req, res, next) {
  console.log('LOGGED')
  next()
}
</pre> <div class="doc-box doc-notice"> <p>Notice the call above to <code>next()</code>. Calling this function invokes the next middleware function in the app. The <code>next()</code> function is not a part of the Node.js or Express API, but is the third argument that is passed to the middleware function. The <code>next()</code> function could be named anything, but by convention it is always named “next”. To avoid confusion, always use this convention.</p> </div> <p>To load the middleware function, call <code>app.use()</code>, specifying the middleware function. For example, the following code loads the <code>myLogger</code> middleware function before the route to the root path (/).</p> <pre data-language="js">const express = require('express')
const app = express()

const myLogger = function (req, res, next) {
  console.log('LOGGED')
  next()
}

app.use(myLogger)

app.get('/', (req, res) =&gt; {
  res.send('Hello World!')
})

app.listen(3000)
</pre> <p>Every time the app receives a request, it prints the message “LOGGED” to the terminal.</p> <p>The order of middleware loading is important: middleware functions that are loaded first are also executed first.</p> <p>If <code>myLogger</code> is loaded after the route to the root path, the request never reaches it and the app doesn’t print “LOGGED”, because the route handler of the root path terminates the request-response cycle.</p> <p>The middleware function <code>myLogger</code> simply prints a message, then passes on the request to the next middleware function in the stack by calling the <code>next()</code> function.</p> <h3>Middleware function requestTime</h3> <p>Next, we’ll create a middleware function called “requestTime” and add a property called <code>requestTime</code> to the request object.</p> <pre data-language="js">const requestTime = function (req, res, next) {
  req.requestTime = Date.now()
  next()
}
</pre> <p>The app now uses the <code>requestTime</code> middleware function. Also, the callback function of the root path route uses the property that the middleware function adds to <code>req</code> (the request object).</p> <pre data-language="js">const express = require('express')
const app = express()

const requestTime = function (req, res, next) {
  req.requestTime = Date.now()
  next()
}

app.use(requestTime)

app.get('/', (req, res) =&gt; {
  let responseText = 'Hello World!&lt;br&gt;'
  responseText += `&lt;small&gt;Requested at: ${req.requestTime}&lt;/small&gt;`
  res.send(responseText)
})

app.listen(3000)
</pre> <p>When you make a request to the root of the app, the app now displays the timestamp of your request in the browser.</p> <h3>Middleware function validateCookies</h3> <p>Finally, we’ll create a middleware function that validates incoming cookies and sends a 400 response if cookies are invalid.</p> <p>Here’s an example function that validates cookies with an external async service.</p> <pre data-language="js">async function cookieValidator (cookies) {
  try {
    await externallyValidateCookie(cookies.testCookie)
  } catch {
    throw new Error('Invalid cookies')
  }
}
</pre> <p>Here we use the <a href="http://expressjs.com/resources/middleware/cookie-parser.html"><code>cookie-parser</code></a> middleware to parse incoming cookies off the <code>req</code> object and pass them to our <code>cookieValidator</code> function. The <code>validateCookies</code> middleware returns a Promise that upon rejection will automatically trigger our error handler.</p> <pre data-language="js">const express = require('express')
const cookieParser = require('cookie-parser')
const cookieValidator = require('./cookieValidator')

const app = express()

async function validateCookies (req, res, next) {
  await cookieValidator(req.cookies)
  next()
}

app.use(cookieParser())

app.use(validateCookies)

// error handler
app.use((err, req, res, next) =&gt; {
  res.status(400).send(err.message)
})

app.listen(3000)
</pre> <div class="doc-box doc-notice"> <p>Note how <code>next()</code> is called after <code>await cookieValidator(req.cookies)</code>. This ensures that if <code>cookieValidator</code> resolves, the next middleware in the stack will get called. If you pass anything to the <code>next()</code> function (except the string <code>'route'</code> or <code>'router'</code>), Express regards the current request as being an error and will skip any remaining non-error handling routing and middleware functions.</p> </div> <p>Because you have access to the request object, the response object, the next middleware function in the stack, and the whole Node.js API, the possibilities with middleware functions are endless.</p> <p>For more information about Express middleware, see: <a href="using-middleware">Using Express middleware</a>.</p> <h2>Configurable middleware</h2> <p>If you need your middleware to be configurable, export a function which accepts an options object or other parameters, which, then returns the middleware implementation based on the input parameters.</p> <p>File: <code>my-middleware.js</code></p> <pre data-language="js">module.exports = function (options) {
  return function (req, res, next) {
    // Implement the middleware function based on the options object
    next()
  }
}
</pre> <p>The middleware can now be used as shown below.</p> <pre data-language="js">const mw = require('./my-middleware.js')

app.use(mw({ option1: '1', option2: '2' }))
</pre> <p>Refer to <a href="https://github.com/expressjs/cookie-session">cookie-session</a> and <a href="https://github.com/expressjs/compression">compression</a> for examples of configurable middleware.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="http://expressjs.com/en/guide/writing-middleware.html" class="_attribution-link" target="_blank">http://expressjs.com/en/guide/writing-middleware.html</a>
  </p>
</div>
