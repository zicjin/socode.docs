<h1>docker buildx build</h1>
   <p><br></p> <p>Start a build</p> <h2 id="usage">Usage</h2> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build [OPTIONS] PATH | URL | -
</pre></div> <p>Refer to the <a href="#options">options section</a> for an overview of available <a href="#options"><code class="language-plaintext highlighter-rouge">OPTIONS</code></a> for this command.</p> <h2 id="description">Description</h2> <p name="extended-description">The <code class="language-plaintext highlighter-rouge">buildx build</code> command starts a build using BuildKit. This command is similar to the UI of <code class="language-plaintext highlighter-rouge">docker build</code> command and takes the same flags and arguments.</p> <p>For documentation on most of these flags, refer to the <a href="../build/index"><code class="language-plaintext highlighter-rouge">docker build</code> documentation</a>. In here we’ll document a subset of the new flags.</p> <p>For example uses of this command, refer to the <a href="#examples">examples section</a> below.</p> <h2 id="options">Options</h2> <table> <thead> <tr> <td>Name, shorthand</td> <td>Default</td> <td>Description</td> </tr> </thead> <tbody> <tr> <td><a href="../build/index#add-entries-to-container-hosts-file---add-host"><code class="language-plaintext highlighter-rouge">--add-host</code></a></td> <td></td> <td>Add a custom host-to-IP mapping (format: <code class="language-plaintext highlighter-rouge">host:ip</code>)</td> </tr> <tr> <td><a href="#allow"><code class="language-plaintext highlighter-rouge">--allow</code></a></td> <td></td> <td>Allow extra privileged entitlement (e.g., <code class="language-plaintext highlighter-rouge">network.host</code>, <code class="language-plaintext highlighter-rouge">security.insecure</code>)</td> </tr> <tr> <td><a href="#build-arg"><code class="language-plaintext highlighter-rouge">--build-arg</code></a></td> <td></td> <td>Set build-time variables</td> </tr> <tr> <td><a href="#build-context"><code class="language-plaintext highlighter-rouge">--build-context</code></a></td> <td></td> <td>Additional build contexts (e.g., name=path)</td> </tr> <tr> <td><a href="#cache-from"><code class="language-plaintext highlighter-rouge">--cache-from</code></a></td> <td></td> <td>External cache sources (e.g., <code class="language-plaintext highlighter-rouge">user/app:cache</code>, <code class="language-plaintext highlighter-rouge">type=local,src=path/to/dir</code>)</td> </tr> <tr> <td><a href="#cache-to"><code class="language-plaintext highlighter-rouge">--cache-to</code></a></td> <td></td> <td>Cache export destinations (e.g., <code class="language-plaintext highlighter-rouge">user/app:cache</code>, <code class="language-plaintext highlighter-rouge">type=local,dest=path/to/dir</code>)</td> </tr> <tr> <td><a href="../build/index#use-a-custom-parent-cgroup---cgroup-parent"><code class="language-plaintext highlighter-rouge">--cgroup-parent</code></a></td> <td></td> <td>Optional parent cgroup for the container</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--compress</code></td> <td></td> <td>Compress the build context using gzip</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--cpu-period</code></td> <td></td> <td>Limit the CPU CFS (Completely Fair Scheduler) period</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--cpu-quota</code></td> <td></td> <td>Limit the CPU CFS (Completely Fair Scheduler) quota</td> </tr> <tr> <td>
<code class="language-plaintext highlighter-rouge">--cpu-shares</code> , <code class="language-plaintext highlighter-rouge">-c</code>
</td> <td></td> <td>CPU shares (relative weight)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--cpuset-cpus</code></td> <td></td> <td>CPUs in which to allow execution (<code class="language-plaintext highlighter-rouge">0-3</code>, <code class="language-plaintext highlighter-rouge">0,1</code>)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--cpuset-mems</code></td> <td></td> <td>MEMs in which to allow execution (<code class="language-plaintext highlighter-rouge">0-3</code>, <code class="language-plaintext highlighter-rouge">0,1</code>)</td> </tr> <tr> <td>
<a href="../build/index#specify-a-dockerfile--f"><code class="language-plaintext highlighter-rouge">--file</code></a> , <a href="../build/index#specify-a-dockerfile--f"><code class="language-plaintext highlighter-rouge">-f</code></a>
</td> <td></td> <td>Name of the Dockerfile (default: <code class="language-plaintext highlighter-rouge">PATH/Dockerfile</code>)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--force-rm</code></td> <td></td> <td>Always remove intermediate containers</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--iidfile</code></td> <td></td> <td>Write the image ID to the file</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--isolation</code></td> <td></td> <td>Container isolation technology</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--label</code></td> <td></td> <td>Set metadata for an image</td> </tr> <tr> <td><a href="#load"><code class="language-plaintext highlighter-rouge">--load</code></a></td> <td></td> <td>Shorthand for <code class="language-plaintext highlighter-rouge">--output=type=docker</code>
</td> </tr> <tr> <td>
<code class="language-plaintext highlighter-rouge">--memory</code> , <code class="language-plaintext highlighter-rouge">-m</code>
</td> <td></td> <td>Memory limit</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--memory-swap</code></td> <td></td> <td>Swap limit equal to memory plus swap: <code class="language-plaintext highlighter-rouge">-1</code> to enable unlimited swap</td> </tr> <tr> <td><a href="#metadata-file"><code class="language-plaintext highlighter-rouge">--metadata-file</code></a></td> <td></td> <td>Write build result metadata to the file</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--network</code></td> <td></td> <td>Set the networking mode for the <code class="language-plaintext highlighter-rouge">RUN</code> instructions during build</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--no-cache</code></td> <td></td> <td>Do not use cache when building the image</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--no-cache-filter</code></td> <td></td> <td>Do not cache specified stages</td> </tr> <tr> <td>
<a href="#output"><code class="language-plaintext highlighter-rouge">--output</code></a> , <a href="#output"><code class="language-plaintext highlighter-rouge">-o</code></a>
</td> <td></td> <td>Output destination (format: <code class="language-plaintext highlighter-rouge">type=local,dest=path</code>)</td> </tr> <tr> <td><a href="#platform"><code class="language-plaintext highlighter-rouge">--platform</code></a></td> <td></td> <td>Set target platform for build</td> </tr> <tr> <td><a href="#progress"><code class="language-plaintext highlighter-rouge">--progress</code></a></td> <td><code class="language-plaintext highlighter-rouge">auto</code></td> <td>Set type of progress output (<code class="language-plaintext highlighter-rouge">auto</code>, <code class="language-plaintext highlighter-rouge">plain</code>, <code class="language-plaintext highlighter-rouge">tty</code>). Use plain to show container output</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--pull</code></td> <td></td> <td>Always attempt to pull all referenced images</td> </tr> <tr> <td><a href="#push"><code class="language-plaintext highlighter-rouge">--push</code></a></td> <td></td> <td>Shorthand for <code class="language-plaintext highlighter-rouge">--output=type=registry</code>
</td> </tr> <tr> <td>
<code class="language-plaintext highlighter-rouge">--quiet</code> , <code class="language-plaintext highlighter-rouge">-q</code>
</td> <td></td> <td>Suppress the build output and print image ID on success</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--rm</code></td> <td><code class="language-plaintext highlighter-rouge">true</code></td> <td>Remove intermediate containers after a successful build</td> </tr> <tr> <td><a href="#secret"><code class="language-plaintext highlighter-rouge">--secret</code></a></td> <td></td> <td>Secret to expose to the build (format: <code class="language-plaintext highlighter-rouge">id=mysecret[,src=/local/secret]</code>)</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--security-opt</code></td> <td></td> <td>Security options</td> </tr> <tr> <td><a href="#shm-size"><code class="language-plaintext highlighter-rouge">--shm-size</code></a></td> <td></td> <td>Size of <code class="language-plaintext highlighter-rouge">/dev/shm</code>
</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">--squash</code></td> <td></td> <td>Squash newly built layers into a single new layer</td> </tr> <tr> <td><a href="#ssh"><code class="language-plaintext highlighter-rouge">--ssh</code></a></td> <td></td> <td>SSH agent socket or keys to expose to the build (format: <code class="language-plaintext highlighter-rouge">default|&amp;lt;id&amp;gt;[=&amp;lt;socket&amp;gt;|&amp;lt;key&amp;gt;[,&amp;lt;key&amp;gt;]]</code>)</td> </tr> <tr> <td>
<a href="../build/index#tag-an-image--t"><code class="language-plaintext highlighter-rouge">--tag</code></a> , <a href="../build/index#tag-an-image--t"><code class="language-plaintext highlighter-rouge">-t</code></a>
</td> <td></td> <td>Name and optionally a tag (format: <code class="language-plaintext highlighter-rouge">name:tag</code>)</td> </tr> <tr> <td><a href="../build/index#specifying-target-build-stage---target"><code class="language-plaintext highlighter-rouge">--target</code></a></td> <td></td> <td>Set the target build stage to build</td> </tr> <tr> <td><a href="#ulimit"><code class="language-plaintext highlighter-rouge">--ulimit</code></a></td> <td></td> <td>Ulimit options</td> </tr> <tr> <td><a href="#builder"><code class="language-plaintext highlighter-rouge">--builder</code></a></td> <td></td> <td>Override the configured builder instance</td> </tr>  </tbody> </table>  <h2 id="examples">Examples</h2> <h3 id="allow">Allow extra privileged entitlement (--allow)</h3> <div class="highlight"><pre class="highlight" data-language="">--allow=ENTITLEMENT
</pre></div> <p>Allow extra privileged entitlement. List of entitlements:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">network.host</code> - Allows executions with host networking.</li> <li>
<code class="language-plaintext highlighter-rouge">security.insecure</code> - Allows executions without sandbox. See <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/experimental/#run---securityinsecuresandbox">related Dockerfile extensions</a>.</li> </ul> <p>For entitlements to be enabled, the <code class="language-plaintext highlighter-rouge">buildkitd</code> daemon also needs to allow them with <code class="language-plaintext highlighter-rouge">--allow-insecure-entitlement</code> (see <a href="../buildx_create/index#buildkitd-flags"><code class="language-plaintext highlighter-rouge">create --buildkitd-flags</code></a>)</p> <p><strong>Examples</strong></p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx create --use --name insecure-builder --buildkitd-flags '--allow-insecure-entitlement security.insecure'
$ docker buildx build --allow security.insecure .
</pre></div> <h3 id="build-arg">Set build-time variables (--build-arg)</h3> <p>Same as <a href="../build/index#set-build-time-variables---build-arg"><code class="language-plaintext highlighter-rouge">docker build</code> command</a>.</p> <p>There are also useful built-in build args like:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">BUILDKIT_CONTEXT_KEEP_GIT_DIR=&lt;bool&gt;</code> trigger git context to keep the <code class="language-plaintext highlighter-rouge">.git</code> directory</li> <li>
<code class="language-plaintext highlighter-rouge">BUILDKIT_INLINE_BUILDINFO_ATTRS=&lt;bool&gt;</code> inline build info attributes in image config or not</li> <li>
<code class="language-plaintext highlighter-rouge">BUILDKIT_INLINE_CACHE=&lt;bool&gt;</code> inline cache metadata to image config or not</li> <li>
<code class="language-plaintext highlighter-rouge">BUILDKIT_MULTI_PLATFORM=&lt;bool&gt;</code> opt into determnistic output regardless of multi-platform output or not</li> </ul> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --build-arg BUILDKIT_MULTI_PLATFORM=1 .
</pre></div> <p>More built-in build args can be found in <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax/#built-in-build-args">dockerfile frontend docs</a>.</p> <h3 id="build-context">Additional build contexts (--build-context)</h3> <div class="highlight"><pre class="highlight" data-language="">--build-context=name=VALUE
</pre></div> <p>Define additional build context with specified contents. In Dockerfile the context can be accessed when <code class="language-plaintext highlighter-rouge">FROM name</code> or <code class="language-plaintext highlighter-rouge">--from=name</code> is used. When Dockerfile defines a stage with the same name it is overwritten.</p> <p>The value can be a local source directory, container image (with docker-image:// prefix), Git or HTTP URL.</p> <p>Replace <code class="language-plaintext highlighter-rouge">alpine:latest</code> with a pinned one:</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --build-context alpine=docker-image://alpine@sha256:0123456789 .
</pre></div> <p>Expose a secondary local source directory:</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --build-context project=path/to/project/source .
# docker buildx build --build-context project=https://github.com/myuser/project.git .
</pre></div> <div class="highlight"><pre class="highlight" data-language="">FROM alpine
COPY --from=project myfile /
</pre></div> <h3 id="builder">Override the configured builder instance (--builder)</h3> <p>Same as <a href="../buildx/index#builder"><code class="language-plaintext highlighter-rouge">buildx --builder</code></a>.</p> <h3 id="cache-from">Use an external cache source for a build (--cache-from)</h3> <div class="highlight"><pre class="highlight" data-language="">--cache-from=[NAME|type=TYPE[,KEY=VALUE]]
</pre></div> <p>Use an external cache source for a build. Supported types are <code class="language-plaintext highlighter-rouge">registry</code>, <code class="language-plaintext highlighter-rouge">local</code> and <code class="language-plaintext highlighter-rouge">gha</code>.</p> <ul> <li>
<a href="https://github.com/moby/buildkit#registry-push-image-and-cache-separately"><code class="language-plaintext highlighter-rouge">registry</code> source</a> can import cache from a cache manifest or (special) image configuration on the registry.</li> <li>
<a href="https://github.com/moby/buildkit#local-directory-1"><code class="language-plaintext highlighter-rouge">local</code> source</a> can import cache from local files previously exported with <code class="language-plaintext highlighter-rouge">--cache-to</code>.</li> <li>
<a href="https://github.com/moby/buildkit#github-actions-cache-experimental"><code class="language-plaintext highlighter-rouge">gha</code> source</a> can import cache from a previously exported cache with <code class="language-plaintext highlighter-rouge">--cache-to</code> in your GitHub repository</li> </ul> <p>If no type is specified, <code class="language-plaintext highlighter-rouge">registry</code> exporter is used with a specified reference.</p> <p><code class="language-plaintext highlighter-rouge">docker</code> driver currently only supports importing build cache from the registry.</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --cache-from=user/app:cache .
$ docker buildx build --cache-from=user/app .
$ docker buildx build --cache-from=type=registry,ref=user/app .
$ docker buildx build --cache-from=type=local,src=path/to/cache .
$ docker buildx build --cache-from=type=gha .
</pre></div> <p>More info about cache exporters and available attributes: https://github.com/moby/buildkit#export-cache</p> <h3 id="cache-to">Export build cache to an external cache destination (--cache-to)</h3> <div class="highlight"><pre class="highlight" data-language="">--cache-to=[NAME|type=TYPE[,KEY=VALUE]]
</pre></div> <p>Export build cache to an external cache destination. Supported types are <code class="language-plaintext highlighter-rouge">registry</code>, <code class="language-plaintext highlighter-rouge">local</code>, <code class="language-plaintext highlighter-rouge">inline</code> and <code class="language-plaintext highlighter-rouge">gha</code>.</p> <ul> <li>
<a href="https://github.com/moby/buildkit#registry-push-image-and-cache-separately"><code class="language-plaintext highlighter-rouge">registry</code> type</a> exports build cache to a cache manifest in the registry.</li> <li>
<a href="https://github.com/moby/buildkit#local-directory-1"><code class="language-plaintext highlighter-rouge">local</code> type</a> type exports cache to a local directory on the client.</li> <li>
<a href="https://github.com/moby/buildkit#inline-push-image-and-cache-together"><code class="language-plaintext highlighter-rouge">inline</code> type</a> type writes the cache metadata into the image configuration.</li> <li>
<a href="https://github.com/moby/buildkit#github-actions-cache-experimental"><code class="language-plaintext highlighter-rouge">gha</code> type</a> type exports cache through the <a href="https://github.com/tonistiigi/go-actions-cache/blob/master/api/#authentication">Github Actions Cache service API</a>.</li> </ul> <p><code class="language-plaintext highlighter-rouge">docker</code> driver currently only supports exporting inline cache metadata to image configuration. Alternatively, <code class="language-plaintext highlighter-rouge">--build-arg BUILDKIT_INLINE_CACHE=1</code> can be used to trigger inline cache exporter.</p> <p>Attribute key:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">mode</code> - Specifies how many layers are exported with the cache. <code class="language-plaintext highlighter-rouge">min</code> on only exports layers already in the final build stage, <code class="language-plaintext highlighter-rouge">max</code> exports layers for all stages. Metadata is always exported for the whole build.</li> </ul> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --cache-to=user/app:cache .
$ docker buildx build --cache-to=type=inline .
$ docker buildx build --cache-to=type=registry,ref=user/app .
$ docker buildx build --cache-to=type=local,dest=path/to/cache .
$ docker buildx build --cache-to=type=gha .
</pre></div> <p>More info about cache exporters and available attributes: https://github.com/moby/buildkit#export-cache</p> <h3 id="load">Load the single-platform build result to <code class="language-plaintext highlighter-rouge">docker images</code> (--load)</h3> <p>Shorthand for <a href="#docker"><code class="language-plaintext highlighter-rouge">--output=type=docker</code></a>. Will automatically load the single-platform build result to <code class="language-plaintext highlighter-rouge">docker images</code>.</p> <h3 id="metadata-file">Write build result metadata to the file (--metadata-file)</h3> <p>To output build metadata such as the image digest, pass the <code class="language-plaintext highlighter-rouge">--metadata-file</code> flag. The metadata will be written as a JSON object to the specified file. The directory of the specified file must already exist and be writable.</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --load --metadata-file metadata.json .
$ cat metadata.json
</pre></div> <div class="highlight"><pre class="highlight" data-language="">{
  "containerimage.buildinfo": {
    "frontend": "dockerfile.v0",
    "attrs": {
      "context": "https://github.com/crazy-max/buildkit-buildsources-test.git#master",
      "filename": "Dockerfile",
      "source": "docker/dockerfile:master"
    },
    "sources": [
      {
        "type": "docker-image",
        "ref": "docker.io/docker/buildx-bin:0.6.1@sha256:a652ced4a4141977c7daaed0a074dcd9844a78d7d2615465b12f433ae6dd29f0",
        "pin": "sha256:a652ced4a4141977c7daaed0a074dcd9844a78d7d2615465b12f433ae6dd29f0"
      },
      {
        "type": "docker-image",
        "ref": "docker.io/library/alpine:3.13",
        "pin": "sha256:026f721af4cf2843e07bba648e158fb35ecc876d822130633cc49f707f0fc88c"
      }
    ]
  },
  "containerimage.config.digest": "sha256:2937f66a9722f7f4a2df583de2f8cb97fc9196059a410e7f00072fc918930e66",
  "containerimage.descriptor": {
    "annotations": {
      "config.digest": "sha256:2937f66a9722f7f4a2df583de2f8cb97fc9196059a410e7f00072fc918930e66",
      "org.opencontainers.image.created": "2022-02-08T21:28:03Z"
    },
    "digest": "sha256:19ffeab6f8bc9293ac2c3fdf94ebe28396254c993aea0b5a542cfb02e0883fa3",
    "mediaType": "application/vnd.oci.image.manifest.v1+json",
    "size": 506
  },
  "containerimage.digest": "sha256:19ffeab6f8bc9293ac2c3fdf94ebe28396254c993aea0b5a542cfb02e0883fa3"
}
</pre></div> <h3 id="output">Set the export action for the build result (-o, --output)</h3> <div class="highlight"><pre class="highlight" data-language="">-o, --output=[PATH,-,type=TYPE[,KEY=VALUE]
</pre></div> <p>Sets the export action for the build result. In <code class="language-plaintext highlighter-rouge">docker build</code> all builds finish by creating a container image and exporting it to <code class="language-plaintext highlighter-rouge">docker images</code>. <code class="language-plaintext highlighter-rouge">buildx</code> makes this step configurable allowing results to be exported directly to the client, oci image tarballs, registry etc.</p> <p>Buildx with <code class="language-plaintext highlighter-rouge">docker</code> driver currently only supports local, tarball exporter and image exporter. <code class="language-plaintext highlighter-rouge">docker-container</code> driver supports all the exporters.</p> <p>If just the path is specified as a value, <code class="language-plaintext highlighter-rouge">buildx</code> will use the local exporter with this path as the destination. If the value is “-“, <code class="language-plaintext highlighter-rouge">buildx</code> will use <code class="language-plaintext highlighter-rouge">tar</code> exporter and write to <code class="language-plaintext highlighter-rouge">stdout</code>.</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build -o . .
$ docker buildx build -o outdir .
$ docker buildx build -o - - &gt; out.tar
$ docker buildx build -o type=docker .
$ docker buildx build -o type=docker,dest=- . &gt; myimage.tar
$ docker buildx build -t tonistiigi/foo -o type=registry
</pre></div> <p>Supported exported types are:</p> <h4 id="local"><code class="language-plaintext highlighter-rouge">local</code></h4> <p>The <code class="language-plaintext highlighter-rouge">local</code> export type writes all result files to a directory on the client. The new files will be owned by the current user. On multi-platform builds, all results will be put in subdirectories by their platform.</p> <p>Attribute key:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">dest</code> - destination directory where files will be written</li> </ul> <h4 id="tar"><code class="language-plaintext highlighter-rouge">tar</code></h4> <p>The <code class="language-plaintext highlighter-rouge">tar</code> export type writes all result files as a single tarball on the client. On multi-platform builds all results will be put in subdirectories by their platform.</p> <p>Attribute key:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">dest</code> - destination path where tarball will be written. “-” writes to stdout.</li> </ul> <h4 id="oci"><code class="language-plaintext highlighter-rouge">oci</code></h4> <p>The <code class="language-plaintext highlighter-rouge">oci</code> export type writes the result image or manifest list as an <a href="https://github.com/opencontainers/image-spec/blob/v1.0.1/image-layout/">OCI image layout</a> tarball on the client.</p> <p>Attribute key:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">dest</code> - destination path where tarball will be written. “-” writes to stdout.</li> </ul> <h4 id="docker"><code class="language-plaintext highlighter-rouge">docker</code></h4> <p>The <code class="language-plaintext highlighter-rouge">docker</code> export type writes the single-platform result image as a <a href="https://github.com/docker/docker/blob/v20.10.2/image/spec/v1.2/">Docker image specification</a> tarball on the client. Tarballs created by this exporter are also OCI compatible.</p> <p>Currently, multi-platform images cannot be exported with the <code class="language-plaintext highlighter-rouge">docker</code> export type. The most common usecase for multi-platform images is to directly push to a registry (see <a href="#registry"><code class="language-plaintext highlighter-rouge">registry</code></a>).</p> <p>Attribute keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">dest</code> - destination path where tarball will be written. If not specified the tar will be loaded automatically to the current docker instance.</li> <li>
<code class="language-plaintext highlighter-rouge">context</code> - name for the docker context where to import the result</li> </ul> <h4 id="image"><code class="language-plaintext highlighter-rouge">image</code></h4> <p>The <code class="language-plaintext highlighter-rouge">image</code> exporter writes the build result as an image or a manifest list. When using <code class="language-plaintext highlighter-rouge">docker</code> driver the image will appear in <code class="language-plaintext highlighter-rouge">docker images</code>. Optionally, image can be automatically pushed to a registry by specifying attributes.</p> <p>Attribute keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">name</code> - name (references) for the new image.</li> <li>
<code class="language-plaintext highlighter-rouge">push</code> - boolean to automatically push the image.</li> </ul> <h4 id="registry"><code class="language-plaintext highlighter-rouge">registry</code></h4> <p>The <code class="language-plaintext highlighter-rouge">registry</code> exporter is a shortcut for <code class="language-plaintext highlighter-rouge">type=image,push=true</code>.</p> <h3 id="platform">Set the target platforms for the build (--platform)</h3> <div class="highlight"><pre class="highlight" data-language="">--platform=value[,value]
</pre></div> <p>Set the target platform for the build. All <code class="language-plaintext highlighter-rouge">FROM</code> commands inside the Dockerfile without their own <code class="language-plaintext highlighter-rouge">--platform</code> flag will pull base images for this platform and this value will also be the platform of the resulting image. The default value will be the current platform of the buildkit daemon.</p> <p>When using <code class="language-plaintext highlighter-rouge">docker-container</code> driver with <code class="language-plaintext highlighter-rouge">buildx</code>, this flag can accept multiple values as an input separated by a comma. With multiple values the result will be built for all of the specified platforms and joined together into a single manifest list.</p> <p>If the <code class="language-plaintext highlighter-rouge">Dockerfile</code> needs to invoke the <code class="language-plaintext highlighter-rouge">RUN</code> command, the builder needs runtime support for the specified platform. In a clean setup, you can only execute <code class="language-plaintext highlighter-rouge">RUN</code> commands for your system architecture. If your kernel supports <a href="https://en.wikipedia.org/wiki/Binfmt_misc"><code class="language-plaintext highlighter-rouge">binfmt_misc</code></a> launchers for secondary architectures, buildx will pick them up automatically. Docker desktop releases come with <code class="language-plaintext highlighter-rouge">binfmt_misc</code> automatically configured for <code class="language-plaintext highlighter-rouge">arm64</code> and <code class="language-plaintext highlighter-rouge">arm</code> architectures. You can see what runtime platforms your current builder instance supports by running <code class="language-plaintext highlighter-rouge">docker buildx inspect --bootstrap</code>.</p> <p>Inside a <code class="language-plaintext highlighter-rouge">Dockerfile</code>, you can access the current platform value through <code class="language-plaintext highlighter-rouge">TARGETPLATFORM</code> build argument. Please refer to the <a href="../../builder/index#automatic-platform-args-in-the-global-scope"><code class="language-plaintext highlighter-rouge">docker build</code> documentation</a> for the full description of automatic platform argument variants .</p> <p>The formatting for the platform specifier is defined in the <a href="https://github.com/containerd/containerd/blob/v1.4.3/platforms/platforms.go#L63">containerd source code</a>.</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --platform=linux/arm64 .
$ docker buildx build --platform=linux/amd64,linux/arm64,linux/arm/v7 .
$ docker buildx build --platform=darwin .
</pre></div> <h3 id="progress">Set type of progress output (--progress)</h3> <div class="highlight"><pre class="highlight" data-language="">--progress=VALUE
</pre></div> <p>Set type of progress output (auto, plain, tty). Use plain to show container output (default “auto”).</p> <blockquote> <p>You can also use the <code class="language-plaintext highlighter-rouge">BUILDKIT_PROGRESS</code> environment variable to set its value.</p> </blockquote> <p>The following example uses <code class="language-plaintext highlighter-rouge">plain</code> output during the build:</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --load --progress=plain .

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 227B 0.0s done
#1 DONE 0.1s

#2 [internal] load .dockerignore
#2 transferring context: 129B 0.0s done
#2 DONE 0.0s
...
</pre></div> <h3 id="push">Push the build result to a registry (--push)</h3> <p>Shorthand for <a href="#registry"><code class="language-plaintext highlighter-rouge">--output=type=registry</code></a>. Will automatically push the build result to registry.</p> <h3 id="secret">Secret to expose to the build (--secret)</h3> <div class="highlight"><pre class="highlight" data-language="">--secret=[type=TYPE[,KEY=VALUE]
</pre></div> <p>Exposes secret to the build. The secret can be used by the build using <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax/#run---mounttypesecret"><code class="language-plaintext highlighter-rouge">RUN --mount=type=secret</code> mount</a>.</p> <p>If <code class="language-plaintext highlighter-rouge">type</code> is unset it will be detected. Supported types are:</p> <h4 id="file"><code class="language-plaintext highlighter-rouge">file</code></h4> <p>Attribute keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">id</code> - ID of the secret. Defaults to basename of the <code class="language-plaintext highlighter-rouge">src</code> path.</li> <li>
<code class="language-plaintext highlighter-rouge">src</code>, <code class="language-plaintext highlighter-rouge">source</code> - Secret filename. <code class="language-plaintext highlighter-rouge">id</code> used if unset.</li> </ul> <div class="highlight"><pre class="highlight" data-language=""># syntax=docker/dockerfile:1.3
FROM python:3
RUN pip install awscli
RUN --mount=type=secret,id=aws,target=/root/.aws/credentials \
  aws s3 cp s3://... ...
</pre></div> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --secret id=aws,src=$HOME/.aws/credentials .
</pre></div> <h4 id="env"><code class="language-plaintext highlighter-rouge">env</code></h4> <p>Attribute keys:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">id</code> - ID of the secret. Defaults to <code class="language-plaintext highlighter-rouge">env</code> name.</li> <li>
<code class="language-plaintext highlighter-rouge">env</code> - Secret environment variable. <code class="language-plaintext highlighter-rouge">id</code> used if unset, otherwise will look for <code class="language-plaintext highlighter-rouge">src</code>, <code class="language-plaintext highlighter-rouge">source</code> if <code class="language-plaintext highlighter-rouge">id</code> unset.</li> </ul> <div class="highlight"><pre class="highlight" data-language=""># syntax=docker/dockerfile:1.3
FROM node:alpine
RUN --mount=type=bind,target=. \
  --mount=type=secret,id=SECRET_TOKEN \
  SECRET_TOKEN=$(cat /run/secrets/SECRET_TOKEN) yarn run test
</pre></div> <div class="highlight"><pre class="highlight" data-language="">$ SECRET_TOKEN=token docker buildx build --secret id=SECRET_TOKEN .
</pre></div> <h3 id="shm-size">Size of /dev/shm (--shm-size)</h3> <p>The format is <code class="language-plaintext highlighter-rouge">&lt;number&gt;&lt;unit&gt;</code>. <code class="language-plaintext highlighter-rouge">number</code> must be greater than <code class="language-plaintext highlighter-rouge">0</code>. Unit is optional and can be <code class="language-plaintext highlighter-rouge">b</code> (bytes), <code class="language-plaintext highlighter-rouge">k</code> (kilobytes), <code class="language-plaintext highlighter-rouge">m</code> (megabytes), or <code class="language-plaintext highlighter-rouge">g</code> (gigabytes). If you omit the unit, the system uses bytes.</p> <h3 id="ssh">SSH agent socket or keys to expose to the build (--ssh)</h3> <div class="highlight"><pre class="highlight" data-language="">--ssh=default|&lt;id&gt;[=&lt;socket&gt;|&lt;key&gt;[,&lt;key&gt;]]
</pre></div> <p>This can be useful when some commands in your Dockerfile need specific SSH authentication (e.g., cloning a private repository).</p> <p><code class="language-plaintext highlighter-rouge">--ssh</code> exposes SSH agent socket or keys to the build and can be used with the <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax/#run---mounttypessh"><code class="language-plaintext highlighter-rouge">RUN --mount=type=ssh</code> mount</a>.</p> <p>Example to access Gitlab using an SSH agent socket:</p> <div class="highlight"><pre class="highlight" data-language=""># syntax=docker/dockerfile:1.3
FROM alpine
RUN apk add --no-cache openssh-client
RUN mkdir -p -m 0700 ~/.ssh &amp;&amp; ssh-keyscan gitlab.com &gt;&gt; ~/.ssh/known_hosts
RUN --mount=type=ssh ssh -q -T git@gitlab.com 2&gt;&amp;1 | tee /hello
# "Welcome to GitLab, @GITLAB_USERNAME_ASSOCIATED_WITH_SSHKEY" should be printed here
# with the type of build progress is defined as `plain`.
</pre></div> <div class="highlight"><pre class="highlight" data-language="">$ eval $(ssh-agent)
$ ssh-add ~/.ssh/id_rsa
(Input your passphrase here)
$ docker buildx build --ssh default=$SSH_AUTH_SOCK .
</pre></div> <h3 id="ulimit">Set ulimits (--ulimit)</h3> <p><code class="language-plaintext highlighter-rouge">--ulimit</code> is specified with a soft and hard limit as such: <code class="language-plaintext highlighter-rouge">&lt;type&gt;=&lt;soft limit&gt;[:&lt;hard limit&gt;]</code>, for example:</p> <div class="highlight"><pre class="highlight" data-language="">$ docker buildx build --ulimit nofile=1024:1024 .
</pre></div> <blockquote> <p><strong>Note</strong></p> <p>If you do not provide a <code class="language-plaintext highlighter-rouge">hard limit</code>, the <code class="language-plaintext highlighter-rouge">soft limit</code> is used for both values. If no <code class="language-plaintext highlighter-rouge">ulimits</code> are set, they are inherited from the default <code class="language-plaintext highlighter-rouge">ulimits</code> set on the daemon.</p> </blockquote> <h2 id="parent-command">Parent command</h2> <table> <thead> <tr> <th style="text-align: left">Command</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><a href="../buildx/index">docker buildx</a></td> <td style="text-align: left">Docker Buildx</td> </tr> </tbody> </table> <h2 id="related-commands">Related commands</h2> <table> <thead> <tr> <td>Command</td> <td>Description</td> </tr> </thead> <tbody> <tr> <td><a href="../buildx_bake/index">docker buildx bake</a></td> <td>Build from a file</td> </tr> <tr> <td><a href="index">docker buildx build</a></td> <td>Start a build</td> </tr> <tr> <td><a href="../buildx_create/index">docker buildx create</a></td> <td>Create a new builder instance</td> </tr> <tr> <td><a href="../buildx_du/index">docker buildx du</a></td> <td>Disk usage</td> </tr> <tr> <td><a href="../buildx_imagetools/index">docker buildx imagetools</a></td> <td>Commands to work on images in registry</td> </tr> <tr> <td><a href="../buildx_inspect/index">docker buildx inspect</a></td> <td>Inspect current builder instance</td> </tr> <tr> <td><a href="../buildx_ls/index">docker buildx ls</a></td> <td>List builder instances</td> </tr> <tr> <td><a href="../buildx_prune/index">docker buildx prune</a></td> <td>Remove build cache</td> </tr> <tr> <td><a href="../buildx_rm/index">docker buildx rm</a></td> <td>Remove a builder instance</td> </tr> <tr> <td><a href="../buildx_stop/index">docker buildx stop</a></td> <td>Stop builder instance</td> </tr> <tr> <td><a href="../buildx_use/index">docker buildx use</a></td> <td>Set the current builder instance</td> </tr> <tr> <td><a href="../buildx_version/index">docker buildx version</a></td> <td>Show buildx version information</td> </tr> </tbody> </table> <div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.docker.com/engine/reference/commandline/buildx_build/" class="_attribution-link" target="_blank">https://docs.docker.com/engine/reference/commandline/buildx_build/</a>
  </p>
</div>
