<h1> mix xref   </h1> <section id="moduledoc"> <p>Prints cross reference information between modules.</p>
<p>This task is automatically reenabled, so you can print information multiple times in the same Mix invocation.</p>
<h2 id="module-xref-modes" class="section-heading">  Xref modes </h2> <p>The <code class="inline">xref</code> task expects a mode as first argument:</p>
<pre data-language="elixir">mix xref MODE</pre>
<p>All available modes are discussed below.</p>
<h3 id="module-callers-callee" class="section-heading">  callers CALLEE </h3> <p>Prints all callers of the given <code class="inline">MODULE</code>. Example:</p>
<pre data-language="elixir">mix xref callers MyMod</pre>
<h3 id="module-graph" class="section-heading">  graph </h3> <p>Prints a file dependency graph where an edge from <code class="inline">A</code> to <code class="inline">B</code> indicates that <code class="inline">A</code> (source) depends on <code class="inline">B</code> (sink).</p>
<pre data-language="elixir">mix xref graph --format stats</pre>
<p>The following options are accepted:</p>
<ul>
<li><p><code class="inline">--exclude</code> - paths to exclude</p></li>
<li><p><code class="inline">--label</code> - only shows relationships with the given label. By default, it keeps all labels that are transitive. The labels are "compile", "export" and "runtime". See "Dependencies types" section below</p></li>
<li><p><code class="inline">--only-nodes</code> - only shows the node names (no edges). Generally useful with the <code class="inline">--sink</code> flag</p></li>
<li><p><code class="inline">--only-direct</code> - the <code class="inline">--label</code> option will restrict itself to only direct dependencies instead of transitive ones</p></li>
<li><p><code class="inline">--source</code> - displays all files that the given source file references (directly or indirectly)</p></li>
<li><p><code class="inline">--sink</code> - displays all files that reference the given file (directly or indirectly)</p></li>
<li><p><code class="inline">--min-cycle-size</code> - controls the minimum cycle size on formats like <code class="inline">stats</code> and <code class="inline">cycles</code></p></li>
<li>
<p><code class="inline">--format</code> - can be set to one of:</p>
<ul>
<li>
<code class="inline">pretty</code> - prints the graph to the terminal using Unicode characters. Each prints each file followed by the files it depends on. This is the default except on Windows;</li>
<li>
<code class="inline">plain</code> - the same as pretty except ASCII characters are used instead of Unicode characters. This is the default on Windows;</li>
<li>
<code class="inline">stats</code> - prints general statistics about the graph;</li>
<li>
<code class="inline">cycles</code> - prints all cycles in the graph;</li>
<li>
<code class="inline">dot</code> - produces a DOT graph description in <code class="inline">xref_graph.dot</code> in the current directory. Warning: this will override any previously generated file</li>
</ul>
</li>
</ul>
<p>The <code class="inline">--source</code> and <code class="inline">--sink</code> options are particularly useful when trying to understand how the modules in a particular file interact with the whole system. You can combine those options with <code class="inline">--label</code> and <code class="inline">--only-nodes</code> to get all files that exhibit a certain property, for example:</p>
<pre data-language="elixir"># To get all files and their direct compile time dependencies
mix xref graph --label compile --only-direct

# To get the tree that depend on lib/foo.ex at compile time
mix xref graph --label compile --sink lib/foo.ex

# To get all files that depend on lib/foo.ex at compile time
mix xref graph --label compile --sink lib/foo.ex --only-nodes

# To get all paths between two files
mix xref graph --source lib/foo.ex --sink lib/bar.ex

# To show general statistics about the graph
mix xref graph --format stats

# To limit statistics only to certain labels
mix xref graph --format stats --label compile</pre>
<h4>Understanding the printed graph</h4>
<p>When <code class="inline">mix xref graph</code> runs, it will print a tree of the following format:</p>
<pre data-language="elixir">lib/a.ex
`-- lib/b.ex (compile)
    `-- lib/c.ex</pre>
<p>This tree means that <code class="inline">lib/a.ex</code> depends on <code class="inline">lib/b.ex</code> at compile time which then depends on <code class="inline">lib/c.ex</code> at runtime. This is often problematic because if <code class="inline">lib/c.ex</code> changes, <code class="inline">lib/a.ex</code> also has to recompile due to this indirect compile time dependency.</p>
<p>The flags <code class="inline">--source</code> or <code class="inline">--sink</code> does not change how you read the graph. For example, if we use the <code class="inline">--sink lib/c.ex</code> flag, we would see the same tree:</p>
<pre data-language="elixir">lib/a.ex
`-- lib/b.ex (compile)
    `-- lib/c.ex</pre>
<p>If the <code class="inline">--label compile</code> flag is given with <code class="inline">--sink</code>, then <code class="inline">lib/c.ex</code> won't be shown, because no module has a compile time dependency on <code class="inline">lib/c.ex</code> but <code class="inline">lib/a.ex</code> still has an indirect compile time dependency on <code class="inline">lib/c.ex</code> via <code class="inline">lib/b.ex</code>:</p>
<pre data-language="elixir">lib/a.ex
`-- lib/b.ex (compile)</pre>
<p>Therefore, using a combination of <code class="inline">--sink</code> with <code class="inline">--label</code> is useful to find all files that will change once the sink changes, alongside the transitive dependencies that will cause said recompilations.</p>
<h4>Dependencies types</h4>
<p>Elixir tracks three types of dependencies between modules: compile, exports, and runtime. If a module has a compile time dependency on another module, the caller module has to be recompiled whenever the callee changes. Compile-time dependencies are typically added when using macros or when invoking functions in the module body (outside of functions).</p>
<p>Exports dependencies are compile time dependencies on the module API, namely structs and its public definitions. For example, if you import a module but only use its functions, it is an export dependency. If you use a struct, it is an export dependency too. Export dependencies are only recompiled if the module API changes. Note, however, that compile time dependencies have higher precedence than exports. Therefore if you import a module and use its macros, it is a compile time dependency.</p>
<p>Runtime dependencies are added whenever you invoke another module inside a function. Modules with runtime dependencies do not have to be compiled when the callee changes, unless there is a transitive compile or export time dependency between them.</p>
<h2 id="module-shared-options" class="section-heading">  Shared options </h2> <p>Those options are shared across all modes:</p>
<ul>
<li><p><code class="inline">--include-siblings</code> - includes dependencies that have <code class="inline">:in_umbrella</code> set to true in the current project in the reports. This can be used to find callers or to analyze graphs between projects</p></li>
<li><p><code class="inline">--no-compile</code> - does not compile even if files require compilation</p></li>
<li><p><code class="inline">--no-deps-check</code> - does not check dependencies</p></li>
<li><p><code class="inline">--no-archives-check</code> - does not check archives</p></li>
<li><p><code class="inline">--no-elixir-version-check</code> - does not check the Elixir version from mix.exs</p></li>
</ul> </section> <section id="summary" class="details-list"> <h1 class="section-heading">  Summary </h1> <h2> Functions </h2>
<dl class="summary-functions summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#calls/1">calls(opts \\ [])</a> <span class="deprecated" title="Use compilation tracers described in the Code module">deprecated</span> </dt> <dd class="summary-synopsis"><p>Returns a list of information of all the runtime function calls in the project.</p></dd> </div> </dl> </section> <section id="functions" class="details-list"> <h1 class="section-heading">  Functions </h1> <div class="functions-list"> <section class="detail">  <h3 class="detail-header" id="calls/1">calls(opts \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.12.0/lib/mix/lib/mix/tasks/xref.ex#L247" class="source">Source</a>
</h3> <div class="deprecated"> This function is deprecated. Use compilation tracers described in the Code module. </div> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">calls(keyword()) :: [
  %{callee: {module(), atom(), arity()}, line: integer(), file: String.t()}
]</pre> </div> <p>Returns a list of information of all the runtime function calls in the project.</p>
<p>Each item in the list is a map with the following keys:</p>
<ul>
<li>
<code class="inline">:callee</code> - a tuple containing the module, function, and arity of the call</li>
<li>
<code class="inline">:line</code> - an integer representing the line where the function is called</li>
<li>
<code class="inline">:file</code> - a binary representing the file where the function is called</li>
<li>
<code class="inline">:caller_module</code> - the module where the function is called</li>
</ul>
<p>This function returns an empty list when used at the root of an umbrella project because there is no compile manifest to extract the function call information from. To get the function calls of each child in an umbrella, execute the function at the root of each individual application.</p> </section> </section> </div> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://hexdocs.pm/mix/1.12.0/Mix.Tasks.Xref.html" class="_attribution-link" target="_blank">https://hexdocs.pm/mix/1.12.0/Mix.Tasks.Xref.html</a>
  </p>
</div>
