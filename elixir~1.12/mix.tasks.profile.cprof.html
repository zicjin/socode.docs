<h1> mix profile.cprof   </h1> <section id="moduledoc"> <p>Profiles the given file or expression using Erlang's <code class="inline">cprof</code> tool.</p>
<p><code class="inline">cprof</code> can be useful when you want to discover the bottlenecks related to function calls.</p>
<p>Before running the code, it invokes the <code class="inline">app.start</code> task which compiles and loads your project. After that, the target expression is profiled together with all matching function calls, by setting breakpoints containing counters. These can only be set on BEAM code so BIFs cannot be call count traced.</p>
<p>To profile the code, you can use syntax similar to the <a href="mix.tasks.run"><code class="inline">mix run</code></a> task:</p>
<pre data-language="elixir">mix profile.cprof -e Hello.world
mix profile.cprof -e "[1, 2, 3] |&gt; Enum.reverse |&gt; Enum.map(&amp;Integer.to_string/1)"
mix profile.cprof my_script.exs arg1 arg2 arg3</pre>
<p>This task is automatically reenabled, so you can profile multiple times in the same Mix invocation.</p>
<h2 id="module-command-line-options" class="section-heading">  Command line options </h2> <ul>
<li>
<code class="inline">--matching</code> - only profile calls matching the given <code class="inline">Module.function/arity</code> pattern</li>
<li>
<code class="inline">--limit</code> - filters out any results with a call count less than the limit</li>
<li>
<code class="inline">--module</code> - filters out any results not pertaining to the given module</li>
<li>
<code class="inline">--eval</code>, <code class="inline">-e</code> - evaluate the given code</li>
<li>
<code class="inline">--require</code>, <code class="inline">-r</code> - requires pattern before running the command</li>
<li>
<code class="inline">--parallel</code>, <code class="inline">-p</code> - makes all requires parallel</li>
<li>
<code class="inline">--no-compile</code> - does not compile even if files require compilation</li>
<li>
<code class="inline">--no-deps-check</code> - does not check dependencies</li>
<li>
<code class="inline">--no-archives-check</code> - does not check archives</li>
<li>
<code class="inline">--no-halt</code> - does not halt the system after running the command</li>
<li>
<code class="inline">--no-start</code> - does not start applications after compilation</li>
<li>
<code class="inline">--no-elixir-version-check</code> - does not check the Elixir version from mix.exs</li>
</ul>
<h2 id="module-profile-output" class="section-heading">  Profile output </h2> <p>Example output:</p>
<pre data-language="elixir">                                                                     CNT
Total                                                                 15
Enum                                                                   6  &lt;--
  Enum."-map/2-lists^map/1-0-"/2                                       4
  Enum.reverse/1                                                       1
  Enum.map/2                                                           1
:elixir_compiler                                                       4  &lt;--
  anonymous fn/1 in :elixir_compiler.__FILE__/1                        3
  anonymous fn/0 in :elixir_compiler.__FILE__/1                        1
String.Chars.Integer                                                   3  &lt;--
  String.Chars.Integer.to_string/1                                     3
:erlang                                                                2  &lt;--
  :erlang.trace_pattern/3                                              2
Profile done over 20229 matching functions</pre>
<p>The default output contains data gathered from all matching functions. The left column structures each module and its total call count trace is presented on the right. Each module has its count discriminated by function below. The <code class="inline">&lt;--</code> symbol is meant to help visualize where a new module call count begins.</p>
<p>The first row (Total) is the sum of all function calls. In the last row the number of matching functions that were considered for profiling is presented.</p>
<p>When <code class="inline">--matching</code> option is specified, call count tracing will be started only for the functions matching the given pattern:</p>
<pre data-language="elixir">String.Chars.Integer                                                   3  &lt;--
  String.Chars.Integer.to_string/1                                     3
Profile done over 1 matching functions</pre>
<p>The pattern can be a module name, such as <a href="https://hexdocs.pm/elixir/1.12/String.html"><code class="inline">String</code></a> to count all calls to that module, a call without arity, such as <code class="inline">String.split</code>, to count all calls to that function regardless of arity, or a call with arity, such as <a href="https://hexdocs.pm/elixir/1.12/String.html#split/2"><code class="inline">String.split/2</code></a>, to count all calls to that exact module, function and arity.</p>
<h2 id="module-caveats" class="section-heading">  Caveats </h2> <p>You should be aware the profiler is stopped as soon as the code has finished running. This may need special attention, when: running asynchronous code as function calls which were called before the profiler stopped will not be counted; running synchronous code as long running computations and a profiler without a proper MFA trace pattern or filter may lead to a result set which is difficult to comprehend.</p>
<p>Other caveats are the impossibility to call count trace BIFs, since breakpoints can only be set on BEAM code; functions calls performed by <code class="inline">:cprof</code> are not traced; the maximum size of a call counter is equal to the host machine's word size (for example, 2147483647 in a 32-bit host).</p> </section> <section id="summary" class="details-list"> <h1 class="section-heading">  Summary </h1> <h2> Functions </h2>
<dl class="summary-functions summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#profile/2">profile(fun, opts \\ [])</a> </dt> <dd class="summary-synopsis"><p>Allows to programmatically run the <code class="inline">cprof</code> profiler on expression in <code class="inline">fun</code>.</p></dd> </div> </dl> </section> <section id="functions" class="details-list"> <h1 class="section-heading">  Functions </h1> <div class="functions-list"> <section class="detail">  <h3 class="detail-header" id="profile/2">profile(fun, opts \\ [])<a href="https://github.com/elixir-lang/elixir/blob/v1.12.0/lib/mix/lib/mix/tasks/profile.cprof.ex#L169" class="source">Source</a>
</h3> <section class="docstring"> <p>Allows to programmatically run the <code class="inline">cprof</code> profiler on expression in <code class="inline">fun</code>.</p>
<h4 id="profile/2-options" class="section-heading">  Options </h4> <ul>
<li>
<code class="inline">:matching</code> - only profile calls matching the given pattern in form of <code class="inline">{module, function, arity}</code>, where each element may be replaced by <code class="inline">:_</code> to allow any value</li>
<li>
<code class="inline">:limit</code> - filters out any results with a call count less than the limit</li>
<li>
<code class="inline">:module</code> - filters out any results not pertaining to the given module</li>
</ul> </section> </section> </div> </section><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://hexdocs.pm/mix/1.12.0/Mix.Tasks.Profile.Cprof.html" class="_attribution-link" target="_blank">https://hexdocs.pm/mix/1.12.0/Mix.Tasks.Profile.Cprof.html</a>
  </p>
</div>
