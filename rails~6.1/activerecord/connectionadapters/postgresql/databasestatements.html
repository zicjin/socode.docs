<h1 id="module-ActiveRecord::ConnectionAdapters::PostgreSQL::DatabaseStatements" class="module"> module ActiveRecord::ConnectionAdapters::PostgreSQL::DatabaseStatements </h1>  <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-begin_db_transaction"> <span class="method-name">begin_db_transaction</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="begin_db_transaction-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 108
def begin_db_transaction
  execute("BEGIN", "TRANSACTION")
end</pre> </div> <p>Begins a transaction.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-begin_isolated_db_transaction"> <span class="method-name">begin_isolated_db_transaction</span><span class="method-args">(isolation)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="begin_isolated_db_transaction-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 112
def begin_isolated_db_transaction(isolation)
  begin_db_transaction
  execute "SET TRANSACTION ISOLATION LEVEL #{transaction_isolation_levels.fetch(isolation)}"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-commit_db_transaction"> <span class="method-name">commit_db_transaction</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="commit_db_transaction-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 118
def commit_db_transaction
  execute("COMMIT", "TRANSACTION")
end</pre> </div> <p>Commits a transaction.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-exec_delete"> <span class="method-name">exec_delete</span><span class="method-args">(sql, name = nil, binds = [])</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="exec_delete-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 69
def exec_delete(sql, name = nil, binds = [])
  execute_and_clear(sql, name, binds) { |result| result.cmd_tuples }
end</pre> </div>  </div> <div class="aliases"> Also aliased as: <a href="databasestatements#method-i-exec_update">exec_update</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-exec_insert"> <span class="method-name">exec_insert</span><span class="method-args">(sql, name = nil, binds = [], pk = nil, sequence_name = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="exec_insert-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 89
def exec_insert(sql, name = nil, binds = [], pk = nil, sequence_name = nil)
  if use_insert_returning? || pk == false
    super
  else
    result = exec_query(sql, name, binds)
    unless sequence_name
      table_ref = extract_table_ref_from_insert_sql(sql)
      if table_ref
        pk = primary_key(table_ref) if pk.nil?
        pk = suppress_composite_primary_key(pk)
        sequence_name = default_sequence_name(table_ref, pk)
      end
      return result unless sequence_name
    end
    last_insert_id_result(sequence_name)
  end
end</pre> </div> <div class="method-calls-super"> Calls superclass method </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-exec_query"> <span class="method-name">exec_query</span><span class="method-args">(sql, name = "SQL", binds = [], prepare: false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="exec_query-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 52
def exec_query(sql, name = "SQL", binds = [], prepare: false)
  execute_and_clear(sql, name, binds, prepare: prepare) do |result|
    types = {}
    fields = result.fields
    fields.each_with_index do |fname, i|
      ftype = result.ftype i
      fmod  = result.fmod i
      case type = get_oid_type(ftype, fmod, fname)
      when Type::Integer, Type::Float, OID::Decimal, Type::String, Type::DateTime, Type::Boolean
        # skip if a column has already been type casted by pg decoders
      else types[fname] = type
      end
    end
    build_result(columns: fields, rows: result.values, column_types: types)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-exec_rollback_db_transaction"> <span class="method-name">exec_rollback_db_transaction</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="exec_rollback_db_transaction-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 123
def exec_rollback_db_transaction
  execute("ROLLBACK", "TRANSACTION")
end</pre> </div> <p>Aborts a transaction.</p>  </div> </div> <div class="method-detail method-alias"> <div class="method-heading" id="method-i-exec_update"> <span class="method-name">exec_update</span><span class="method-args">(sql, name = nil, binds = [])</span> </div>  <div class="aliases"> Alias for: <a href="databasestatements#method-i-exec_delete">exec_delete</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-execute"> <span class="method-name">execute</span><span class="method-args">(sql, name = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="execute-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 37
def execute(sql, name = nil)
  if preventing_writes? &amp;&amp; write_query?(sql)
    raise ActiveRecord::ReadOnlyError, "Write query attempted while in readonly mode: #{sql}"
  end

  materialize_transactions
  mark_transaction_written_if_write(sql)

  log(sql, name) do
    ActiveSupport::Dependencies.interlock.permit_concurrent_loads do
      @connection.async_exec(sql)
    end
  end
end</pre> </div> <p>Executes an SQL statement, returning a PG::Result object on success or raising a PG::Error exception otherwise. Note: the PG::Result object is manually memory managed; if you don't need it specifically, you may want consider the <code>exec_query</code> wrapper.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-explain"> <span class="method-name">explain</span><span class="method-args">(arel, binds = [])</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="explain-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/postgresql/database_statements.rb, line 7
def explain(arel, binds = [])
  sql = "EXPLAIN #{to_sql(arel, binds)}"
  PostgreSQL::ExplainPrettyPrinter.new.pp(exec_query(sql, "EXPLAIN", binds))
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2020 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>
