<h1 id="module-ActionMailer::TestHelper" class="module"> module ActionMailer::TestHelper </h1>
<dl class="meta">
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="../activejob/testhelper">ActiveJob::TestHelper</a></dd>
</dl> <section class="description"> <p>Provides helper methods for testing Action Mailer, including <a href="testhelper#method-i-assert_emails"><code>assert_emails</code></a> and <a href="testhelper#method-i-assert_no_emails"><code>assert_no_emails</code></a>.</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-assert_emails"> <span class="method-name">assert_emails</span><span class="method-args">(number, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_emails-source"> <pre class="ruby" data-language="ruby"># File actionmailer/lib/action_mailer/test_helper.rb, line 34
def assert_emails(number, &amp;block)
  if block_given?
    original_count = ActionMailer::Base.deliveries.size
    perform_enqueued_jobs(only: -&gt;(job) { delivery_job_filter(job) }, &amp;block)
    new_count = ActionMailer::Base.deliveries.size
    assert_equal number, new_count - original_count, "#{number} emails expected, but #{new_count - original_count} were sent"
  else
    assert_equal number, ActionMailer::Base.deliveries.size
  end
end</pre> </div> <p>Asserts that the number of emails sent matches the given number.</p> <pre class="ruby" data-language="ruby">def test_emails
  assert_emails 0
  ContactMailer.welcome.deliver_now
  assert_emails 1
  ContactMailer.welcome.deliver_now
  assert_emails 2
end
</pre> <p>If a block is passed, that block should cause the specified number of emails to be sent.</p> <pre class="ruby" data-language="ruby">def test_emails_again
  assert_emails 1 do
    ContactMailer.welcome.deliver_now
  end

  assert_emails 2 do
    ContactMailer.welcome.deliver_now
    ContactMailer.welcome.deliver_later
  end
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-assert_enqueued_email_with"> <span class="method-name">assert_enqueued_email_with</span><span class="method-args">(mailer, method, args: nil, queue: ActionMailer::Base.deliver_later_queue_name || "default", &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_enqueued_email_with-source"> <pre class="ruby" data-language="ruby"># File actionmailer/lib/action_mailer/test_helper.rb, line 126
def assert_enqueued_email_with(mailer, method, args: nil, queue: ActionMailer::Base.deliver_later_queue_name || "default", &amp;block)
  args = if args.is_a?(Hash)
    [mailer.to_s, method.to_s, "deliver_now", params: args, args: []]
  else
    [mailer.to_s, method.to_s, "deliver_now", args: Array(args)]
  end
  assert_enqueued_with(job: mailer.delivery_job, args: args, queue: queue.to_s, &amp;block)
end</pre> </div> <p>Asserts that a specific email has been enqueued, optionally matching arguments.</p> <pre class="ruby" data-language="ruby">def test_email
  ContactMailer.welcome.deliver_later
  assert_enqueued_email_with ContactMailer, :welcome
end

def test_email_with_arguments
  ContactMailer.welcome("Hello", "Goodbye").deliver_later
  assert_enqueued_email_with ContactMailer, :welcome, args: ["Hello", "Goodbye"]
end
</pre> <p>If a block is passed, that block should cause the specified email to be enqueued.</p> <pre class="ruby" data-language="ruby">def test_email_in_block
  assert_enqueued_email_with ContactMailer, :welcome do
    ContactMailer.welcome.deliver_later
  end
end
</pre> <p>If <code>args</code> is provided as a <a href="../hash"><code>Hash</code></a>, a parameterized email is matched.</p> <pre class="ruby" data-language="ruby">def test_parameterized_email
  assert_enqueued_email_with ContactMailer, :welcome,
    args: {email: 'user@example.com'} do
    ContactMailer.with(email: 'user@example.com').welcome.deliver_later
  end
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-assert_enqueued_emails"> <span class="method-name">assert_enqueued_emails</span><span class="method-args">(number, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_enqueued_emails-source"> <pre class="ruby" data-language="ruby"># File actionmailer/lib/action_mailer/test_helper.rb, line 92
def assert_enqueued_emails(number, &amp;block)
  assert_enqueued_jobs(number, only: -&gt;(job) { delivery_job_filter(job) }, &amp;block)
end</pre> </div> <p>Asserts that the number of emails enqueued for later delivery matches the given number.</p> <pre class="ruby" data-language="ruby">def test_emails
  assert_enqueued_emails 0
  ContactMailer.welcome.deliver_later
  assert_enqueued_emails 1
  ContactMailer.welcome.deliver_later
  assert_enqueued_emails 2
end
</pre> <p>If a block is passed, that block should cause the specified number of emails to be enqueued.</p> <pre class="ruby" data-language="ruby">def test_emails_again
  assert_enqueued_emails 1 do
    ContactMailer.welcome.deliver_later
  end

  assert_enqueued_emails 2 do
    ContactMailer.welcome.deliver_later
    ContactMailer.welcome.deliver_later
  end
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-assert_no_emails"> <span class="method-name">assert_no_emails</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_no_emails-source"> <pre class="ruby" data-language="ruby"># File actionmailer/lib/action_mailer/test_helper.rb, line 64
def assert_no_emails(&amp;block)
  assert_emails 0, &amp;block
end</pre> </div> <p>Asserts that no emails have been sent.</p> <pre class="ruby" data-language="ruby">def test_emails
  assert_no_emails
  ContactMailer.welcome.deliver_now
  assert_emails 1
end
</pre> <p>If a block is passed, that block should not cause any emails to be sent.</p> <pre class="ruby" data-language="ruby">def test_emails_again
  assert_no_emails do
    # No emails should be sent from this block
  end
end
</pre> <p>Note: This assertion is simply a shortcut for:</p> <pre class="ruby" data-language="ruby">assert_emails 0, &amp;block
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-assert_no_enqueued_emails"> <span class="method-name">assert_no_enqueued_emails</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_no_enqueued_emails-source"> <pre class="ruby" data-language="ruby"># File actionmailer/lib/action_mailer/test_helper.rb, line 150
def assert_no_enqueued_emails(&amp;block)
  assert_enqueued_emails 0, &amp;block
end</pre> </div> <p>Asserts that no emails are enqueued for later delivery.</p> <pre class="ruby" data-language="ruby">def test_no_emails
  assert_no_enqueued_emails
  ContactMailer.welcome.deliver_later
  assert_enqueued_emails 1
end
</pre> <p>If a block is provided, it should not cause any emails to be enqueued.</p> <pre class="ruby" data-language="ruby">def test_no_emails
  assert_no_enqueued_emails do
    # No emails should be enqueued from this block
  end
end
</pre>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2004&ndash;2020 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>
