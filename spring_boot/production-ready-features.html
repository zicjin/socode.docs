<div id="header"> <h1>Spring Boot Actuator: Production-ready Features</h1> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#production-ready-enabling">1. Enabling Production-ready Features</a></li> <li>
<a href="#production-ready-endpoints">2. Endpoints</a> <ul class="sectlevel2"> <li><a href="#production-ready-endpoints-enabling-endpoints">2.1. Enabling Endpoints</a></li> <li><a href="#production-ready-endpoints-exposing-endpoints">2.2. Exposing Endpoints</a></li> <li><a href="#production-ready-endpoints-security">2.3. Securing HTTP Endpoints</a></li> <li><a href="#production-ready-endpoints-caching">2.4. Configuring Endpoints</a></li> <li><a href="#production-ready-endpoints-hypermedia">2.5. Hypermedia for Actuator Web Endpoints</a></li> <li><a href="#production-ready-endpoints-cors">2.6. CORS Support</a></li> <li>
<a href="#production-ready-endpoints-custom">2.7. Implementing Custom Endpoints</a> <ul class="sectlevel3"> <li>
<a href="#production-ready-endpoints-custom-input">2.7.1. Receiving Input</a> <ul class="sectlevel4"> <li><a href="#production-ready-endpoints-custom-input-conversion">Input type conversion</a></li> </ul> </li> <li>
<a href="#production-ready-endpoints-custom-web">2.7.2. Custom Web Endpoints</a> <ul class="sectlevel4"> <li><a href="#production-ready-endpoints-custom-web-predicate">Web Endpoint Request Predicates</a></li> <li><a href="#production-ready-endpoints-custom-web-predicate-path">Path</a></li> <li><a href="#production-ready-endpoints-custom-web-predicate-http-method">HTTP method</a></li> <li><a href="#production-ready-endpoints-custom-web-predicate-consumes">Consumes</a></li> <li><a href="#production-ready-endpoints-custom-web-predicate-produces">Produces</a></li> <li><a href="#production-ready-endpoints-custom-web-response-status">Web Endpoint Response Status</a></li> <li><a href="#production-ready-endpoints-custom-web-range-requests">Web Endpoint Range Requests</a></li> <li><a href="#production-ready-endpoints-custom-web-security">Web Endpoint Security</a></li> </ul> </li> <li><a href="#production-ready-endpoints-custom-servlet">2.7.3. Servlet endpoints</a></li> <li><a href="#production-ready-endpoints-custom-controller">2.7.4. Controller endpoints</a></li> </ul> </li> <li>
<a href="#production-ready-health">2.8. Health Information</a> <ul class="sectlevel3"> <li><a href="#production-ready-health-indicators">2.8.1. Auto-configured HealthIndicators</a></li> <li><a href="#writing-custom-healthindicators">2.8.2. Writing Custom HealthIndicators</a></li> <li><a href="#reactive-health-indicators">2.8.3. Reactive Health Indicators</a></li> <li><a href="#auto-configured-reactivehealthindicators">2.8.4. Auto-configured ReactiveHealthIndicators</a></li> <li><a href="#production-ready-health-groups">2.8.5. Health Groups</a></li> </ul> </li> <li>
<a href="#production-ready-kubernetes-probes">2.9. Kubernetes Probes</a> <ul class="sectlevel3"> <li><a href="#production-ready-kubernetes-probes-external-state">2.9.1. Checking external state with Kubernetes Probes</a></li> <li><a href="#production-ready-kubernetes-probes-lifecycle">2.9.2. Application lifecycle and Probes states</a></li> </ul> </li> <li>
<a href="#production-ready-application-info">2.10. Application Information</a> <ul class="sectlevel3"> <li><a href="#production-ready-application-info-autoconfigure">2.10.1. Auto-configured InfoContributors</a></li> <li><a href="#production-ready-application-info-env">2.10.2. Custom Application Information</a></li> <li><a href="#production-ready-application-info-git">2.10.3. Git Commit Information</a></li> <li><a href="#production-ready-application-info-build">2.10.4. Build Information</a></li> <li><a href="#production-ready-application-info-custom">2.10.5. Writing Custom InfoContributors</a></li> </ul> </li> </ul> </li> <li>
<a href="#production-ready-monitoring">3. Monitoring and Management over HTTP</a> <ul class="sectlevel2"> <li><a href="#production-ready-customizing-management-server-context-path">3.1. Customizing the Management Endpoint Paths</a></li> <li><a href="#production-ready-customizing-management-server-port">3.2. Customizing the Management Server Port</a></li> <li><a href="#production-ready-management-specific-ssl">3.3. Configuring Management-specific SSL</a></li> <li><a href="#production-ready-customizing-management-server-address">3.4. Customizing the Management Server Address</a></li> <li><a href="#production-ready-disabling-http-endpoints">3.5. Disabling HTTP Endpoints</a></li> </ul> </li> <li>
<a href="#production-ready-jmx">4. Monitoring and Management over JMX</a> <ul class="sectlevel2"> <li><a href="#production-ready-custom-mbean-names">4.1. Customizing MBean Names</a></li> <li><a href="#production-ready-disable-jmx-endpoints">4.2. Disabling JMX Endpoints</a></li> <li>
<a href="#production-ready-jolokia">4.3. Using Jolokia for JMX over HTTP</a> <ul class="sectlevel3"> <li><a href="#production-ready-customizing-jolokia">4.3.1. Customizing Jolokia</a></li> <li><a href="#production-ready-disabling-jolokia">4.3.2. Disabling Jolokia</a></li> </ul> </li> </ul> </li> <li>
<a href="#production-ready-loggers">5. Loggers</a> <ul class="sectlevel2"> <li><a href="#production-ready-logger-configuration">5.1. Configure a Logger</a></li> </ul> </li> <li>
<a href="#production-ready-metrics">6. Metrics</a> <ul class="sectlevel2"> <li><a href="#production-ready-metrics-getting-started">6.1. Getting started</a></li> <li>
<a href="#production-ready-metrics-export">6.2. Supported monitoring systems</a> <ul class="sectlevel3"> <li><a href="#production-ready-metrics-export-appoptics">6.2.1. AppOptics</a></li> <li><a href="#production-ready-metrics-export-atlas">6.2.2. Atlas</a></li> <li><a href="#production-ready-metrics-export-datadog">6.2.3. Datadog</a></li> <li><a href="#production-ready-metrics-export-dynatrace">6.2.4. Dynatrace</a></li> <li><a href="#production-ready-metrics-export-elastic">6.2.5. Elastic</a></li> <li><a href="#production-ready-metrics-export-ganglia">6.2.6. Ganglia</a></li> <li><a href="#production-ready-metrics-export-graphite">6.2.7. Graphite</a></li> <li><a href="#production-ready-metrics-export-humio">6.2.8. Humio</a></li> <li><a href="#production-ready-metrics-export-influx">6.2.9. Influx</a></li> <li><a href="#production-ready-metrics-export-jmx">6.2.10. JMX</a></li> <li><a href="#production-ready-metrics-export-kairos">6.2.11. KairosDB</a></li> <li><a href="#production-ready-metrics-export-newrelic">6.2.12. New Relic</a></li> <li><a href="#production-ready-metrics-export-prometheus">6.2.13. Prometheus</a></li> <li><a href="#production-ready-metrics-export-signalfx">6.2.14. SignalFx</a></li> <li><a href="#production-ready-metrics-export-simple">6.2.15. Simple</a></li> <li><a href="#production-ready-metrics-export-stackdriver">6.2.16. Stackdriver</a></li> <li><a href="#production-ready-metrics-export-statsd">6.2.17. StatsD</a></li> <li><a href="#production-ready-metrics-export-wavefront">6.2.18. Wavefront</a></li> </ul> </li> <li>
<a href="#production-ready-metrics-meter">6.3. Supported Metrics</a> <ul class="sectlevel3"> <li><a href="#production-ready-metrics-spring-mvc">6.3.1. Spring MVC Metrics</a></li> <li><a href="#production-ready-metrics-web-flux">6.3.2. Spring WebFlux Metrics</a></li> <li><a href="#production-ready-metrics-jersey-server">6.3.3. Jersey Server Metrics</a></li> <li><a href="#production-ready-metrics-http-clients">6.3.4. HTTP Client Metrics</a></li> <li><a href="#production-ready-metrics-cache">6.3.5. Cache Metrics</a></li> <li><a href="#production-ready-metrics-jdbc">6.3.6. DataSource Metrics</a></li> <li><a href="#production-ready-metrics-hibernate">6.3.7. Hibernate Metrics</a></li> <li><a href="#production-ready-metrics-rabbitmq">6.3.8. RabbitMQ Metrics</a></li> </ul> </li> <li><a href="#production-ready-metrics-custom">6.4. Registering custom metrics</a></li> <li>
<a href="#production-ready-metrics-per-meter-properties">6.5. Customizing individual metrics</a> <ul class="sectlevel3"> <li><a href="#production-ready-metrics-common-tags">6.5.1. Common tags</a></li> <li><a href="#per-meter-properties">6.5.2. Per-meter properties</a></li> </ul> </li> <li><a href="#production-ready-metrics-endpoint">6.6. Metrics endpoint</a></li> </ul> </li> <li>
<a href="#production-ready-auditing">7. Auditing</a> <ul class="sectlevel2"> <li><a href="#production-ready-auditing-custom">7.1. Custom Auditing</a></li> </ul> </li> <li>
<a href="#production-ready-http-tracing">8. HTTP Tracing</a> <ul class="sectlevel2"> <li><a href="#production-ready-http-tracing-custom">8.1. Custom HTTP tracing</a></li> </ul> </li> <li>
<a href="#production-ready-process-monitoring">9. Process Monitoring</a> <ul class="sectlevel2"> <li><a href="#production-ready-process-monitoring-configuration">9.1. Extending Configuration</a></li> <li><a href="#production-ready-process-monitoring-programmatically">9.2. Programmatically</a></li> </ul> </li> <li>
<a href="#production-ready-cloudfoundry">10. Cloud Foundry Support</a> <ul class="sectlevel2"> <li><a href="#production-ready-cloudfoundry-disable">10.1. Disabling Extended Cloud Foundry Actuator Support</a></li> <li><a href="#production-ready-cloudfoundry-ssl">10.2. Cloud Foundry Self-signed Certificates</a></li> <li><a href="#custom-context-path">10.3. Custom context path</a></li> </ul> </li> <li><a href="#production-ready-whats-next">11. What to Read Next</a></li> </ul> </div> </div> <div id="content"> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot includes a number of additional features to help you monitor and manage your application when you push it to production. You can choose to manage and monitor your application by using HTTP endpoints or with JMX. Auditing, health, and metrics gathering can also be automatically applied to your application.</p> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-enabling">
1. Enabling Production-ready Features</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator"><code>spring-boot-actuator</code></a> module provides all of Spring Boot’s production-ready features. The simplest way to enable the features is to add a dependency to the <code>spring-boot-starter-actuator</code> ‘Starter’.</p> </div> <div class="sidebarblock"> <div class="content"> <div class="title">Definition of Actuator</div> <div class="paragraph"> <p>An actuator is a manufacturing term that refers to a mechanical device for moving or controlling something. Actuators can generate a large amount of motion from a small change.</p> </div> </div> </div> <div class="paragraph"> <p>To add the actuator to a Maven based project, add the following ‘Starter’ dependency:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="xml"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre> </div> </div> <div class="paragraph"> <p>For Gradle, use the following declaration:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="groovy"><code data-lang="groovy" class="language-groovy hljs">dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
}</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-endpoints">
2. Endpoints</h2> <div class="sectionbody"> <div class="paragraph"> <p>Actuator endpoints let you monitor and interact with your application. Spring Boot includes a number of built-in endpoints and lets you add your own. For example, the <code>health</code> endpoint provides basic application health information.</p> </div> <div class="paragraph"> <p>Each individual endpoint can be <a href="#production-ready-endpoints-enabling-endpoints">enabled or disabled</a> and <a href="#production-ready-endpoints-exposing-endpoints">exposed (made remotely accessible) over HTTP or JMX</a>. An endpoint is considered to be available when it is both enabled and exposed. The built-in endpoints will only be auto-configured when they are available. Most applications choose exposure via HTTP, where the ID of the endpoint along with a prefix of <code>/actuator</code> is mapped to a URL. For example, by default, the <code>health</code> endpoint is mapped to <code>/actuator/health</code>.</p> </div> <div class="paragraph"> <p>The following technology-agnostic endpoints are available:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 28.5714%;"> <col style="width: 71.4286%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">ID</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>auditevents</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes audit events information for the current application. Requires an <code>AuditEventRepository</code> bean.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>beans</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Displays a complete list of all the Spring beans in your application.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>caches</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes available caches.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows the conditions that were evaluated on configuration and auto-configuration classes and the reasons why they did or did not match.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>configprops</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Displays a collated list of all <code>@ConfigurationProperties</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes properties from Spring’s <code>ConfigurableEnvironment</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>flyway</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows any Flyway database migrations that have been applied. Requires one or more <code>Flyway</code> beans.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>health</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows application health information.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>httptrace</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Displays HTTP trace information (by default, the last 100 HTTP request-response exchanges). Requires an <code>HttpTraceRepository</code> bean.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Displays arbitrary application info.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>integrationgraph</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows the Spring Integration graph. Requires a dependency on <code>spring-integration-core</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>loggers</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows and modifies the configuration of loggers in the application.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>liquibase</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows any Liquibase database migrations that have been applied. Requires one or more <code>Liquibase</code> beans.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>metrics</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shows ‘metrics’ information for the current application.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mappings</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Displays a collated list of all <code>@RequestMapping</code> paths.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheduledtasks</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Displays the scheduled tasks in your application.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessions</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Allows retrieval and deletion of user sessions from a Spring Session-backed session store. Requires a Servlet-based web application using Spring Session.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>shutdown</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Lets the application be gracefully shutdown. Disabled by default.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>threaddump</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Performs a thread dump.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>If your application is a web application (Spring MVC, Spring WebFlux, or Jersey), you can use the following additional endpoints:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 28.5714%;"> <col style="width: 71.4286%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">ID</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>heapdump</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Returns an <code>hprof</code> heap dump file.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>jolokia</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes JMX beans over HTTP (when Jolokia is on the classpath, not available for WebFlux). Requires a dependency on <code>jolokia-core</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>logfile</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Returns the contents of the logfile (if <code>logging.file.name</code> or <code>logging.file.path</code> properties have been set). Supports the use of the HTTP <code>Range</code> header to retrieve part of the log file’s content.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>prometheus</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes metrics in a format that can be scraped by a Prometheus server. Requires a dependency on <code>micrometer-registry-prometheus</code>.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>To learn more about the Actuator’s endpoints and their request and response formats, please refer to the separate API documentation (<a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/actuator-api/html/">HTML</a> or <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/actuator-api/pdf/spring-boot-actuator-web-api.pdf">PDF</a>).</p> </div> <div class="sect2"> <h3 id="production-ready-endpoints-enabling-endpoints">
2.1. Enabling Endpoints</h3> <div class="paragraph"> <p>By default, all endpoints except for <code>shutdown</code> are enabled. To configure the enablement of an endpoint, use its <code>management.endpoint.&lt;id&gt;.enabled</code> property. The following example enables the <code>shutdown</code> endpoint:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.shutdown.enabled=true</code></pre> </div> </div> <div class="paragraph"> <p>If you prefer endpoint enablement to be opt-in rather than opt-out, set the <code>management.endpoints.enabled-by-default</code> property to <code>false</code> and use individual endpoint <code>enabled</code> properties to opt back in. The following example enables the <code>info</code> endpoint and disables all other endpoints:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.enabled-by-default=false
management.endpoint.info.enabled=true</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Disabled endpoints are removed entirely from the application context. If you want to change only the technologies over which an endpoint is exposed, use the <a href="#production-ready-endpoints-exposing-endpoints"><code>include</code> and <code>exclude</code> properties</a> instead. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="production-ready-endpoints-exposing-endpoints">
2.2. Exposing Endpoints</h3> <div class="paragraph"> <p>Since Endpoints may contain sensitive information, careful consideration should be given about when to expose them. The following table shows the default exposure for the built-in endpoints:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 33.3333%;"> <col style="width: 33.3333%;"> <col style="width: 33.3334%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">ID</th> <th class="tableblock halign-left valign-top">JMX</th> <th class="tableblock halign-left valign-top">Web</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>auditevents</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>beans</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>caches</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>configprops</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>env</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>flyway</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>health</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>heapdump</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>httptrace</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>integrationgraph</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>jolokia</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>logfile</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>loggers</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>liquibase</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>metrics</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mappings</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>prometheus</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheduledtasks</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessions</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>shutdown</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>threaddump</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>To change which endpoints are exposed, use the following technology-specific <code>include</code> and <code>exclude</code> properties:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 75%;"> <col style="width: 25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property</th> <th class="tableblock halign-left valign-top">Default</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.jmx.exposure.exclude</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.jmx.exposure.include</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.web.exposure.exclude</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.endpoints.web.exposure.include</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>info, health</code></p></td> </tr> </tbody> </table> <div class="paragraph"> <p>The <code>include</code> property lists the IDs of the endpoints that are exposed. The <code>exclude</code> property lists the IDs of the endpoints that should not be exposed. The <code>exclude</code> property takes precedence over the <code>include</code> property. Both <code>include</code> and <code>exclude</code> properties can be configured with a list of endpoint IDs.</p> </div> <div class="paragraph"> <p>For example, to stop exposing all endpoints over JMX and only expose the <code>health</code> and <code>info</code> endpoints, use the following property:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.jmx.exposure.include=health,info</code></pre> </div> </div> <div class="paragraph"> <p><code>*</code> can be used to select all endpoints. For example, to expose everything over HTTP except the <code>env</code> and <code>beans</code> endpoints, use the following properties:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.web.exposure.include=*
management.endpoints.web.exposure.exclude=env,beans</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p><code>*</code> has a special meaning in YAML, so be sure to add quotes if you want to include (or exclude) all endpoints, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="yaml"><code data-lang="yaml" class="language-yaml hljs">management:
  endpoints:
    web:
      exposure:
        include: "*"</code></pre> </div> </div> </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If your application is exposed publicly, we strongly recommend that you also <a href="#production-ready-endpoints-security">secure your endpoints</a>. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If you want to implement your own strategy for when endpoints are exposed, you can register an <code>EndpointFilter</code> bean. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="production-ready-endpoints-security">
2.3. Securing HTTP Endpoints</h3> <div class="paragraph"> <p>You should take care to secure HTTP endpoints in the same way that you would any other sensitive URL. If Spring Security is present, endpoints are secured by default using Spring Security’s content-negotiation strategy. If you wish to configure custom security for HTTP endpoints, for example, only allow users with a certain role to access them, Spring Boot provides some convenient <code>RequestMatcher</code> objects that can be used in combination with Spring Security.</p> </div> <div class="paragraph"> <p>A typical Spring Security configuration might look something like the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Configuration(proxyBeanMethods = false)
public class ActuatorSecurity extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests((requests) -&gt;
                requests.anyRequest().hasRole("ENDPOINT_ADMIN"));
        http.httpBasic();
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>The preceding example uses <code>EndpointRequest.toAnyEndpoint()</code> to match a request to any endpoint and then ensures that all have the <code>ENDPOINT_ADMIN</code> role. Several other matcher methods are also available on <code>EndpointRequest</code>. See the API documentation (<a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/actuator-api/html">HTML</a> or <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/actuator-api/pdf/spring-boot-actuator-web-api.pdf">PDF</a>) for details.</p> </div> <div class="paragraph"> <p>If you deploy applications behind a firewall, you may prefer that all your actuator endpoints can be accessed without requiring authentication. You can do so by changing the <code>management.endpoints.web.exposure.include</code> property, as follows:</p> </div> <div class="listingblock"> <div class="title">application.properties</div> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.web.exposure.include=*</code></pre> </div> </div> <div class="paragraph"> <p>Additionally, if Spring Security is present, you would need to add custom security configuration that allows unauthenticated access to the endpoints as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Configuration(proxyBeanMethods = false)
public class ActuatorSecurity extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests((requests) -&gt;
            requests.anyRequest().permitAll());
    }

}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-endpoints-caching">
2.4. Configuring Endpoints</h3> <div class="paragraph"> <p>Endpoints automatically cache responses to read operations that do not take any parameters. To configure the amount of time for which an endpoint will cache a response, use its <code>cache.time-to-live</code> property. The following example sets the time-to-live of the <code>beans</code> endpoint’s cache to 10 seconds:</p> </div> <div class="listingblock"> <div class="title">application.properties</div> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.beans.cache.time-to-live=10s</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The prefix <code>management.endpoint.&lt;name&gt;</code> is used to uniquely identify the endpoint that is being configured. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="production-ready-endpoints-hypermedia">
2.5. Hypermedia for Actuator Web Endpoints</h3> <div class="paragraph"> <p>A “discovery page” is added with links to all the endpoints. The “discovery page” is available on <code>/actuator</code> by default.</p> </div> <div class="paragraph"> <p>When a custom management context path is configured, the “discovery page” automatically moves from <code>/actuator</code> to the root of the management context. For example, if the management context path is <code>/management</code>, then the discovery page is available from <code>/management</code>. When the management context path is set to <code>/</code>, the discovery page is disabled to prevent the possibility of a clash with other mappings.</p> </div> </div> <div class="sect2"> <h3 id="production-ready-endpoints-cors">
2.6. CORS Support</h3> <div class="paragraph"> <p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing</a> (CORS) is a <a href="https://www.w3.org/TR/cors/">W3C specification</a> that lets you specify in a flexible way what kind of cross-domain requests are authorized. If you use Spring MVC or Spring WebFlux, Actuator’s web endpoints can be configured to support such scenarios.</p> </div> <div class="paragraph"> <p>CORS support is disabled by default and is only enabled once the <code>management.endpoints.web.cors.allowed-origins</code> property has been set. The following configuration permits <code>GET</code> and <code>POST</code> calls from the <code>example.com</code> domain:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.web.cors.allowed-origins=https://example.com
management.endpoints.web.cors.allowed-methods=GET,POST</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> See <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/CorsEndpointProperties.java">CorsEndpointProperties</a> for a complete list of options. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="production-ready-endpoints-custom">
2.7. Implementing Custom Endpoints</h3> <div class="paragraph"> <p>If you add a <code>@Bean</code> annotated with <code>@Endpoint</code>, any methods annotated with <code>@ReadOperation</code>, <code>@WriteOperation</code>, or <code>@DeleteOperation</code> are automatically exposed over JMX and, in a web application, over HTTP as well. Endpoints can be exposed over HTTP using Jersey, Spring MVC, or Spring WebFlux. If both Jersey and Spring MVC are available, Spring MVC will be used.</p> </div> <div class="paragraph"> <p>You can also write technology-specific endpoints by using <code>@JmxEndpoint</code> or <code>@WebEndpoint</code>. These endpoints are restricted to their respective technologies. For example, <code>@WebEndpoint</code> is exposed only over HTTP and not over JMX.</p> </div> <div class="paragraph"> <p>You can write technology-specific extensions by using <code>@EndpointWebExtension</code> and <code>@EndpointJmxExtension</code>. These annotations let you provide technology-specific operations to augment an existing endpoint.</p> </div> <div class="paragraph"> <p>Finally, if you need access to web-framework-specific functionality, you can implement Servlet or Spring <code>@Controller</code> and <code>@RestController</code> endpoints at the cost of them not being available over JMX or when using a different web framework.</p> </div> <div class="sect3"> <h4 id="production-ready-endpoints-custom-input">
2.7.1. Receiving Input</h4> <div class="paragraph"> <p>Operations on an endpoint receive input via their parameters. When exposed via the web, the values for these parameters are taken from the URL’s query parameters and from the JSON request body. When exposed via JMX, the parameters are mapped to the parameters of the MBean’s operations. Parameters are required by default. They can be made optional by annotating them with <code>@org.springframework.lang.Nullable</code>.</p> </div> <div class="paragraph"> <p>Each root property in the JSON request body can be mapped to a parameter of the endpoint. Consider the following JSON request body:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="json"><code data-lang="json" class="language-json hljs">{
    "name": "test",
    "counter": 42
}</code></pre> </div> </div> <div class="paragraph"> <p>This can be used to invoke a write operation that takes <code>String name</code> and <code>int counter</code> parameters.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> Because endpoints are technology agnostic, only simple types can be specified in the method signature. In particular declaring a single parameter with a custom type defining a <code>name</code> and <code>counter</code> properties is not supported. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> To allow the input to be mapped to the operation method’s parameters, Java code implementing an endpoint should be compiled with <code>-parameters</code>, and Kotlin code implementing an endpoint should be compiled with <code>-java-parameters</code>. This will happen automatically if you are using Spring Boot’s Gradle plugin or if you are using Maven and <code>spring-boot-starter-parent</code>. </td> </tr> </table> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-input-conversion">
Input type conversion</h5> <div class="paragraph"> <p>The parameters passed to endpoint operation methods are, if necessary, automatically converted to the required type. Before calling an operation method, the input received via JMX or an HTTP request is converted to the required types using an instance of <code>ApplicationConversionService</code> as well as any <code>Converter</code> or <code>GenericConverter</code> beans qualified with <code>@EndpointConverter</code>.</p> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-endpoints-custom-web">
2.7.2. Custom Web Endpoints</h4> <div class="paragraph"> <p>Operations on an <code>@Endpoint</code>, <code>@WebEndpoint</code>, or <code>@EndpointWebExtension</code> are automatically exposed over HTTP using Jersey, Spring MVC, or Spring WebFlux. If both Jersey and Spring MVC are available, Spring MVC will be used.</p> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-predicate">
Web Endpoint Request Predicates</h5> <div class="paragraph"> <p>A request predicate is automatically generated for each operation on a web-exposed endpoint.</p> </div> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-predicate-path">
Path</h5> <div class="paragraph"> <p>The path of the predicate is determined by the ID of the endpoint and the base path of web-exposed endpoints. The default base path is <code>/actuator</code>. For example, an endpoint with the ID <code>sessions</code> will use <code>/actuator/sessions</code> as its path in the predicate.</p> </div> <div class="paragraph"> <p>The path can be further customized by annotating one or more parameters of the operation method with <code>@Selector</code>. Such a parameter is added to the path predicate as a path variable. The variable’s value is passed into the operation method when the endpoint operation is invoked. If you want to capture all remaining path elements, you can add <code>@Selector(Match=ALL_REMAINING)</code> to the last parameter and make it a type that is conversion compatible with a <code>String[]</code>.</p> </div> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-predicate-http-method">
HTTP method</h5> <div class="paragraph"> <p>The HTTP method of the predicate is determined by the operation type, as shown in the following table:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 75%;"> <col style="width: 25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Operation</th> <th class="tableblock halign-left valign-top">HTTP method</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ReadOperation</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>@WriteOperation</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DeleteOperation</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-predicate-consumes">
Consumes</h5> <div class="paragraph"> <p>For a <code>@WriteOperation</code> (HTTP <code>POST</code>) that uses the request body, the consumes clause of the predicate is <code>application/vnd.spring-boot.actuator.v2+json, application/json</code>. For all other operations the consumes clause is empty.</p> </div> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-predicate-produces">
Produces</h5> <div class="paragraph"> <p>The produces clause of the predicate can be determined by the <code>produces</code> attribute of the <code>@DeleteOperation</code>, <code>@ReadOperation</code>, and <code>@WriteOperation</code> annotations. The attribute is optional. If it is not used, the produces clause is determined automatically.</p> </div> <div class="paragraph"> <p>If the operation method returns <code>void</code> or <code>Void</code> the produces clause is empty. If the operation method returns a <code>org.springframework.core.io.Resource</code>, the produces clause is <code>application/octet-stream</code>. For all other operations the produces clause is <code>application/vnd.spring-boot.actuator.v2+json, application/json</code>.</p> </div> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-response-status">
Web Endpoint Response Status</h5> <div class="paragraph"> <p>The default response status for an endpoint operation depends on the operation type (read, write, or delete) and what, if anything, the operation returns.</p> </div> <div class="paragraph"> <p>A <code>@ReadOperation</code> returns a value, the response status will be 200 (OK). If it does not return a value, the response status will be 404 (Not Found).</p> </div> <div class="paragraph"> <p>If a <code>@WriteOperation</code> or <code>@DeleteOperation</code> returns a value, the response status will be 200 (OK). If it does not return a value the response status will be 204 (No Content).</p> </div> <div class="paragraph"> <p>If an operation is invoked without a required parameter, or with a parameter that cannot be converted to the required type, the operation method will not be called and the response status will be 400 (Bad Request).</p> </div> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-range-requests">
Web Endpoint Range Requests</h5> <div class="paragraph"> <p>An HTTP range request can be used to request part of an HTTP resource. When using Spring MVC or Spring Web Flux, operations that return a <code>org.springframework.core.io.Resource</code> automatically support range requests.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Range requests are not supported when using Jersey. </td> </tr> </table> </div> </div> <div class="sect4"> <h5 id="production-ready-endpoints-custom-web-security">
Web Endpoint Security</h5> <div class="paragraph"> <p>An operation on a web endpoint or a web-specific endpoint extension can receive the current <code>java.security.Principal</code> or <code>org.springframework.boot.actuate.endpoint.SecurityContext</code> as a method parameter. The former is typically used in conjunction with <code>@Nullable</code> to provide different behavior for authenticated and unauthenticated users. The latter is typically used to perform authorization checks using its <code>isUserInRole(String)</code> method.</p> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-endpoints-custom-servlet">
2.7.3. Servlet endpoints</h4> <div class="paragraph"> <p>A <code>Servlet</code> can be exposed as an endpoint by implementing a class annotated with <code>@ServletEndpoint</code> that also implements <code>Supplier&lt;EndpointServlet&gt;</code>. Servlet endpoints provide deeper integration with the Servlet container but at the expense of portability. They are intended to be used to expose an existing <code>Servlet</code> as an endpoint. For new endpoints, the <code>@Endpoint</code> and <code>@WebEndpoint</code> annotations should be preferred whenever possible.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-endpoints-custom-controller">
2.7.4. Controller endpoints</h4> <div class="paragraph"> <p><code>@ControllerEndpoint</code> and <code>@RestControllerEndpoint</code> can be used to implement an endpoint that is only exposed by Spring MVC or Spring WebFlux. Methods are mapped using the standard annotations for Spring MVC and Spring WebFlux such as <code>@RequestMapping</code> and <code>@GetMapping</code>, with the endpoint’s ID being used as a prefix for the path. Controller endpoints provide deeper integration with Spring’s web frameworks but at the expense of portability. The <code>@Endpoint</code> and <code>@WebEndpoint</code> annotations should be preferred whenever possible.</p> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-health">
2.8. Health Information</h3> <div class="paragraph"> <p>You can use health information to check the status of your running application. It is often used by monitoring software to alert someone when a production system goes down. The information exposed by the <code>health</code> endpoint depends on the <code>management.endpoint.health.show-details</code> and <code>management.endpoint.health.show-components</code> properties which can be configured with one of the following values:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 25%;"> <col style="width: 75%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>never</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Details are never shown.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>when-authorized</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Details are only shown to authorized users. Authorized roles can be configured using <code>management.endpoint.health.roles</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>always</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Details are shown to all users.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>The default value is <code>never</code>. A user is considered to be authorized when they are in one or more of the endpoint’s roles. If the endpoint has no configured roles (the default) all authenticated users are considered to be authorized. The roles can be configured using the <code>management.endpoint.health.roles</code> property.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If you have secured your application and wish to use <code>always</code>, your security configuration must permit access to the health endpoint for both authenticated and unauthenticated users. </td> </tr> </table> </div> <div class="paragraph"> <p>Health information is collected from the content of a <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributorRegistry.java"><code>HealthContributorRegistry</code></a> (by default all <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributor.java"><code>HealthContributor</code></a> instances defined in your <code>ApplicationContext</code>). Spring Boot includes a number of auto-configured <code>HealthContributors</code> and you can also write your own.</p> </div> <div class="paragraph"> <p>A <code>HealthContributor</code> can either be a <code>HealthIndicator</code> or a <code>CompositeHealthContributor</code>. A <code>HealthIndicator</code> provides actual health information, including a <code>Status</code>. A <code>CompositeHealthContributor</code> provides a composite of other <code>HealthContributors</code>. Taken together, contributors form a tree structure to represent the overall system health.</p> </div> <div class="paragraph"> <p>By default, the final system health is derived by a <code>StatusAggregator</code> which sorts the statuses from each <code>HealthIndicator</code> based on an ordered list of statuses. The first status in the sorted list is used as the overall health status. If no <code>HealthIndicator</code> returns a status that is known to the <code>StatusAggregator</code>, an <code>UNKNOWN</code> status is used.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The <code>HealthContributorRegistry</code> can be used to register and unregister health indicators at runtime. </td> </tr> </table> </div> <div class="sect3"> <h4 id="production-ready-health-indicators">
2.8.1. Auto-configured HealthIndicators</h4> <div class="paragraph"> <p>The following <code>HealthIndicators</code> are auto-configured by Spring Boot when appropriate:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 40%;"> <col style="width: 60%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraHealthIndicator.java"><code>CassandraHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Cassandra database is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java"><code>CouchbaseHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Couchbase cluster is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.java"><code>DataSourceHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a connection to <code>DataSource</code> can be obtained.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java"><code>DiskSpaceHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks for low disk space.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticSearchRestHealthContributorAutoConfiguration.java"><code>ElasticSearchRestHealthContributorAutoConfiguration</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that an Elasticsearch cluster is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/hazelcast/HazelcastHealthIndicator.java"><code>HazelcastHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Hazelcast server is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java"><code>InfluxDbHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that an InfluxDB server is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java"><code>JmsHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a JMS broker is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/ldap/LdapHealthIndicator.java"><code>LdapHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that an LDAP server is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/availability/LivenessStateHealthIndicator.java"><code>LivenessStateHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes the "Liveness" application availability state.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java"><code>MailHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a mail server is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoHealthIndicator.java"><code>MongoHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Mongo database is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jHealthIndicator.java"><code>Neo4jHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Neo4j database is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/PingHealthIndicator.java"><code>PingHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Always responds with <code>UP</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java"><code>RabbitHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Rabbit server is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/availability/ReadinessStateHealthIndicator.java"><code>ReadinessStateHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes the "Readiness" application availability state.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisHealthIndicator.java"><code>RedisHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Redis server is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/solr/SolrHealthIndicator.java"><code>SolrHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Solr server is up.</p></td> </tr> </tbody> </table> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> You can disable them all by setting the <code>management.health.defaults.enabled</code> property. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="writing-custom-healthindicators">
2.8.2. Writing Custom HealthIndicators</h4> <div class="paragraph"> <p>To provide custom health information, you can register Spring beans that implement the <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a> interface. You need to provide an implementation of the <code>health()</code> method and return a <code>Health</code> response. The <code>Health</code> response should include a status and can optionally include additional details to be displayed. The following code shows a sample <code>HealthIndicator</code> implementation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">import org.springframework.boot.actuate.health.Health;
import org.springframework.boot.actuate.health.HealthIndicator;
import org.springframework.stereotype.Component;

@Component
public class MyHealthIndicator implements HealthIndicator {

    @Override
    public Health health() {
        int errorCode = check(); // perform some specific health check
        if (errorCode != 0) {
            return Health.down().withDetail("Error Code", errorCode).build();
        }
        return Health.up().build();
    }

}</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The identifier for a given <code>HealthIndicator</code> is the name of the bean without the <code>HealthIndicator</code> suffix, if it exists. In the preceding example, the health information is available in an entry named <code>my</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>In addition to Spring Boot’s predefined <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java"><code>Status</code></a> types, it is also possible for <code>Health</code> to return a custom <code>Status</code> that represents a new system state. In such cases, a custom implementation of the <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/StatusAggregator.java"><code>StatusAggregator</code></a> interface also needs to be provided, or the default implementation has to be configured by using the <code>management.endpoint.health.status.order</code> configuration property.</p> </div> <div class="paragraph"> <p>For example, assume a new <code>Status</code> with code <code>FATAL</code> is being used in one of your <code>HealthIndicator</code> implementations. To configure the severity order, add the following property to your application properties:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.health.status.order=fatal,down,out-of-service,unknown,up</code></pre> </div> </div> <div class="paragraph"> <p>The HTTP status code in the response reflects the overall health status. By default, <code>OUT_OF_SERVICE</code> and <code>DOWN</code> map to 503. Any unmapped health statuses, including <code>UP</code>, map to 200. You might also want to register custom status mappings if you access the health endpoint over HTTP. Configuring a custom mapping disables the defaults mappings for <code>DOWN</code> and <code>OUT_OF_SERVICE</code>. If you want to retain the default mappings they must be configured explicitly alongside any custom mappings. For example, the following property maps <code>FATAL</code> to 503 (service unavailable) and retains the default mappings for <code>DOWN</code> and <code>OUT_OF_SERVICE</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.health.status.http-mapping.down=503
management.endpoint.health.status.http-mapping.fatal=503
management.endpoint.health.status.http-mapping.out-of-service=503</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If you need more control, you can define your own <code>HttpCodeStatusMapper</code> bean. </td> </tr> </table> </div> <div class="paragraph"> <p>The following table shows the default status mappings for the built-in statuses:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 25%;"> <col style="width: 75%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Status</th> <th class="tableblock halign-left valign-top">Mapping</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE_UNAVAILABLE (503)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">OUT_OF_SERVICE</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE_UNAVAILABLE (503)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">UP</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No mapping by default, so http status is 200</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">UNKNOWN</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">No mapping by default, so http status is 200</p></td> </tr> </tbody> </table> </div> <div class="sect3"> <h4 id="reactive-health-indicators">
2.8.3. Reactive Health Indicators</h4> <div class="paragraph"> <p>For reactive applications, such as those using Spring WebFlux, <code>ReactiveHealthContributor</code> provides a non-blocking contract for getting application health. Similar to a traditional <code>HealthContributor</code>, health information is collected from the content of a <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthContributorRegistry.java"><code>ReactiveHealthContributorRegistry</code></a> (by default all <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributor.java"><code>HealthContributor</code></a> and <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthContributor.java"><code>ReactiveHealthContributor</code></a> instances defined in your <code>ApplicationContext</code>). Regular <code>HealthContributors</code> that do not check against a reactive API are executed on the elastic scheduler.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> In a reactive application, The <code>ReactiveHealthContributorRegistry</code> should be used to register and unregister health indicators at runtime. If you need to register a regular <code>HealthContributor</code>, you should wrap it using <code>ReactiveHealthContributor#adapt</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>To provide custom health information from a reactive API, you can register Spring beans that implement the <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java"><code>ReactiveHealthIndicator</code></a> interface. The following code shows a sample <code>ReactiveHealthIndicator</code> implementation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Component
public class MyReactiveHealthIndicator implements ReactiveHealthIndicator {

    @Override
    public Mono&lt;Health&gt; health() {
        return doHealthCheck() //perform some specific health check that returns a Mono&lt;Health&gt;
            .onErrorResume(ex -&gt; Mono.just(new Health.Builder().down(ex).build()));
    }

}</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> To handle the error automatically, consider extending from <code>AbstractReactiveHealthIndicator</code>. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="auto-configured-reactivehealthindicators">
2.8.4. Auto-configured ReactiveHealthIndicators</h4> <div class="paragraph"> <p>The following <code>ReactiveHealthIndicators</code> are auto-configured by Spring Boot when appropriate:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 20%;"> <col style="width: 80%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraReactiveHealthIndicator.java"><code>CassandraReactiveHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Cassandra database is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseReactiveHealthIndicator.java"><code>CouchbaseReactiveHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Couchbase cluster is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoReactiveHealthIndicator.java"><code>MongoReactiveHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Mongo database is up.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisReactiveHealthIndicator.java"><code>RedisReactiveHealthIndicator</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that a Redis server is up.</p></td> </tr> </tbody> </table> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If necessary, reactive indicators replace the regular ones. Also, any <code>HealthIndicator</code> that is not handled explicitly is wrapped automatically. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="production-ready-health-groups">
2.8.5. Health Groups</h4> <div class="paragraph"> <p>It’s sometimes useful to organize health indicators into groups that can be used for different purposes.</p> </div> <div class="paragraph"> <p>To create a health indicator group you can use the <code>management.endpoint.health.group.&lt;name&gt;</code> property and specify a list of health indicator IDs to <code>include</code> or <code>exclude</code>. For example, to create a group that includes only database indicators you can define the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.health.group.custom.include=db</code></pre> </div> </div> <div class="paragraph"> <p>You can then check the result by hitting <code><a href="http://localhost:8080/actuator/health/custom" class="bare">localhost:8080/actuator/health/custom</a></code>.</p> </div> <div class="paragraph"> <p>By default groups will inherit the same <code>StatusAggregator</code> and <code>HttpCodeStatusMapper</code> settings as the system health, however, these can also be defined on a per-group basis. It’s also possible to override the <code>show-details</code> and <code>roles</code> properties if required:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.health.group.custom.show-details=when-authorized
management.endpoint.health.group.custom.roles=admin
management.endpoint.health.group.custom.status.order=fatal,up
management.endpoint.health.group.custom.status.http-mapping.fatal=500
management.endpoint.health.group.custom.status.http-mapping.out-of-service=500</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> You can use <code>@Qualifier("groupname")</code> if you need to register custom <code>StatusAggregator</code> or <code>HttpCodeStatusMapper</code> beans for use with the group. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-kubernetes-probes">
2.9. Kubernetes Probes</h3> <div class="paragraph"> <p>Applications deployed on Kubernetes can provide information about their internal state with <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#container-probes">Container Probes</a>. Depending on <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">your Kubernetes configuration</a>, the kubelet will call those probes and react to the result.</p> </div> <div class="paragraph"> <p>Spring Boot manages your <a href="spring-boot-features#boot-features-application-availability">Application Availability State</a> out-of-the-box. If deployed in a Kubernetes environment, actuator will gather the "Liveness" and "Readiness" information from the <code>ApplicationAvailability</code> interface and use that information in dedicated <a href="#production-ready-health-indicators">Health Indicators</a>: <code>LivenessStateHealthIndicator</code> and <code>ReadinessStateHealthIndicator</code>. These indicators will be shown on the global health endpoint (<code>"/actuator/health"</code>). They will also be exposed as separate HTTP Probes using <a href="#production-ready-health-groups">Health Groups</a>: <code>"/actuator/health/liveness"</code> and <code>"/actuator/health/readiness"</code>.</p> </div> <div class="paragraph"> <p>You can then configure your Kubernetes infrastructure with the following endpoint information:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="yml"><code data-lang="yml" class="language-yml hljs">livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: &lt;actuator-port&gt;
  failureThreshold: ...
  periodSeconds: ...

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: &lt;actuator-port&gt;
  failureThreshold: ...
  periodSeconds: ...</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> <code>&lt;actuator-port&gt;</code> should be set to the port that the actuator endpoints are available on. It could be the main web server port, or a separate management port if the <code>"management.server.port"</code> property has been set. </td> </tr> </table> </div> <div class="paragraph"> <p>These health groups are only enabled automatically if the application is <a href="deployment#cloud-deployment-kubernetes">running in a Kubernetes environment</a>. You can enable them in any environment using the <code>management.health.probes.enabled</code> configuration property.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If an application takes longer to start than the configured liveness period, Kubernetes mention the <code>"startupProbe"</code> as a possible solution. The <code>"startupProbe"</code> is not necessarily needed here as the <code>"readinessProbe"</code> fails until all startup tasks are done, see <a href="#production-ready-kubernetes-probes-lifecycle">how Probes behave during the application lifecycle</a>. </td> </tr> </table> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon">  </td> <td class="content"> If your Actuator endpoints are deployed on a separate management context, be aware that endpoints are then not using the same web infrastructure (port, connection pools, framework components) as the main application. In this case, a probe check could be successful even if the main application does not work properly (for example, it cannot accept new connections). </td> </tr> </table> </div> <div class="sect3"> <h4 id="production-ready-kubernetes-probes-external-state">
2.9.1. Checking external state with Kubernetes Probes</h4> <div class="paragraph"> <p>Actuator configures the "liveness" and "readiness" probes as Health Groups; this means that all the <a href="#production-ready-health-groups">Health Groups features</a> are available for them. You can, for example, configure additional Health Indicators:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.health.group.readiness.include=readinessState,customCheck</code></pre> </div> </div> <div class="paragraph"> <p>By default, Spring Boot does not add other Health Indicators to these groups.</p> </div> <div class="paragraph"> <p>The “liveness” Probe should not depend on health checks for external systems. If the <a href="spring-boot-features#boot-features-application-availability-liveness-state">Liveness State of an application</a> is broken, Kubernetes will try to solve that problem by restarting the application instance. This means that if an external system fails (e.g. a database, a Web API, an external cache), Kubernetes might restart all application instances and create cascading failures.</p> </div> <div class="paragraph"> <p>As for the “readiness” Probe, the choice of checking external systems must be made carefully by the application developers, i.e. Spring Boot does not include any additional health checks in the readiness probe. If the <a href="spring-boot-features#boot-features-application-availability-readiness-state">Readiness State of an application instance</a> is unready, Kubernetes will not route traffic to that instance. Some external systems might not be shared by application instances, in which case they could quite naturally be included in a readiness probe. Other external systems might not be essential to the application (the application could have circuit breakers and fallbacks), in which case they definitely should not be included. Unfortunately, an external system that is shared by all application instances is common, and you have to make a judgement call: include it in the readiness probe and expect that the application is taken out of service when the external service is down, or leave it out and deal with failures higher up the stack, e.g. using a circuit breaker in the caller.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> If all instances of an application are unready, a Kubernetes Service with <code>type=ClusterIP</code> or <code>NodePort</code> will not accept any incoming connections. There is no HTTP error response (503 etc.) since there is no connection. A Service with <code>type=LoadBalancer</code> might or might not accept connections, depending on the provider. A Service that has an explicit <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> will also respond in a way that depends on the implementation - the ingress service itself will have to decide how to handle the "connection refused" from downstream. HTTP 503 is quite likely in the case of both load balancer and ingress. </td> </tr> </table> </div> <div class="paragraph"> <p>Also, if an application is using Kubernetes <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">autoscaling</a> it may react differently to applications being taken out of the load-balancer, depending on its autoscaler configuration.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-kubernetes-probes-lifecycle">
2.9.2. Application lifecycle and Probes states</h4> <div class="paragraph"> <p>An important aspect of the Kubernetes Probes support is its consistency with the application lifecycle. Spring Boot publishes <a href="spring-boot-features#boot-features-application-events-and-listeners">Application Events during startup and shutdown</a>.</p> </div> <div class="paragraph"> <p>When a Spring Boot application starts:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 23.0769%;"> <col style="width: 15.3846%;"> <col style="width: 15.3846%;"> <col style="width: 46.1539%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Application startup phase</th> <th class="tableblock halign-left valign-top">Liveness State</th> <th class="tableblock halign-left valign-top">Readiness State</th> <th class="tableblock halign-left valign-top">Notes</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Starting</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>BROKEN</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>REFUSING_TRAFFIC</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes checks the "liveness" Probe and restarts the application if it takes too long.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Started</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CORRECT</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>REFUSING_TRAFFIC</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The application context is refreshed. The application performs startup tasks and does not receive traffic yet.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Ready</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CORRECT</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACCEPTING_TRAFFIC</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Startup tasks are finished. The application is receiving traffic.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>When a Spring Boot application shuts down:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 23.0769%;"> <col style="width: 15.3846%;"> <col style="width: 15.3846%;"> <col style="width: 46.1539%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Application shutdown phase</th> <th class="tableblock halign-left valign-top">Liveness State</th> <th class="tableblock halign-left valign-top">Readiness State</th> <th class="tableblock halign-left valign-top">Notes</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Running</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">live</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ready</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Shutdown has been requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Graceful shutdown</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">live</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">unready</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, <a href="spring-boot-features#boot-features-graceful-shutdown">graceful shutdown processes in-flight requests</a>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Shutdown complete</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">broken</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">unready</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The application context is closed and the application cannot serve traffic.</p></td> </tr> </tbody> </table> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> Check out the <a href="deployment#cloud-deployment-kubernetes-container-lifecycle">Kubernetes container lifecycle section</a> for more information about Kubernetes deployment. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-application-info">
2.10. Application Information</h3> <div class="paragraph"> <p>Application information exposes various information collected from all <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a> beans defined in your <code>ApplicationContext</code>. Spring Boot includes a number of auto-configured <code>InfoContributor</code> beans, and you can write your own.</p> </div> <div class="sect3"> <h4 id="production-ready-application-info-autoconfigure">
2.10.1. Auto-configured InfoContributors</h4> <div class="paragraph"> <p>The following <code>InfoContributor</code> beans are auto-configured by Spring Boot, when appropriate:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 20%;"> <col style="width: 80%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java"><code>EnvironmentInfoContributor</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes any key from the <code>Environment</code> under the <code>info</code> key.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java"><code>GitInfoContributor</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes git information if a <code>git.properties</code> file is available.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java"><code>BuildInfoContributor</code></a></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Exposes build information if a <code>META-INF/build-info.properties</code> file is available.</p></td> </tr> </tbody> </table> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> It is possible to disable them all by setting the <code>management.info.defaults.enabled</code> property. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="production-ready-application-info-env">
2.10.2. Custom Application Information</h4> <div class="paragraph"> <p>You can customize the data exposed by the <code>info</code> endpoint by setting <code>info.*</code> Spring properties. All <code>Environment</code> properties under the <code>info</code> key are automatically exposed. For example, you could add the following settings to your <code>application.properties</code> file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">info.app.encoding=UTF-8
info.app.java.source=1.8
info.app.java.target=1.8</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>Rather than hardcoding those values, you could also <a href="howto#howto-automatic-expansion">expand info properties at build time</a>.</p> </div> <div class="paragraph"> <p>Assuming you use Maven, you could rewrite the preceding example as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">info.app.encoding=@project.build.sourceEncoding@
info.app.java.source=@java.version@
info.app.java.target=@java.version@</code></pre> </div> </div> </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="production-ready-application-info-git">
2.10.3. Git Commit Information</h4> <div class="paragraph"> <p>Another useful feature of the <code>info</code> endpoint is its ability to publish information about the state of your <code>git</code> source code repository when the project was built. If a <code>GitProperties</code> bean is available, the <code>git.branch</code>, <code>git.commit.id</code>, and <code>git.commit.time</code> properties are exposed.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> A <code>GitProperties</code> bean is auto-configured if a <code>git.properties</code> file is available at the root of the classpath. See "<a href="howto#howto-git-info">Generate git information</a>" for more details. </td> </tr> </table> </div> <div class="paragraph"> <p>If you want to display the full git information (that is, the full content of <code>git.properties</code>), use the <code>management.info.git.mode</code> property, as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.info.git.mode=full</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-application-info-build">
2.10.4. Build Information</h4> <div class="paragraph"> <p>If a <code>BuildProperties</code> bean is available, the <code>info</code> endpoint can also publish information about your build. This happens if a <code>META-INF/build-info.properties</code> file is available in the classpath.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The Maven and Gradle plugins can both generate that file. See "<a href="howto#howto-build-info">Generate build information</a>" for more details. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="production-ready-application-info-custom">
2.10.5. Writing Custom InfoContributors</h4> <div class="paragraph"> <p>To provide custom application information, you can register Spring beans that implement the <a href="https://github.com/spring-projects/spring-boot/tree/v2.3.1.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a> interface.</p> </div> <div class="paragraph"> <p>The following example contributes an <code>example</code> entry with a single value:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">import java.util.Collections;

import org.springframework.boot.actuate.info.Info;
import org.springframework.boot.actuate.info.InfoContributor;
import org.springframework.stereotype.Component;

@Component
public class ExampleInfoContributor implements InfoContributor {

    @Override
    public void contribute(Info.Builder builder) {
        builder.withDetail("example",
                Collections.singletonMap("key", "value"));
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>If you reach the <code>info</code> endpoint, you should see a response that contains the following additional entry:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="json"><code data-lang="json" class="language-json hljs">{
    "example": {
        "key" : "value"
    }
}</code></pre> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-monitoring">
3. Monitoring and Management over HTTP</h2> <div class="sectionbody"> <div class="paragraph"> <p>If you are developing a web application, Spring Boot Actuator auto-configures all enabled endpoints to be exposed over HTTP. The default convention is to use the <code>id</code> of the endpoint with a prefix of <code>/actuator</code> as the URL path. For example, <code>health</code> is exposed as <code>/actuator/health</code>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> Actuator is supported natively with Spring MVC, Spring WebFlux, and Jersey. If both Jersey and Spring MVC are available, Spring MVC will be used. </td> </tr> </table> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Jackson is a required dependency in order to get the correct JSON responses as documented in the API documentation (<a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/actuator-api/html">HTML</a> or <a href="https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/actuator-api/pdf/spring-boot-actuator-web-api.pdf">PDF</a>). </td> </tr> </table> </div> <div class="sect2"> <h3 id="production-ready-customizing-management-server-context-path">
3.1. Customizing the Management Endpoint Paths</h3> <div class="paragraph"> <p>Sometimes, it is useful to customize the prefix for the management endpoints. For example, your application might already use <code>/actuator</code> for another purpose. You can use the <code>management.endpoints.web.base-path</code> property to change the prefix for your management endpoint, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.web.base-path=/manage</code></pre> </div> </div> <div class="paragraph"> <p>The preceding <code>application.properties</code> example changes the endpoint from <code>/actuator/{id}</code> to <code>/manage/{id}</code> (for example, <code>/manage/info</code>).</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Unless the management port has been configured to <a href="#production-ready-customizing-management-server-port">expose endpoints by using a different HTTP port</a>, <code>management.endpoints.web.base-path</code> is relative to <code>server.servlet.context-path</code>. If <code>management.server.port</code> is configured, <code>management.endpoints.web.base-path</code> is relative to <code>management.server.servlet.context-path</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>If you want to map endpoints to a different path, you can use the <code>management.endpoints.web.path-mapping</code> property.</p> </div> <div class="paragraph"> <p>The following example remaps <code>/actuator/health</code> to <code>/healthcheck</code>:</p> </div> <div class="listingblock"> <div class="title">application.properties</div> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.web.base-path=/
management.endpoints.web.path-mapping.health=healthcheck</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-customizing-management-server-port">
3.2. Customizing the Management Server Port</h3> <div class="paragraph"> <p>Exposing management endpoints by using the default HTTP port is a sensible choice for cloud-based deployments. If, however, your application runs inside your own data center, you may prefer to expose endpoints by using a different HTTP port.</p> </div> <div class="paragraph"> <p>You can set the <code>management.server.port</code> property to change the HTTP port, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.server.port=8081</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> On Cloud Foundry, applications only receive requests on port 8080 for both HTTP and TCP routing, by default. If you want to use a custom management port on Cloud Foundry, you will need to explicitly set up the application’s routes to forward traffic to the custom port. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="production-ready-management-specific-ssl">
3.3. Configuring Management-specific SSL</h3> <div class="paragraph"> <p>When configured to use a custom port, the management server can also be configured with its own SSL by using the various <code>management.server.ssl.*</code> properties. For example, doing so lets a management server be available over HTTP while the main application uses HTTPS, as shown in the following property settings:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">server.port=8443
server.ssl.enabled=true
server.ssl.key-store=classpath:store.jks
server.ssl.key-password=secret
management.server.port=8080
management.server.ssl.enabled=false</code></pre> </div> </div> <div class="paragraph"> <p>Alternatively, both the main server and the management server can use SSL but with different key stores, as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">server.port=8443
server.ssl.enabled=true
server.ssl.key-store=classpath:main.jks
server.ssl.key-password=secret
management.server.port=8080
management.server.ssl.enabled=true
management.server.ssl.key-store=classpath:management.jks
management.server.ssl.key-password=secret</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-customizing-management-server-address">
3.4. Customizing the Management Server Address</h3> <div class="paragraph"> <p>You can customize the address that the management endpoints are available on by setting the <code>management.server.address</code> property. Doing so can be useful if you want to listen only on an internal or ops-facing network or to listen only for connections from <code>localhost</code>.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> You can listen on a different address only when the port differs from the main server port. </td> </tr> </table> </div> <div class="paragraph"> <p>The following example <code>application.properties</code> does not allow remote management connections:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.server.port=8081
management.server.address=127.0.0.1</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-disabling-http-endpoints">
3.5. Disabling HTTP Endpoints</h3> <div class="paragraph"> <p>If you do not want to expose endpoints over HTTP, you can set the management port to <code>-1</code>, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.server.port=-1</code></pre> </div> </div> <div class="paragraph"> <p>This can be achieved using the <code>management.endpoints.web.exposure.exclude</code> property as well, as shown in following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.web.exposure.exclude=*</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-jmx">
4. Monitoring and Management over JMX</h2> <div class="sectionbody"> <div class="paragraph"> <p>Java Management Extensions (JMX) provide a standard mechanism to monitor and manage applications. By default, this feature is not enabled and can be turned on by setting the configuration property <code>spring.jmx.enabled</code> to <code>true</code>. Spring Boot exposes management endpoints as JMX MBeans under the <code>org.springframework.boot</code> domain by default.</p> </div> <div class="sect2"> <h3 id="production-ready-custom-mbean-names">
4.1. Customizing MBean Names</h3> <div class="paragraph"> <p>The name of the MBean is usually generated from the <code>id</code> of the endpoint. For example, the <code>health</code> endpoint is exposed as <code>org.springframework.boot:type=Endpoint,name=Health</code>.</p> </div> <div class="paragraph"> <p>If your application contains more than one Spring <code>ApplicationContext</code>, you may find that names clash. To solve this problem, you can set the <code>spring.jmx.unique-names</code> property to <code>true</code> so that MBean names are always unique.</p> </div> <div class="paragraph"> <p>You can also customize the JMX domain under which endpoints are exposed. The following settings show an example of doing so in <code>application.properties</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">spring.jmx.unique-names=true
management.endpoints.jmx.domain=com.example.myapp</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-disable-jmx-endpoints">
4.2. Disabling JMX Endpoints</h3> <div class="paragraph"> <p>If you do not want to expose endpoints over JMX, you can set the <code>management.endpoints.jmx.exposure.exclude</code> property to <code>*</code>, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoints.jmx.exposure.exclude=*</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-jolokia">
4.3. Using Jolokia for JMX over HTTP</h3> <div class="paragraph"> <p>Jolokia is a JMX-HTTP bridge that provides an alternative method of accessing JMX beans. To use Jolokia, include a dependency to <code>org.jolokia:jolokia-core</code>. For example, with Maven, you would add the following dependency:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="xml"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;org.jolokia&lt;/groupId&gt;
    &lt;artifactId&gt;jolokia-core&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The Jolokia endpoint can then be exposed by adding <code>jolokia</code> or <code>*</code> to the <code>management.endpoints.web.exposure.include</code> property. You can then access it by using <code>/actuator/jolokia</code> on your management HTTP server.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The Jolokia endpoint exposes Jolokia’s servlet as an actuator endpoint. As a result, it is specific to servlet environments such as Spring MVC and Jersey. The endpoint will not be available in a WebFlux application. </td> </tr> </table> </div> <div class="sect3"> <h4 id="production-ready-customizing-jolokia">
4.3.1. Customizing Jolokia</h4> <div class="paragraph"> <p>Jolokia has a number of settings that you would traditionally configure by setting servlet parameters. With Spring Boot, you can use your <code>application.properties</code> file. To do so, prefix the parameter with <code>management.endpoint.jolokia.config.</code>, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.jolokia.config.debug=true</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-disabling-jolokia">
4.3.2. Disabling Jolokia</h4> <div class="paragraph"> <p>If you use Jolokia but do not want Spring Boot to configure it, set the <code>management.endpoint.jolokia.enabled</code> property to <code>false</code>, as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.endpoint.jolokia.enabled=false</code></pre> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-loggers">
5. Loggers</h2> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot Actuator includes the ability to view and configure the log levels of your application at runtime. You can view either the entire list or an individual logger’s configuration, which is made up of both the explicitly configured logging level as well as the effective logging level given to it by the logging framework. These levels can be one of:</p> </div> <div class="ulist"> <ul> <li> <p><code>TRACE</code></p> </li> <li> <p><code>DEBUG</code></p> </li> <li> <p><code>INFO</code></p> </li> <li> <p><code>WARN</code></p> </li> <li> <p><code>ERROR</code></p> </li> <li> <p><code>FATAL</code></p> </li> <li> <p><code>OFF</code></p> </li> <li> <p><code>null</code></p> </li> </ul> </div> <div class="paragraph"> <p><code>null</code> indicates that there is no explicit configuration.</p> </div> <div class="sect2"> <h3 id="production-ready-logger-configuration">
5.1. Configure a Logger</h3> <div class="paragraph"> <p>To configure a given logger, <code>POST</code> a partial entity to the resource’s URI, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="json"><code data-lang="json" class="language-json hljs">{
    "configuredLevel": "DEBUG"
}</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> To “reset” the specific level of the logger (and use the default configuration instead), you can pass a value of <code>null</code> as the <code>configuredLevel</code>. </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-metrics">
6. Metrics</h2> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot Actuator provides dependency management and auto-configuration for <a href="https://micrometer.io">Micrometer</a>, an application metrics facade that supports <a href="https://micrometer.io/docs">numerous monitoring systems</a>, including:</p> </div> <div class="ulist"> <ul> <li> <p><a href="#production-ready-metrics-export-appoptics">AppOptics</a></p> </li> <li> <p><a href="#production-ready-metrics-export-atlas">Atlas</a></p> </li> <li> <p><a href="#production-ready-metrics-export-datadog">Datadog</a></p> </li> <li> <p><a href="#production-ready-metrics-export-dynatrace">Dynatrace</a></p> </li> <li> <p><a href="#production-ready-metrics-export-elastic">Elastic</a></p> </li> <li> <p><a href="#production-ready-metrics-export-ganglia">Ganglia</a></p> </li> <li> <p><a href="#production-ready-metrics-export-graphite">Graphite</a></p> </li> <li> <p><a href="#production-ready-metrics-export-humio">Humio</a></p> </li> <li> <p><a href="#production-ready-metrics-export-influx">Influx</a></p> </li> <li> <p><a href="#production-ready-metrics-export-jmx">JMX</a></p> </li> <li> <p><a href="#production-ready-metrics-export-kairos">KairosDB</a></p> </li> <li> <p><a href="#production-ready-metrics-export-newrelic">New Relic</a></p> </li> <li> <p><a href="#production-ready-metrics-export-prometheus">Prometheus</a></p> </li> <li> <p><a href="#production-ready-metrics-export-signalfx">SignalFx</a></p> </li> <li> <p><a href="#production-ready-metrics-export-simple">Simple (in-memory)</a></p> </li> <li> <p><a href="#production-ready-metrics-export-stackdriver">Stackdriver</a></p> </li> <li> <p><a href="#production-ready-metrics-export-statsd">StatsD</a></p> </li> <li> <p><a href="#production-ready-metrics-export-wavefront">Wavefront</a></p> </li> </ul> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> To learn more about Micrometer’s capabilities, please refer to its <a href="https://micrometer.io/docs">reference documentation</a>, in particular the <a href="https://micrometer.io/docs/concepts">concepts section</a>. </td> </tr> </table> </div> <div class="sect2"> <h3 id="production-ready-metrics-getting-started">
6.1. Getting started</h3> <div class="paragraph"> <p>Spring Boot auto-configures a composite <code>MeterRegistry</code> and adds a registry to the composite for each of the supported implementations that it finds on the classpath. Having a dependency on <code>micrometer-registry-{system}</code> in your runtime classpath is enough for Spring Boot to configure the registry.</p> </div> <div class="paragraph"> <p>Most registries share common features. For instance, you can disable a particular registry even if the Micrometer registry implementation is on the classpath. For example, to disable Datadog:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.datadog.enabled=false</code></pre> </div> </div> <div class="paragraph"> <p>Spring Boot will also add any auto-configured registries to the global static composite registry on the <code>Metrics</code> class unless you explicitly tell it not to:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.use-global-registry=false</code></pre> </div> </div> <div class="paragraph"> <p>You can register any number of <code>MeterRegistryCustomizer</code> beans to further configure the registry, such as applying common tags, before any meters are registered with the registry:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Bean
MeterRegistryCustomizer&lt;MeterRegistry&gt; metricsCommonTags() {
    return registry -&gt; registry.config().commonTags("region", "us-east-1");
}</code></pre> </div> </div> <div class="paragraph"> <p>You can apply customizations to particular registry implementations by being more specific about the generic type:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Bean
MeterRegistryCustomizer&lt;GraphiteMeterRegistry&gt; graphiteMetricsNamingConvention() {
    return registry -&gt; registry.config().namingConvention(MY_CUSTOM_CONVENTION);
}</code></pre> </div> </div> <div class="paragraph"> <p>With that setup in place you can inject <code>MeterRegistry</code> in your components and register metrics:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Component
public class SampleBean {

    private final Counter counter;

    public SampleBean(MeterRegistry registry) {
        this.counter = registry.counter("received.messages");
    }

    public void handleMessage(String message) {
        this.counter.increment();
        // handle message implementation
    }

}</code></pre> </div> </div> <div class="paragraph"> <p>Spring Boot also <a href="#production-ready-metrics-meter">configures built-in instrumentation</a> (i.e. <code>MeterBinder</code> implementations) that you can control via configuration or dedicated annotation markers.</p> </div> </div> <div class="sect2"> <h3 id="production-ready-metrics-export">
6.2. Supported monitoring systems</h3> <div class="sect3"> <h4 id="production-ready-metrics-export-appoptics">
6.2.1. AppOptics</h4> <div class="paragraph"> <p>By default, the AppOptics registry pushes metrics to <code><a href="https://api.appoptics.com/v1/measurements" class="bare">api.appoptics.com/v1/measurements</a></code> periodically. To export metrics to SaaS <a href="https://micrometer.io/docs/registry/appoptics">AppOptics</a>, your API token must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.appoptics.api-token=YOUR_TOKEN</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-atlas">
6.2.2. Atlas</h4> <div class="paragraph"> <p>By default, metrics are exported to <a href="https://micrometer.io/docs/registry/atlas">Atlas</a> running on your local machine. The location of the <a href="https://github.com/Netflix/atlas">Atlas server</a> to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.atlas.uri=https://atlas.example.com:7101/api/v1/publish</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-datadog">
6.2.3. Datadog</h4> <div class="paragraph"> <p>Datadog registry pushes metrics to <a href="https://www.datadoghq.com">datadoghq</a> periodically. To export metrics to <a href="https://micrometer.io/docs/registry/datadog">Datadog</a>, your API key must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.datadog.api-key=YOUR_KEY</code></pre> </div> </div> <div class="paragraph"> <p>You can also change the interval at which metrics are sent to Datadog:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.datadog.step=30s</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-dynatrace">
6.2.4. Dynatrace</h4> <div class="paragraph"> <p>Dynatrace registry pushes metrics to the configured URI periodically. To export metrics to <a href="https://micrometer.io/docs/registry/dynatrace">Dynatrace</a>, your API token, device ID, and URI must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.dynatrace.api-token=YOUR_TOKEN
management.metrics.export.dynatrace.device-id=YOUR_DEVICE_ID
management.metrics.export.dynatrace.uri=YOUR_URI</code></pre> </div> </div> <div class="paragraph"> <p>You can also change the interval at which metrics are sent to Dynatrace:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.dynatrace.step=30s</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-elastic">
6.2.5. Elastic</h4> <div class="paragraph"> <p>By default, metrics are exported to <a href="https://micrometer.io/docs/registry/elastic">Elastic</a> running on your local machine. The location of the Elastic server to use can be provided using the following property:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.elastic.host=https://elastic.example.com:8086</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-ganglia">
6.2.6. Ganglia</h4> <div class="paragraph"> <p>By default, metrics are exported to <a href="https://micrometer.io/docs/registry/ganglia">Ganglia</a> running on your local machine. The <a href="http://ganglia.sourceforge.net">Ganglia server</a> host and port to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.ganglia.host=ganglia.example.com
management.metrics.export.ganglia.port=9649</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-graphite">
6.2.7. Graphite</h4> <div class="paragraph"> <p>By default, metrics are exported to <a href="https://micrometer.io/docs/registry/graphite">Graphite</a> running on your local machine. The <a href="https://graphiteapp.org">Graphite server</a> host and port to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.graphite.host=graphite.example.com
management.metrics.export.graphite.port=9004</code></pre> </div> </div> <div class="paragraph"> <p>Micrometer provides a default <code>HierarchicalNameMapper</code> that governs how a dimensional meter id is <a href="https://micrometer.io/docs/registry/graphite#_hierarchical_name_mapping">mapped to flat hierarchical names</a>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> To take control over this behaviour, define your <code>GraphiteMeterRegistry</code> and supply your own <code>HierarchicalNameMapper</code>. An auto-configured <code>GraphiteConfig</code> and <code>Clock</code> beans are provided unless you define your own: </td> </tr> </table> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Bean
public GraphiteMeterRegistry graphiteMeterRegistry(GraphiteConfig config, Clock clock) {
    return new GraphiteMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);
}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-humio">
6.2.8. Humio</h4> <div class="paragraph"> <p>By default, the Humio registry pushes metrics to <a href="https://cloud.humio.com" class="bare">cloud.humio.com</a> periodically. To export metrics to SaaS <a href="https://micrometer.io/docs/registry/humio">Humio</a>, your API token must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.humio.api-token=YOUR_TOKEN</code></pre> </div> </div> <div class="paragraph"> <p>You should also configure one or more tags to identify the data source to which metrics will be pushed:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.humio.tags.alpha=a
management.metrics.export.humio.tags.bravo=b</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-influx">
6.2.9. Influx</h4> <div class="paragraph"> <p>By default, metrics are exported to <a href="https://micrometer.io/docs/registry/influx">Influx</a> running on your local machine. The location of the <a href="https://www.influxdata.com">Influx server</a> to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.influx.uri=https://influx.example.com:8086</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-jmx">
6.2.10. JMX</h4> <div class="paragraph"> <p>Micrometer provides a hierarchical mapping to <a href="https://micrometer.io/docs/registry/jmx">JMX</a>, primarily as a cheap and portable way to view metrics locally. By default, metrics are exported to the <code>metrics</code> JMX domain. The domain to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.jmx.domain=com.example.app.metrics</code></pre> </div> </div> <div class="paragraph"> <p>Micrometer provides a default <code>HierarchicalNameMapper</code> that governs how a dimensional meter id is <a href="https://micrometer.io/docs/registry/jmx#_hierarchical_name_mapping">mapped to flat hierarchical names</a>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> To take control over this behaviour, define your <code>JmxMeterRegistry</code> and supply your own <code>HierarchicalNameMapper</code>. An auto-configured <code>JmxConfig</code> and <code>Clock</code> beans are provided unless you define your own: </td> </tr> </table> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Bean
public JmxMeterRegistry jmxMeterRegistry(JmxConfig config, Clock clock) {
    return new JmxMeterRegistry(config, clock, MY_HIERARCHICAL_MAPPER);
}</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-kairos">
6.2.11. KairosDB</h4> <div class="paragraph"> <p>By default, metrics are exported to <a href="https://micrometer.io/docs/registry/kairos">KairosDB</a> running on your local machine. The location of the <a href="https://kairosdb.github.io/">KairosDB server</a> to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.kairos.uri=https://kairosdb.example.com:8080/api/v1/datapoints</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-newrelic">
6.2.12. New Relic</h4> <div class="paragraph"> <p>New Relic registry pushes metrics to <a href="https://micrometer.io/docs/registry/new-relic">New Relic</a> periodically. To export metrics to <a href="https://newrelic.com">New Relic</a>, your API key and account id must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.newrelic.api-key=YOUR_KEY
management.metrics.export.newrelic.account-id=YOUR_ACCOUNT_ID</code></pre> </div> </div> <div class="paragraph"> <p>You can also change the interval at which metrics are sent to New Relic:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.newrelic.step=30s</code></pre> </div> </div> <div class="paragraph"> <p>By default, metrics are published via REST calls but it also possible to use the Java Agent API if you have it on the classpath:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.newrelic.client-provider-type=insights-agent</code></pre> </div> </div> <div class="paragraph"> <p>Finally, you can take full control by defining your own <code>NewRelicClientProvider</code> bean.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-prometheus">
6.2.13. Prometheus</h4> <div class="paragraph"> <p><a href="https://micrometer.io/docs/registry/prometheus">Prometheus</a> expects to scrape or poll individual app instances for metrics. Spring Boot provides an actuator endpoint available at <code>/actuator/prometheus</code> to present a <a href="https://prometheus.io">Prometheus scrape</a> with the appropriate format.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> The endpoint is not available by default and must be exposed, see <a href="#production-ready-endpoints-exposing-endpoints">exposing endpoints</a> for more details. </td> </tr> </table> </div> <div class="paragraph"> <p>Here is an example <code>scrape_config</code> to add to <code>prometheus.yml</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="yaml"><code data-lang="yaml" class="language-yaml hljs">scrape_configs:
  - job_name: 'spring'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['HOST:PORT']</code></pre> </div> </div> <div class="paragraph"> <p>For ephemeral or batch jobs which may not exist long enough to be scraped, <a href="https://github.com/prometheus/pushgateway">Prometheus Pushgateway</a> support can be used to expose their metrics to Prometheus. To enable Prometheus Pushgateway support, add the following dependency to your project:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="xml"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.prometheus&lt;/groupId&gt;
    &lt;artifactId&gt;simpleclient_pushgateway&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>When the Prometheus Pushgateway dependency is present on the classpath, Spring Boot auto-configures a <code>PrometheusPushGatewayManager</code> bean. This manages the pushing of metrics to a Prometheus Pushgateway. The <code>PrometheusPushGatewayManager</code> can be tuned using properties under <code>management.metrics.export.prometheus.pushgateway</code>. For advanced configuration, you can also provide your own <code>PrometheusPushGatewayManager</code> bean.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-signalfx">
6.2.14. SignalFx</h4> <div class="paragraph"> <p>SignalFx registry pushes metrics to <a href="https://micrometer.io/docs/registry/signalfx">SignalFx</a> periodically. To export metrics to <a href="https://www.signalfx.com">SignalFx</a>, your access token must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.signalfx.access-token=YOUR_ACCESS_TOKEN</code></pre> </div> </div> <div class="paragraph"> <p>You can also change the interval at which metrics are sent to SignalFx:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.signalfx.step=30s</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-simple">
6.2.15. Simple</h4> <div class="paragraph"> <p>Micrometer ships with a simple, in-memory backend that is automatically used as a fallback if no other registry is configured. This allows you to see what metrics are collected in the <a href="#production-ready-metrics-endpoint">metrics endpoint</a>.</p> </div> <div class="paragraph"> <p>The in-memory backend disables itself as soon as you’re using any of the other available backend. You can also disable it explicitly:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.simple.enabled=false</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-stackdriver">
6.2.16. Stackdriver</h4> <div class="paragraph"> <p>Stackdriver registry pushes metrics to <a href="https://cloud.google.com/stackdriver/">Stackdriver</a> periodically. To export metrics to SaaS <a href="https://micrometer.io/docs/registry/stackdriver">Stackdriver</a>, your Google Cloud project id must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.stackdriver.project-id=my-project</code></pre> </div> </div> <div class="paragraph"> <p>You can also change the interval at which metrics are sent to Stackdriver:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.stackdriver.step=30s</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-statsd">
6.2.17. StatsD</h4> <div class="paragraph"> <p>The StatsD registry pushes metrics over UDP to a StatsD agent eagerly. By default, metrics are exported to a <a href="https://micrometer.io/docs/registry/statsd">StatsD</a> agent running on your local machine. The StatsD agent host and port to use can be provided using:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.statsd.host=statsd.example.com
management.metrics.export.statsd.port=9125</code></pre> </div> </div> <div class="paragraph"> <p>You can also change the StatsD line protocol to use (default to Datadog):</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.statsd.flavor=etsy</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-export-wavefront">
6.2.18. Wavefront</h4> <div class="paragraph"> <p>Wavefront registry pushes metrics to <a href="https://micrometer.io/docs/registry/wavefront">Wavefront</a> periodically. If you are exporting metrics to <a href="https://www.wavefront.com/">Wavefront</a> directly, your API token must be provided:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.wavefront.api-token=YOUR_API_TOKEN</code></pre> </div> </div> <div class="paragraph"> <p>Alternatively, you may use a Wavefront sidecar or an internal proxy set up in your environment that forwards metrics data to the Wavefront API host:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.wavefront.uri=proxy://localhost:2878</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> If publishing metrics to a Wavefront proxy (as described in <a href="https://docs.wavefront.com/proxies_installing.html">the documentation</a>), the host must be in the <code>proxy://HOST:PORT</code> format. </td> </tr> </table> </div> <div class="paragraph"> <p>You can also change the interval at which metrics are sent to Wavefront:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.export.wavefront.step=30s</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-metrics-meter">
6.3. Supported Metrics</h3> <div class="paragraph"> <p>Spring Boot registers the following core metrics when applicable:</p> </div> <div class="ulist"> <ul> <li> <p>JVM metrics, report utilization of:</p> <div class="ulist"> <ul> <li> <p>Various memory and buffer pools</p> </li> <li> <p>Statistics related to garbage collection</p> </li> <li> <p>Threads utilization</p> </li> <li> <p>Number of classes loaded/unloaded</p> </li> </ul> </div> </li> <li> <p>CPU metrics</p> </li> <li> <p>File descriptor metrics</p> </li> <li> <p>Kafka consumer metrics</p> </li> <li> <p>Log4j2 metrics: record the number of events logged to Log4j2 at each level</p> </li> <li> <p>Logback metrics: record the number of events logged to Logback at each level</p> </li> <li> <p>Uptime metrics: report a gauge for uptime and a fixed gauge representing the application’s absolute start time</p> </li> <li> <p>Tomcat metrics (<code>server.tomcat.mbeanregistry.enabled</code> must be set to <code>true</code> for all Tomcat metrics to be registered)</p> </li> <li> <p><a href="https://docs.spring.io/spring-integration/docs/5.3.1.RELEASE/reference/html/system-management.html#micrometer-integration">Spring Integration</a> metrics</p> </li> </ul> </div> <div class="sect3"> <h4 id="production-ready-metrics-spring-mvc">
6.3.1. Spring MVC Metrics</h4> <div class="paragraph"> <p>Auto-configuration enables the instrumentation of requests handled by Spring MVC. When <code>management.metrics.web.server.request.autotime.enabled</code> is <code>true</code>, this instrumentation occurs for all requests. Alternatively, when set to <code>false</code>, you can enable instrumentation by adding <code>@Timed</code> to a request-handling method:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@RestController
@Timed <b>(1)</b>
public class MyController {

    @GetMapping("/api/people")
    @Timed(extraTags = { "region", "us-east-1" }) <b>(2)</b>
    @Timed(value = "all.people", longTask = true) <b>(3)</b>
    public List&lt;Person&gt; listPeople() { ... }

}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td>
<b>1</b>
</td> <td>A controller class to enable timings on every request handler in the controller.</td> </tr> <tr> <td>
<b>2</b>
</td> <td>A method to enable for an individual endpoint. This is not necessary if you have it on the class, but can be used to further customize the timer for this particular endpoint.</td> </tr> <tr> <td>
<b>3</b>
</td> <td>A method with <code>longTask = true</code> to enable a long task timer for the method. Long task timers require a separate metric name, and can be stacked with a short task timer.</td> </tr> </table> </div> <div class="paragraph"> <p>By default, metrics are generated with the name, <code>http.server.requests</code>. The name can be customized by setting the <code>management.metrics.web.server.request.metric-name</code> property.</p> </div> <div class="paragraph"> <p>By default, Spring MVC-related metrics are tagged with the following information:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Tag</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Simple class name of any exception that was thrown while handling the request.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s method (for example, <code>GET</code> or <code>POST</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s outcome based on the status code of the response. 1xx is <code>INFORMATIONAL</code>, 2xx is <code>SUCCESS</code>, 3xx is <code>REDIRECTION</code>, 4xx <code>CLIENT_ERROR</code>, and 5xx is <code>SERVER_ERROR</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response’s HTTP status code (for example, <code>200</code> or <code>500</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s URI template prior to variable substitution, if possible (for example, <code>/api/person/{id}</code>)</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>To add to the default tags, provide one or more <code>@Bean`s that implement `WebMvcTagsContributor</code>. To replace the default tags, provide a <code>@Bean</code> that implements <code>WebMvcTagsProvider</code>.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-web-flux">
6.3.2. Spring WebFlux Metrics</h4> <div class="paragraph"> <p>Auto-configuration enables the instrumentation of all requests handled by WebFlux controllers and functional handlers.</p> </div> <div class="paragraph"> <p>By default, metrics are generated with the name <code>http.server.requests</code>. You can customize the name by setting the <code>management.metrics.web.server.request.metric-name</code> property.</p> </div> <div class="paragraph"> <p>By default, WebFlux-related metrics are tagged with the following information:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Tag</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Simple class name of any exception that was thrown while handling the request.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s method (for example, <code>GET</code> or <code>POST</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s outcome based on the status code of the response. 1xx is <code>INFORMATIONAL</code>, 2xx is <code>SUCCESS</code>, 3xx is <code>REDIRECTION</code>, 4xx <code>CLIENT_ERROR</code>, and 5xx is <code>SERVER_ERROR</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response’s HTTP status code (for example, <code>200</code> or <code>500</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s URI template prior to variable substitution, if possible (for example, <code>/api/person/{id}</code>)</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>To add to the default tags, provide one or more <code>@Bean`s that implement `WebFluxTagsContributor</code>. To replace the default tags, provide a <code>@Bean</code> that implements <code>WebFluxTagsProvider</code>.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-jersey-server">
6.3.3. Jersey Server Metrics</h4> <div class="paragraph"> <p>When Micrometer’s <code>micrometer-jersey2</code> module is on the classpath, auto-configuration enables the instrumentation of requests handled by the Jersey JAX-RS implementation. When <code>management.metrics.web.server.request.autotime.enabled</code> is <code>true</code>, this instrumentation occurs for all requests. Alternatively, when set to <code>false</code>, you can enable instrumentation by adding <code>@Timed</code> to a request-handling method:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Component
@Path("/api/people")
@Timed <b>(1)</b>
public class Endpoint {
    @GET
    @Timed(extraTags = { "region", "us-east-1" }) <b>(2)</b>
    @Timed(value = "all.people", longTask = true) <b>(3)</b>
    public List&lt;Person&gt; listPeople() { ... }
}</code></pre> </div> </div> <div class="colist arabic"> <table> <tr> <td>
<b>1</b>
</td> <td>On a resource class to enable timings on every request handler in the resource.</td> </tr> <tr> <td>
<b>2</b>
</td> <td>On a method to enable for an individual endpoint. This is not necessary if you have it on the class, but can be used to further customize the timer for this particular endpoint.</td> </tr> <tr> <td>
<b>3</b>
</td> <td>On a method with <code>longTask = true</code> to enable a long task timer for the method. Long task timers require a separate metric name, and can be stacked with a short task timer.</td> </tr> </table> </div> <div class="paragraph"> <p>By default, metrics are generated with the name, <code>http.server.requests</code>. The name can be customized by setting the <code>management.metrics.web.server.request.metric-name</code> property.</p> </div> <div class="paragraph"> <p>By default, Jersey server metrics are tagged with the following information:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Tag</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Simple class name of any exception that was thrown while handling the request.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s method (for example, <code>GET</code> or <code>POST</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s outcome based on the status code of the response. 1xx is <code>INFORMATIONAL</code>, 2xx is <code>SUCCESS</code>, 3xx is <code>REDIRECTION</code>, 4xx <code>CLIENT_ERROR</code>, and 5xx is <code>SERVER_ERROR</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response’s HTTP status code (for example, <code>200</code> or <code>500</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s URI template prior to variable substitution, if possible (for example, <code>/api/person/{id}</code>)</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>To customize the tags, provide a <code>@Bean</code> that implements <code>JerseyTagsProvider</code>.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-http-clients">
6.3.4. HTTP Client Metrics</h4> <div class="paragraph"> <p>Spring Boot Actuator manages the instrumentation of both <code>RestTemplate</code> and <code>WebClient</code>. For that, you have to get injected with an auto-configured builder and use it to create instances:</p> </div> <div class="ulist"> <ul> <li> <p><code>RestTemplateBuilder</code> for <code>RestTemplate</code></p> </li> <li> <p><code>WebClient.Builder</code> for <code>WebClient</code></p> </li> </ul> </div> <div class="paragraph"> <p>It is also possible to apply manually the customizers responsible for this instrumentation, namely <code>MetricsRestTemplateCustomizer</code> and <code>MetricsWebClientCustomizer</code>.</p> </div> <div class="paragraph"> <p>By default, metrics are generated with the name, <code>http.client.requests</code>. The name can be customized by setting the <code>management.metrics.web.client.request.metric-name</code> property.</p> </div> <div class="paragraph"> <p>By default, metrics generated by an instrumented client are tagged with the following information:</p> </div> <table class="tableblock frame-all grid-all stretch"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Tag</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientName</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Host portion of the URI</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s method (for example, <code>GET</code> or <code>POST</code>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>outcome</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s outcome based on the status code of the response. 1xx is <code>INFORMATIONAL</code>, 2xx is <code>SUCCESS</code>, 3xx is <code>REDIRECTION</code>, 4xx <code>CLIENT_ERROR</code>, and 5xx is <code>SERVER_ERROR</code>, <code>UNKNOWN</code> otherwise</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response’s HTTP status code if available (for example, <code>200</code> or <code>500</code>), or <code>IO_ERROR</code> in case of I/O issues, <code>CLIENT_ERROR</code> otherwise</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request’s URI template prior to variable substitution, if possible (for example, <code>/api/person/{id}</code>)</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>To customize the tags, and depending on your choice of client, you can provide a <code>@Bean</code> that implements <code>RestTemplateExchangeTagsProvider</code> or <code>WebClientExchangeTagsProvider</code>. There are convenience static functions in <code>RestTemplateExchangeTags</code> and <code>WebClientExchangeTags</code>.</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-cache">
6.3.5. Cache Metrics</h4> <div class="paragraph"> <p>Auto-configuration enables the instrumentation of all available <code>Cache</code>s on startup with metrics prefixed with <code>cache</code>. Cache instrumentation is standardized for a basic set of metrics. Additional, cache-specific metrics are also available.</p> </div> <div class="paragraph"> <p>The following cache libraries are supported:</p> </div> <div class="ulist"> <ul> <li> <p>Caffeine</p> </li> <li> <p>EhCache 2</p> </li> <li> <p>Hazelcast</p> </li> <li> <p>Any compliant JCache (JSR-107) implementation</p> </li> </ul> </div> <div class="paragraph"> <p>Metrics are tagged by the name of the cache and by the name of the <code>CacheManager</code> that is derived from the bean name.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> Only caches that are configured on startup are bound to the registry. For caches not defined in the cache’s configuration, e.g. caches created on-the-fly or programmatically after the startup phase, an explicit registration is required. A <code>CacheMetricsRegistrar</code> bean is made available to make that process easier. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-jdbc">
6.3.6. DataSource Metrics</h4> <div class="paragraph"> <p>Auto-configuration enables the instrumentation of all available <code>DataSource</code> objects with metrics prefixed with <code>jdbc.connections</code>. Data source instrumentation results in gauges representing the currently active, idle, maximum allowed, and minimum allowed connections in the pool.</p> </div> <div class="paragraph"> <p>Metrics are also tagged by the name of the <code>DataSource</code> computed based on the bean name.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> By default, Spring Boot provides metadata for all supported data sources; you can add additional <code>DataSourcePoolMetadataProvider</code> beans if your favorite data source isn’t supported out of the box. See <code>DataSourcePoolMetadataProvidersConfiguration</code> for examples. </td> </tr> </table> </div> <div class="paragraph"> <p>Also, Hikari-specific metrics are exposed with a <code>hikaricp</code> prefix. Each metric is tagged by the name of the Pool (can be controlled with <code>spring.datasource.name</code>).</p> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-hibernate">
6.3.7. Hibernate Metrics</h4> <div class="paragraph"> <p>Auto-configuration enables the instrumentation of all available Hibernate <code>EntityManagerFactory</code> instances that have statistics enabled with a metric named <code>hibernate</code>.</p> </div> <div class="paragraph"> <p>Metrics are also tagged by the name of the <code>EntityManagerFactory</code> that is derived from the bean name.</p> </div> <div class="paragraph"> <p>To enable statistics, the standard JPA property <code>hibernate.generate_statistics</code> must be set to <code>true</code>. You can enable that on the auto-configured <code>EntityManagerFactory</code> as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">spring.jpa.properties.hibernate.generate_statistics=true</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-rabbitmq">
6.3.8. RabbitMQ Metrics</h4> <div class="paragraph"> <p>Auto-configuration will enable the instrumentation of all available RabbitMQ connection factories with a metric named <code>rabbitmq</code>.</p> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-metrics-custom">
6.4. Registering custom metrics</h3> <div class="paragraph"> <p>To register custom metrics, inject <code>MeterRegistry</code> into your component, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">class Dictionary {

    private final List&lt;String&gt; words = new CopyOnWriteArrayList&lt;&gt;();

    Dictionary(MeterRegistry registry) {
        registry.gaugeCollectionSize("dictionary.size", Tags.empty(), this.words);
    }

    // …

}</code></pre> </div> </div> <div class="paragraph"> <p>If you find that you repeatedly instrument a suite of metrics across components or applications, you may encapsulate this suite in a <code>MeterBinder</code> implementation. By default, metrics from all <code>MeterBinder</code> beans will be automatically bound to the Spring-managed <code>MeterRegistry</code>.</p> </div> </div> <div class="sect2"> <h3 id="production-ready-metrics-per-meter-properties">
6.5. Customizing individual metrics</h3> <div class="paragraph"> <p>If you need to apply customizations to specific <code>Meter</code> instances you can use the <code>io.micrometer.core.instrument.config.MeterFilter</code> interface. By default, all <code>MeterFilter</code> beans will be automatically applied to the micrometer <code>MeterRegistry.Config</code>.</p> </div> <div class="paragraph"> <p>For example, if you want to rename the <code>mytag.region</code> tag to <code>mytag.area</code> for all meter IDs beginning with <code>com.example</code>, you can do the following:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Bean
public MeterFilter renameRegionTagMeterFilter() {
    return MeterFilter.renameTag("com.example", "mytag.region", "mytag.area");
}</code></pre> </div> </div> <div class="sect3"> <h4 id="production-ready-metrics-common-tags">
6.5.1. Common tags</h4> <div class="paragraph"> <p>Common tags are generally used for dimensional drill-down on the operating environment like host, instance, region, stack, etc. Commons tags are applied to all meters and can be configured as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.tags.region=us-east-1
management.metrics.tags.stack=prod</code></pre> </div> </div> <div class="paragraph"> <p>The example above adds <code>region</code> and <code>stack</code> tags to all meters with a value of <code>us-east-1</code> and <code>prod</code> respectively.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The order of common tags is important if you are using Graphite. As the order of common tags cannot be guaranteed using this approach, Graphite users are advised to define a custom <code>MeterFilter</code> instead. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="per-meter-properties">
6.5.2. Per-meter properties</h4> <div class="paragraph"> <p>In addition to <code>MeterFilter</code> beans, it’s also possible to apply a limited set of customization on a per-meter basis using properties. Per-meter customizations apply to any all meter IDs that start with the given name. For example, the following will disable any meters that have an ID starting with <code>example.remote</code></p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.metrics.enable.example.remote=false</code></pre> </div> </div> <div class="paragraph"> <p>The following properties allow per-meter customization:</p> </div> <table class="tableblock frame-all grid-all stretch"> <caption class="title">Table 1. Per-meter customizations</caption> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.enable</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to deny meters from emitting any metrics.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.percentiles-histogram</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Whether to publish a histogram suitable for computing aggregable (across dimension) percentile approximations.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.minimum-expected-value</code>, <code>management.metrics.distribution.maximum-expected-value</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Publish less histogram buckets by clamping the range of expected values.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.percentiles</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Publish percentile values computed in your application</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>management.metrics.distribution.slo</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Publish a cumulative histogram with buckets defined by your service-level objectives.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>For more details on concepts behind <code>percentiles-histogram</code>, <code>percentiles</code> and <code>sla</code> refer to the <a href="https://micrometer.io/docs/concepts#_histograms_and_percentiles">"Histograms and percentiles" section</a> of the micrometer documentation.</p> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-metrics-endpoint">
6.6. Metrics endpoint</h3> <div class="paragraph"> <p>Spring Boot provides a <code>metrics</code> endpoint that can be used diagnostically to examine the metrics collected by an application. The endpoint is not available by default and must be exposed, see <a href="#production-ready-endpoints-exposing-endpoints">exposing endpoints</a> for more details.</p> </div> <div class="paragraph"> <p>Navigating to <code>/actuator/metrics</code> displays a list of available meter names. You can drill down to view information about a particular meter by providing its name as a selector, e.g. <code>/actuator/metrics/jvm.memory.max</code>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>The name you use here should match the name used in the code, not the name after it has been naming-convention normalized for a monitoring system it is shipped to. In other words, if <code>jvm.memory.max</code> appears as <code>jvm_memory_max</code> in Prometheus because of its snake case naming convention, you should still use <code>jvm.memory.max</code> as the selector when inspecting the meter in the <code>metrics</code> endpoint.</p> </div> </td> </tr> </table> </div> <div class="paragraph"> <p>You can also add any number of <code>tag=KEY:VALUE</code> query parameters to the end of the URL to dimensionally drill down on a meter, e.g. <code>/actuator/metrics/jvm.memory.max?tag=area:nonheap</code>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon">  </td> <td class="content"> <div class="paragraph"> <p>The reported measurements are the <em>sum</em> of the statistics of all meters matching the meter name and any tags that have been applied. So in the example above, the returned "Value" statistic is the sum of the maximum memory footprints of "Code Cache", "Compressed Class Space", and "Metaspace" areas of the heap. If you just wanted to see the maximum size for the "Metaspace", you could add an additional <code>tag=id:Metaspace</code>, i.e. <code>/actuator/metrics/jvm.memory.max?tag=area:nonheap&amp;tag=id:Metaspace</code>.</p> </div> </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-auditing">
7. Auditing</h2> <div class="sectionbody"> <div class="paragraph"> <p>Once Spring Security is in play, Spring Boot Actuator has a flexible audit framework that publishes events (by default, “authentication success”, “failure” and “access denied” exceptions). This feature can be very useful for reporting and for implementing a lock-out policy based on authentication failures.</p> </div> <div class="paragraph"> <p>Auditing can be enabled by providing a bean of type <code>AuditEventRepository</code> in your application’s configuration. For convenience, Spring Boot offers an <code>InMemoryAuditEventRepository</code>. <code>InMemoryAuditEventRepository</code> has limited capabilities and we recommend using it only for development environments. For production environments, consider creating your own alternative <code>AuditEventRepository</code> implementation.</p> </div> <div class="sect2"> <h3 id="production-ready-auditing-custom">
7.1. Custom Auditing</h3> <div class="paragraph"> <p>To customize published security events, you can provide your own implementations of <code>AbstractAuthenticationAuditListener</code> and <code>AbstractAuthorizationAuditListener</code>.</p> </div> <div class="paragraph"> <p>You can also use the audit services for your own business events. To do so, either inject the <code>AuditEventRepository</code> bean into your own components and use that directly or publish an <code>AuditApplicationEvent</code> with the Spring <code>ApplicationEventPublisher</code> (by implementing <code>ApplicationEventPublisherAware</code>).</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-http-tracing">
8. HTTP Tracing</h2> <div class="sectionbody"> <div class="paragraph"> <p>HTTP Tracing can be enabled by providing a bean of type <code>HttpTraceRepository</code> in your application’s configuration. For convenience, Spring Boot offers an <code>InMemoryHttpTraceRepository</code> that stores traces for the last 100 request-response exchanges, by default. <code>InMemoryHttpTraceRepository</code> is limited compared to other tracing solutions and we recommend using it only for development environments. For production environments, use of a production-ready tracing or observability solution, such as Zipkin or Spring Cloud Sleuth, is recommended. Alternatively, create your own <code>HttpTraceRepository</code> that meets your needs.</p> </div> <div class="paragraph"> <p>The <code>httptrace</code> endpoint can be used to obtain information about the request-response exchanges that are stored in the <code>HttpTraceRepository</code>.</p> </div> <div class="sect2"> <h3 id="production-ready-http-tracing-custom">
8.1. Custom HTTP tracing</h3> <div class="paragraph"> <p>To customize the items that are included in each trace, use the <code>management.trace.http.include</code> configuration property. For advanced customization, consider registering your own <code>HttpExchangeTracer</code> implementation.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-process-monitoring">
9. Process Monitoring</h2> <div class="sectionbody"> <div class="paragraph"> <p>In the <code>spring-boot</code> module, you can find two classes to create files that are often useful for process monitoring:</p> </div> <div class="ulist"> <ul> <li> <p><code>ApplicationPidFileWriter</code> creates a file containing the application PID (by default, in the application directory with a file name of <code>application.pid</code>).</p> </li> <li> <p><code>WebServerPortFileWriter</code> creates a file (or files) containing the ports of the running web server (by default, in the application directory with a file name of <code>application.port</code>).</p> </li> </ul> </div> <div class="paragraph"> <p>By default, these writers are not activated, but you can enable:</p> </div> <div class="ulist"> <ul> <li> <p><a href="#production-ready-process-monitoring-configuration">By Extending Configuration</a></p> </li> <li> <p><a href="#production-ready-process-monitoring-programmatically">Programmatically</a></p> </li> </ul> </div> <div class="sect2"> <h3 id="production-ready-process-monitoring-configuration">
9.1. Extending Configuration</h3> <div class="paragraph"> <p>In the <code>META-INF/spring.factories</code> file, you can activate the listener(s) that writes a PID file, as shown in the following example:</p> </div> <div class="listingblock"> <div class="content"> <pre data-language="">org.springframework.context.ApplicationListener=\
org.springframework.boot.context.ApplicationPidFileWriter,\
org.springframework.boot.web.context.WebServerPortFileWriter</pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-process-monitoring-programmatically">
9.2. Programmatically</h3> <div class="paragraph"> <p>You can also activate a listener by invoking the <code>SpringApplication.addListeners(…​)</code> method and passing the appropriate <code>Writer</code> object. This method also lets you customize the file name and path in the <code>Writer</code> constructor.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-cloudfoundry">
10. Cloud Foundry Support</h2> <div class="sectionbody"> <div class="paragraph"> <p>Spring Boot’s actuator module includes additional support that is activated when you deploy to a compatible Cloud Foundry instance. The <code>/cloudfoundryapplication</code> path provides an alternative secured route to all <code>@Endpoint</code> beans.</p> </div> <div class="paragraph"> <p>The extended support lets Cloud Foundry management UIs (such as the web application that you can use to view deployed applications) be augmented with Spring Boot actuator information. For example, an application status page may include full health information instead of the typical “running” or “stopped” status.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon">  </td> <td class="content"> The <code>/cloudfoundryapplication</code> path is not directly accessible to regular users. In order to use the endpoint, a valid UAA token must be passed with the request. </td> </tr> </table> </div> <div class="sect2"> <h3 id="production-ready-cloudfoundry-disable">
10.1. Disabling Extended Cloud Foundry Actuator Support</h3> <div class="paragraph"> <p>If you want to fully disable the <code>/cloudfoundryapplication</code> endpoints, you can add the following setting to your <code>application.properties</code> file:</p> </div> <div class="listingblock"> <div class="title">application.properties</div> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.cloudfoundry.enabled=false</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="production-ready-cloudfoundry-ssl">
10.2. Cloud Foundry Self-signed Certificates</h3> <div class="paragraph"> <p>By default, the security verification for <code>/cloudfoundryapplication</code> endpoints makes SSL calls to various Cloud Foundry services. If your Cloud Foundry UAA or Cloud Controller services use self-signed certificates, you need to set the following property:</p> </div> <div class="listingblock"> <div class="title">application.properties</div> <div class="content"> <pre class="highlightjs highlight" data-language="properties"><code data-lang="properties" class="language-properties hljs">management.cloudfoundry.skip-ssl-validation=true</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="custom-context-path">
10.3. Custom context path</h3> <div class="paragraph"> <p>If the server’s context-path has been configured to anything other than <code>/</code>, the Cloud Foundry endpoints will not be available at the root of the application. For example, if <code>server.servlet.context-path=/app</code>, Cloud Foundry endpoints will be available at <code>/app/cloudfoundryapplication/*</code>.</p> </div> <div class="paragraph"> <p>If you expect the Cloud Foundry endpoints to always be available at <code>/cloudfoundryapplication/*</code>, regardless of the server’s context-path, you will need to explicitly configure that in your application. The configuration will differ depending on the web server in use. For Tomcat, the following configuration can be added:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight" data-language="java"><code data-lang="java" class="language-java hljs">@Bean
public TomcatServletWebServerFactory servletWebServerFactory() {
    return new TomcatServletWebServerFactory() {

        @Override
        protected void prepareContext(Host host, ServletContextInitializer[] initializers) {
            super.prepareContext(host, initializers);
            StandardContext child = new StandardContext();
            child.addLifecycleListener(new Tomcat.FixContextListener());
            child.setPath("/cloudfoundryapplication");
            ServletContainerInitializer initializer = getServletContextInitializer(getContextPath());
            child.addServletContainerInitializer(initializer, Collections.emptySet());
            child.setCrossContext(true);
            host.addChild(child);
        }

    };
}

private ServletContainerInitializer getServletContextInitializer(String contextPath) {
    return (c, context) -&gt; {
        Servlet servlet = new GenericServlet() {

            @Override
            public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException {
                ServletContext context = req.getServletContext().getContext(contextPath);
                context.getRequestDispatcher("/cloudfoundryapplication").forward(req, res);
            }

        };
        context.addServlet("cloudfoundry", servlet).addMapping("/*");
    };
}</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="production-ready-whats-next">
11. What to Read Next</h2> <div class="sectionbody"> <div class="paragraph"> <p>You might want to read about graphing tools such as <a href="https://graphiteapp.org">Graphite</a>.</p> </div> <div class="paragraph"> <p>Otherwise, you can continue on, to read about <a href="deployment#deployment">‘deployment options’</a> or jump ahead for some in-depth information about Spring Boot’s <em><a href="build-tool-plugins#build-tool-plugins">build tool plugins</a></em>.</p> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2020-06-11 22:57:02 UTC </div> </div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html" class="_attribution-link" target="_blank">https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html</a>
  </p>
</div>
