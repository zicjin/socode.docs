
<h1 id="disallow-use-of-optional-chaining-in-contexts-where-the-undefined-value-is-not-allowed-no-unsafe-optional-chaining">disallow use of optional chaining in contexts where the <code>undefined</code> value is not allowed (no-unsafe-optional-chaining)</h1>
<p>The optional chaining (<code>?.</code>) expression can short-circuit with a return value of <code>undefined</code>. Therefore, treating an evaluated optional chaining expression as a function, object, number, etc., can cause TypeError or unexpected results. For example:</p>
<pre data-language="js">var obj = undefined;

1 in obj?.foo;  // TypeError
with (obj?.foo);  // TypeError
for (bar of obj?.foo);  // TypeError
bar instanceof obj?.foo;  // TypeError
const { bar } = obj?.foo;  // TypeError</pre>
<p>Also, parentheses limit the scope of short-circuiting in chains. For example:</p>
<pre data-language="js">var obj = undefined;

(obj?.foo)(); // TypeError
(obj?.foo).bar; // TypeError</pre>
<h2 id="rule-details">Rule Details</h2>
<p>This rule aims to detect some cases where the use of optional chaining doesn't prevent runtime errors. In particular, it flags optional chaining expressions in positions where short-circuiting to <code>undefined</code> causes throwing a TypeError afterward.</p>
<p>Examples of <strong>incorrect</strong> code for this rule:</p>
<pre data-language="js">/*eslint no-unsafe-optional-chaining: "error"*/

(obj?.foo)();

(obj?.foo).bar;

(foo?.()).bar;

(foo?.()).bar();

(obj?.foo ?? obj?.bar)();

(foo || obj?.foo)();

(obj?.foo &amp;&amp; foo)();

(foo ? obj?.foo : bar)();

(foo, obj?.bar).baz;

(obj?.foo)`template`;

new (obj?.foo)();

[...obj?.foo];

bar(...obj?.foo);

1 in obj?.foo;

bar instanceof obj?.foo;

for (bar of obj?.foo);

const { bar } = obj?.foo;

[{ bar } = obj?.foo] = [];

with (obj?.foo);

class A extends obj?.foo {}

var a = class A extends obj?.foo {};

async function foo () {
    const { bar } = await obj?.foo;
   (await obj?.foo)();
   (await obj?.foo).bar;
}</pre>
<p>Examples of <strong>correct</strong> code for this rule:</p>
<pre data-language="js">/*eslint no-unsafe-optional-chaining: "error"*/

(obj?.foo)?.();

obj?.foo();

(obj?.foo ?? bar)();

obj?.foo.bar;

obj.foo?.bar;

foo?.()?.bar;

(obj?.foo ?? bar)`template`;

new (obj?.foo ?? bar)();

var baz = {...obj?.foo};

const { bar } = obj?.foo || baz;

async function foo () {
  const { bar } = await obj?.foo || baz;
   (await obj?.foo)?.();
   (await obj?.foo)?.bar;
}</pre>
<h2 id="options">Options</h2>
<p>This rule has an object option:</p>
<ul><li>
<code>disallowArithmeticOperators</code>: Disallow arithmetic operations on optional chaining expressions (Default <code>false</code>). If this is <code>true</code>, this rule warns arithmetic operations on optional chaining expressions, which possibly result in <code>NaN</code>.</li></ul>
<h3 id="disallowarithmeticoperators">disallowArithmeticOperators</h3>
<p>With this option set to <code>true</code> the rule is enforced for:</p>
<ul>
<li>Unary operators: <code>-</code>, <code>+</code>
</li>
<li>Arithmetic operators: <code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>, <code>%</code>, <code>**</code>
</li>
<li>Assignment operators: <code>+=</code>, <code>-=</code>, <code>/=</code>, <code>*=</code>, <code>%=</code>, <code>**=</code>
</li>
</ul>
<p>Examples of additional <strong>incorrect</strong> code for this rule with the <code>{ "disallowArithmeticOperators": true }</code> option:</p>
<pre data-language="js">/*eslint no-unsafe-optional-chaining: ["error", { "disallowArithmeticOperators": true }]*/

+obj?.foo;
-obj?.foo;

obj?.foo + bar;
obj?.foo - bar;
obj?.foo / bar;
obj?.foo * bar;
obj?.foo % bar;
obj?.foo ** bar;

baz += obj?.foo;
baz -= obj?.foo;
baz /= obj?.foo;
baz *= obj?.foo;
baz %= obj?.foo;
baz **= obj?.foo;

async function foo () {
  +await obj?.foo;
  await obj?.foo + bar;
  baz += await obj?.foo;
}</pre>
<h2 id="version">Version</h2>
<p>This rule was introduced in ESLint 7.15.0.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://github.com/eslint/eslint/tree/master/lib/rules/no-unsafe-optional-chaining.js">Rule source</a></li>
<li><a href="https://github.com/eslint/eslint/tree/master/docs/rules/no-unsafe-optional-chaining.md">Documentation source</a></li>
</ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://eslint.org/docs/rules/no-unsafe-optional-chaining" class="_attribution-link" target="_blank">https://eslint.org/docs/rules/no-unsafe-optional-chaining</a>
  </p>
</div>
