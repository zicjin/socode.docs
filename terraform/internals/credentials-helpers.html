 <h1 id="credentials-helpers">  Credentials Helpers </h1> <p>For Terraform-specific features that interact with remote network services, such as <a href="../registry/index">module registries</a> and <a href="../cloud/run/cli">remote operations</a>, Terraform by default looks for API credentials to use in these calls in <a href="../cli/config/config-file">the CLI configuration</a>.</p> <p>Credentials helpers offer an alternative approach that allows you to customize how Terraform obtains credentials using an external program, which can then directly access an existing secrets management system in your organization.</p> <p>This page is about how to write and install a credentials helper. To learn how to configure a credentials helper that was already installed, see <a href="../cli/config/config-file#credentials-helpers">the CLI config Credentials Helpers section</a>.</p> <h2 id="how-terraform-finds-credentials-helpers">  How Terraform finds Credentials Helpers </h2> <p>A credentials helper is a normal executable program that is installed in a particular location and whose name follows a specific naming convention.</p> <p>A credentials helper called "credstore", for example, would be implemented as an executable program named <code>terraform-credentials-credstore</code> (with an <code>.exe</code> extension on Windows only), and installed in one of the <a href="../extend/how-terraform-works#plugin-locations">default plugin search locations</a>.</p> <h2 id="how-terraform-runs-credentials-helpers">  How Terraform runs Credentials Helpers </h2> <p>Once Terraform has located the configured credentials helper, it will execute it once for each credentials request that cannot be satisfied by a <code>credentials</code> block in the CLI configuration.</p> <p>For the following examples, we'll assume a "credstore" credentials helper configured as follows:</p> <pre>credentials_helper "credstore" {
  args = ["--host=credstore.example.com"]
}
</pre>
<p>Terraform runs the helper program with each of the arguments given in <code>args</code>, followed by an <em>verb</em> and then the hostname that the verb will apply to. The current set of verbs are:</p> <ul> <li>
<a href="#get"><code>get</code></a>: retrieve the credentials for the given hostname </li> <li>
<a href="#store"><code>store</code></a>: store new credentials for the given hostname </li> <li>
<a href="#forget"><code>forget</code></a>: delete any stored credentials for the given hostname </li> </ul> <p>To represent credentials, the credentials helper protocol uses a JSON object whose contents correspond with the contents of <a href="../cli/config/config-file#credentials"><code>credentials</code> blocks in the CLI configuration</a>. To represent an API token, the object contains a property called "token" whose value is the token string:</p> <pre data-language="json">{
  "token": "example-token-value"
}
</pre>
<p>The following sections describe the specific expected behaviors for each of the three verbs.</p> <h2 id="get-retrieve-the-credentials-for-the-given-hostname">  <code>get</code>: retrieve the credentials for the given hostname </h2> <p>To retrieve credentials for <code>app.terraform.io</code>, Terraform would run the "credstore" helper as follows:</p> <pre>terraform-credentials-credstore --host=credstore.example.com get app.terraform.io
</pre>
<p>If the credentials helper is able to provide credentials for the given host then it must print a JSON credentials object to its stdout stream and then exit with status code zero to indicate success.</p> <p>If the credentials helper definitively has no credentials for the given host, then it must print an empty JSON object to stdout and exit with status zero.</p> <p>If the credentials helper is unable to provide the requested credentials for any other reason, it must print an end-user-oriented plain text error message to its stderr stream and then exit with a <em>non-zero</em> status code.</p> <h2 id="store-store-new-credentials-for-the-given-hostname">  <code>store</code>: store new credentials for the given hostname </h2> <p>To store new credentials for <code>app.terraform.io</code>, Terraform would run the "credstore" helper as follows:</p> <pre>terraform-credentials-credstore --host=credstore.example.com store app.terraform.io
</pre>
<p>Terraform then writes a JSON credentials object to the helper program's stdin stream. If the helper is able to store the given credentials then it must do so and then exit with status code zero and no output on stdout or stderr to indicate success.</p> <p>If it is unable to store the given credentials for any reason, it <em>must</em> still fully read its stdin until EOF and then print an end-user-oriented plain text error message to its stderr stream before exiting with a non-zero status code.</p> <p>The new credentials must fully replace any existing credentials stored for the given hostname.</p> <h2 id="forget-delete-any-stored-credentials-for-the-given-hostname">  <code>forget</code>: delete any stored credentials for the given hostname </h2> <p>To forget any existing credentials for <code>app.terraform.io</code>, Terraform would run the "credstore" helper as follows:</p> <pre>terraform-credentials-credstore --host=credstore.example.com forget app.terraform.io
</pre>
<p>No JSON credentials objects are used for the <code>forget</code> verb.</p> <p>If the helper program is able to delete its stored credentials for the given hostname or if there are no such credentials stored already then it must exist with status code zero and produce no output on stdout or stderr.</p> <p>If it is unable to forget the stored credentials for any reason, particularly if the helper cannot be sure that the credentials are no longer available for retrieval, the helper program must print an end-user-oriented plain text error message to its stderr stream and then exit with a non-zero status code.</p> <h2 id="handling-other-commands">  Handling Other Commands </h2> <p>The credentials helper protocol may be extended with additional verbs in future, so for forward-compatibility a credentials helper must react to any unsupported verb by printing an end-user-oriented plain text error message to its stderr stream and then exiting with a non-zero status code.</p> <h2 id="handling-unsupported-credentials-object-properties">  Handling Unsupported Credentials Object Properties </h2> <p>Currently Terraform defines only the <code>token</code> property within JSON credentials objects, but this format might be extended in future.</p> <p>If a credentials helper is asked to store an object that has any properties other than <code>token</code> and if it is not able to faithfully retain them then it must behave as if the object is unstorable, returning an error. It must <em>not</em> store the <code>token</code> value in isolation and silently drop other properties, as that might change the meaning of the credentials object.</p> <p>If technically possible within the constraints of the target system, a credentials helper should prefer to store the whole JSON object as-is for later retrieval. For systems that are more constrained, it's acceptable to store only the <code>token</code> string so long as the program rejects objects containing other properties as described above.</p> <h2 id="installing-a-credentials-helper">  Installing a Credentials Helper </h2> <p>Terraform does not have any automatic installation mechanism for credentials helpers. Instead, the user must extract the helper program executable into one of the <a href="../extend/how-terraform-works#plugin-locations">default plugin search locations</a>.</p> <p>If you are packaging a credentials helper for distribution, place it in an named with the expected naming scheme (<code>terraform-credentials-example</code>) and, if the containing archive format supports it and it's meaningful for the target operating system, mark the file as executable to increase the chances that it will work immediately after extraction.</p> <p>Terraform does <em>not</em> honor the <code>-plugin-dir</code> argument to <code>terraform init</code> when searching for credentials helpers, because credentials are also used by other commands that can be run prior to <code>terraform init</code>. Only the default search locations are supported.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/internals/credentials-helpers.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/internals/credentials-helpers.html</a>
  </p>
</div>
