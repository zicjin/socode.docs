 <h1 id="gcs">  gcs </h1> <p><strong>Kind: Standard (with locking)</strong></p> <p>Stores the state as an object in a configurable prefix in a pre-existing bucket on <a href="https://cloud.google.com/storage/">Google Cloud Storage</a> (GCS). This backend also supports <a href="../../state/locking">state locking</a>. The bucket must exist prior to configuring the backend.</p> <blockquote class="alert alert-warning" role="alert"> <p><strong>Warning!</strong> It is highly recommended that you enable <a href="https://cloud.google.com/storage/docs/object-versioning">Object Versioning</a> on the GCS bucket to allow for state recovery in the case of accidental deletions and human error.</p> </blockquote> <h2 id="example-configuration">  Example Configuration </h2> <pre data-language="ruby">terraform {
  backend "gcs" {
    bucket  = "tf-state-prod"
    prefix  = "terraform/state"
  }
}
</pre>
<h2 id="data-source-configuration">  Data Source Configuration </h2> <pre data-language="ruby">data "terraform_remote_state" "foo" {
  backend = "gcs"
  config = {
    bucket  = "terraform-state"
    prefix  = "prod"
  }
}

resource "template_file" "bar" {
  template = "${greeting}"

  vars {
    greeting = "${data.terraform_remote_state.foo.greeting}"
  }
}
</pre>
<h2 id="authentication">  Authentication </h2> <p>IAM Changes to buckets are <a href="https://cloud.google.com/storage/docs/consistency#eventually_consistent_operations">eventually consistent</a> and may take upto a few minutes to take effect. Terraform will return 403 errors till it is eventually consistent.</p> <h3 id="running-terraform-on-your-workstation-">  Running Terraform on your workstation. </h3> <p>If you are using terraform on your workstation, you will need to install the Google Cloud SDK and authenticate using <a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default">User Application Default Credentials</a>.</p> <p>User ADCs do <a href="https://developers.google.com/identity/protocols/oauth2#expiration">expire</a> and you can refresh them by running <code>gcloud auth application-default login</code>.</p> <h3 id="running-terraform-on-google-cloud">  Running Terraform on Google Cloud </h3> <p>If you are running terraform on Google Cloud, you can configure that instance or cluster to use a <a href="https://cloud.google.com/compute/docs/authentication">Google Service Account</a>. This will allow Terraform to authenticate to Google Cloud without having to bake in a separate credential/authentication file. Make sure that the scope of the VM/Cluster is set to cloud-platform.</p> <h3 id="running-terraform-outside-of-google-cloud">  Running Terraform outside of Google Cloud </h3> <p>If you are running terraform outside of Google Cloud, generate a service account key and set the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to the path of the service account key. Terraform will use that key for authentication.</p> <h3 id="impersonating-service-accounts">  Impersonating Service Accounts </h3> <p>Terraform can impersonate a Google Service Account as described <a href="https://cloud.google.com/iam/docs/creating-short-lived-service-account-credentials">here</a>. A valid credential must be provided as mentioned in the earlier section and that identity must have the <code>roles/iam.serviceAccountTokenCreator</code> role on the service account you are impersonating.</p> <h2 id="configuration-variables">  Configuration variables </h2> <p>The following configuration options are supported:</p> <ul> <li> <code>bucket</code> - (Required) The name of the GCS bucket. This name must be globally unique. For more information, see <a href="https://cloud.google.com/storage/docs/bucketnaming.html#requirements">Bucket Naming Guidelines</a>. </li> <li> <code>credentials</code> / <code>GOOGLE_BACKEND_CREDENTIALS</code> / <code>GOOGLE_CREDENTIALS</code> - (Optional) Local path to Google Cloud Platform account credentials in JSON format. If unset, <a href="https://developers.google.com/identity/protocols/application-default-credentials">Google Application Default Credentials</a> are used. The provided credentials must have Storage Object Admin role on the bucket. <strong>Warning</strong>: if using the Google Cloud Platform provider as well, it will also pick up the <code>GOOGLE_CREDENTIALS</code> environment variable. </li> <li>
<a href="#impersonate_service_account"><code>impersonate_service_account</code></a> - (Optional) The service account to impersonate for accessing the State Bucket. You must have <code>roles/iam.serviceAccountTokenCreator</code> role on that account for the impersonation to succeed. If you are using a delegation chain, you can specify that using the <code>impersonate_service_account_delegates</code> field. Alternatively, this can be specified using the <code>GOOGLE_IMPERSONATE_SERVICE_ACCOUNT</code> environment variable. </li> <li>
<a href="#impersonate_service_account_delegates"><code>impersonate_service_account_delegates</code></a> - (Optional) The delegation chain for an impersonating a service account as described <a href="https://cloud.google.com/iam/docs/creating-short-lived-service-account-credentials#sa-credentials-delegated">here</a>. </li> <li>
<a href="#access_token"><code>access_token</code></a> - (Optional) A temporary [OAuth 2.0 access token] obtained from the Google Authorization server, i.e. the <code>Authorization: Bearer</code> token used to authenticate HTTP requests to GCP APIs. This is an alternative to <code>credentials</code>. If both are specified, <code>access_token</code> will be used over the <code>credentials</code> field. </li> <li> <code>prefix</code> - (Optional) GCS prefix inside the bucket. Named states for workspaces are stored in an object called <code>&lt;prefix&gt;/&lt;name&gt;.tfstate</code>. </li> <li> <code>encryption_key</code> / <code>GOOGLE_ENCRYPTION_KEY</code> - (Optional) A 32 byte base64 encoded 'customer supplied encryption key' used to encrypt all state. For more information see <a href="https://cloud.google.com/storage/docs/encryption#customer-supplied">Customer Supplied Encryption Keys</a>. </li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/language/settings/backends/gcs.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/language/settings/backends/gcs.html</a>
  </p>
</div>
