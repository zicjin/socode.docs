 <h1 id="pg">  pg </h1> <p><strong>Kind: Standard (with locking)</strong></p> <p>Stores the state in a <a href="https://www.postgresql.org">Postgres database</a> version 10 or newer.</p> <p>This backend supports <a href="../../state/locking">state locking</a>.</p> <h2 id="example-configuration">  Example Configuration </h2> <pre data-language="ruby">terraform {
  backend "pg" {
    conn_str = "postgres://user:pass@db.example.com/terraform_backend"
  }
}
</pre>
<p>Before initializing the backend with <code>terraform init</code>, the database must already exist:</p> <pre>createdb terraform_backend
</pre>
<p>This <code>createdb</code> command is found in <a href="https://www.postgresql.org/docs/10/reference-client.html">Postgres client applications</a> which are installed along with the database server.</p> <p>We recommend using a <a href="configuration#partial-configuration">partial configuration</a> for the <code>conn_str</code> variable, because it typically contains access credentials that should not be committed to source control:</p> <pre data-language="ruby">terraform {
  backend "pg" {}
}
</pre>
<p>Then, set the credentials when initializing the configuration:</p> <pre>terraform init -backend-config="conn_str=postgres://user:pass@db.example.com/terraform_backend"
</pre>
<p>To use a Postgres server running on the same machine as Terraform, configure localhost with SSL disabled:</p> <pre>terraform init -backend-config="conn_str=postgres://localhost/terraform_backend?sslmode=disable"
</pre>
<h2 id="data-source-configuration">  Data Source Configuration </h2> <p>To make use of the pg remote state in another configuration, use the <a href="../../state/remote-state-data"><code>terraform_remote_state</code> data source</a>.</p> <pre data-language="ruby">data "terraform_remote_state" "network" {
  backend = "pg"
  config {
    conn_str = "postgres://localhost/terraform_backend"
  }
}
</pre>
<h2 id="configuration-variables">  Configuration Variables </h2> <p>The following configuration options or environment variables are supported:</p> <ul> <li>
<a href="#conn_str"><code>conn_str</code></a> - (Required) Postgres connection string; a <code>postgres://</code> URL </li> <li>
<a href="#schema_name"><code>schema_name</code></a> - Name of the automatically-managed Postgres schema, default <code>terraform_remote_state</code>. </li> <li>
<a href="#skip_schema_creation"><code>skip_schema_creation</code></a> - If set to <code>true</code>, the Postgres schema must already exist. Terraform won't try to create the schema, this is useful when it has already been created by a database administrator. </li> <li>
<a href="#skip_table_creation"><code>skip_table_creation</code></a> - If set to <code>true</code>, the Postgres table must already exist. Terraform won't try to create the table, this is useful when it has already been created by a database administrator. </li> <li>
<a href="#skip_index_creation"><code>skip_index_creation</code></a> - If set to <code>true</code>, the Postgres index must already exist. Terraform won't try to create the index, this is useful when it has already been created by a database administrator. </li> </ul> <h2 id="technical-design">  Technical Design </h2> <p>This backend creates one table <strong>states</strong> in the automatically-managed Postgres schema configured by the <code>schema_name</code> variable.</p> <p>The table is keyed by the <a href="../../state/workspaces">workspace</a> name. If workspaces are not in use, the name <code>default</code> is used.</p> <p>Locking is supported using <a href="https://www.postgresql.org/docs/9.5/explicit-locking.html#ADVISORY-LOCKS">Postgres advisory locks</a>. <a href="../../../cli/commands/force-unlock"><code>force-unlock</code></a> is not supported, because these database-native locks will automatically unlock when the session is aborted or the connection fails. To see outstanding locks in a Postgres server, use the <a href="https://www.postgresql.org/docs/9.5/view-pg-locks.html"><code>pg_locks</code> system view</a>.</p> <p>The <strong>states</strong> table contains:</p> <ul> <li>a serial integer <code>id</code>, used as the key for advisory locks </li> <li>the workspace <code>name</code> key as <em>text</em> with a unique index </li> <li>the Terraform state <code>data</code> as <em>text</em> </li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/language/settings/backends/pg.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/language/settings/backends/pg.html</a>
  </p>
</div>
