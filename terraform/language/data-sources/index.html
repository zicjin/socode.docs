 <h1 id="data-sources">  Data Sources </h1> <p><em>Data sources</em> allow Terraform use information defined outside of Terraform, defined by another separate Terraform configuration, or modified by functions.</p> <blockquote> <p><strong>Hands-on:</strong> Try the <a href="https://learn.hashicorp.com/tutorials/terraform/data-sources?in=terraform/configuration-language&amp;utm_source=WEBSITE&amp;utm_medium=WEB_IO&amp;utm_offer=ARTICLE_PAGE&amp;utm_content=DOCS">Query data sources</a> tutorial on HashiCorp Learn.</p> </blockquote> <p>Each <a href="../providers/index">provider</a> may offer data sources alongside its set of <a href="../resources/index">resource</a> types.</p> <h2 id="using-data-sources">  Using Data Sources </h2> <p>A data source is accessed via a special kind of resource known as a <em>data resource</em>, declared using a <code>data</code> block:</p> <pre data-language="ruby">data "aws_ami" "example" {
  most_recent = true

  owners = ["self"]
  tags = {
    Name   = "app-server"
    Tested = "true"
  }
}
</pre>
<p>A <code>data</code> block requests that Terraform read from a given data source ("aws_ami") and export the result under the given local name ("example"). The name is used to refer to this resource from elsewhere in the same Terraform module, but has no significance outside of the scope of a module.</p> <p>The data source and name together serve as an identifier for a given resource and so must be unique within a module.</p> <p>Within the block body (between <code>{</code> and <code>}</code>) are query constraints defined by the data source. Most arguments in this section depend on the data source, and indeed in this example <code>most_recent</code>, <code>owners</code> and <code>tags</code> are all arguments defined specifically for <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami">the <code>aws_ami</code> data source</a>.</p> <p>When distinguishing from data resources, the primary kind of resource (as declared by a <code>resource</code> block) is known as a <em>managed resource</em>. Both kinds of resources take arguments and export attributes for use in configuration, but while managed resources cause Terraform to create, update, and delete infrastructure objects, data resources cause Terraform only to <em>read</em> objects. For brevity, managed resources are often referred to just as "resources" when the meaning is clear from context.</p> <h2 id="data-source-arguments">  Data Source Arguments </h2> <p>Each data resource is associated with a single data source, which determines the kind of object (or objects) it reads and what query constraint arguments are available.</p> <p>Each data source in turn belongs to a <a href="../providers/index">provider</a>, which is a plugin for Terraform that offers a collection of resource types and data sources that most often belong to a single cloud or on-premises infrastructure platform.</p> <p>Most of the items within the body of a <code>data</code> block are defined by and specific to the selected data source, and these arguments can make full use of <a href="../expressions/index">expressions</a> and other dynamic Terraform language features.</p> <p>However, there are some "meta-arguments" that are defined by Terraform itself and apply across all data sources. These arguments often have additional restrictions on what language features can be used with them, and are described in more detail in the following sections.</p> <h2 id="data-resource-behavior">  Data Resource Behavior </h2> <p>If the query constraint arguments for a data resource refer only to constant values or values that are already known, the data resource will be read and its state updated during Terraform's "refresh" phase, which runs prior to creating a plan. This ensures that the retrieved data is available for use during planning and so Terraform's plan will show the actual values obtained.</p> <p>Query constraint arguments may refer to values that cannot be determined until after configuration is applied, such as the id of a managed resource that has not been created yet. In this case, reading from the data source is deferred until the apply phase, and any references to the results of the data resource elsewhere in configuration will themselves be unknown until after the configuration has been applied.</p> <h2 id="local-only-data-sources">  Local-only Data Sources </h2> <p>While many data sources correspond to an infrastructure object type that is accessed via a remote network API, some specialized data sources operate only within Terraform itself, calculating some results and exposing them for use elsewhere.</p> <p>For example, local-only data sources exist for <a href="https://registry.terraform.io/providers/hashicorp/template/latest/docs/data-sources/file">rendering templates</a>, <a href="https://registry.terraform.io/providers/hashicorp/local/latest/docs/data-sources/file">reading local files</a>, and <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document">rendering AWS IAM policies</a>.</p> <p>The behavior of local-only data sources is the same as all other data sources, but their result data exists only temporarily during a Terraform operation, and is re-calculated each time a new plan is created.</p> <h2 id="data-resource-dependencies">  Data Resource Dependencies </h2> <p>Data resources have the same dependency resolution behavior <a href="../resources/behavior#resource-dependencies">as defined for managed resources</a>. Setting the <code>depends_on</code> meta-argument within <code>data</code> blocks defers reading of the data source until after all changes to the dependencies have been applied.</p> <p>In order to ensure that data sources are accessing the most up to date information possible in a wide variety of use cases, arguments directly referencing managed resources are treated the same as if the resource was listed in <code>depends_on</code>. This behavior can be avoided when desired by indirectly referencing the managed resource values through a <code>local</code> value.</p> <blockquote class="alert alert-warning" role="alert"> <p><strong>NOTE:</strong> <strong>In Terraform 0.12 and earlier</strong>, due to the data resource behavior of deferring the read until the apply phase when depending on values that are not yet known, using <code>depends_on</code> with <code>data</code> resources will force the read to always be deferred to the apply phase, and therefore a configuration that uses <code>depends_on</code> with a <code>data</code> resource can never converge. Due to this behavior, we do not recommend using <code>depends_on</code> with data resources.</p> </blockquote> <h2 id="multiple-resource-instances">  Multiple Resource Instances </h2> <p>Data resources support <a href="../meta-arguments/count"><code>count</code></a> and <a href="../meta-arguments/for_each"><code>for_each</code></a> meta-arguments as defined for managed resources, with the same syntax and behavior.</p> <p>As with managed resources, when <code>count</code> or <code>for_each</code> is present it is important to distinguish the resource itself from the multiple resource <em>instances</em> it creates. Each instance will separately read from its data source with its own variant of the constraint arguments, producing an indexed result.</p> <h2 id="selecting-a-non-default-provider-configuration">  Selecting a Non-default Provider Configuration </h2> <p>Data resources support <a href="../meta-arguments/resource-provider">the <code>provider</code> meta-argument</a> as defined for managed resources, with the same syntax and behavior.</p> <h2 id="lifecycle-customizations">  Lifecycle Customizations </h2> <p>Data resources do not currently have any customization settings available for their lifecycle, but the <code>lifecycle</code> nested block is reserved in case any are added in future versions.</p> <h2 id="example">  Example </h2> <p>A data source configuration looks like the following:</p> <pre data-language="ruby"># Find the latest available AMI that is tagged with Component = web
data "aws_ami" "web" {
  filter {
    name   = "state"
    values = ["available"]
  }

  filter {
    name   = "tag:Component"
    values = ["web"]
  }

  most_recent = true
}
</pre>
<h2 id="description">  Description </h2> <p>The <code>data</code> block creates a data instance of the given <em>type</em> (first block label) and <em>name</em> (second block label). The combination of the type and name must be unique.</p> <p>Within the block (the <code>{ }</code>) is configuration for the data instance. The configuration is dependent on the type; as with <a href="../resources/index">resources</a>, each provider on the <a href="https://registry.terraform.io/browse/providers">Terraform Registry</a> has its own documentation for configuring and using the data types it provides.</p> <p>Each data instance will export one or more attributes, which can be used in other resources as reference expressions of the form <code>data.&lt;TYPE&gt;.&lt;NAME&gt;.&lt;ATTRIBUTE&gt;</code>. For example:</p> <pre data-language="ruby">resource "aws_instance" "web" {
  ami           = data.aws_ami.web.id
  instance_type = "t1.micro"
}
</pre>
<h2 id="meta-arguments">  Meta-Arguments </h2> <p>As data sources are essentially a read only subset of resources, they also support the same <a href="../resources/syntax#meta-arguments">meta-arguments</a> of resources with the exception of the <a href="../meta-arguments/lifecycle"><code>lifecycle</code> configuration block</a>.</p> <h3 id="non-default-provider-configurations">  Non-Default Provider Configurations </h3> <p>Similarly to <a href="../resources/index">resources</a>, when a module has multiple configurations for the same provider you can specify which configuration to use with the <code>provider</code> meta-argument:</p> <pre data-language="ruby">data "aws_ami" "web" {
  provider = aws.west

  # ...
}
</pre>
<p>See <a href="../meta-arguments/resource-provider">The Resource <code>provider</code> Meta-Argument</a> for more information.</p> <h2 id="data-source-lifecycle">  Data Source Lifecycle </h2> <p>If the arguments of a data instance contain no references to computed values, such as attributes of resources that have not yet been created, then the data instance will be read and its state updated during Terraform's "refresh" phase, which by default runs prior to creating a plan. This ensures that the retrieved data is available for use during planning and the diff will show the real values obtained.</p> <p>Data instance arguments may refer to computed values, in which case the attributes of the instance itself cannot be resolved until all of its arguments are defined. In this case, refreshing the data instance will be deferred until the "apply" phase, and all interpolations of the data instance attributes will show as "computed" in the plan since the values are not yet known.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/language/data-sources/" class="_attribution-link" target="_blank">https://www.terraform.io/docs/language/data-sources/</a>
  </p>
</div>
