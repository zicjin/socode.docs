 <h1 id="module-blocks">  Module Blocks </h1> <blockquote> <p><strong>Hands-on:</strong> Try the <a href="https://learn.hashicorp.com/collections/terraform/modules?utm_source=WEBSITE&amp;utm_medium=WEB_IO&amp;utm_offer=ARTICLE_PAGE&amp;utm_content=DOCS">Reuse Configuration with Modules</a> collection on HashiCorp Learn.</p> </blockquote> <p>A <em>module</em> is a container for multiple resources that are used together.</p> <p>Every Terraform configuration has at least one module, known as its <em>root module</em>, which consists of the resources defined in the <code>.tf</code> files in the main working directory.</p> <p>A module can call other modules, which lets you include the child module's resources into the configuration in a concise way. Modules can also be called multiple times, either within the same configuration or in separate configurations, allowing resource configurations to be packaged and re-used.</p> <p>This page describes how to call one module from another. For more information about creating re-usable child modules, see <a href="develop/index">Module Development</a>.</p> <h2 id="calling-a-child-module">  Calling a Child Module </h2> <p>To <em>call</em> a module means to include the contents of that module into the configuration with specific values for its <a href="../values/variables">input variables</a>. Modules are called from within other modules using <code>module</code> blocks:</p> <pre data-language="ruby">module "servers" {
  source = "./app-cluster"

  servers = 5
}
</pre>
<p>A module that includes a <code>module</code> block like this is the <em>calling module</em> of the child module.</p> <p>The label immediately after the <code>module</code> keyword is a local name, which the calling module can use to refer to this instance of the module.</p> <p>Within the block body (between <code>{</code> and <code>}</code>) are the arguments for the module. Module calls use the following kinds of arguments:</p> <ul> <li>
<p>The <code>source</code> argument is mandatory for all modules.</p> </li> <li>
<p>The <code>version</code> argument is recommended for modules from a registry.</p> </li> <li>
<p>Most other arguments correspond to <a href="../values/variables">input variables</a> defined by the module. (The <code>servers</code> argument in the example above is one of these.)</p> </li> <li>
<p>Terraform defines a few other meta-arguments that can be used with all modules, including <code>for_each</code> and <code>depends_on</code>.</p> </li> </ul> <h3 id="source">  Source </h3> <p>All modules <strong>require</strong> a <code>source</code> argument, which is a meta-argument defined by Terraform. Its value is either the path to a local directory containing the module's configuration files, or a remote module source that Terraform should download and use. This value must be a literal string with no template sequences; arbitrary expressions are not allowed. For more information on possible values for this argument, see <a href="sources">Module Sources</a>.</p> <p>The same source address can be specified in multiple <code>module</code> blocks to create multiple copies of the resources defined within, possibly with different variable values.</p> <p>After adding, removing, or modifying <code>module</code> blocks, you must re-run <code>terraform init</code> to allow Terraform the opportunity to adjust the installed modules. By default this command will not upgrade an already-installed module; use the <code>-upgrade</code> option to instead upgrade to the newest available version.</p> <h3 id="version">  Version </h3> <p>When using modules installed from a module registry, we recommend explicitly constraining the acceptable version numbers to avoid unexpected or unwanted changes.</p> <p>Use the <code>version</code> argument in the <code>module</code> block to specify versions:</p> <pre data-language="shell">module "consul" {
  source  = "hashicorp/consul/aws"
  version = "0.0.5"

  servers = 3
}
</pre>
<p>The <code>version</code> argument accepts a <a href="../expressions/version-constraints">version constraint string</a>. Terraform will use the newest installed version of the module that meets the constraint; if no acceptable versions are installed, it will download the newest version that meets the constraint.</p> <p>Version constraints are supported only for modules installed from a module registry, such as the public <a href="https://registry.terraform.io/">Terraform Registry</a> or <a href="../../cloud/registry/index">Terraform Cloud's private module registry</a>. Other module sources can provide their own versioning mechanisms within the source string itself, or might not support versions at all. In particular, modules sourced from local file paths do not support <code>version</code>; since they're loaded from the same source repository, they always share the same version as their caller.</p> <h3 id="meta-arguments">  Meta-arguments </h3> <p>Along with <code>source</code> and <code>version</code>, Terraform defines a few more optional meta-arguments that have special meaning across all modules, described in more detail in the following pages:</p> <ul> <li>
<p><a href="#count"><code>count</code></a> - Creates multiple instances of a module from a single <code>module</code> block. See <a href="../meta-arguments/count">the <code>count</code> page</a> for details.</p> </li> <li>
<p><a href="#for_each"><code>for_each</code></a> - Creates multiple instances of a module from a single <code>module</code> block. See <a href="../meta-arguments/for_each">the <code>for_each</code> page</a> for details.</p> </li> <li>
<p><a href="#providers"><code>providers</code></a> - Passes provider configurations to a child module. See <a href="../meta-arguments/module-providers">the <code>providers</code> page</a> for details. If not specified, the child module inherits all of the default (un-aliased) provider configurations from the calling module.</p> </li> <li>
<p><a href="#depends_on"><code>depends_on</code></a> - Creates explicit dependencies between the entire module and the listed targets. See <a href="../meta-arguments/depends_on">the <code>depends_on</code> page</a> for details.</p> </li> </ul> <p>In addition to the above, the <code>lifecycle</code> argument is not currently used by Terraform but is reserved for planned future features.</p> <h2 id="accessing-module-output-values">  Accessing Module Output Values </h2> <p>The resources defined in a module are encapsulated, so the calling module cannot access their attributes directly. However, the child module can declare <a href="../values/outputs">output values</a> to selectively export certain values to be accessed by the calling module.</p> <p>For example, if the <code>./app-cluster</code> module referenced in the example above exported an output value named <code>instance_ids</code> then the calling module can reference that result using the expression <code>module.servers.instance_ids</code>:</p> <pre data-language="ruby">resource "aws_elb" "example" {
  # ...

  instances = module.servers.instance_ids
}
</pre>
<p>For more information about referring to named values, see <a href="../expressions/index">Expressions</a>.</p> <h2 id="transferring-resource-state-into-modules">  Transferring Resource State Into Modules </h2> <p>When refactoring an existing configuration to split code into child modules, moving resource blocks between modules causes Terraform to see the new location as an entirely different resource from the old. Always check the execution plan after moving code across modules to ensure that no resources are deleted by surprise.</p> <p>If you want to make sure an existing resource is preserved, use <a href="../../cli/commands/state/mv">the <code>terraform state mv</code> command</a> to inform Terraform that it has moved to a different module.</p> <p>When passing resource addresses to <code>terraform state mv</code>, resources within child modules must be prefixed with <code>module.&lt;MODULE NAME&gt;.</code>. If a module was called with <a href="../meta-arguments/count"><code>count</code></a> or <a href="../meta-arguments/for_each"><code>for_each</code></a>, its resource addresses must be prefixed with <code>module.&lt;MODULE NAME&gt;[&lt;INDEX&gt;].</code> instead, where <code>&lt;INDEX&gt;</code> matches the <code>count.index</code> or <code>each.key</code> value of a particular module instance.</p> <p>Full resource addresses for module contents are used within the UI and on the command line, but cannot be used within a Terraform configuration. Only <a href="../values/outputs">outputs</a> from a module can be referenced from elsewhere in your configuration.</p> <h2 id="tainting-resources-within-a-module">  Tainting resources within a module </h2> <p>The <a href="../../cli/commands/taint">taint command</a> can be used to <em>taint</em> specific resources within a module:</p> <pre data-language="shell">$ terraform taint module.salt_master.aws_instance.salt_master
</pre>
<p>It is not possible to taint an entire module. Instead, each resource within the module must be tainted separately.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/language/modules/syntax.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/language/modules/syntax.html</a>
  </p>
</div>
