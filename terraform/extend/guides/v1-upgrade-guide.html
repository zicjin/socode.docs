 <h1 id="terraform-plugin-sdk">  Terraform Plugin SDK </h1> <p>As of September 2019, Terraform provider developers importing the Go module <code>github.com/hashicorp/terraform</code>, known as Terraform Core, should switch to <code>github.com/hashicorp/terraform-plugin-sdk</code>, the Terraform Plugin SDK, instead.</p> <h2 id="why-a-separate-module-">  Why a separate module? </h2> <p>While the <code>helper/*</code> and other packages in Terraform Core has served us well, in order for provider development to evolve, the SDK needed to break out into its own repository. Terraform Core's versioning has been oriented towards practitioners. With the "unofficial" SDK existing in the core repository, the SDK becomes tied to Core releases and cannot follow semantic versioning. The new standalone SDK <a href="https://github.com/hashicorp/terraform-plugin-sdk">github.com/hashicorp/terraform-plugin-sdk</a> follows sematic versioning starting with v1.0.0.</p> <p>We will use the term "legacy Terraform plugin SDK" when referring to the version of Terraform Core imported and used by providers.</p> <h2 id="what-do-providers-need-to-do-">  What do providers need to do? </h2> <p>The first release of the standalone plugin SDK aims to keep nearly 100% backwards compatibility, aside from a handful of APIs, so only the imports within your provider need to be replaced.</p> <p>The migration process can be automated with the <a href="https://github.com/hashicorp/tf-sdk-migrator">migrator tool</a>. This tool will check eligibility of a provider codebase, ensuring the use of Go modules and that the provider is upgrading from at least v0.12.7 of <code>github.com/hashicorp/terraform</code>. It will also identify if the handful of removed APIs are being used.</p> <p>You can also migrate your provider manually by replacing references to <code>github.com/hashicorp/terraform</code> with <code>github.com/hashicorp/terraform-plugin-sdk</code>. We recommend using the official migrator tool as it has a number of checks that will make this process safer. Please also read the <a href="#deprecations">deprecation notices</a> below.</p> <h2 id="how-do-i-migrate-my-provider-to-the-standalone-sdk-">  How do I migrate my provider to the standalone SDK? </h2> <h3 id="using-tf-sdk-migrator">  Using tf-sdk-migrator </h3> <h4 id="step-0-install-the-migrator-tool">  Step 0: Install the migrator tool </h4> <pre>$ go install github.com/hashicorp/tf-sdk-migrator
</pre>
<p>The migrator binary is now available at <code>$GOBIN/tf-sdk-migrator</code>. Examples below assume you have added <code>$GOBIN</code> to your <code>PATH</code>.</p> <h4 id="step-1-check-eligibility-for-migration">  Step 1: Check eligibility for migration </h4> <pre>$ cd /provider/source/directory/
$ tf-sdk-migrator check
</pre>
<p>If this command succeeds, proceed to Step 2.</p> <p>Otherwise, the tool will output the steps you need to take to ensure the provider can be migrated. Please see <a href="https://github.com/hashicorp/tf-sdk-migrator">https://github.com/hashicorp/tf-sdk-migrator</a> for more information about the eligibility checks, and see the <a href="#deprecations">Deprecations section</a> below for what to do if you are using deprecated packages or identifiers.</p> <p>Projects that are on an old version of the legacy Terraform plugin SDK, particularly &lt; v0.12, should first <a href="../terraform-0.12-compatibility">upgrade to v0.12</a>.</p> <h4 id="step-2-migrate">  Step 2: Migrate </h4> <pre>$ tf-sdk-migrator migrate
</pre>
<p>The <code>migrate</code> subcommand runs the <code>check</code> subcommand, and migration will not proceed if the eligibility check fails.</p> <p>If migration succeeds, you will see something like the following:</p> <pre>$ tf-sdk-migrator migrate
Checking Go runtime version ...
Go version 1.12.9: OK.
Checking whether provider uses Go modules...
Go modules in use: OK.
Checking version of github.com/hashicorp/terraform SDK used in provider...
SDK version 0.12.7: OK.
Checking whether provider uses deprecated SDK packages or identifiers...
No imports of deprecated SDK packages or identifiers: OK.

All constraints satisfied. Provider can be migrated to the new SDK.

Rewriting provider go.mod file...
Rewriting SDK package imports...
Success! Provider is migrated to github.com/hashicorp/terraform-plugin-sdk v1.0.0.
</pre>
<p>Remember to vendor the dependencies if the project still uses vendoring.</p> <pre>$ go mod vendor
</pre>
<p>Congratulations! Your Terraform provider is migrated to the standalone SDK. You can now run your tests and commit the changed files.</p> <h3 id="manually">  Manually </h3> <h4 id="step-0-check-requirements">  Step 0: Check requirements </h4> <p>Below is a list of requirements. It is possible to migrate without meeting these requirements, but it may be much more difficult. It is therefore highly recommended to try to meet all of these, or meet as many as possible.</p> <ul> <li>Go <code>1.12</code> <ul> <li>
<a href="#go-version"><code>go version</code></a> should yield the current version in use </li> </ul> </li> <li>Dependencies managed via Go modules <ul> <li>
<a href="#go-mod"><code>go.mod</code></a> and <code>go.sum</code> should be present in the root </li> </ul> </li> <li>
<a href="#github-com-hashicorp-terraform"><code>github.com/hashicorp/terraform</code></a> <code>&gt;=0.12.7</code> <ul> <li>
<a href="#go-mod-1"><code>go.mod</code></a> should contain a line which starts with <code>github.com/hashicorp/terraform</code> and version that is greater than or equal to <code>0.12.7</code> </li> </ul> </li> </ul> <h4 id="step-1-check-for-deprecations">  Step 1: Check for deprecations </h4> <p>See the <a href="#deprecations">list of deprecations</a> below and take actions to remove all occurrences of deprecated packages, functions or identifiers.</p> <p>You may find a full list of SDK packages in <a href="https://pkg.go.dev/github.com/hashicorp/tf-sdk-migrator@v1.4.0/cmd/check#CheckSDKPackageImports"><code>tf-sdk-migrator</code> source code</a>. Any package which is not on the list is considered as deprecated in the context of SDK and/or doesn't classify as SDK.</p> <p>You can use standard Go tooling, <a href="https://stedolan.github.io/jq/">jq</a> and <a href="https://en.wikipedia.org/wiki/Grep">grep</a> to list all packages which are in use by your provider:</p> <pre data-language="shell">go list -json ./... | \
    jq -r .Imports[] | \
    grep '^github.com/hashicorp/terraform/'
</pre>
<p>You can use <a href="https://github.com/radeksimko/go-refs"><code>go-refs</code></a> to list all identifiers of a given package which are in use.</p> <h4 id="step-2-replace-import-paths">  Step 2: Replace import paths </h4> <p>The simplest way to replace all import paths is to find all Go files using the standard Go tooling and jq, and <a href="https://en.wikipedia.org/wiki/Sed">sed</a> for replacing the paths:</p> <pre data-language="shell">go list -json ./... | \
    jq -r '.Dir + "/" + .GoFiles[]' | \
    xargs -n1 sed -i 's;"github.com/hashicorp/terraform/;"github.com/hashicorp/terraform-plugin-sdk/;'
</pre>
<h4 id="step-3-go-modules">  Step 3: Go Modules </h4> <p>Tidy up dependencies after removing Terraform and adding standalone SDK:</p> <pre>go mod tidy
</pre>
<p>re-vendor dependencies, if you're vendoring</p> <pre>go mod vendor
</pre>
<p>and finally run your tests, review changes and commit.</p> <h2 id="what-if-my-provider-is-not-eligible-for-migration-">  What if my provider is not eligible for migration? </h2> <p>Version 1.0.0 of the standalone plugin SDK is intended to differ as little as possible from the legacy plugin SDK. However, we have had to deprecate some packages and identifiers. Some of the rationale behind which packages made up SDK v1.0.0 can be seen from the <a href="https://github.com/radeksimko/terraform-provider-sdk-exposure">analysis</a> we performed.</p> <h2 id="deprecations">  Deprecations </h2> <p>The following packages, functions, and identifiers have been deprecated as of v0.12.7 of the legacy SDK in Core, and have removed altogether in the standalone SDK.</p> <ul> <li>
<p><strong><code>config.NewRawConfig()/terraform.NewResourceConfig()</code></strong> were sometimes used in tandem for testing provider block configuration. The config package has been removed entirely from the SDK as well as <code>terraform.NewResourceConfig</code>, you should now use <code>terraform.NewResourceConfigRaw()</code>. See <a href="https://github.com/hashicorp/terraform-provider-consul/pull/149/files">example</a></p> </li> <li>
<p>Passing along a user agent header to backend APIs has been done a few ways. The new standalone SDK tries to standardize the creation of a user agent header, as well as provide an accurate version of Terraform calling the provider.</p> <ul> <li>
<strong><code>terraform.VersionString()</code></strong> has been removed, it provided the version of terraform the dependency, which was not accurate. The version of terraform can now be accessed at runtime in a provider's <code>ConfigureFunc</code>. See <a href="https://github.com/hashicorp/terraform-provider-kubernetes/pull/620/files">example</a> </li> <li>
<strong><code>httpclient.UserAgentString()/terraform.UserAgentString()</code></strong> have been removed. Please use <a href="https://pkg.go.dev/github.com/hashicorp/terraform-plugin-sdk/v2/httpclient#TerraformUserAgent"><code>httpclient.TerraformUserAgent()</code></a> instead. </li> <li>
<strong><code>httpclient.New()</code></strong> has been removed. Please use <code>github.com/hashicorp/go-cleanhttp.DefaultPooledClient()</code> directly with a custom transport. This is how <a href="https://pkg.go.dev/github.com/hashicorp/terraform@v0.14.7/httpclient#New"><code>httpclient.New()</code></a> was implemented in Core. </li> </ul> </li> <li>
<p>A small number of providers have used the <a href="https://github.com/hashicorp/terraform/tree/e1d0acda0b19be25ea96748896d3cd7117df955a/flatmap">flatmap package</a>. Unfortunately it will not be a part of the standalone SDK. It is recommended to just move away from using that altogether, but as a quick solution, copy paste whatever is needed over and strip away the parts that are Terraform Core specific. This package was never intended to be used outside of Terraform Core.</p> </li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/extend/guides/v1-upgrade-guide.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/extend/guides/v1-upgrade-guide.html</a>
  </p>
</div>
