 <h1 id="command-state-mv">  Command: state mv </h1> <p>The main function of <a href="../../../language/state/index">Terraform state</a> is to track the bindings between resource instance addresses in your configuration and the remote objects they represent. Normally Terraform automatically updates the state in response to actions taken when applying a plan, such as removing a binding for an remote object that has now been deleted.</p> <p>You can use <code>terraform state mv</code> in the less common situation where you wish to retain an existing remote object but track it as a different resource instance address in Terraform, such as if you have renamed a resource block or you have moved it into a different module in your configuration.</p> <h2 id="usage">  Usage </h2> <p>Usage: <code>terraform state mv [options] SOURCE DESTINATION</code></p> <p>Terraform will look in the current state for a resource instance, resource, or module that matches the given address, and if successful it will move the remote objects currently associated with the source to be tracked instead by the destination.</p> <p>Both the source and destination addresses must use <a href="../../state/resource-addressing">resource address syntax</a>, and they must both refer to the same kind of object: you can only move a resource instance to another resource instance, a whole module instance to another whole module instance, etc. Furthermore, if you are moving a resource or a resource instance then you can only move it to a new address with the same resource type.</p> <p>The most common uses for <code>terraform state mv</code> are when you have renamed a resource block in your configuration or you've moved a resource block into a child module, in both cases with the intention of retaining the existing object but tracking it under a new name. By default Terraform will understand moving or renaming a resource configuration as a request to delete the old object and create a new object at the new address, and so <code>terraform state mv</code> allows you to override that interpretation by pre-emptively attaching the existing object to the new address in Terraform.</p> <blockquote class="alert alert-warning" role="alert"> <p><em>Warning:</em> If you are using Terraform in a collaborative environment, you must ensure that when you are using <code>terraform state mv</code> for a code refactoring purpose you communicate carefully with your coworkers to ensure that nobody makes any other changes between your configuration change and your <code>terraform state mv</code> command, because otherwise they might inadvertently create a plan that will destroy the old object and create a new object at the new address.</p> </blockquote> <p>This command also accepts the following options:</p> <ul> <li>
<p><a href="#dry-run"><code>-dry-run</code></a> - Report all of the resource instances that match the given address without actually "forgetting" any of them.</p> </li> <li>
<p><a href="#lock-false"><code>-lock=false</code></a> - Don't hold a state lock during the operation. This is dangerous if others might concurrently run commands against the same workspace.</p> </li> <li>
<p><a href="#lock-timeout-duration"><code>-lock-timeout=DURATION</code></a> - Unless locking is disabled with <code>-lock=false</code>, instructs Terraform to retry acquiring a lock for a period of time before returning an error. The duration syntax is a number followed by a time unit letter, such as "3s" for three seconds.</p> </li> </ul> <p>For configurations using <a href="../../../language/settings/backends/remote">the <code>remote</code> backend</a> only, <code>terraform state mv</code> also accepts the option <a href="../../../language/settings/backends/remote#command-line-arguments"><code>-ignore-remote-version</code></a>.</p> <p>For configurations using <a href="../../../language/settings/backends/local">the <code>local</code> state mv</a> only, <code>terraform taint</code> also accepts the legacy options <a href="../../../language/settings/backends/local#command-line-arguments"><code>-state</code>, <code>-state-out</code>, and <code>-backup</code></a>.</p> <h2 id="example-rename-a-resource">  Example: Rename a Resource </h2> <p>Renaming a resource means making a configuration change like the following:</p> <pre>-resource "packet_device" "worker" {
+resource "packet_device" "helper" {
   # ...
 }
</pre>
<p>To tell Terraform that it should treat the new "helper" resource as a rename of the old "worker" resource, you can pair the above configuration change with the following command:</p> <pre data-language="shell">terraform state mv packet_device.worker packet_device.helper
</pre>
<h2 id="example-move-a-resource-into-a-module">  Example: Move a Resource Into a Module </h2> <p>If you originally wrote a resource in your root module but now wish to refactor it into a child module, you can move the <code>resource</code> block into the child module configuration, removing the original in the root module, and then run the following command to tell Terraform to treat it as a move:</p> <pre data-language="shell">terraform state mv packet_device.worker module.worker.packet_device.worker
</pre>
<p>In the above example the new resource has the same name but a different module address. You could also change the resource name at the same time, if the new module organization suggests a different naming scheme:</p> <pre data-language="shell">terraform state mv packet_device.worker module.worker.packet_device.main
</pre>
<h2 id="example-move-a-module-into-a-module">  Example: Move a Module Into a Module </h2> <p>You can also refactor an entire module into a child module. In the configuration, move the <code>module</code> block representing the module into a different module and then pair that change with a command like the following:</p> <pre data-language="shell">terraform state mv module.app module.parent.module.app
</pre>
<h2 id="example-move-a-particular-instance-of-a-resource-using-count">  Example: Move a Particular Instance of a Resource using <code>count</code> </h2> <p>A resource defined with <a href="../../../language/meta-arguments/count">the <code>count</code> meta-argument</a> has multiple instances that are each identified by an integer. You can select a particular instance by including an explicit index in your given address:</p> <pre data-language="shell">$ terraform state mv 'packet_device.worker[0]' 'packet_device.helper[0]'
</pre>
<p>A resource that doesn't use <code>count</code> or <code>for_each</code> has only a single resource instance whose address is the same as the resource itself, and so you can move from an address not containing an index to an address containing an index, or the opposite, as long as the address type you use matches whether and how each resource is configured:</p> <pre data-language="shell">$ terraform state mv 'packet_device.main' 'packet_device.all[0]'
</pre>
<p>Brackets (<code>[</code>, <code>]</code>) have a special meaning in some shells, so you may need to quote or escape the address in order to pass it literally to Terraform. The above examples show the typical quoting syntax for Unix-style shells.</p> <h2 id="example-move-a-resource-configured-with-for_each">  Example: Move a Resource configured with for_each </h2> <p>A resource defined with <a href="../../../language/meta-arguments/for_each">the <code>for_each</code> meta-argument</a> has multiple instances that are each identified by an string. You can select a particular instance by including an explicit key in your given address.</p> <p>However, the syntax for strings includes quotes and the quote symbol often has special meaning in command shells, so you'll need to use the appropriate quoting and/or escaping syntax for the shell you are using. For example:</p> <p>Unix-style shells, such as on Linux or macOS:</p> <pre data-language="shell">terraform state mv 'packet_device.worker["example123"]' 'packet_device.helper["example456"]'
</pre>
<p>Windows Command Prompt (<code>cmd.exe</code>):</p> <pre data-language="shell">terraform state mv packet_device.worker[\"example123\"] packet_device.helper[\"example456\"]
</pre>
<p>PowerShell:</p> <pre data-language="shell">terraform state mv 'packet_device.worker[\"example123\"]' 'packet_device.helper[\"example456\"]'
</pre>
<p>Aside from the use of strings instead of integers for instance keys, the treatment of <code>for_each</code> resources is similar to <code>count</code> resources and so the same combinations of addresses with and without index components is valid as described in the previous section.</p><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/cli/commands/state/mv.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/cli/commands/state/mv.html</a>
  </p>
</div>
