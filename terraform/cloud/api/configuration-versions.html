 <h1 id="configuration-versions-api">  Configuration Versions API </h1> <blockquote class="alert alert-info" role="alert"> <p><strong>Note:</strong> Before working with the runs or configuration versions APIs, read the <a href="../run/api">API-driven run workflow</a> page, which includes both a full overview of this workflow and a walkthrough of a simple implementation of it.</p> </blockquote> <p>A configuration version (<code>configuration-version</code>) is a resource used to reference the uploaded configuration files. It is associated with the run to use the uploaded configuration files for performing the plan and apply.</p> <p>Listing and viewing configuration versions for a workspace requires permission to read runs; creating new configuration versions requires permission to queue plans. (<a href="../users-teams-organizations/permissions">More about permissions.</a>)</p> <h2 id="list-configuration-versions">  List Configuration Versions </h2> <p><code>GET /workspaces/:workspace_id/configuration-versions</code></p> <table>
<thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>:workspace_id</code></td> <td>The ID of the workspace to list configurations from. Obtain this from the <a href="../workspaces/settings">workspace settings</a> or the <a href="workspaces#show-workspace">Show Workspace</a> endpoint.</td> </tr> </tbody>
</table> <h3 id="query-parameters">  Query Parameters </h3> <p>This endpoint supports pagination <a href="index#query-parameters">with standard URL query parameters</a>; remember to percent-encode <code>[</code> as <code>%5B</code> and <code>]</code> as <code>%5D</code> if your tooling doesn't automatically encode URLs.</p> <table>
<thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>page[number]</code></td> <td>
<strong>Optional.</strong> If omitted, the endpoint will return the first page.</td> </tr> <tr> <td><code>page[size]</code></td> <td>
<strong>Optional.</strong> If omitted, the endpoint will return 20 configuration versions per page.</td> </tr> </tbody>
</table> <h3 id="sample-request">  Sample Request </h3> <pre data-language="shell">curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request GET \
  https://app.terraform.io/api/v2/workspaces/ws-2Qhk7LHgbMrm3grF/configuration-versions
</pre>
<h3 id="sample-response">  Sample Response </h3> <pre data-language="json">{
  "data": [
    {
      "id": "cv-ntv3HbhJqvFzamy7",
      "type": "configuration-versions",
      "attributes": {
        "error": null,
        "error-message": null,
        "source": "gitlab",
        "status": "uploaded",
        "status-timestamps": {}
      },
      "relationships": {
        "ingress-attributes": {
          "data": {
            "id": "ia-i4MrTxmQXYxH2nYD",
            "type": "ingress-attributes"
          },
          "links": {
            "related":
              "/api/v2/configuration-versions/cv-ntv3HbhJqvFzamy7/ingress-attributes"
          }
        }
      },
      "links": {
        "self": "/api/v2/configuration-versions/cv-ntv3HbhJqvFzamy7"
      }
    }
  ]
}
</pre>
<h2 id="show-a-configuration-version">  Show a Configuration Version </h2> <p><code>GET /configuration-versions/:configuration-id</code></p> <table>
<thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>:configuration-id</code></td> <td>The id of the configuration to show.</td> </tr> </tbody>
</table> <h3 id="sample-request-1">  Sample Request </h3> <pre data-language="shell">curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request GET \
  https://app.terraform.io/api/v2/configuration-versions/cv-ntv3HbhJqvFzamy7
</pre>
<h3 id="sample-response-1">  Sample Response </h3> <pre data-language="json">{
  "data": {
    "id": "cv-ntv3HbhJqvFzamy7",
    "type": "configuration-versions",
    "attributes": {
      "error": null,
      "error-message": null,
      "source": "gitlab",
      "status": "uploaded",
      "status-timestamps": {}
    },
    "relationships": {
      "ingress-attributes": {
        "data": {
          "id": "ia-i4MrTxmQXYxH2nYD",
          "type": "ingress-attributes"
        },
        "links": {
          "related":
            "/api/v2/configuration-versions/cv-ntv3HbhJqvFzamy7/ingress-attributes"
        }
      }
    },
    "links": {
      "self": "/api/v2/configuration-versions/cv-ntv3HbhJqvFzamy7"
    }
  }
}
</pre>
<h2 id="show-a-configuration-version-39-s-commit-information">  Show a Configuration Version's Commit Information </h2> <p>An ingress attributes resource (<code>ingress-attributes</code>) is used to reference commit information for configuration versions created in a workspace with a VCS repository.</p> <p><code>GET /configuration-versions/:configuration-id/ingress-attributes</code></p> <table>
<thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>:configuration-id</code></td> <td>The id of the configuration to show.</td> </tr> </tbody>
</table> <p>Ingress attributes can also be fetched as part of a query to a particular configuration version via <code>include</code>:</p> <p><code>GET /configuration-versions/:configuration-id?include=ingress-attributes</code></p> <table>
<thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>:configuration-id</code></td> <td>The id of the configuration to show.</td> </tr> </tbody>
</table>  <h3 id="sample-request-2">  Sample Request </h3> <pre data-language="shell">curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request GET \
  https://app.terraform.io/api/v2/configuration-versions/cv-TrHjxIzad9Ae9i8x/ingress-attributes
</pre>
<h3 id="sample-response-2">  Sample Response </h3> <pre data-language="json">{
  "data": {
    "id": "ia-zqHjxJzaB9Ae6i9t",
    "type": "ingress-attributes",
    "attributes": {
      "branch": "add-cool-stuff",
      "clone-url": "https://github.com/hashicorp/foobar.git",
      "commit-message": "Adding really cool infrastructure",
      "commit-sha": "1e1c1018d1bbc0b8517d072718e0d87c1a0eda95",
      "commit-url": "https://github.com/hashicorp/foobar/commit/1e1c1018d1bbc0b8517d072718e0d87c1a0eda95",
      "compare-url": "https://github.com/hashicorp/foobar/pull/163",
      "identifier": "hashicorp/foobar",
      "is-pull-request": true,
      "on-default-branch": false,
      "pull-request-number": 163,
      "pull-request-url": "https://github.com/hashicorp/foobar/pull/163",
      "pull-request-title": "Adding really cool infrastructure",
      "pull-request-body": "These are changes to add really cool stuff. We should absolutely merge this.",
      "tag": null,
      "sender-username": "chrisarcand",
      "sender-avatar-url": "https://avatars.githubusercontent.com/u/2430490?v=4",
      "sender-html-url": "https://github.com/chrisarcand"
    },
    "relationships": {
      "created-by": {
        "data": {
          "id": "user-PQk2Z3dfXAax18P6s",
          "type": "users"
        },
        "links": {
          "related": "/api/v2/ingress-attributes/ia-zqHjxJzaB9Ae6i9t/created-by"
        }
      }
    },
    "links": {
      "self": "/api/v2/ingress-attributes/ia-zqHjxJzaB9Ae6i9t"
    }
  }
}
</pre>
<h2 id="create-a-configuration-version">  Create a Configuration Version </h2> <p><code>POST /workspaces/:workspace_id/configuration-versions</code></p> <table>
<thead> <tr> <th>Parameter</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>:workspace_id</code></td> <td>The ID of the workspace to create the new configuration version in. Obtain this from the <a href="../workspaces/settings">workspace settings</a> or the <a href="workspaces#show-workspace">Show Workspace</a> endpoint.</td> </tr> </tbody>
</table> <blockquote class="alert alert-info" role="alert"> <p><strong>Note:</strong> This endpoint cannot be accessed with <a href="../users-teams-organizations/api-tokens#organization-api-tokens">organization tokens</a>. You must access it with a <a href="../users-teams-organizations/users#api-tokens">user token</a> or <a href="../users-teams-organizations/api-tokens#team-api-tokens">team token</a>.</p> </blockquote> <h3 id="request-body">  Request Body </h3> <p>This POST endpoint requires a JSON object with the following properties as a request payload.</p> <p>Properties without a default value are required.</p> <table>
<thead> <tr> <th>Key path</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>data.attributes.auto-queue-runs</code></td> <td>boolean</td> <td>true</td> <td>When true, runs are queued automatically when the configuration version is uploaded.</td> </tr> <tr> <td><code>data.attributes.speculative</code></td> <td>boolean</td> <td>false</td> <td>When true, this configuration version may only be used to create runs which are speculative, that is, can neither be confirmed nor applied.</td> </tr> </tbody>
</table> <h3 id="sample-payload">  Sample Payload </h3> <pre data-language="json">{
  "data": {
    "type": "configuration-versions",
    "attributes": {
      "auto-queue-runs": true
    }
  }
}
</pre>
<h3 id="sample-request-3">  Sample Request </h3> <pre data-language="shell">curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request POST \
  --data @payload.json \
  https://app.terraform.io/api/v2/workspaces/ws-2Qhk7LHgbMrm3grF/configuration-versions
</pre>
<h3 id="sample-response-3">  Sample Response </h3> <pre data-language="json">{
  "data": {
    "id": "cv-UYwHEakurukz85nW",
    "type": "configuration-versions",
    "attributes": {
      "auto-queue-runs": true,
      "error": null,
      "error-message": null,
      "source": "tfe-api",
      "status": "pending",
      "status-timestamps": {},
      "upload-url":
        "https://archivist.terraform.io/v1/object/9224c6b3-2e14-4cd7-adff-ed484d7294c2"
    },
    "relationships": {
      "ingress-attributes": {
        "data": null,
        "links": {
          "related":
            "/api/v2/configuration-versions/cv-UYwHEakurukz85nW/ingress-attributes"
        }
      }
    },
    "links": { "self": "/api/v2/configuration-versions/cv-UYwHEakurukz85nW" }
  }
}
</pre>
<h3 id="configuration-version-status">  Configuration Version Status </h3> <p>A configuration version will be in the <code>pending</code> status when initially created. It will remain pending until configuration files are supplied via <a href="#upload-configuration-files">upload</a>, and while they are processed.</p> <p>If upload and processing succeed, the configuration version status will then be <code>uploaded</code>. An <code>uploaded</code> configuration version is ready for use.</p> <p>If upload and processing fail, the status will be <code>errored</code>, indicating that something went wrong.</p> <p>Runs cannot be created using <code>pending</code> or <code>errored</code> configuration versions.</p> <h2 id="upload-configuration-files">  Upload Configuration Files </h2> <blockquote class="alert alert-info" role="alert"> <p><strong>Note</strong>: If <code>auto-queue-runs</code> was either not provided or set to <code>true</code> during creation of the configuration version, a run using this configuration version will be automatically queued on the workspace. If <code>auto-queue-runs</code> was set to <code>false</code> explicitly, then it is necessary to <a href="run#create-a-run">create a run on the workspace</a> manually after the configuration version is uploaded.</p> </blockquote> <p><code>PUT https://archivist.terraform.io/v1/object/&lt;UNIQUE OBJECT ID&gt;</code></p> <p><strong>The URL is provided in the <code>upload-url</code> attribute in the <code>configuration-versions</code> resource.</strong></p> <h3 id="sample-request-4">  Sample Request </h3> <p><strong>@filename is the name of configuration file you wish to upload.</strong></p> <pre data-language="shell">curl \
  --header "Content-Type: application/octet-stream" \
  --request PUT \
  --data-binary @filename \
  https://archivist.terraform.io/v1/object/4c44d964-eba7-4dd5-ad29-1ece7b99e8da
</pre>
<h2 id="available-related-resources">  Available Related Resources </h2> <p>The GET endpoints above can optionally return related resources, if requested with <a href="index#inclusion-of-related-resources">the <code>include</code> query parameter</a>. The following resource types are available:</p> <ul> <li>
<a href="#ingress_attributes"><code>ingress_attributes</code></a> - The commit information used in the configuration </li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://www.terraform.io/docs/cloud/api/configuration-versions.html" class="_attribution-link" target="_blank">https://www.terraform.io/docs/cloud/api/configuration-versions.html</a>
  </p>
</div>
