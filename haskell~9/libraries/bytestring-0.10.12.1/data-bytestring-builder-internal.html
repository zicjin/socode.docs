<h1 class="caption">Data.ByteString.Builder.Internal</h1>
<div class="_haskell-api">
<table class="info">
<tr>
<th valign="top">Copyright</th>
<td>(c) 2010 - 2011 Simon Meier</td>
</tr>
<tr>
<th>License</th>
<td>BSD3-style (see LICENSE)</td>
</tr>
<tr>
<th>Maintainer</th>
<td>Simon Meier &lt;iridcode@gmail.com&gt;</td>
</tr>
<tr>
<th>Stability</th>
<td>unstable, private</td>
</tr>
<tr>
<th>Portability</th>
<td>GHC</td>
</tr>
<tr>
<th>Safe Haskell</th>
<td>Unsafe</td>
</tr>
<tr>
<th>Language</th>
<td>Haskell98</td>
</tr>
</table>
<div id="table-of-contents"><div id="contents-list">
<h4 class="caption" onclick="window.scrollTo(0,0)">Contents</h4>
<ul>
<li><a href="#g:1">Buffer management</a></li>
<li><a href="#g:2">Build signals and steps</a></li>
<li>
<a href="#g:3">The Builder monoid</a><ul>
<li><a href="#g:4">Primitive combinators</a></li>
<li><a href="#g:5">Execution</a></li>
</ul>
</li>
<li>
<a href="#g:6">The Put monad</a><ul>
<li><a href="#g:7">Execution</a></li>
<li><a href="#g:8">Conversion to and from Builders</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="description">
<h4 class="caption">Description</h4>
<ul><li>Warning:* this module is internal. If you find that you need it then please contact the maintainers and explain what you are trying to do and discuss what you would need in the public API. It is important that you do this as the module may not be exposed at all in future releases.</li></ul>
<p>Core types and functions for the <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> monoid and its generalization, the <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> monad.</p>
<p>The design of the <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> monoid is optimized such that</p>
<ol>
<li>buffers of arbitrary size can be filled as efficiently as possible and</li>
<li>sequencing of <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s is as cheap as possible.</li>
</ol>
<p>We achieve (1) by completely handing over control over writing to the buffer to the <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> implementing the <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>. This <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> is just told the start and the end of the buffer (represented as a <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>). Then, the <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> can write to as big a prefix of this <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> in any way it desires. If the <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> is done, the <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> is full, or a long sequence of bytes should be inserted directly, then the <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> signals this to its caller using a <code><a href="data-bytestring-builder-internal#t:BuildSignal" title="Data.ByteString.Builder.Internal">BuildSignal</a></code>.</p>
<p>We achieve (2) by requiring that every <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> is implemented by a <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> that takes a continuation <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code>, which it calls with the updated <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> after it is done. Therefore, only two pointers have to be passed in a function call to implement concatenation of <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s. Moreover, many <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s are completely inlined, which enables the compiler to sequence them without a function call and with no boxing at all.</p>
<p>This design gives the implementation of a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> full access to the <code><a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a></code> monad. Therefore, utmost care has to be taken to not overwrite anything outside the given <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>s. Moreover, further care has to be taken to ensure that <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s and <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s are referentially transparent. See the comments of the <code><a href="data-bytestring-builder-internal#v:builder" title="Data.ByteString.Builder.Internal">builder</a></code> and <code><a href="data-bytestring-builder-internal#v:put" title="Data.ByteString.Builder.Internal">put</a></code> functions for further information. Note that there are <em>no safety belts</em> at all, when implementing a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> using an <code><a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a></code> action: you are writing code that might enable the next buffer-overflow attack on a Haskell server!</p>
</div>
<a href="#g:1" id="g:1"><h2>Buffer management</h2></a><p class="src">data <a id="t:Buffer" class="def">Buffer</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#Buffer" class="link">Source</a> </p>
<p>A <code><a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a></code> together with the <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> of free bytes. The filled space starts at offset 0 and ends at the first free byte.</p>
<div class="subs constructors">
<h4 class="caption">Constructors</h4>
<table><tr>
<td class="src">
<a id="v:Buffer" class="def">Buffer</a> !(<a href="../base-4.15.0.0/foreign-foreignptr-safe#t:ForeignPtr" title="Foreign.ForeignPtr.Safe">ForeignPtr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a>) !<a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a>
</td>
<td class="doc empty"> </td>
</tr></table>
</div>
<p class="src">data <a id="t:BufferRange" class="def">BufferRange</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#BufferRange" class="link">Source</a> </p>
<p>A range of bytes in a buffer represented by the pointer to the first byte of the range and the pointer to the first byte <em>after</em> the range.</p>
<div class="subs constructors">
<h4 class="caption">Constructors</h4>
<table><tr>
<td class="src">
<a id="v:BufferRange" class="def">BufferRange</a> !(<a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a>) !(<a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a>)</td>
<td class="doc empty"> </td>
</tr></table>
</div>
<p class="src"><a id="v:newBuffer" class="def">newBuffer</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> <a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#newBuffer" class="link">Source</a> </p>
<p>Allocate a new buffer of the given size.</p>
<p class="src"><a id="v:bufferSize" class="def">bufferSize</a> :: <a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a> -&gt; <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#bufferSize" class="link">Source</a> </p>
<p>Combined size of the filled and free space in the buffer.</p>
<p class="src"><a id="v:byteStringFromBuffer" class="def">byteStringFromBuffer</a> :: <a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a> -&gt; <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#byteStringFromBuffer" class="link">Source</a> </p>
<p>Convert the filled part of a <code><a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a></code> to a strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>.</p>
<p class="src">data <a id="t:ChunkIOStream" class="def">ChunkIOStream</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#ChunkIOStream" class="link">Source</a> </p>
<p>A stream of chunks that are constructed in the <code><a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a></code> monad.</p>
<p>This datatype serves as the common interface for the buffer-by-buffer execution of a <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> by <code><a href="data-bytestring-builder-internal#v:buildStepToCIOS" title="Data.ByteString.Builder.Internal">buildStepToCIOS</a></code>. Typical users of this interface are <code><a href="data-bytestring-builder-internal#v:ciosToLazyByteString" title="Data.ByteString.Builder.Internal">ciosToLazyByteString</a></code> or iteratee-style libraries like <code>enumerator</code>.</p>
<div class="subs constructors">
<h4 class="caption">Constructors</h4>
<table>
<tr>
<td class="src">
<a id="v:Finished" class="def">Finished</a> <a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a> a</td>
<td class="doc"><p>The partially filled last buffer together with the result.</p></td>
</tr>
<tr>
<td class="src">
<a id="v:Yield1" class="def">Yield1</a> <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> (<a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> (<a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a> a))</td>
<td class="doc"><p>Yield a <em>non-empty</em> strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>.</p></td>
</tr>
</table>
</div>
<p class="src"><a id="v:buildStepToCIOS" class="def">buildStepToCIOS</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#buildStepToCIOS" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a>
</td>
<td class="doc"><p>Buffer allocation strategy to use</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> to execute</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> (<a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a> a)</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Convert a <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> to a <code><a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a></code> stream by executing it on <code><a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a></code>s allocated according to the given <code><a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a></code>.</p>
<p class="src"><a id="v:ciosUnitToLazyByteString" class="def">ciosUnitToLazyByteString</a> :: <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a> -&gt; <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a> () -&gt; <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#ciosUnitToLazyByteString" class="link">Source</a> </p>
<p>Convert a <code><a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a> ()</code> to a lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> using <code><a href="../base-4.15.0.0/system-io-unsafe#v:unsafeDupablePerformIO" title="System.IO.Unsafe">unsafeDupablePerformIO</a></code>.</p>
<p class="src"><a id="v:ciosToLazyByteString" class="def">ciosToLazyByteString</a> :: <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a> -&gt; (a -&gt; (b, <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>)) -&gt; <a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a> a -&gt; (b, <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>) <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#ciosToLazyByteString" class="link">Source</a> </p>
<p>Convert a <code><a href="data-bytestring-builder-internal#t:ChunkIOStream" title="Data.ByteString.Builder.Internal">ChunkIOStream</a></code> to a lazy tuple of the result and the written <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> using <code><a href="../base-4.15.0.0/system-io-unsafe#v:unsafeDupablePerformIO" title="System.IO.Unsafe">unsafeDupablePerformIO</a></code>.</p>
<a href="#g:2" id="g:2"><h2>Build signals and steps</h2></a><p class="src">data <a id="t:BuildSignal" class="def">BuildSignal</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#BuildSignal" class="link">Source</a> </p>
<p><code><a href="data-bytestring-builder-internal#t:BuildSignal" title="Data.ByteString.Builder.Internal">BuildSignal</a></code>s abstract signals to the caller of a <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code>. There are three signals: <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code>, <code><a href="data-bytestring-builder-internal#v:bufferFull" title="Data.ByteString.Builder.Internal">bufferFull</a></code>, or 'insertChunks signals</p>
<p class="src">type <a id="t:BuildStep" class="def">BuildStep</a> a = <a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a> -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> (<a href="data-bytestring-builder-internal#t:BuildSignal" title="Data.ByteString.Builder.Internal">BuildSignal</a> a) <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#BuildStep" class="link">Source</a> </p>
<p><code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code>s may be called *multiple times* and they must not rise an async. exception.</p>
<p class="src"><a id="v:finalBuildStep" class="def">finalBuildStep</a> :: <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> () <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#finalBuildStep" class="link">Source</a> </p>
<p>The final build step that returns the <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code> signal.</p>
<p class="src"><a id="v:done" class="def">done</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#done" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a>
</td>
<td class="doc"><p>Next free byte in current <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code></p></td>
</tr>
<tr>
<td class="src">-&gt; a</td>
<td class="doc"><p>Computed value</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildSignal" title="Data.ByteString.Builder.Internal">BuildSignal</a> a</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Signal that the current <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> is done and has computed a value.</p>
<p class="src"><a id="v:bufferFull" class="def">bufferFull</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#bufferFull" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>
</td>
<td class="doc"><p>Minimal size of next <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a>
</td>
<td class="doc"><p>Next free byte in current <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> to run on the next <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>. This <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> may assume that it is called with a <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> of at least the required minimal size; i.e., the caller of this <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> must guarantee this.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildSignal" title="Data.ByteString.Builder.Internal">BuildSignal</a> a</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Signal that the current buffer is full.</p>
<p class="src"><a id="v:insertChunk" class="def">insertChunk</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#insertChunk" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a>
</td>
<td class="doc"><p>Next free byte in current <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code></p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a>
</td>
<td class="doc"><p>Chunk to insert.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> to run on next <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code></p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildSignal" title="Data.ByteString.Builder.Internal">BuildSignal</a> a</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Signal that a <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> chunk should be inserted directly.</p>
<p class="src"><a id="v:fillWithBuildStep" class="def">fillWithBuildStep</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#fillWithBuildStep" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc"><p>Build step to use for filling the <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>.</p></td>
</tr>
<tr>
<td class="src">-&gt; (<a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a> -&gt; a -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> b)</td>
<td class="doc"><p>Handling the <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code> signal</p></td>
</tr>
<tr>
<td class="src">-&gt; (<a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a> -&gt; <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> b)</td>
<td class="doc"><p>Handling the <code><a href="data-bytestring-builder-internal#v:bufferFull" title="Data.ByteString.Builder.Internal">bufferFull</a></code> signal</p></td>
</tr>
<tr>
<td class="src">-&gt; (<a href="../base-4.15.0.0/foreign-ptr#t:Ptr" title="Foreign.Ptr">Ptr</a> <a href="../base-4.15.0.0/data-word#t:Word8" title="Data.Word">Word8</a> -&gt; <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> b)</td>
<td class="doc"><p>Handling the <code><a href="data-bytestring-builder-internal#v:insertChunk" title="Data.ByteString.Builder.Internal">insertChunk</a></code> signal</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a>
</td>
<td class="doc"><p>Buffer range to fill.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> b</td>
<td class="doc"><p>Value computed while filling this <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>.</p></td>
</tr>
</table>
</div>
<p>Fill a <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> using a <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code>.</p>
<a href="#g:3" id="g:3"><h2>The Builder monoid</h2></a><p class="src">data <a id="t:Builder" class="def">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#Builder" class="link">Source</a> </p>
<p><code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s denote sequences of bytes. They are <code><a href="../base-4.15.0.0/data-monoid#t:Monoid" title="Data.Monoid">Monoid</a></code>s where <code><a href="../base-4.15.0.0/data-monoid#v:mempty" title="Data.Monoid">mempty</a></code> is the zero-length sequence and <code><a href="../base-4.15.0.0/data-monoid#v:mappend" title="Data.Monoid">mappend</a></code> is concatenation, which runs in <span class="complexity">O(1)</span>.</p>
<div class="subs instances">
<h5 class="instances details-toggle-control details-toggle" data-details-id="i:Builder">Instances</h5>
<details id="i:Builder" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table>
<tr>
<td class="src clearfix">
 <a href="../base-4.15.0.0/data-string#t:IsString" title="Data.String">IsString</a> <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> </td>
<td class="doc empty"> </td>
</tr>
<tr><td colspan="2"><details id="i:id:Builder:IsString:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="data-bytestring-builder">Data.ByteString.Builder</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:fromString">fromString</a> :: <a href="../base-4.15.0.0/data-string#t:String" title="Data.String">String</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/Data-String.html#fromString" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="../base-4.15.0.0/prelude#t:Semigroup" title="Prelude">Semigroup</a> <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> </td>
<td class="doc empty"> </td>
</tr>
<tr><td colspan="2"><details id="i:id:Builder:Semigroup:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="data-bytestring-builder-internal">Data.ByteString.Builder.Internal</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:-60--62-">(&lt;&gt;)</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%3C%3E" class="link">Source</a> </p>
<p class="src"><a href="#v:sconcat">sconcat</a> :: <a href="../base-4.15.0.0/data-list-nonempty#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#sconcat" class="link">Source</a> </p>
<p class="src"><a href="#v:stimes">stimes</a> :: <a href="../base-4.15.0.0/prelude#t:Integral" title="Prelude">Integral</a> b =&gt; b -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#stimes" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="../base-4.15.0.0/data-monoid#t:Monoid" title="Data.Monoid">Monoid</a> <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> </td>
<td class="doc empty"> </td>
</tr>
<tr><td colspan="2"><details id="i:id:Builder:Monoid:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="data-bytestring-builder-internal">Data.ByteString.Builder.Internal</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:mempty">mempty</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#mempty" class="link">Source</a> </p>
<p class="src"><a href="#v:mappend">mappend</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#mappend" class="link">Source</a> </p>
<p class="src"><a href="#v:mconcat">mconcat</a> :: [<a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a>] -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#mconcat" class="link">Source</a> </p>
</div></details></td></tr>
</table></details>
</div>
<p class="src"><a id="v:builder" class="def">builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#builder" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: (forall r. <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> r -&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> r)</td>
<td class="doc">
<p>A function that fills a <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>, calls the continuation with the updated <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> once its done, and signals its caller how to proceed using <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code>, <code><a href="data-bytestring-builder-internal#v:bufferFull" title="Data.ByteString.Builder.Internal">bufferFull</a></code>, or <code><a href="data-bytestring-builder-internal#v:insertChunk" title="Data.ByteString.Builder.Internal">insertChunk</a></code>.</p>
<p>This function must be referentially transparent; i.e., calling it multiple times with equally sized <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>s must result in the same sequence of bytes being written. If you need mutable state, then you must allocate it anew upon each call of this function. Moroever, this function must call the continuation once its done. Otherwise, concatenation of <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s does not work. Finally, this function must write to all bytes that it claims it has written. Otherwise, the resulting <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> is not guaranteed to be referentially transparent and sensitive data might leak.</p>
</td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a>
</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>. In contrast to <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code>s, <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s are referentially transparent.</p>
<p class="src"><a id="v:runBuilder" class="def">runBuilder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#runBuilder" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a>
</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> to run</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> ()</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> that writes the byte stream of this <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> and signals <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code> upon completion.</p></td>
</tr>
</table>
</div>
<p>Run a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> with the <code><a href="data-bytestring-builder-internal#v:finalBuildStep" title="Data.ByteString.Builder.Internal">finalBuildStep</a></code>.</p>
<p class="src"><a id="v:runBuilderWith" class="def">runBuilderWith</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#runBuilderWith" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a>
</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> to run</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc"><p>Continuation <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code></p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Run a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>.</p>
<a href="#g:4" id="g:4"><h3>Primitive combinators</h3></a><p class="src"><a id="v:empty" class="def">empty</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#empty" class="link">Source</a> </p>
<p>The <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> denoting a zero-length sequence of bytes. This function is only exported for use in rewriting rules. Use <code><a href="../base-4.15.0.0/data-monoid#v:mempty" title="Data.Monoid">mempty</a></code> otherwise.</p>
<p class="src"><a id="v:append" class="def">append</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#append" class="link">Source</a> </p>
<p>Concatenate two <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s. This function is only exported for use in rewriting rules. Use <code><a href="../base-4.15.0.0/data-monoid#v:mappend" title="Data.Monoid">mappend</a></code> otherwise.</p>
<p class="src"><a id="v:flush" class="def">flush</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#flush" class="link">Source</a> </p>
<p>Flush the current buffer. This introduces a chunk boundary.</p>
<p class="src"><a id="v:ensureFree" class="def">ensureFree</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#ensureFree" class="link">Source</a> </p>
<p><code><a href="data-bytestring-builder-internal#v:ensureFree" title="Data.ByteString.Builder.Internal">ensureFree</a> n</code> ensures that there are at least <code>n</code> free bytes for the following <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>.</p>
<p class="src"><a id="v:byteStringCopy" class="def">byteStringCopy</a> :: <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#byteStringCopy" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that copies the strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>.</p>
<p>Use this function to create <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s from smallish (<code>&lt;= 4kb</code>) <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>s or if you need to guarantee that the <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> is not shared with the chunks generated by the <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>.</p>
<p class="src"><a id="v:byteStringInsert" class="def">byteStringInsert</a> :: <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#byteStringInsert" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that always inserts the strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> directly as a chunk.</p>
<p>This implies flushing the output buffer, even if it contains just a single byte. You should therefore use <code><a href="data-bytestring-builder-internal#v:byteStringInsert" title="Data.ByteString.Builder.Internal">byteStringInsert</a></code> only for large (<code>&gt; 8kb</code>) <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>s. Otherwise, the generated chunks are too fragmented to be processed efficiently afterwards.</p>
<p class="src"><a id="v:byteStringThreshold" class="def">byteStringThreshold</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#byteStringThreshold" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that copies the strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>s, if it is smaller than the treshold, and inserts it directly otherwise.</p>
<p>For example, <code>byteStringThreshold 1024</code> copies strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>s whose size is less or equal to 1kb, and inserts them directly otherwise. This implies that the average chunk-size of the generated lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> may be as low as 513 bytes, as there could always be just a single byte between the directly inserted 1025 byte, strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>s.</p>
<p class="src"><a id="v:lazyByteStringCopy" class="def">lazyByteStringCopy</a> :: <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#lazyByteStringCopy" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that copies the lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>.</p>
<p class="src"><a id="v:lazyByteStringInsert" class="def">lazyByteStringInsert</a> :: <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#lazyByteStringInsert" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that inserts all chunks of the lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> directly.</p>
<p class="src"><a id="v:lazyByteStringThreshold" class="def">lazyByteStringThreshold</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#lazyByteStringThreshold" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that uses the thresholding strategy of <code><a href="data-bytestring-builder-internal#v:byteStringThreshold" title="Data.ByteString.Builder.Internal">byteStringThreshold</a></code> for each chunk of the lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>.</p>
<p class="src"><a id="v:shortByteString" class="def">shortByteString</a> :: <a href="data-bytestring-short#t:ShortByteString" title="Data.ByteString.Short">ShortByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#shortByteString" class="link">Source</a> </p>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> that copies the <code><a href="sh#v:ShortByteString" title="SH">ShortByteString</a></code>.</p>
<p class="src"><a id="v:maximalCopySize" class="def">maximalCopySize</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#maximalCopySize" class="link">Source</a> </p>
<p>The maximal size of a <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> that is copied. <code>2 * <a href="data-bytestring-builder-internal#v:smallChunkSize" title="Data.ByteString.Builder.Internal">smallChunkSize</a></code> to guarantee that on average a chunk is of <code><a href="data-bytestring-builder-internal#v:smallChunkSize" title="Data.ByteString.Builder.Internal">smallChunkSize</a></code>.</p>
<p class="src"><a id="v:byteString" class="def">byteString</a> :: <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#byteString" class="link">Source</a> </p>
<p>Create a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> denoting the same sequence of bytes as a strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>. The <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> inserts large <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code>s directly, but copies small ones to ensure that the generated chunks are large on average.</p>
<p class="src"><a id="v:lazyByteString" class="def">lazyByteString</a> :: <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a> -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#lazyByteString" class="link">Source</a> </p>
<p>Create a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> denoting the same sequence of bytes as a lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>. The <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> inserts large chunks of the lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> directly, but copies small ones to ensure that the generated chunks are large on average.</p>
<a href="#g:5" id="g:5"><h3>Execution</h3></a><p class="src"><a id="v:toLazyByteStringWith" class="def">toLazyByteStringWith</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#toLazyByteStringWith" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a>
</td>
<td class="doc"><p>Buffer allocation strategy to use</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>
</td>
<td class="doc"><p>Lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> to use as the tail of the generated lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code></p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a>
</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> to execute</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>
</td>
<td class="doc"><p>Resulting lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code></p></td>
</tr>
</table>
</div>
<p><em>Heavy inlining.</em> Execute a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> with custom execution parameters.</p>
<p>This function is inlined despite its heavy code-size to allow fusing with the allocation strategy. For example, the default <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> execution function <code><a href="data-bytestring-builder#v:toLazyByteString" title="Data.ByteString.Builder">toLazyByteString</a></code> is defined as follows.</p>
<pre>{-# NOINLINE toLazyByteString #-}
toLazyByteString =
  toLazyByteStringWith (<a href="data-bytestring-builder-internal#v:safeStrategy" title="Data.ByteString.Builder.Internal">safeStrategy</a> <a href="data-bytestring-builder-internal#v:smallChunkSize" title="Data.ByteString.Builder.Internal">smallChunkSize</a> <a href="data-bytestring-builder-internal#v:defaultChunkSize" title="Data.ByteString.Builder.Internal">defaultChunkSize</a>) L.empty
</pre>
<p>where <code>L.empty</code> is the zero-length lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>.</p>
<p>In most cases, the parameters used by <code><a href="data-bytestring-builder#v:toLazyByteString" title="Data.ByteString.Builder">toLazyByteString</a></code> give good performance. A sub-performing case of <code><a href="data-bytestring-builder#v:toLazyByteString" title="Data.ByteString.Builder">toLazyByteString</a></code> is executing short (&lt;128 bytes) <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s. In this case, the allocation overhead for the first 4kb buffer and the trimming cost dominate the cost of executing the <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>. You can avoid this problem using</p>
<pre>toLazyByteStringWith (safeStrategy 128 smallChunkSize) L.empty</pre>
<p>This reduces the allocation and trimming overhead, as all generated <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>s fit into the first buffer and there is no trimming required, if more than 64 bytes and less than 128 bytes are written.</p>
<p class="src">data <a id="t:AllocationStrategy" class="def">AllocationStrategy</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#AllocationStrategy" class="link">Source</a> </p>
<p>A buffer allocation strategy for executing <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s.</p>
<p class="src"><a id="v:safeStrategy" class="def">safeStrategy</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#safeStrategy" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>
</td>
<td class="doc"><p>Size of first buffer</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>
</td>
<td class="doc"><p>Size of successive buffers</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a>
</td>
<td class="doc"><p>An allocation strategy that guarantees that at least half of the allocated memory is used for live data</p></td>
</tr>
</table>
</div>
<p>Use this strategy for generating lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>s whose chunks are likely to survive one garbage collection. This strategy trims buffers that are filled less than half in order to avoid spilling too much memory.</p>
<p class="src"><a id="v:untrimmedStrategy" class="def">untrimmedStrategy</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#untrimmedStrategy" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>
</td>
<td class="doc"><p>Size of the first buffer</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>
</td>
<td class="doc"><p>Size of successive buffers</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a>
</td>
<td class="doc"><p>An allocation strategy that does not trim any of the filled buffers before converting it to a chunk</p></td>
</tr>
</table>
</div>
<p>Use this strategy for generating lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>s whose chunks are discarded right after they are generated. For example, if you just generate them to write them to a network socket.</p>
<p class="src"><a id="v:customStrategy" class="def">customStrategy</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#customStrategy" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: (<a href="../base-4.15.0.0/data-maybe#t:Maybe" title="Data.Maybe">Maybe</a> (<a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a>, <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>) -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> <a href="data-bytestring-builder-internal#t:Buffer" title="Data.ByteString.Builder.Internal">Buffer</a>)</td>
<td class="doc"><p>Buffer allocation function. If <code><a href="../base-4.15.0.0/data-maybe#v:Nothing" title="Data.Maybe">Nothing</a></code> is given, then a new first buffer should be allocated. If <code><a href="../base-4.15.0.0/data-maybe#v:Just" title="Data.Maybe">Just</a> (oldBuf, minSize)</code> is given, then a buffer with minimal size <code>minSize</code> must be returned. The strategy may reuse the <code>oldBuf</code>, if it can guarantee that this referentially transparent and <code>oldBuf</code> is large enough.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a>
</td>
<td class="doc"><p>Default buffer size.</p></td>
</tr>
<tr>
<td class="src">-&gt; (<a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.15.0.0/data-bool#t:Bool" title="Data.Bool">Bool</a>)</td>
<td class="doc"><p>A predicate <code>trim used allocated</code> returning <code><a href="../base-4.15.0.0/data-bool#v:True" title="Data.Bool">True</a></code>, if the buffer should be trimmed before it is returned.</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a>
</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Create a custom allocation strategy. See the code for <code><a href="data-bytestring-builder-internal#v:safeStrategy" title="Data.ByteString.Builder.Internal">safeStrategy</a></code> and <code><a href="data-bytestring-builder-internal#v:untrimmedStrategy" title="Data.ByteString.Builder.Internal">untrimmedStrategy</a></code> for examples.</p>
<p class="src"><a id="v:smallChunkSize" class="def">smallChunkSize</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Lazy-Internal.html#smallChunkSize" class="link">Source</a> </p>
<p>The recommended chunk size. Currently set to 4k, less the memory management overhead</p>
<p class="src"><a id="v:defaultChunkSize" class="def">defaultChunkSize</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Lazy-Internal.html#defaultChunkSize" class="link">Source</a> </p>
<p>The chunk size used for I/O. Currently set to 32k, less the memory management overhead</p>
<p class="src"><a id="v:chunkOverhead" class="def">chunkOverhead</a> :: <a href="../base-4.15.0.0/data-int#t:Int" title="Data.Int">Int</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Lazy-Internal.html#chunkOverhead" class="link">Source</a> </p>
<p>The memory management overhead. Currently this is tuned for GHC only.</p>
<a href="#g:6" id="g:6"><h2>The Put monad</h2></a><p class="src">data <a id="t:Put" class="def">Put</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#Put" class="link">Source</a> </p>
<p>A <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> action denotes a computation of a value that writes a stream of bytes as a side-effect. <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s are strict in their side-effect; i.e., the stream of bytes will always be written before the computed value is returned.</p>
<p><code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s are a generalization of <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s. The typical use case is the implementation of an encoding that might fail (e.g., an interface to the <a href="https://hackage.haskell.org/package/zlib">zlib</a> compression library or the conversion from Base64 encoded data to 8-bit data). For a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>, the only way to handle and report such a failure is ignore it or call <code><a href="../base-4.15.0.0/prelude#v:error" title="Prelude">error</a></code>. In contrast, <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> actions are expressive enough to allow reportng and handling such a failure in a pure fashion.</p>
<p><code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> ()</code> actions are isomorphic to <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s. The functions <code><a href="data-bytestring-builder-internal#v:putBuilder" title="Data.ByteString.Builder.Internal">putBuilder</a></code> and <code><a href="data-bytestring-builder-internal#v:fromPut" title="Data.ByteString.Builder.Internal">fromPut</a></code> convert between these two types. Where possible, you should use <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>s, as sequencing them is slightly cheaper than sequencing <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s because they do not carry around a computed value.</p>
<div class="subs instances">
<h5 class="instances details-toggle-control details-toggle" data-details-id="i:Put">Instances</h5>
<details id="i:Put" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table>
<tr>
<td class="src clearfix">
 <a href="../base-4.15.0.0/control-monad#t:Monad" title="Control.Monad">Monad</a> <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> </td>
<td class="doc empty"> </td>
</tr>
<tr><td colspan="2"><details id="i:id:Put:Monad:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="data-bytestring-builder-internal">Data.ByteString.Builder.Internal</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:-62--62--61-">(&gt;&gt;=)</a> :: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; (a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b) -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%3E%3E%3D" class="link">Source</a> </p>
<p class="src"><a href="#v:-62--62-">(&gt;&gt;)</a> :: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%3E%3E" class="link">Source</a> </p>
<p class="src"><a href="#v:return">return</a> :: a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#return" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="../base-4.15.0.0/data-functor#t:Functor" title="Data.Functor">Functor</a> <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> </td>
<td class="doc empty"> </td>
</tr>
<tr><td colspan="2"><details id="i:id:Put:Functor:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="data-bytestring-builder-internal">Data.ByteString.Builder.Internal</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#fmap" class="link">Source</a> </p>
<p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%3C%24" class="link">Source</a> </p>
</div></details></td></tr>
<tr>
<td class="src clearfix">
 <a href="../base-4.15.0.0/control-applicative#t:Applicative" title="Control.Applicative">Applicative</a> <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> </td>
<td class="doc empty"> </td>
</tr>
<tr><td colspan="2"><details id="i:id:Put:Applicative:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="data-bytestring-builder-internal">Data.ByteString.Builder.Internal</a></p> <div class="subs methods">
<h4 class="caption">Methods</h4>
<p class="src"><a href="#v:pure">pure</a> :: a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#pure" class="link">Source</a> </p>
<p class="src"><a href="#v:-60--42--62-">(&lt;*&gt;)</a> :: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> (a -&gt; b) -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%3C%2A%3E" class="link">Source</a> </p>
<p class="src"><a href="#v:liftA2">liftA2</a> :: (a -&gt; b -&gt; c) -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> c <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#liftA2" class="link">Source</a> </p>
<p class="src"><a href="#v:-42--62-">(*&gt;)</a> :: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%2A%3E" class="link">Source</a> </p>
<p class="src"><a href="#v:-60--42-">(&lt;*)</a> :: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> b -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/base-4.15.0.0/src/GHC-Base.html#%3C%2A" class="link">Source</a> </p>
</div></details></td></tr>
</table></details>
</div>
<p class="src"><a id="v:put" class="def">put</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#put" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: (forall r. (a -&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> r) -&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> r)</td>
<td class="doc">
<p>A function that fills a <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>, calls the continuation with the updated <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code> and its computed value once its done, and signals its caller how to proceed using <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code>, <code><a href="data-bytestring-builder-internal#v:bufferFull" title="Data.ByteString.Builder.Internal">bufferFull</a></code>, or <code><a href="data-bytestring-builder-internal#v:insertChunk" title="Data.ByteString.Builder.Internal">insertChunk</a></code> signals.</p>
<p>This function must be referentially transparent; i.e., calling it multiple times with equally sized <code><a href="data-bytestring-builder-internal#t:BufferRange" title="Data.ByteString.Builder.Internal">BufferRange</a></code>s must result in the same sequence of bytes being written and the same value being computed. If you need mutable state, then you must allocate it anew upon each call of this function. Moroever, this function must call the continuation once its done. Otherwise, monadic sequencing of <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s does not work. Finally, this function must write to all bytes that it claims it has written. Otherwise, the resulting <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> is not guaranteed to be referentially transparent and sensitive data might leak.</p>
</td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a</td>
<td class="doc empty"> </td>
</tr>
</table>
</div>
<p>Construct a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> action. In contrast to <code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code>s, <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s are referentially transparent in the sense that sequencing the same <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> multiple times yields every time the same value with the same side-effect.</p>
<p class="src"><a id="v:runPut" class="def">runPut</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#runPut" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a</td>
<td class="doc"><p>Put to run</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a> a</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:BuildStep" title="Data.ByteString.Builder.Internal">BuildStep</a></code> that first writes the byte stream of this <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> and then yields the computed value using the <code><a href="data-bytestring-builder-internal#v:done" title="Data.ByteString.Builder.Internal">done</a></code> signal.</p></td>
</tr>
</table>
</div>
<p>Run a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>.</p>
<a href="#g:7" id="g:7"><h3>Execution</h3></a><p class="src"><a id="v:putToLazyByteString" class="def">putToLazyByteString</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#putToLazyByteString" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> to execute</p></td>
</tr>
<tr>
<td class="src">-&gt; (a, <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>)</td>
<td class="doc"><p>Result and lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code> written as its side-effect</p></td>
</tr>
</table>
</div>
<p>Execute a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> and return the computed result and the bytes written during the computation as a lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code>.</p>
<p>This function is strict in the computed result and lazy in the writing of the bytes. For example, given</p>
<pre>infinitePut = sequence_ (repeat (putBuilder (word8 1))) &gt;&gt; return 0
 </pre>
<p>evaluating the expression</p>
<pre>fst $ putToLazyByteString infinitePut
 </pre>
<p>does not terminate, while evaluating the expression</p>
<pre>L.head $ snd $ putToLazyByteString infinitePut
 </pre>
<p>does terminate and yields the value <code>1 :: Word8</code>.</p>
<p>An illustrative example for these strictness properties is the implementation of Base64 decoding (<a href="http://en.wikipedia.org/wiki/Base64">http://en.wikipedia.org/wiki/Base64</a>).</p>
<pre>type DecodingState = ...

decodeBase64 :: <a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a> -&gt; DecodingState -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> (Maybe DecodingState)
decodeBase64 = ...
 </pre>
<p>The above function takes a strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> supposed to represent Base64 encoded data and the current decoding state. It writes the decoded bytes as the side-effect of the <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> and returns the new decoding state, if the decoding of all data in the <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> was successful. The checking if the strict <code><a href="data-bytestring#t:ByteString" title="Data.ByteString">ByteString</a></code> represents Base64 encoded data and the actual decoding are fused. This makes the common case, where all data represents Base64 encoded data, more efficient. It also implies that all data must be decoded before the final decoding state can be returned. <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code>s are intended for implementing such fused checking and decoding/encoding, which is reflected in their strictness properties.</p>
<p class="src"><a id="v:putToLazyByteStringWith" class="def">putToLazyByteStringWith</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#putToLazyByteStringWith" class="link">Source</a> </p>
<div class="subs arguments">
<h4 class="caption">Arguments</h4>
<table>
<tr>
<td class="src">:: <a href="data-bytestring-builder-internal#t:AllocationStrategy" title="Data.ByteString.Builder.Internal">AllocationStrategy</a>
</td>
<td class="doc"><p>Buffer allocation strategy to use</p></td>
</tr>
<tr>
<td class="src">-&gt; (a -&gt; (b, <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>))</td>
<td class="doc"><p>Continuation to use for computing the final result and the tail of its side-effect (the written bytes).</p></td>
</tr>
<tr>
<td class="src">-&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a</td>
<td class="doc"><p><code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> to execute</p></td>
</tr>
<tr>
<td class="src">-&gt; (b, <a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a>)</td>
<td class="doc"><p>Resulting lazy <code><a href="data-bytestring-lazy#t:ByteString" title="Data.ByteString.Lazy">ByteString</a></code></p></td>
</tr>
</table>
</div>
<p>Execute a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> with a buffer-allocation strategy and a continuation. For example, <code><a href="data-bytestring-builder-internal#v:putToLazyByteString" title="Data.ByteString.Builder.Internal">putToLazyByteString</a></code> is implemented as follows.</p>
<pre>putToLazyByteString = <a href="data-bytestring-builder-internal#v:putToLazyByteStringWith" title="Data.ByteString.Builder.Internal">putToLazyByteStringWith</a>
    (<a href="data-bytestring-builder-internal#v:safeStrategy" title="Data.ByteString.Builder.Internal">safeStrategy</a> <a href="data-bytestring-builder-internal#v:smallChunkSize" title="Data.ByteString.Builder.Internal">smallChunkSize</a> <a href="data-bytestring-builder-internal#v:defaultChunkSize" title="Data.ByteString.Builder.Internal">defaultChunkSize</a>) (x -&gt; (x, L.empty))
 </pre>
<p class="src"><a id="v:hPut" class="def">hPut</a> :: forall a. <a href="../base-4.15.0.0/ghc-io-handle#t:Handle" title="GHC.IO.Handle">Handle</a> -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> a -&gt; <a href="../base-4.15.0.0/system-io#t:IO" title="System.IO">IO</a> a <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#hPut" class="link">Source</a> </p>
<p>Run a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> action redirecting the produced output to a <code><a href="../base-4.15.0.0/ghc-io-handle#t:Handle" title="GHC.IO.Handle">Handle</a></code>.</p>
<p>The output is buffered using the <code><a href="../base-4.15.0.0/ghc-io-handle#t:Handle" title="GHC.IO.Handle">Handle</a></code>s associated buffer. If this buffer is too small to execute one step of the <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a></code> action, then it is replaced with a large enough buffer.</p>
<a href="#g:8" id="g:8"><h3>Conversion to and from Builders</h3></a><p class="src"><a id="v:putBuilder" class="def">putBuilder</a> :: <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> -&gt; <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> () <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#putBuilder" class="link">Source</a> </p>
<p>Run a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code> as a side-effect of a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> ()</code> action.</p>
<p class="src"><a id="v:fromPut" class="def">fromPut</a> :: <a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> () -&gt; <a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a> <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/src/Data-ByteString-Builder-Internal.html#fromPut" class="link">Source</a> </p>
<p>Convert a <code><a href="data-bytestring-builder-internal#t:Put" title="Data.ByteString.Builder.Internal">Put</a> ()</code> action to a <code><a href="data-bytestring-builder-internal#t:Builder" title="Data.ByteString.Builder.Internal">Builder</a></code>.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/Data-ByteString-Builder-Internal.html" class="_attribution-link" target="_blank">https://downloads.haskell.org/~ghc/9.0.1/docs/html/libraries/bytestring-0.10.12.1/Data-ByteString-Builder-Internal.html</a>
  </p>
</div>
